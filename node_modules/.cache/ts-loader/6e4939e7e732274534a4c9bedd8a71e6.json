{"remainingRequest":"/home/mobiotics/Projects/hancom/FormcontrolLatest/node_modules/babel-loader/lib/index.js!/home/mobiotics/Projects/hancom/FormcontrolLatest/node_modules/ts-loader/index.js??ref--14-2!/home/mobiotics/Projects/hancom/FormcontrolLatest/node_modules/cache-loader/dist/cjs.js??ref--0-0!/home/mobiotics/Projects/hancom/FormcontrolLatest/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/mobiotics/Projects/hancom/FormcontrolLatest/src/FormDesigner/components/atoms/FDContextMenu/index.vue?vue&type=script&lang=ts&","dependencies":[{"path":"/home/mobiotics/Projects/hancom/FormcontrolLatest/src/FormDesigner/components/atoms/FDContextMenu/index.vue","mtime":1611419998000},{"path":"/home/mobiotics/Projects/hancom/FormcontrolLatest/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/mobiotics/Projects/hancom/FormcontrolLatest/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/home/mobiotics/Projects/hancom/FormcontrolLatest/node_modules/ts-loader/index.js","mtime":499162500000},{"path":"/home/mobiotics/Projects/hancom/FormcontrolLatest/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/mobiotics/Projects/hancom/FormcontrolLatest/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IHsgX19kZWNvcmF0ZSB9IGZyb20gInRzbGliIjsKaW1wb3J0IHsgQ29tcG9uZW50LCBQcm9wLCBFbWl0IH0gZnJvbSAndnVlLXByb3BlcnR5LWRlY29yYXRvcic7CmltcG9ydCBGRFNWR0ltYWdlIGZyb20gJ0AvRm9ybURlc2lnbmVyL2NvbXBvbmVudHMvYXRvbXMvRkRTVkdJbWFnZS9pbmRleC52dWUnOwppbXBvcnQgeyBDb250cm9sUHJvcGVydHlEYXRhIH0gZnJvbSAnQC9Gb3JtRGVzaWduZXIvbW9kZWxzL0NvbnRyb2xzVGFibGVQcm9wZXJ0aWVzL0NvbnRyb2xQcm9wZXJ0eURhdGEudHMnOwppbXBvcnQgeyBBY3Rpb24sIFN0YXRlIH0gZnJvbSAndnVleC1jbGFzcyc7CmltcG9ydCB7IEV2ZW50QnVzIH0gZnJvbSAnQC9Gb3JtRGVzaWduZXIvZXZlbnQtYnVzJzsKaW1wb3J0IEZEQ29tbW9uTWV0aG9kIGZyb20gJ0AvYXBpL2Fic3RyYWN0L0Zvcm1EZXNpZ25lci9GRENvbW1vbk1ldGhvZCc7CmxldCBDb250ZXh0TWVudSA9IGNsYXNzIENvbnRleHRNZW51IGV4dGVuZHMgRkRDb21tb25NZXRob2QgewogIGNvbnRyb2xBY3Rpb24oZXZlbnQsIGNvbnRyb2xBY3Rpb25OYW1lLCBzdWJWYWwpIHsKICAgIGlmICh0aGlzLnRleHRNZW51ID09PSBmYWxzZSkgewogICAgICBpZiAoY29udHJvbEFjdGlvbk5hbWUgPT09ICdJRF9DT1BZJykgewogICAgICAgIHRoaXMuY29weUNvbnRyb2woJ2NvcHknKTsKICAgICAgfSBlbHNlIGlmIChjb250cm9sQWN0aW9uTmFtZSA9PT0gJ0lEX0RFTEVURScpIHsKICAgICAgICB0aGlzLmNsaWNrRGVsZXRlKCk7CiAgICAgIH0gZWxzZSBpZiAoY29udHJvbEFjdGlvbk5hbWUgPT09ICdJRF9QQVNURScpIHsKICAgICAgICB0aGlzLnBhc3RlQ29udHJvbCgpOwogICAgICB9IGVsc2UgaWYgKGNvbnRyb2xBY3Rpb25OYW1lID09PSAnSURfQ1VUJykgewogICAgICAgIHRoaXMuY3V0Q29udHJvbCgpOwogICAgICB9IGVsc2UgaWYgKGNvbnRyb2xBY3Rpb25OYW1lID09PSAnSURfU0VMRUNUQUxMJykgewogICAgICAgIHRoaXMuc2VsZWN0QWxsKCk7CiAgICAgIH0gZWxzZSBpZiAoY29udHJvbEFjdGlvbk5hbWUgPT09ICdJRF9HUk9VUCcpIHsKICAgICAgICB0aGlzLmdyb3VwQ29udHJvbCgpOwogICAgICB9IGVsc2UgaWYgKGNvbnRyb2xBY3Rpb25OYW1lID09PSAnSURfVU5HUk9VUCcpIHsKICAgICAgICB0aGlzLnVuR3JvdXBDb250cm9sKCk7CiAgICAgIH0gZWxzZSBpZiAoY29udHJvbEFjdGlvbk5hbWUgPT09ICdJRF9ORVdQQUdFJykgewogICAgICAgIHRoaXMuYWRkTmV3UGFnZSgpOwogICAgICB9IGVsc2UgaWYgKGNvbnRyb2xBY3Rpb25OYW1lID09PSAnSURfREVMRVRFUEFHRScpIHsKICAgICAgICB0aGlzLmRlbGV0ZUN1cnJlbnRQYWdlKCk7CiAgICAgIH0gZWxzZSBpZiAoY29udHJvbEFjdGlvbk5hbWUgPT09ICdJRF9DT05UUk9MRk9SV0FSRCcpIHsKICAgICAgICB0aGlzLmJyaW5nRm9yd2FyZCgpOwogICAgICB9IGVsc2UgaWYgKGNvbnRyb2xBY3Rpb25OYW1lID09PSAnSURfQ09OVFJPTEJBQ0tXQVJEJykgewogICAgICAgIHRoaXMuYnJpbmdCYWNrd2FyZCgpOwogICAgICB9IGVsc2UgaWYgKGNvbnRyb2xBY3Rpb25OYW1lID09PSAnSURfT0JKRUNUUFJPUCcpIHsKICAgICAgICB0aGlzLmRpc3BsYXlQcm9wKCk7CiAgICAgIH0gZWxzZSBpZiAoY29udHJvbEFjdGlvbk5hbWUgPT09ICdJRF9SRU5BTUUnKSB7CiAgICAgICAgY29uc3Qgc2VsZWN0ZWRQYWdlSUQgPSB0aGlzLnNlbGVjdGVkQ29udHJvbHNbdGhpcy51c2VyRm9ybUlkXS5zZWxlY3RlZFswXTsKICAgICAgICBFdmVudEJ1cy4kZW1pdCgncmVuYW1lUGFnZScsIHRoaXMudXNlckZvcm1JZCwgc2VsZWN0ZWRQYWdlSUQsIHRoaXMuc2VsZWN0ZWRUYWIsIHRoaXMudXNlcmZvcm1EYXRhW3RoaXMudXNlckZvcm1JZF1bc2VsZWN0ZWRQYWdlSURdLnR5cGUpOwogICAgICB9IGVsc2UgaWYgKGNvbnRyb2xBY3Rpb25OYW1lID09PSAnSURfTU9WRScpIHsKICAgICAgICBjb25zdCB0eXBlID0gdGhpcy51c2VyZm9ybURhdGFbdGhpcy51c2VyRm9ybUlkXVt0aGlzLmNvbnRyb2xJZF0udHlwZTsKCiAgICAgICAgaWYgKHR5cGUgPT09ICdNdWx0aVBhZ2UnKSB7CiAgICAgICAgICBFdmVudEJ1cy4kZW1pdCgndXNlckZvcm1UYWJPcmRlcicsIHRoaXMudXNlckZvcm1JZCwgdGhpcy5jb250cm9sSWQsIHR5cGUpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBFdmVudEJ1cy4kZW1pdCgndGFiU3RyaXBUYWJPcmRlcicsIHRoaXMudXNlckZvcm1JZCwgdGhpcy5jb250cm9sSWQsIHR5cGUpOwogICAgICAgIH0KICAgICAgfSBlbHNlIGlmIChjb250cm9sQWN0aW9uTmFtZSA9PT0gJ0lEX1RBQk9SREVSJykgewogICAgICAgIEV2ZW50QnVzLiRlbWl0KCd1c2VyRm9ybVRhYk9yZGVyJywgdGhpcy51c2VyRm9ybUlkLCB0aGlzLmNvbnRhaW5lcklkLCAnJyk7CiAgICAgIH0gZWxzZSBpZiAoY29udHJvbEFjdGlvbk5hbWUgPT09ICdJRF9BTElHTicgfHwgY29udHJvbEFjdGlvbk5hbWUgPT09ICdJRF9NQUtFU0FNRVNJWkUnKSB7CiAgICAgICAgdGhpcy5jb250cm9sQWxpZ25NZW50KHN1YlZhbCk7CiAgICAgIH0KICAgIH0gZWxzZSB7CiAgICAgIGlmIChjb250cm9sQWN0aW9uTmFtZSA9PT0gJ0lEX0NPUFknKSB7CiAgICAgICAgdGhpcy5jb3B5VGV4dCgpOwogICAgICB9IGVsc2UgaWYgKGNvbnRyb2xBY3Rpb25OYW1lID09PSAnSURfREVMRVRFJykgewogICAgICAgIHRoaXMuZGVsZXRlVGV4dCgpOwogICAgICB9IGVsc2UgaWYgKGNvbnRyb2xBY3Rpb25OYW1lID09PSAnSURfUEFTVEUnKSB7CiAgICAgICAgaWYgKGV2ZW50IGluc3RhbmNlb2YgTW91c2VFdmVudCkgewogICAgICAgICAgdGhpcy5wYXN0ZVRleHQoZXZlbnQpOwogICAgICAgIH0KICAgICAgfSBlbHNlIGlmIChjb250cm9sQWN0aW9uTmFtZSA9PT0gJ0lEX0NVVCcpIHsKICAgICAgICB0aGlzLmN1dFRleHQoKTsKICAgICAgfSBlbHNlIGlmIChjb250cm9sQWN0aW9uTmFtZSA9PT0gJ0lEX09CSkVDVFBST1AnKSB7CiAgICAgICAgdGhpcy5kaXNwbGF5UHJvcCgpOwogICAgICB9CiAgICB9CgogICAgdGhpcy5jbG9zZU1lbnUoKTsKICB9CgogIGN1dFRleHQoKSB7CiAgICBkb2N1bWVudC5leGVjQ29tbWFuZCgnY3V0Jyk7CiAgfQoKICBkZWxldGVUZXh0KCkgewogICAgZG9jdW1lbnQuZXhlY0NvbW1hbmQoJ2RlbGV0ZScpOwogIH0KCiAgY29weVRleHQoKSB7CiAgICBkb2N1bWVudC5leGVjQ29tbWFuZCgnY29weScpOwogIH0KCiAgcGFzdGVUZXh0KGV2ZW50KSB7CiAgICBjb25zdCBjb250cm9sVHlwZSA9IHRoaXMudXNlcmZvcm1EYXRhW3RoaXMudXNlckZvcm1JZF1bdGhpcy5jb250cm9sSWRdLnR5cGU7CiAgICBjb25zdCBwb3NpdGlvbiA9IHRoaXMuZ2V0Q3Vyc29yUG9zKGV2ZW50KTsKICAgIGNvbnN0IGxlbmd0aCA9IHBvc2l0aW9uLmVuZFBvc2l0aW9uIC0gcG9zaXRpb24uc3RhcnRQb3NpdGlvbjsKICAgIGxldCBiYXNlVmFsdWUgPSB0aGlzLmVkaXRUZXh0UmVmLmlubmVySFRNTC5zcGxpdCgnJyk7CiAgICBiYXNlVmFsdWUuc3BsaWNlKHBvc2l0aW9uLnN0YXJ0UG9zaXRpb24sIGxlbmd0aCk7CiAgICBjb25zdCB1cGRhdGVWYWx1ZSA9IGJhc2VWYWx1ZS5zbGljZSgwLCBwb3NpdGlvbi5zdGFydFBvc2l0aW9uKS5qb2luKCcnKSArIHRoaXMuY29waWVkVGV4dCArIGJhc2VWYWx1ZS5zbGljZShwb3NpdGlvbi5zdGFydFBvc2l0aW9uKS5qb2luKCcnKTsKICAgIEV2ZW50QnVzLiRlbWl0KCd1cGRhdGVUZXh0JywgdXBkYXRlVmFsdWUpOwogIH0KCiAgZ2V0Q3Vyc29yUG9zKGV2ZW50KSB7CiAgICBsZXQgc3RhcnRQb3NpdGlvbiA9IDA7CiAgICBsZXQgZW5kUG9zaXRpb24gPSAwOwogICAgY29uc3QgaXNTdXBwb3J0ZWQgPSB0eXBlb2Ygd2luZG93LmdldFNlbGVjdGlvbiAhPT0gJ3VuZGVmaW5lZCc7CgogICAgaWYgKGlzU3VwcG9ydGVkKSB7CiAgICAgIGNvbnN0IHNlbGVjdGlvbiA9IHdpbmRvdy5nZXRTZWxlY3Rpb24oKTsKCiAgICAgIGlmIChzZWxlY3Rpb24uYW5jaG9yT2Zmc2V0ID4gc2VsZWN0aW9uLmZvY3VzT2Zmc2V0KSB7CiAgICAgICAgc3RhcnRQb3NpdGlvbiA9IHNlbGVjdGlvbi5mb2N1c09mZnNldDsKICAgICAgICBlbmRQb3NpdGlvbiA9IHNlbGVjdGlvbi5hbmNob3JPZmZzZXQ7CiAgICAgIH0gZWxzZSBpZiAoc2VsZWN0aW9uLmFuY2hvck9mZnNldCA9PT0gc2VsZWN0aW9uLmZvY3VzT2Zmc2V0KSB7CiAgICAgICAgc3RhcnRQb3NpdGlvbiA9IHNlbGVjdGlvbi5mb2N1c09mZnNldDsKICAgICAgICBlbmRQb3NpdGlvbiA9IHNlbGVjdGlvbi5mb2N1c09mZnNldDsKICAgICAgfSBlbHNlIHsKICAgICAgICBzdGFydFBvc2l0aW9uID0gc2VsZWN0aW9uLmFuY2hvck9mZnNldDsKICAgICAgICBlbmRQb3NpdGlvbiA9IHNlbGVjdGlvbi5mb2N1c09mZnNldDsKICAgICAgfQogICAgfQoKICAgIHJldHVybiB7CiAgICAgIHN0YXJ0UG9zaXRpb246IHN0YXJ0UG9zaXRpb24sCiAgICAgIGVuZFBvc2l0aW9uOiBlbmRQb3NpdGlvbgogICAgfTsKICB9CgogIGNyZWF0ZWQoKSB7CiAgICBFdmVudEJ1cy4kb24oJ2dyb3VwQ29udHJvbCcsIHZhbHVlID0+IHsKICAgICAgaWYgKHRoaXMuc2VsZWN0ZWRDb250cm9sc1t0aGlzLnVzZXJGb3JtSWRdLmNvbnRhaW5lclswXSA9PT0gdGhpcy5jb250YWluZXJJZCkgewogICAgICAgIGlmICh2YWx1ZSA9PT0gJ2dyb3VwJykgewogICAgICAgICAgdGhpcy5ncm91cENvbnRyb2woKTsKICAgICAgICB9IGVsc2UgaWYgKHZhbHVlID09PSAndW5ncm91cCcpIHsKICAgICAgICAgIHRoaXMudW5Hcm91cENvbnRyb2woKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0pOwogIH0KCiAgZGVzdHJveWVkKCkgewogICAgRXZlbnRCdXMuJG9mZignZ3JvdXBDb250cm9sJyk7CiAgfQoKICBjbG9zZU1lbnUoKSB7CiAgICByZXR1cm4gMDsKICB9CgogIGRpc3BsYXlQcm9wKCkgewogICAgRXZlbnRCdXMuJGVtaXQoJ2Rpc3BQcm9wJywgZmFsc2UpOwogIH0KCiAgY3JlYXRlUGFnZU5hbWUocGFnZUxpc3QpIHsKICAgIGxldCBsYXN0Q29udHJvbElkID0gMDsKCiAgICBmb3IgKGxldCBpIG9mIHBhZ2VMaXN0KSB7CiAgICAgIGlmIChpLmluZGV4T2YoJ1BhZ2UnKSAhPT0gLTEpIHsKICAgICAgICBjb25zdCBJZE51bSA9IGkuc3BsaXQoJ1BhZ2UnKS5wb3AoKSB8fCAnLTEnOwogICAgICAgIGNvbnN0IHBhc3JlSWQgPSBwYXJzZUludChJZE51bSwgMTApOwoKICAgICAgICBpZiAoIWlzTmFOKHBhc3JlSWQpICYmIGxhc3RDb250cm9sSWQgPCBwYXNyZUlkKSB7CiAgICAgICAgICBsYXN0Q29udHJvbElkID0gcGFzcmVJZDsKICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgICByZXR1cm4gbGFzdENvbnRyb2xJZCArIDE7CiAgfQoKICBnZXRQYWdlQ291bnQoY29udGFpbmVyKSB7CiAgICBjb25zdCBwYWdlTGlzdCA9IFtdOwoKICAgIGZvciAoY29uc3QgcGFnZUlkIG9mIHRoaXMudXNlcmZvcm1EYXRhW3RoaXMudXNlckZvcm1JZF1bY29udGFpbmVyXS5jb250cm9scykgewogICAgICBwYWdlTGlzdC5wdXNoKHRoaXMudXNlcmZvcm1EYXRhW3RoaXMudXNlckZvcm1JZF1bcGFnZUlkXS5wcm9wZXJ0aWVzLk5hbWUpOwogICAgfQoKICAgIGNvbnN0IG5hbWUgPSB0aGlzLmNyZWF0ZVBhZ2VOYW1lKHBhZ2VMaXN0KTsKICAgIHJldHVybiBuYW1lOwogIH0KCiAgYWRkTmV3UGFnZSgpIHsKICAgIGNvbnN0IHR5cGUgPSB0aGlzLnVzZXJmb3JtRGF0YVt0aGlzLnVzZXJGb3JtSWRdW3RoaXMuY29udHJvbElkXS50eXBlOwoKICAgIGlmICh0eXBlID09PSAnVGFiU3RyaXAnKSB7CiAgICAgIGNvbnN0IHRhYkNvbnRyb2xEYXRhID0gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeSh0aGlzLnVzZXJmb3JtRGF0YVt0aGlzLnVzZXJGb3JtSWRdW3RoaXMuY29udHJvbElkXSkpLmV4dHJhRGF0YXMuVGFiczsKICAgICAgbGV0IHByZXZUYWJJZCA9IC0xOwogICAgICBjb25zdCBpbml0aWFsVGFiRGF0YSA9IHsKICAgICAgICBOYW1lOiAnJywKICAgICAgICBDYXB0aW9uOiAnJywKICAgICAgICBUb29sVGlwOiAnJywKICAgICAgICBBY2NlbGVyYXRvcjogJycKICAgICAgfTsKCiAgICAgIGlmICh0YWJDb250cm9sRGF0YS5sZW5ndGggPiAwKSB7CiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0YWJDb250cm9sRGF0YS5sZW5ndGg7IGkrKykgewogICAgICAgICAgY29uc3QgaWQgPSB0YWJDb250cm9sRGF0YVtpXS5OYW1lLnNwbGl0KCdUYWInKS5wb3AoKSB8fCAnLTEnOwogICAgICAgICAgY29uc3QgcGFyc2VJZCA9IHBhcnNlSW50KGlkLCAxMCk7CgogICAgICAgICAgaWYgKCFpc05hTihwYXJzZUlkKSAmJiBwcmV2VGFiSWQgPCBwYXJzZUlkKSB7CiAgICAgICAgICAgIHByZXZUYWJJZCA9IHBhcnNlSWQ7CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBwcmV2VGFiSWQgKz0gMTsKICAgICAgICBpbml0aWFsVGFiRGF0YS5OYW1lID0gYFRhYiR7cHJldlRhYklkfWA7CiAgICAgICAgaW5pdGlhbFRhYkRhdGEuQ2FwdGlvbiA9IGBUYWIke3ByZXZUYWJJZH1gOwogICAgICB9IGVsc2UgewogICAgICAgIGluaXRpYWxUYWJEYXRhLk5hbWUgPSBgVGFiJHsxfWA7CiAgICAgICAgaW5pdGlhbFRhYkRhdGEuQ2FwdGlvbiA9IGBUYWIkezF9YDsKICAgICAgfQoKICAgICAgdGFiQ29udHJvbERhdGEucHVzaChpbml0aWFsVGFiRGF0YSk7CiAgICAgIHRoaXMudXBkYXRlQ29udHJvbEV4dHJhRGF0YSh7CiAgICAgICAgdXNlckZvcm1JZDogdGhpcy51c2VyRm9ybUlkLAogICAgICAgIGNvbnRyb2xJZDogdGhpcy5jb250cm9sSWQsCiAgICAgICAgcHJvcGVydHlOYW1lOiAnVGFicycsCiAgICAgICAgdmFsdWU6IHRhYkNvbnRyb2xEYXRhCiAgICAgIH0pOwogICAgICB0aGlzLnVwZGF0ZUNvbnRyb2woewogICAgICAgIHVzZXJGb3JtSWQ6IHRoaXMudXNlckZvcm1JZCwKICAgICAgICBjb250cm9sSWQ6IHRoaXMuY29udHJvbElkLAogICAgICAgIHByb3BlcnR5TmFtZTogJ1ZhbHVlJywKICAgICAgICB2YWx1ZTogcHJldlRhYklkIC0gMQogICAgICB9KTsKICAgIH0gZWxzZSBpZiAodHlwZSA9PT0gJ011bHRpUGFnZScpIHsKICAgICAgY29uc3QgcGFyZW50SWQgPSB0aGlzLmNvbnRyb2xJZC5zcGxpdCgnTXVsdGlQYWdlJykucG9wKCk7CiAgICAgIGNvbnN0IGNvbnRyb2xOYW1lID0gYFBhZ2Uke3BhcmVudElkfV9gOwogICAgICBsZXQgbGFzdENvbnRyb2xJZCA9IDA7CiAgICAgIGNvbnN0IHVzZXJmb3JtQ29udHJvbElkcyA9IE9iamVjdC5rZXlzKHRoaXMudXNlcmZvcm1EYXRhW3RoaXMudXNlckZvcm1JZF0pOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB1c2VyZm9ybUNvbnRyb2xJZHMubGVuZ3RoOyBpKyspIHsKICAgICAgICBpZiAodXNlcmZvcm1Db250cm9sSWRzW2ldLmluZGV4T2YoY29udHJvbE5hbWUpICE9PSAtMSkgewogICAgICAgICAgY29uc3QgSWROdW0gPSB1c2VyZm9ybUNvbnRyb2xJZHNbaV0uc3BsaXQoY29udHJvbE5hbWUpLnBvcCgpIHx8ICctMSc7CiAgICAgICAgICBjb25zdCBwYXNyZUlkID0gcGFyc2VJbnQoSWROdW0sIDEwKTsKCiAgICAgICAgICBpZiAoIWlzTmFOKHBhc3JlSWQpICYmIGxhc3RDb250cm9sSWQgPCBwYXNyZUlkKSB7CiAgICAgICAgICAgIGxhc3RDb250cm9sSWQgPSBwYXNyZUlkOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQoKICAgICAgY29uc3QgY29udHJvbFByb3BEYXRhID0gbmV3IENvbnRyb2xQcm9wZXJ0eURhdGEoKTsKICAgICAgbGV0IGNvbnRyb2xPYmogPSBjb250cm9sUHJvcERhdGEuZGF0YVsnUGFnZSddOwogICAgICBjb25zdCBpdGVtID0gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShjb250cm9sT2JqKSk7CiAgICAgIGxhc3RDb250cm9sSWQgKz0gMTsKICAgICAgaXRlbS5wcm9wZXJ0aWVzLklEID0gYElEXyR7Y29udHJvbE5hbWV9JHtsYXN0Q29udHJvbElkfWA7CiAgICAgIGNvbnN0IGNvdW50ID0gdGhpcy5nZXRQYWdlQ291bnQodGhpcy5jb250cm9sSWQpOwogICAgICBpdGVtLnByb3BlcnRpZXMuQ2FwdGlvbiA9IGBQYWdlJHtjb3VudH1gOwogICAgICBpdGVtLnByb3BlcnRpZXMuTmFtZSA9IGBQYWdlJHtjb3VudH1gOwogICAgICBpdGVtLnByb3BlcnRpZXMuSW5kZXggPSB0aGlzLnVzZXJmb3JtRGF0YVt0aGlzLnVzZXJGb3JtSWRdW3RoaXMuY29udHJvbElkXS5jb250cm9scy5sZW5ndGg7CiAgICAgIHRoaXMuYWRkQ29udHJvbCh7CiAgICAgICAgdXNlckZvcm1JZDogdGhpcy51c2VyRm9ybUlkLAogICAgICAgIGNvbnRyb2xJZDogdGhpcy5jb250cm9sSWQsCiAgICAgICAgYWRkSWQ6IGl0ZW0ucHJvcGVydGllcy5JRCwKICAgICAgICBpdGVtOiBpdGVtCiAgICAgIH0pOwogICAgICB0aGlzLnVwZGF0ZUNvbnRyb2woewogICAgICAgIHVzZXJGb3JtSWQ6IHRoaXMudXNlckZvcm1JZCwKICAgICAgICBjb250cm9sSWQ6IHRoaXMuY29udHJvbElkLAogICAgICAgIHByb3BlcnR5TmFtZTogJ1ZhbHVlJywKICAgICAgICB2YWx1ZTogaXRlbS5wcm9wZXJ0aWVzLkluZGV4CiAgICAgIH0pOwogICAgICB0aGlzLnNlbGVjdENvbnRyb2woewogICAgICAgIHVzZXJGb3JtSWQ6IHRoaXMudXNlckZvcm1JZCwKICAgICAgICBzZWxlY3Q6IHsKICAgICAgICAgIGNvbnRhaW5lcjogdGhpcy5nZXRDb250YWluZXJMaXN0KGl0ZW0ucHJvcGVydGllcy5JRCksCiAgICAgICAgICBzZWxlY3RlZDogW2l0ZW0ucHJvcGVydGllcy5JRF0KICAgICAgICB9CiAgICAgIH0pOwogICAgICBFdmVudEJ1cy4kZW1pdCgndXBkYXRlTXVsdGlQYWdlVmFsdWUnKTsKICAgIH0KICB9CgogIGJyaW5nRm9yd2FyZCgpIHsKICAgIGNvbnN0IHVzZXJEYXRhID0gdGhpcy51c2VyZm9ybURhdGFbdGhpcy51c2VyRm9ybUlkXTsKICAgIGNvbnN0IGhpZ2hQcm9yQ29udHJvbCA9IFtdOwogICAgY29uc3QgbG93UHJvckNvbnRyb2wgPSBbXTsKICAgIGNvbnN0IGNvbnRhaW5lciA9IHRoaXMuZ2V0Q29udGFpbmVyTGlzdCh0aGlzLmdldFNlbGVjdGVkQ29udHJvbHNEYXRhc1swXSlbMF07CiAgICBjb25zdCBjb250YWluZXJDb250cm9scyA9IHRoaXMudXNlcmZvcm1EYXRhW3RoaXMudXNlckZvcm1JZF1bY29udGFpbmVyXS5jb250cm9sczsKCiAgICBmb3IgKGNvbnN0IGluZGV4IGluIGNvbnRhaW5lckNvbnRyb2xzKSB7CiAgICAgIGNvbnN0IGNudHJsRGF0YSA9IHRoaXMudXNlcmZvcm1EYXRhW3RoaXMudXNlckZvcm1JZF1bY29udGFpbmVyQ29udHJvbHNbaW5kZXhdXTsKCiAgICAgIGlmIChjbnRybERhdGEudHlwZSA9PT0gJ011bHRpUGFnZScgfHwgY250cmxEYXRhLnR5cGUgPT09ICdGcmFtZScgfHwgY250cmxEYXRhLnR5cGUgPT09ICdMaXN0Qm94JykgewogICAgICAgIGhpZ2hQcm9yQ29udHJvbC5wdXNoKGNvbnRhaW5lckNvbnRyb2xzW2luZGV4XSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgbG93UHJvckNvbnRyb2wucHVzaChjb250YWluZXJDb250cm9sc1tpbmRleF0pOwogICAgICB9CiAgICB9CgogICAgbGV0IG5leHRTZWxjdGVkU2VyaWVzID0gW107CiAgICBsZXQgbmV4dEhpZ2hDb250cm9sU2VyaWVzID0gW107CiAgICBjb25zdCBnZXRTZWxDb250cm9sID0gWy4uLnRoaXMuZ2V0U2VsZWN0ZWRDb250cm9sc0RhdGFzXTsKICAgIGdldFNlbENvbnRyb2wuc29ydCgoYSwgYikgPT4gewogICAgICByZXR1cm4gdXNlckRhdGFbYV0uZXh0cmFEYXRhcy56SW5kZXggLSB1c2VyRGF0YVtiXS5leHRyYURhdGFzLnpJbmRleDsKICAgIH0pOwoKICAgIGZvciAoY29uc3Qgc2VsQ29udHJvbCBvZiBnZXRTZWxDb250cm9sKSB7CiAgICAgIGNvbnN0IHR5cGUgPSB1c2VyRGF0YVtzZWxDb250cm9sXS50eXBlOwogICAgICBjb25zdCB0ZW1wWkluZGV4ID0gdXNlckRhdGFbc2VsQ29udHJvbF0uZXh0cmFEYXRhcy56SW5kZXg7CiAgICAgIGNvbnN0IGNvbnRyb2xJbmRleCA9IE9iamVjdC5rZXlzKHVzZXJEYXRhKS5maW5kSW5kZXgoKHZhbCwgaW5kZXgpID0+IHsKICAgICAgICByZXR1cm4gJ3pJbmRleCcgaW4gdXNlckRhdGFbdmFsXS5leHRyYURhdGFzICYmIHVzZXJEYXRhW3ZhbF0uZXh0cmFEYXRhcy56SW5kZXggPT09IHRlbXBaSW5kZXggKyAxOwogICAgICB9KTsKICAgICAgY29uc3QgbmV4dFNlbGVjdGVkQ29udHJvbCA9IGNvbnRyb2xJbmRleCAhPT0gLTEgPyBPYmplY3Qua2V5cyh1c2VyRGF0YSlbY29udHJvbEluZGV4XSA6ICcnOwogICAgICBjb25zdCBuZXh0Q29udHJvbFR5cGUgPSB1c2VyRGF0YVtuZXh0U2VsZWN0ZWRDb250cm9sXS50eXBlOwoKICAgICAgaWYgKG5leHRTZWxlY3RlZENvbnRyb2wgIT09ICcnICYmICFoaWdoUHJvckNvbnRyb2wuaW5jbHVkZXMobmV4dFNlbGVjdGVkQ29udHJvbCkpIHsKICAgICAgICBpZiAoZ2V0U2VsQ29udHJvbC5pbmNsdWRlcyhuZXh0U2VsZWN0ZWRDb250cm9sKSkgewogICAgICAgICAgaWYgKCFuZXh0U2VsY3RlZFNlcmllcy5pbmNsdWRlcyhzZWxDb250cm9sKSkgewogICAgICAgICAgICBuZXh0U2VsY3RlZFNlcmllcy5wdXNoKHNlbENvbnRyb2wpOwogICAgICAgICAgfQoKICAgICAgICAgIGlmICghbmV4dFNlbGN0ZWRTZXJpZXMuaW5jbHVkZXMobmV4dFNlbGVjdGVkQ29udHJvbCkpIHsKICAgICAgICAgICAgbmV4dFNlbGN0ZWRTZXJpZXMucHVzaChuZXh0U2VsZWN0ZWRDb250cm9sKTsKICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgaWYgKE9iamVjdC5rZXlzKG5leHRTZWxjdGVkU2VyaWVzKS5sZW5ndGggIT09IDApIHsKICAgICAgICAgICAgY29uc3QgdGVtcEV4Y2hhZ2VJbmRleCA9IHVzZXJEYXRhW25leHRTZWxjdGVkU2VyaWVzWzBdXS5leHRyYURhdGFzLnpJbmRleDsKICAgICAgICAgICAgY29uc3Qgc3dhcFRhYkluZGV4ID0gdXNlckRhdGFbbmV4dFNlbGVjdGVkQ29udHJvbF0uZXh0cmFEYXRhcy56SW5kZXg7CgogICAgICAgICAgICBpZiAoc3dhcFRhYkluZGV4IDw9IHVzZXJEYXRhW2NvbnRhaW5lcl0uY29udHJvbHMubGVuZ3RoCiAgICAgICAgICAgIC8qICYmIHN3YXBUYWJJbmRleCA+IDAgKi8KICAgICAgICAgICAgKSB7CiAgICAgICAgICAgICAgICBjb25zdCBpbmRleCA9IHVzZXJEYXRhW2NvbnRhaW5lcl0uY29udHJvbHMuZmluZEluZGV4KHZhbCA9PiB1c2VyRGF0YVt2YWxdLmV4dHJhRGF0YXMuekluZGV4ID09PSBzd2FwVGFiSW5kZXgpOwogICAgICAgICAgICAgICAgdGhpcy51cGRhdGVFeHRyYURhdGFzKHVzZXJEYXRhW2NvbnRhaW5lcl0uY29udHJvbHNbaW5kZXhdLCAnekluZGV4JywgdGVtcEV4Y2hhZ2VJbmRleCk7CiAgICAgICAgICAgICAgICB0aGlzLnVwZGF0ZUV4dHJhRGF0YXMobmV4dFNlbGN0ZWRTZXJpZXNbMF0sICd6SW5kZXgnLCBzd2FwVGFiSW5kZXggLSAobmV4dFNlbGN0ZWRTZXJpZXMubGVuZ3RoIC0gMSkpOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGZvciAobGV0IGogPSAxOyBqIDwgbmV4dFNlbGN0ZWRTZXJpZXMubGVuZ3RoOyBqKyspIHsKICAgICAgICAgICAgICBjb25zdCB1cGRhdGVJbmRleCA9IHVzZXJEYXRhW25leHRTZWxjdGVkU2VyaWVzW2pdXS5leHRyYURhdGFzLnpJbmRleCArIDE7CiAgICAgICAgICAgICAgdGhpcy51cGRhdGVFeHRyYURhdGFzKG5leHRTZWxjdGVkU2VyaWVzW2pdLCAnekluZGV4JywgdXBkYXRlSW5kZXgpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBuZXh0U2VsY3RlZFNlcmllcyA9IFtdOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgY29uc3Qgc3dhcFRhYkluZGV4ID0gdXNlckRhdGFbbmV4dFNlbGVjdGVkQ29udHJvbF0uZXh0cmFEYXRhcy56SW5kZXg7CgogICAgICAgICAgICBpZiAoc3dhcFRhYkluZGV4IDw9IHVzZXJEYXRhW2NvbnRhaW5lcl0uY29udHJvbHMubGVuZ3RoCiAgICAgICAgICAgIC8qICYmIHN3YXBUYWJJbmRleCA+IDAgKi8KICAgICAgICAgICAgKSB7CiAgICAgICAgICAgICAgICBjb25zdCBpbmRleCA9IHVzZXJEYXRhW2NvbnRhaW5lcl0uY29udHJvbHMuZmluZEluZGV4KHZhbCA9PiB1c2VyRGF0YVt2YWxdLmV4dHJhRGF0YXMuekluZGV4ID09PSBzd2FwVGFiSW5kZXgpOwogICAgICAgICAgICAgICAgdGhpcy51cGRhdGVFeHRyYURhdGFzKHNlbENvbnRyb2wsICd6SW5kZXgnLCBzd2FwVGFiSW5kZXgpOwogICAgICAgICAgICAgICAgdGhpcy51cGRhdGVFeHRyYURhdGFzKG5leHRTZWxlY3RlZENvbnRyb2wsICd6SW5kZXgnLCB0ZW1wWkluZGV4KTsKICAgICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIGlmIChnZXRTZWxDb250cm9sLmluY2x1ZGVzKG5leHRTZWxlY3RlZENvbnRyb2wpICYmICh0eXBlID09PSAnRnJhbWUnIHx8IHR5cGUgPT09ICdNdWx0aVBhZ2UnIHx8IHR5cGUgPT09ICdMaXN0Qm94JykpIHsKICAgICAgICAgIGlmICghbmV4dEhpZ2hDb250cm9sU2VyaWVzLmluY2x1ZGVzKHNlbENvbnRyb2wpKSB7CiAgICAgICAgICAgIG5leHRIaWdoQ29udHJvbFNlcmllcy5wdXNoKHNlbENvbnRyb2wpOwogICAgICAgICAgfQoKICAgICAgICAgIGlmICghbmV4dEhpZ2hDb250cm9sU2VyaWVzLmluY2x1ZGVzKG5leHRTZWxlY3RlZENvbnRyb2wpKSB7CiAgICAgICAgICAgIG5leHRIaWdoQ29udHJvbFNlcmllcy5wdXNoKG5leHRTZWxlY3RlZENvbnRyb2wpOwogICAgICAgICAgfQogICAgICAgIH0gZWxzZSBpZiAodHlwZSA9PT0gJ0ZyYW1lJyB8fCB0eXBlID09PSAnTXVsdGlQYWdlJyB8fCB0eXBlID09PSAnTGlzdEJveCcpIHsKICAgICAgICAgIGlmIChPYmplY3Qua2V5cyhuZXh0SGlnaENvbnRyb2xTZXJpZXMpLmxlbmd0aCAhPT0gMCkgewogICAgICAgICAgICBjb25zdCB0ZW1wRXhjaGFnZUluZGV4ID0gdXNlckRhdGFbbmV4dEhpZ2hDb250cm9sU2VyaWVzWzBdXS5leHRyYURhdGFzLnpJbmRleDsKICAgICAgICAgICAgY29uc3Qgc3dhcFRhYkluZGV4ID0gdXNlckRhdGFbbmV4dFNlbGVjdGVkQ29udHJvbF0uZXh0cmFEYXRhcy56SW5kZXg7CgogICAgICAgICAgICBpZiAoc3dhcFRhYkluZGV4IDw9IHVzZXJEYXRhW2NvbnRhaW5lcl0uY29udHJvbHMubGVuZ3RoKSB7CiAgICAgICAgICAgICAgY29uc3QgaW5kZXggPSB1c2VyRGF0YVtjb250YWluZXJdLmNvbnRyb2xzLmZpbmRJbmRleCh2YWwgPT4gdXNlckRhdGFbdmFsXS5leHRyYURhdGFzLnpJbmRleCA9PT0gc3dhcFRhYkluZGV4KTsKICAgICAgICAgICAgICB0aGlzLnVwZGF0ZUV4dHJhRGF0YXModXNlckRhdGFbY29udGFpbmVyXS5jb250cm9sc1tpbmRleF0sICd6SW5kZXgnLCB0ZW1wRXhjaGFnZUluZGV4KTsKICAgICAgICAgICAgICB0aGlzLnVwZGF0ZUV4dHJhRGF0YXMobmV4dEhpZ2hDb250cm9sU2VyaWVzWzBdLCAnekluZGV4Jywgc3dhcFRhYkluZGV4IC0gKG5leHRIaWdoQ29udHJvbFNlcmllcy5sZW5ndGggLSAxKSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGZvciAobGV0IGogPSAxOyBqIDwgbmV4dEhpZ2hDb250cm9sU2VyaWVzLmxlbmd0aDsgaisrKSB7CiAgICAgICAgICAgICAgY29uc3QgdXBkYXRlSW5kZXggPSB1c2VyRGF0YVtuZXh0SGlnaENvbnRyb2xTZXJpZXNbal1dLmV4dHJhRGF0YXMuekluZGV4ICsgMTsKICAgICAgICAgICAgICB0aGlzLnVwZGF0ZUV4dHJhRGF0YXMobmV4dEhpZ2hDb250cm9sU2VyaWVzW2pdLCAnekluZGV4JywgdXBkYXRlSW5kZXgpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBuZXh0SGlnaENvbnRyb2xTZXJpZXMgPSBbXTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGNvbnN0IHN3YXBUYWJJbmRleCA9IHVzZXJEYXRhW25leHRTZWxlY3RlZENvbnRyb2xdLmV4dHJhRGF0YXMuekluZGV4OwoKICAgICAgICAgICAgaWYgKHN3YXBUYWJJbmRleCA8PSB1c2VyRGF0YVtjb250YWluZXJdLmNvbnRyb2xzLmxlbmd0aAogICAgICAgICAgICAvKiAmJiBzd2FwVGFiSW5kZXggPiAwICovCiAgICAgICAgICAgICkgewogICAgICAgICAgICAgICAgY29uc3QgaW5kZXggPSB1c2VyRGF0YVtjb250YWluZXJdLmNvbnRyb2xzLmZpbmRJbmRleCh2YWwgPT4gdXNlckRhdGFbdmFsXS5leHRyYURhdGFzLnpJbmRleCA9PT0gc3dhcFRhYkluZGV4KTsKICAgICAgICAgICAgICAgIHRoaXMudXBkYXRlRXh0cmFEYXRhcyhzZWxDb250cm9sLCAnekluZGV4Jywgc3dhcFRhYkluZGV4KTsKICAgICAgICAgICAgICAgIHRoaXMudXBkYXRlRXh0cmFEYXRhcyhuZXh0U2VsZWN0ZWRDb250cm9sLCAnekluZGV4JywgdGVtcFpJbmRleCk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgfQogIH0KCiAgYnJpbmdCYWNrd2FyZCgpIHsKICAgIGNvbnN0IHVzZXJEYXRhID0gdGhpcy51c2VyZm9ybURhdGFbdGhpcy51c2VyRm9ybUlkXTsKICAgIGNvbnN0IGhpZ2hQcm9yQ29udHJvbCA9IFtdOwogICAgY29uc3QgbG93UHJvckNvbnRyb2wgPSBbXTsKICAgIGNvbnN0IGNvbnRhaW5lciA9IHRoaXMuZ2V0Q29udGFpbmVyTGlzdCh0aGlzLmdldFNlbGVjdGVkQ29udHJvbHNEYXRhc1swXSlbMF07CiAgICBjb25zdCBjb250YWluZXJDb250cm9scyA9IHRoaXMudXNlcmZvcm1EYXRhW3RoaXMudXNlckZvcm1JZF1bY29udGFpbmVyXS5jb250cm9sczsKCiAgICBmb3IgKGNvbnN0IGluZGV4IGluIGNvbnRhaW5lckNvbnRyb2xzKSB7CiAgICAgIGNvbnN0IGNudHJsRGF0YSA9IHRoaXMudXNlcmZvcm1EYXRhW3RoaXMudXNlckZvcm1JZF1bY29udGFpbmVyQ29udHJvbHNbaW5kZXhdXTsKCiAgICAgIGlmIChjbnRybERhdGEudHlwZSA9PT0gJ011bHRpUGFnZScgfHwgY250cmxEYXRhLnR5cGUgPT09ICdGcmFtZScgfHwgY250cmxEYXRhLnR5cGUgPT09ICdMaXN0Qm94JykgewogICAgICAgIGhpZ2hQcm9yQ29udHJvbC5wdXNoKGNvbnRhaW5lckNvbnRyb2xzW2luZGV4XSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgbG93UHJvckNvbnRyb2wucHVzaChjb250YWluZXJDb250cm9sc1tpbmRleF0pOwogICAgICB9CiAgICB9CgogICAgbGV0IG5leHRTZWxjdGVkU2VyaWVzID0gW107CiAgICBsZXQgbmV4dEhpZ2hDb250cm9sU2VyaWVzID0gW107CiAgICBjb25zdCBnZXRTZWxDb250cm9sID0gWy4uLnRoaXMuZ2V0U2VsZWN0ZWRDb250cm9sc0RhdGFzXTsKICAgIGdldFNlbENvbnRyb2wuc29ydCgoYSwgYikgPT4gewogICAgICByZXR1cm4gdXNlckRhdGFbYV0uZXh0cmFEYXRhcy56SW5kZXggLSB1c2VyRGF0YVtiXS5leHRyYURhdGFzLnpJbmRleDsKICAgIH0pOwoKICAgIGZvciAoY29uc3Qgc2VsQ29udHJvbCBvZiBnZXRTZWxDb250cm9sKSB7CiAgICAgIGNvbnN0IHR5cGUgPSB1c2VyRGF0YVtzZWxDb250cm9sXS50eXBlOwogICAgICBjb25zdCB0ZW1wWkluZGV4ID0gdXNlckRhdGFbc2VsQ29udHJvbF0uZXh0cmFEYXRhcy56SW5kZXg7CiAgICAgIGNvbnN0IGNvbnRyb2xJbmRleCA9IE9iamVjdC5rZXlzKHVzZXJEYXRhKS5maW5kSW5kZXgoKHZhbCwgaW5kZXgpID0+IHsKICAgICAgICByZXR1cm4gJ3pJbmRleCcgaW4gdXNlckRhdGFbdmFsXS5leHRyYURhdGFzICYmIHVzZXJEYXRhW3ZhbF0uZXh0cmFEYXRhcy56SW5kZXggPT09IHRlbXBaSW5kZXggLSAxOwogICAgICB9KTsKICAgICAgY29uc3QgbmV4dFNlbGVjdGVkQ29udHJvbCA9IGNvbnRyb2xJbmRleCAhPT0gLTEgPyBPYmplY3Qua2V5cyh1c2VyRGF0YSlbY29udHJvbEluZGV4XSA6ICcnOwogICAgICBjb25zdCBuZXh0Q29udHJvbFR5cGUgPSB1c2VyRGF0YVtuZXh0U2VsZWN0ZWRDb250cm9sXS50eXBlOwoKICAgICAgaWYgKG5leHRTZWxlY3RlZENvbnRyb2wgIT09ICcnICYmICFoaWdoUHJvckNvbnRyb2wuaW5jbHVkZXMoc2VsQ29udHJvbCkpIHsKICAgICAgICBpZiAoZ2V0U2VsQ29udHJvbC5pbmNsdWRlcyhuZXh0U2VsZWN0ZWRDb250cm9sKSkgewogICAgICAgICAgaWYgKCFuZXh0U2VsY3RlZFNlcmllcy5pbmNsdWRlcyhzZWxDb250cm9sKSkgewogICAgICAgICAgICBuZXh0U2VsY3RlZFNlcmllcy5wdXNoKHNlbENvbnRyb2wpOwogICAgICAgICAgfQoKICAgICAgICAgIGlmICghbmV4dFNlbGN0ZWRTZXJpZXMuaW5jbHVkZXMobmV4dFNlbGVjdGVkQ29udHJvbCkpIHsKICAgICAgICAgICAgbmV4dFNlbGN0ZWRTZXJpZXMucHVzaChuZXh0U2VsZWN0ZWRDb250cm9sKTsKICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgaWYgKE9iamVjdC5rZXlzKG5leHRTZWxjdGVkU2VyaWVzKS5sZW5ndGggIT09IDApIHsKICAgICAgICAgICAgY29uc3QgdGVtcEV4Y2hhZ2VJbmRleCA9IHVzZXJEYXRhW25leHRTZWxjdGVkU2VyaWVzWzBdXS5leHRyYURhdGFzLnpJbmRleDsKICAgICAgICAgICAgY29uc3Qgc3dhcFRhYkluZGV4ID0gdXNlckRhdGFbbmV4dFNlbGVjdGVkQ29udHJvbF0uZXh0cmFEYXRhcy56SW5kZXg7CgogICAgICAgICAgICBpZiAoc3dhcFRhYkluZGV4IDw9IHVzZXJEYXRhW2NvbnRhaW5lcl0uY29udHJvbHMubGVuZ3RoICYmIHN3YXBUYWJJbmRleCA+IDApIHsKICAgICAgICAgICAgICBjb25zdCBpbmRleCA9IHVzZXJEYXRhW2NvbnRhaW5lcl0uY29udHJvbHMuZmluZEluZGV4KHZhbCA9PiB1c2VyRGF0YVt2YWxdLmV4dHJhRGF0YXMuekluZGV4ID09PSBzd2FwVGFiSW5kZXgpOwogICAgICAgICAgICAgIHRoaXMudXBkYXRlRXh0cmFEYXRhcyh1c2VyRGF0YVtjb250YWluZXJdLmNvbnRyb2xzW2luZGV4XSwgJ3pJbmRleCcsIHRlbXBFeGNoYWdlSW5kZXgpOwogICAgICAgICAgICAgIHRoaXMudXBkYXRlRXh0cmFEYXRhcyhuZXh0U2VsY3RlZFNlcmllc1swXSwgJ3pJbmRleCcsIG5leHRTZWxjdGVkU2VyaWVzLmxlbmd0aCArIDEgLSBzd2FwVGFiSW5kZXgpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBmb3IgKGxldCBqID0gMTsgaiA8IG5leHRTZWxjdGVkU2VyaWVzLmxlbmd0aDsgaisrKSB7CiAgICAgICAgICAgICAgY29uc3QgdXBkYXRlSW5kZXggPSB1c2VyRGF0YVtuZXh0U2VsY3RlZFNlcmllc1tqXV0uZXh0cmFEYXRhcy56SW5kZXggLSAxOwogICAgICAgICAgICAgIHRoaXMudXBkYXRlRXh0cmFEYXRhcyhuZXh0U2VsY3RlZFNlcmllc1tqXSwgJ3pJbmRleCcsIHVwZGF0ZUluZGV4KTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgbmV4dFNlbGN0ZWRTZXJpZXMgPSBbXTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGNvbnN0IHN3YXBUYWJJbmRleCA9IHVzZXJEYXRhW25leHRTZWxlY3RlZENvbnRyb2xdLmV4dHJhRGF0YXMuekluZGV4OwoKICAgICAgICAgICAgaWYgKHN3YXBUYWJJbmRleCA8PSB1c2VyRGF0YVtjb250YWluZXJdLmNvbnRyb2xzLmxlbmd0aCAmJiBzd2FwVGFiSW5kZXggPiAwKSB7CiAgICAgICAgICAgICAgY29uc3QgaW5kZXggPSB1c2VyRGF0YVtjb250YWluZXJdLmNvbnRyb2xzLmZpbmRJbmRleCh2YWwgPT4gdXNlckRhdGFbdmFsXS5leHRyYURhdGFzLnpJbmRleCA9PT0gc3dhcFRhYkluZGV4KTsKICAgICAgICAgICAgICB0aGlzLnVwZGF0ZUV4dHJhRGF0YXMoc2VsQ29udHJvbCwgJ3pJbmRleCcsIHN3YXBUYWJJbmRleCk7CiAgICAgICAgICAgICAgdGhpcy51cGRhdGVFeHRyYURhdGFzKG5leHRTZWxlY3RlZENvbnRyb2wsICd6SW5kZXgnLCB0ZW1wWkluZGV4KTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSBlbHNlIGlmICghbG93UHJvckNvbnRyb2wuaW5jbHVkZXMobmV4dFNlbGVjdGVkQ29udHJvbCkgJiYgKHR5cGUgPT09ICdGcmFtZScgfHwgdHlwZSA9PT0gJ011bHRpUGFnZScgfHwgdHlwZSA9PT0gJ0xpc3RCb3gnKSkgewogICAgICAgIGlmIChnZXRTZWxDb250cm9sLmluY2x1ZGVzKG5leHRTZWxlY3RlZENvbnRyb2wpKSB7CiAgICAgICAgICBpZiAoIW5leHRIaWdoQ29udHJvbFNlcmllcy5pbmNsdWRlcyhzZWxDb250cm9sKSkgewogICAgICAgICAgICBuZXh0SGlnaENvbnRyb2xTZXJpZXMucHVzaChzZWxDb250cm9sKTsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoIW5leHRIaWdoQ29udHJvbFNlcmllcy5pbmNsdWRlcyhuZXh0U2VsZWN0ZWRDb250cm9sKSkgewogICAgICAgICAgICBuZXh0SGlnaENvbnRyb2xTZXJpZXMucHVzaChuZXh0U2VsZWN0ZWRDb250cm9sKTsKICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgaWYgKE9iamVjdC5rZXlzKG5leHRIaWdoQ29udHJvbFNlcmllcykubGVuZ3RoICE9PSAwKSB7CiAgICAgICAgICAgIGNvbnN0IHRlbXBFeGNoYWdlSW5kZXggPSB1c2VyRGF0YVtuZXh0SGlnaENvbnRyb2xTZXJpZXNbMF1dLmV4dHJhRGF0YXMuekluZGV4OwogICAgICAgICAgICBjb25zdCBzd2FwVGFiSW5kZXggPSB1c2VyRGF0YVtuZXh0U2VsZWN0ZWRDb250cm9sXS5leHRyYURhdGFzLnpJbmRleDsKCiAgICAgICAgICAgIGlmIChzd2FwVGFiSW5kZXggPD0gdXNlckRhdGFbY29udGFpbmVyXS5jb250cm9scy5sZW5ndGgpIHsKICAgICAgICAgICAgICBjb25zdCBpbmRleCA9IHVzZXJEYXRhW2NvbnRhaW5lcl0uY29udHJvbHMuZmluZEluZGV4KHZhbCA9PiB1c2VyRGF0YVt2YWxdLmV4dHJhRGF0YXMuekluZGV4ID09PSBzd2FwVGFiSW5kZXgpOwogICAgICAgICAgICAgIHRoaXMudXBkYXRlRXh0cmFEYXRhcyh1c2VyRGF0YVtjb250YWluZXJdLmNvbnRyb2xzW2luZGV4XSwgJ3pJbmRleCcsIHRlbXBFeGNoYWdlSW5kZXgpOwogICAgICAgICAgICAgIHRoaXMudXBkYXRlRXh0cmFEYXRhcyhuZXh0SGlnaENvbnRyb2xTZXJpZXNbMF0sICd6SW5kZXgnLCBuZXh0SGlnaENvbnRyb2xTZXJpZXMubGVuZ3RoICsgMSAtIHN3YXBUYWJJbmRleCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGZvciAobGV0IGogPSAxOyBqIDwgbmV4dEhpZ2hDb250cm9sU2VyaWVzLmxlbmd0aDsgaisrKSB7CiAgICAgICAgICAgICAgY29uc3QgdXBkYXRlSW5kZXggPSB1c2VyRGF0YVtuZXh0SGlnaENvbnRyb2xTZXJpZXNbal1dLmV4dHJhRGF0YXMuekluZGV4IC0gMTsKICAgICAgICAgICAgICB0aGlzLnVwZGF0ZUV4dHJhRGF0YXMobmV4dEhpZ2hDb250cm9sU2VyaWVzW2pdLCAnekluZGV4JywgdXBkYXRlSW5kZXgpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBuZXh0SGlnaENvbnRyb2xTZXJpZXMgPSBbXTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGNvbnN0IHN3YXBUYWJJbmRleCA9IHVzZXJEYXRhW25leHRTZWxlY3RlZENvbnRyb2xdLmV4dHJhRGF0YXMuekluZGV4OwoKICAgICAgICAgICAgaWYgKHN3YXBUYWJJbmRleCA8PSB1c2VyRGF0YVtjb250YWluZXJdLmNvbnRyb2xzLmxlbmd0aCAmJiBzd2FwVGFiSW5kZXggPiAwKSB7CiAgICAgICAgICAgICAgY29uc3QgaW5kZXggPSB1c2VyRGF0YVtjb250YWluZXJdLmNvbnRyb2xzLmZpbmRJbmRleCh2YWwgPT4gdXNlckRhdGFbdmFsXS5leHRyYURhdGFzLnpJbmRleCA9PT0gc3dhcFRhYkluZGV4KTsKICAgICAgICAgICAgICB0aGlzLnVwZGF0ZUV4dHJhRGF0YXMoc2VsQ29udHJvbCwgJ3pJbmRleCcsIHN3YXBUYWJJbmRleCk7CiAgICAgICAgICAgICAgdGhpcy51cGRhdGVFeHRyYURhdGFzKG5leHRTZWxlY3RlZENvbnRyb2wsICd6SW5kZXgnLCB0ZW1wWkluZGV4KTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgfQogIH0KCiAgZGVsZXRlUGFnZUluZGV4KGlkKSB7CiAgICBjb25zdCB1c2VyRGF0YSA9IHRoaXMudXNlcmZvcm1EYXRhW3RoaXMudXNlckZvcm1JZF07CiAgICBjb25zdCBjb250YWluZXIgPSB0aGlzLnNlbGVjdGVkQ29udHJvbHNbdGhpcy51c2VyRm9ybUlkXS5jb250YWluZXJbMF07CiAgICBjb25zdCB0ZW1wSW5kZXggPSB1c2VyRGF0YVtpZF0ucHJvcGVydGllcy5JbmRleDsKCiAgICBmb3IgKGNvbnN0IGtleSBpbiB1c2VyRGF0YVtjb250YWluZXJdLmNvbnRyb2xzKSB7CiAgICAgIGNvbnN0IGNvbnRyb2xaSW5kZXggPSB1c2VyRGF0YVt1c2VyRGF0YVtjb250YWluZXJdLmNvbnRyb2xzW2tleV1dLnByb3BlcnRpZXMuSW5kZXg7CgogICAgICBpZiAoY29udHJvbFpJbmRleCA+IHRlbXBJbmRleCkgewogICAgICAgIHRoaXMudXBkYXRlQ29udHJvbCh7CiAgICAgICAgICB1c2VyRm9ybUlkOiB0aGlzLnVzZXJGb3JtSWQsCiAgICAgICAgICBjb250cm9sSWQ6IHVzZXJEYXRhW2NvbnRhaW5lcl0uY29udHJvbHNba2V5XSwKICAgICAgICAgIHByb3BlcnR5TmFtZTogJ0luZGV4JywKICAgICAgICAgIHZhbHVlOiBjb250cm9sWkluZGV4IC0gMQogICAgICAgIH0pOwogICAgICB9CiAgICB9CiAgfQoKICBkZWxldGVDdXJyZW50UGFnZSgpIHsKICAgIGNvbnN0IHR5cGUgPSB0aGlzLnVzZXJmb3JtRGF0YVt0aGlzLnVzZXJGb3JtSWRdW3RoaXMuY29udHJvbElkXS50eXBlOwoKICAgIGlmICh0eXBlID09PSAnVGFiU3RyaXAnKSB7CiAgICAgIGNvbnN0IHRhYkNvbnRyb2xEYXRhID0gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeSh0aGlzLnVzZXJmb3JtRGF0YVt0aGlzLnVzZXJGb3JtSWRdW3RoaXMuY29udHJvbElkXSkpLmV4dHJhRGF0YXMuVGFiczsKCiAgICAgIGlmICh0YWJDb250cm9sRGF0YSAmJiB0YWJDb250cm9sRGF0YS5sZW5ndGggPiAwKSB7CiAgICAgICAgdGFiQ29udHJvbERhdGEuc3BsaWNlKHRoaXMuc2VsZWN0ZWRUYWIsIDEpOwogICAgICAgIHRoaXMudXBkYXRlQ29udHJvbEV4dHJhRGF0YSh7CiAgICAgICAgICB1c2VyRm9ybUlkOiB0aGlzLnVzZXJGb3JtSWQsCiAgICAgICAgICBjb250cm9sSWQ6IHRoaXMuY29udHJvbElkLAogICAgICAgICAgcHJvcGVydHlOYW1lOiAnVGFicycsCiAgICAgICAgICB2YWx1ZTogdGFiQ29udHJvbERhdGEKICAgICAgICB9KTsKICAgICAgICB0aGlzLnVwZGF0ZVRhYlN0cmlwVmFsdWUodGhpcy5zZWxlY3RlZFRhYiAtIDEpOwogICAgICB9CiAgICB9IGVsc2UgaWYgKHR5cGUgPT09ICdNdWx0aVBhZ2UnKSB7CiAgICAgIGNvbnN0IGNvbnRyb2xzID0gdGhpcy51c2VyZm9ybURhdGFbdGhpcy51c2VyRm9ybUlkXVt0aGlzLmNvbnRyb2xJZF0uY29udHJvbHM7CgogICAgICBpZiAoY29udHJvbHMubGVuZ3RoID4gMCkgewogICAgICAgIHRoaXMuZGVsZXRlUGFnZUluZGV4KHRoaXMuc2VsZWN0ZWRDb250cm9sc1t0aGlzLnVzZXJGb3JtSWRdLnNlbGVjdGVkWzBdKTsKICAgICAgICBjb25zdCBpbmRleCA9IHRoaXMudXNlcmZvcm1EYXRhW3RoaXMudXNlckZvcm1JZF1bdGhpcy5zZWxlY3RlZENvbnRyb2xzW3RoaXMudXNlckZvcm1JZF0uc2VsZWN0ZWRbMF1dLnByb3BlcnRpZXMuSW5kZXg7CiAgICAgICAgdGhpcy5kZWxldGVDb250cm9sKHsKICAgICAgICAgIHVzZXJGb3JtSWQ6IHRoaXMudXNlckZvcm1JZCwKICAgICAgICAgIHBhcmVudElkOiB0aGlzLnNlbGVjdGVkQ29udHJvbHNbdGhpcy51c2VyRm9ybUlkXS5jb250YWluZXJbMF0sCiAgICAgICAgICB0YXJnZXRJZDogdGhpcy5zZWxlY3RlZENvbnRyb2xzW3RoaXMudXNlckZvcm1JZF0uc2VsZWN0ZWRbMF0KICAgICAgICB9KTsKICAgICAgICB0aGlzLnVwZGF0ZUluZGV4KGluZGV4IC0gMSk7CiAgICAgIH0KCiAgICAgIEV2ZW50QnVzLiRlbWl0KCd1cGRhdGVNdWx0aVBhZ2VWYWx1ZScpOwogICAgfQogIH0KCiAgdXBkYXRlVGFiU3RyaXBWYWx1ZShpbmRleCkgewogICAgY29uc3QgdXNlckRhdGEgPSB0aGlzLnVzZXJmb3JtRGF0YVt0aGlzLnVzZXJGb3JtSWRdOwogICAgY29uc3QgdGFicyA9IHVzZXJEYXRhW3RoaXMuY29udHJvbElkXS5leHRyYURhdGFzLlRhYnM7CiAgICBjb25zdCB0YWJJbmRleCA9IHRhYnMuZmluZEluZGV4KCh2YWwsIGtleSkgPT4ga2V5ID09PSBpbmRleCArIDEpOwoKICAgIGlmICh0YWJJbmRleCAhPT0gLTEpIHsKICAgICAgY29uc3QgdmFsdWUgPSBpbmRleCArIDE7CiAgICAgIHRoaXMudXBkYXRlQ29udHJvbFByb3BlcnR5KCdWYWx1ZScsIHZhbHVlLCB0aGlzLmNvbnRyb2xJZCk7CiAgICB9IGVsc2UgaWYgKHRhYkluZGV4ID09PSAtMSAmJiBpbmRleCAhPT0gLTEpIHsKICAgICAgY29uc3QgdmFsdWUgPSBpbmRleDsKICAgICAgdGhpcy51cGRhdGVDb250cm9sUHJvcGVydHkoJ1ZhbHVlJywgdmFsdWUsIHRoaXMuY29udHJvbElkKTsKICAgIH0gZWxzZSB7CiAgICAgIHRoaXMudXBkYXRlQ29udHJvbFByb3BlcnR5KCdWYWx1ZScsIC0xLCB0aGlzLmNvbnRyb2xJZCk7CiAgICB9CiAgfQoKICBjaGFuZ2VTZWxlY3QoY29udHJvbCkgewogICAgdGhpcy5zZWxlY3RDb250cm9sKHsKICAgICAgdXNlckZvcm1JZDogdGhpcy51c2VyRm9ybUlkLAogICAgICBzZWxlY3Q6IHsKICAgICAgICBjb250YWluZXI6IHRoaXMuZ2V0Q29udGFpbmVyTGlzdChjb250cm9sKSwKICAgICAgICBzZWxlY3RlZDogW2NvbnRyb2xdCiAgICAgIH0KICAgIH0pOwogIH0KCiAgdXBkYXRlSW5kZXgoaW5kZXgpIHsKICAgIGNvbnN0IHVzZXJEYXRhID0gdGhpcy51c2VyZm9ybURhdGFbdGhpcy51c2VyRm9ybUlkXTsKICAgIGNvbnN0IGNvbnRyb2xzID0gdXNlckRhdGFbdGhpcy5jb250cm9sSWRdLmNvbnRyb2xzOwogICAgY29uc3QgcGFnZUluZGV4ID0gY29udHJvbHMuZmluZEluZGV4KHZhbCA9PiB1c2VyRGF0YVt2YWxdLnByb3BlcnRpZXMuSW5kZXggPT09IGluZGV4ICsgMSk7CgogICAgaWYgKHBhZ2VJbmRleCAhPT0gLTEpIHsKICAgICAgY29uc3QgdmFsdWUgPSB1c2VyRGF0YVtjb250cm9sc1twYWdlSW5kZXhdXS5wcm9wZXJ0aWVzLkluZGV4OwogICAgICB0aGlzLnVwZGF0ZUNvbnRyb2xQcm9wZXJ0eSgnVmFsdWUnLCB2YWx1ZSwgdGhpcy5jb250cm9sSWQpOwogICAgICB0aGlzLmNoYW5nZVNlbGVjdChjb250cm9sc1twYWdlSW5kZXhdKTsKICAgIH0gZWxzZSBpZiAocGFnZUluZGV4ID09PSAtMSAmJiBpbmRleCAhPT0gLTEpIHsKICAgICAgY29uc3QgdXBkYXRlSW5kZXggPSBjb250cm9scy5maW5kSW5kZXgodmFsID0+IHVzZXJEYXRhW3ZhbF0ucHJvcGVydGllcy5JbmRleCA9PT0gaW5kZXgpOwogICAgICBjb25zdCB2YWx1ZSA9IHVzZXJEYXRhW2NvbnRyb2xzW3VwZGF0ZUluZGV4XV0ucHJvcGVydGllcy5JbmRleDsKICAgICAgdGhpcy51cGRhdGVDb250cm9sUHJvcGVydHkoJ1ZhbHVlJywgdmFsdWUsIHRoaXMuY29udHJvbElkKTsKICAgICAgdGhpcy5jaGFuZ2VTZWxlY3QoY29udHJvbHNbdXBkYXRlSW5kZXhdKTsKICAgIH0gZWxzZSB7CiAgICAgIHRoaXMudXBkYXRlQ29udHJvbFByb3BlcnR5KCdWYWx1ZScsIC0xLCB0aGlzLmNvbnRyb2xJZCk7CiAgICAgIHRoaXMuY2hhbmdlU2VsZWN0KHRoaXMuY29udHJvbElkKTsKICAgIH0KICB9CgogIHVwZGF0ZUNvbnRyb2xQcm9wZXJ0eShwcm9wZXJ0eU5hbWUsIHByb3BlcnR5VmFsdWUsIGNvbnRyb2xJZCkgewogICAgdGhpcy51cGRhdGVDb250cm9sKHsKICAgICAgdXNlckZvcm1JZDogdGhpcy51c2VyRm9ybUlkLAogICAgICBjb250cm9sSWQ6IGNvbnRyb2xJZCwKICAgICAgcHJvcGVydHlOYW1lOiBwcm9wZXJ0eU5hbWUsCiAgICAgIHZhbHVlOiBwcm9wZXJ0eVZhbHVlCiAgICB9KTsKICB9CgogIHVuR3JvdXBDb250cm9sKCkgewogICAgY29uc3QgaXNHcm91cCA9IHRoaXMuc2VsZWN0ZWRDb250cm9sc1t0aGlzLnVzZXJGb3JtSWRdLnNlbGVjdGVkWzBdLnN0YXJ0c1dpdGgoJ2dyb3VwJyk7CiAgICBjb25zdCBzZWxDb250cm9sID0gdGhpcy5zZWxlY3RlZENvbnRyb2xzW3RoaXMudXNlckZvcm1JZF0uc2VsZWN0ZWRbMF07CiAgICBjb25zdCBzZWxlY3RlZCA9IGlzR3JvdXAgPyBzZWxDb250cm9sIDogdGhpcy51c2VyZm9ybURhdGFbdGhpcy51c2VyRm9ybUlkXVtzZWxDb250cm9sXS5wcm9wZXJ0aWVzLkdyb3VwSUQ7CiAgICBjb25zdCBjb250cm9sTGlzdCA9IFtdOwoKICAgIGZvciAoY29uc3Qga2V5IGluIHRoaXMudXNlcmZvcm1EYXRhW3RoaXMudXNlckZvcm1JZF0pIHsKICAgICAgY29uc3QgdHlwZSA9IHRoaXMudXNlcmZvcm1EYXRhW3RoaXMudXNlckZvcm1JZF1ba2V5XS50eXBlOwoKICAgICAgaWYgKHR5cGUgIT09ICdVc2VyZm9ybScgJiYgdGhpcy51c2VyZm9ybURhdGFbdGhpcy51c2VyRm9ybUlkXVtrZXldLnByb3BlcnRpZXMuR3JvdXBJRCA9PT0gc2VsZWN0ZWQpIHsKICAgICAgICBjb250cm9sTGlzdC5wdXNoKGtleSk7CiAgICAgIH0KICAgIH0KCiAgICBjb25zdCBncm91cEFycmF5ID0gWy4uLnRoaXMuZ3JvdXBlZENvbnRyb2xzW3RoaXMudXNlckZvcm1JZF0uZ3JvdXBBcnJheV07CiAgICB0aGlzLnVwZGF0ZUNvbnRyb2xHcm91cElEKHNlbGVjdGVkLCAnJyk7CiAgICBjb25zdCBpbmRleCA9IHRoaXMuZ3JvdXBlZENvbnRyb2xzW3RoaXMudXNlckZvcm1JZF0uZ3JvdXBBcnJheS5maW5kSW5kZXgodmFsID0+IHZhbCA9PT0gc2VsZWN0ZWQpOwogICAgZ3JvdXBBcnJheS5zcGxpY2UoaW5kZXgsIDEpOwogICAgdGhpcy51cGRhdGVHcm91cCh7CiAgICAgIHVzZXJGb3JtSWQ6IHRoaXMudXNlckZvcm1JZCwKICAgICAgZ3JvdXBBcnJheTogZ3JvdXBBcnJheQogICAgfSk7CiAgICB0aGlzLnNlbGVjdENvbnRyb2woewogICAgICB1c2VyRm9ybUlkOiB0aGlzLnVzZXJGb3JtSWQsCiAgICAgIHNlbGVjdDogewogICAgICAgIGNvbnRhaW5lcjogaXNHcm91cCA/IHRoaXMuZ2V0Q29udGFpbmVyTGlzdChjb250cm9sTGlzdFswXSkgOiB0aGlzLmdldENvbnRhaW5lckxpc3Qoc2VsQ29udHJvbFswXSksCiAgICAgICAgc2VsZWN0ZWQ6IGlzR3JvdXAgPyBjb250cm9sTGlzdCA6IFtzZWxDb250cm9sXQogICAgICB9CiAgICB9KTsKICB9CiAgLyoqCiAgICogQGRlc2NyaXB0aW9uIFRvIGdlbmVyYXRlIG5ldyBHcm91cElECiAgICogQGZ1bmN0aW9uIGNyZWF0ZUdyb3VwSWQKICAgKi8KCgogIGNyZWF0ZUdyb3VwSWQoKSB7CiAgICBsZXQgbGFzdENvbnRyb2xJZCA9IDA7CgogICAgZm9yIChsZXQgaSBvZiB0aGlzLmdyb3VwZWRDb250cm9sc1t0aGlzLnVzZXJGb3JtSWRdLmdyb3VwQXJyYXkpIHsKICAgICAgaWYgKGkuaW5kZXhPZignZ3JvdXAnKSAhPT0gLTEpIHsKICAgICAgICBjb25zdCBJZE51bSA9IGkuc3BsaXQoJ2dyb3VwJykucG9wKCkgfHwgJy0xJzsKICAgICAgICBjb25zdCBwYXNyZUlkID0gcGFyc2VJbnQoSWROdW0sIDEwKTsKCiAgICAgICAgaWYgKCFpc05hTihwYXNyZUlkKSAmJiBsYXN0Q29udHJvbElkIDwgcGFzcmVJZCkgewogICAgICAgICAgbGFzdENvbnRyb2xJZCA9IHBhc3JlSWQ7CiAgICAgICAgfQogICAgICB9CiAgICB9CgogICAgcmV0dXJuIGBncm91cCR7bGFzdENvbnRyb2xJZCArIDF9YDsKICB9CgogIGNyZWF0ZUdyb3VwKGdyb3VwSWQpIHsKICAgIHJldHVybiBncm91cElkOwogIH0KCiAgdXBkYXRlQ29udHJvbEdyb3VwSUQoZ3JvdXBOYW1lLCB1cGRhdGVHcm91cElkKSB7CiAgICBmb3IgKGNvbnN0IHZhbCBpbiB0aGlzLnVzZXJmb3JtRGF0YVt0aGlzLnVzZXJGb3JtSWRdKSB7CiAgICAgIGlmICghdmFsLnN0YXJ0c1dpdGgoJ0lEX1VTRVJGT1JNJykpIHsKICAgICAgICBjb25zdCBjb250cm9sR3JwSWQgPSB0aGlzLnVzZXJmb3JtRGF0YVt0aGlzLnVzZXJGb3JtSWRdW3ZhbF0ucHJvcGVydGllcy5Hcm91cElEOwoKICAgICAgICBpZiAoY29udHJvbEdycElkID09PSBncm91cE5hbWUpIHsKICAgICAgICAgIHRoaXMudXBkYXRlQ29udHJvbFByb3BlcnR5KCdHcm91cElEJywgdXBkYXRlR3JvdXBJZCwgdmFsKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICB9CiAgLyoqCiAgICogQGRlc2NyaXB0aW9uIFRvIHVwZGF0ZSB0aGUgZ3JvdXAgSW5mb3JtYXRpb24gaW4gbWFpbiBkYXRhCiAgICogQGZ1bmN0aW9uIGdyb3VwQ29udHJvbAogICAqLwoKCiAgZ3JvdXBDb250cm9sKCkgewogICAgbGV0IHVwZGF0ZUdyb3VwSWQgPSAnJzsKICAgIGNvbnN0IHNlbGVjdGVkID0gdGhpcy5zZWxlY3RlZENvbnRyb2xzW3RoaXMudXNlckZvcm1JZF0uc2VsZWN0ZWQ7CiAgICBjb25zdCBzZWxlY3RlZEdyb3VwQXJyYXkgPSBzZWxlY3RlZC5maWx0ZXIodmFsID0+IHZhbC5zdGFydHNXaXRoKCdncm91cCcpICYmIHZhbCk7CiAgICB1cGRhdGVHcm91cElkID0gc2VsZWN0ZWRHcm91cEFycmF5WzBdOwoKICAgIGlmIChzZWxlY3RlZEdyb3VwQXJyYXkubGVuZ3RoID49IDIpIHsKICAgICAgY29uc3QgZ3JvdXBBcnJheSA9IFsuLi50aGlzLmdyb3VwZWRDb250cm9sc1t0aGlzLnVzZXJGb3JtSWRdLmdyb3VwQXJyYXldOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBncm91cEFycmF5Lmxlbmd0aDsgaSsrKSB7CiAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCBzZWxlY3RlZEdyb3VwQXJyYXkubGVuZ3RoOyBqKyspIHsKICAgICAgICAgIGlmIChzZWxlY3RlZEdyb3VwQXJyYXlbal0gPT09IGdyb3VwQXJyYXlbaV0pIHsKICAgICAgICAgICAgdGhpcy51cGRhdGVDb250cm9sR3JvdXBJRChncm91cEFycmF5W2ldLCBzZWxlY3RlZEdyb3VwQXJyYXlbMF0pOwogICAgICAgICAgICBncm91cEFycmF5LnNwbGljZShpLCAxKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KCiAgICAgIHRoaXMudXBkYXRlR3JvdXAoewogICAgICAgIHVzZXJGb3JtSWQ6IHRoaXMudXNlckZvcm1JZCwKICAgICAgICBncm91cEFycmF5OiBbLi4uZ3JvdXBBcnJheSwgc2VsZWN0ZWRHcm91cEFycmF5WzBdXQogICAgICB9KTsKICAgICAgdXBkYXRlR3JvdXBJZCA9IHNlbGVjdGVkR3JvdXBBcnJheVswXTsKICAgIH0gZWxzZSBpZiAoc2VsZWN0ZWRHcm91cEFycmF5Lmxlbmd0aCA9PT0gMCkgewogICAgICB1cGRhdGVHcm91cElkID0gdGhpcy5jcmVhdGVHcm91cElkKCk7CiAgICAgIGNvbnN0IGdyb3VwQXJyYXkgPSBbLi4udGhpcy5ncm91cGVkQ29udHJvbHNbdGhpcy51c2VyRm9ybUlkXS5ncm91cEFycmF5LCB1cGRhdGVHcm91cElkXTsKICAgICAgdGhpcy51cGRhdGVHcm91cCh7CiAgICAgICAgdXNlckZvcm1JZDogdGhpcy51c2VyRm9ybUlkLAogICAgICAgIGdyb3VwQXJyYXk6IGdyb3VwQXJyYXkKICAgICAgfSk7CiAgICB9CgogICAgZm9yIChsZXQgdmFsIG9mIHNlbGVjdGVkKSB7CiAgICAgIGlmICghdmFsLnN0YXJ0c1dpdGgoJ2dyb3VwJykpIHsKICAgICAgICB0aGlzLnVwZGF0ZUNvbnRyb2xQcm9wZXJ0eSgnR3JvdXBJRCcsIHVwZGF0ZUdyb3VwSWQsIHZhbCk7CiAgICAgIH0KICAgIH0KCiAgICB0aGlzLmNyZWF0ZUdyb3VwKHVwZGF0ZUdyb3VwSWQpOwogICAgdGhpcy5zZWxlY3RDb250cm9sKHsKICAgICAgdXNlckZvcm1JZDogdGhpcy51c2VyRm9ybUlkLAogICAgICBzZWxlY3Q6IHsKICAgICAgICBjb250YWluZXI6IHRoaXMuZ2V0Q29udGFpbmVyTGlzdCh1cGRhdGVHcm91cElkKSwKICAgICAgICBzZWxlY3RlZDogW3VwZGF0ZUdyb3VwSWRdCiAgICAgIH0KICAgIH0pOwogIH0KICAvKioKICAgKiBAZGVzY3JpcHRpb24gVG8gc2VsZWN0IGFsbCB0aGUgY29udHJvbHMgaW4gcmVzcGVjdGl2ZSBjb250YWluZXIgcHJlc2VudCBpbiByZXNwZWN0aXZlIHVzZXJmb3JtCiAgICogQGZ1bmN0aW9uIHNlbGVjdEFsbAogICAqLwoKCiAgc2VsZWN0QWxsKCkgewogICAgLy8gY29uc3Qgc2VsZWNldGVkQ29udGFpbmVyID0gdGhpcy5zZWxlY3RlZENvbnRyb2xzW3RoaXMudXNlckZvcm1JZF0uY29udGFpbmVyWzBdCiAgICBjb25zdCBjb250cm9sT2JqZWN0TGlzdCA9IFsuLi50aGlzLnVzZXJmb3JtRGF0YVt0aGlzLnVzZXJGb3JtSWRdW3RoaXMuY29udGFpbmVySWRdLmNvbnRyb2xzXTsKICAgIGNvbnN0IHNlbGVjZWRHcm91cCA9IFtdOwoKICAgIGZvciAoY29uc3QgdmFsIG9mIGNvbnRyb2xPYmplY3RMaXN0KSB7CiAgICAgIGNvbnN0IGNvbnRyb2xHcm91cElkID0gdGhpcy51c2VyZm9ybURhdGFbdGhpcy51c2VyRm9ybUlkXVt2YWxdLnByb3BlcnRpZXMuR3JvdXBJRDsKCiAgICAgIGlmIChjb250cm9sR3JvdXBJZCAmJiBjb250cm9sR3JvdXBJZCAhPT0gJycpIHsKICAgICAgICAhc2VsZWNlZEdyb3VwLmluY2x1ZGVzKGNvbnRyb2xHcm91cElkKSAmJiBzZWxlY2VkR3JvdXAucHVzaChjb250cm9sR3JvdXBJZCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgc2VsZWNlZEdyb3VwLnB1c2godmFsKTsKICAgICAgfQogICAgfQoKICAgIGlmIChjb250cm9sT2JqZWN0TGlzdC5sZW5ndGggIT09IDApIHsKICAgICAgdGhpcy5zZWxlY3RDb250cm9sKHsKICAgICAgICB1c2VyRm9ybUlkOiB0aGlzLnVzZXJGb3JtSWQsCiAgICAgICAgc2VsZWN0OiB7CiAgICAgICAgICBjb250YWluZXI6IHRoaXMuZ2V0Q29udGFpbmVyTGlzdChzZWxlY2VkR3JvdXBbMF0pLAogICAgICAgICAgc2VsZWN0ZWQ6IFsuLi5zZWxlY2VkR3JvdXBdCiAgICAgICAgfQogICAgICB9KTsKICAgIH0KICB9CiAgLyoqCiAgICogQGRlc2NyaXB0aW9uIFRvIHVwZGF0ZSB0aGUgY3V0dGVkIGNvbnRyb2xzIGluIHJlc3BlY3RpdmUgY29udGFpbmVyIHByZXNlbnQgaW4gcmVzcGVjdGl2ZSB1c2VyZm9ybQogICAqIEBmdW5jdGlvbiBjdXRDb250cm9sCiAgICovCgoKICBjdXRDb250cm9sKCkgewogICAgdGhpcy5jb3B5Q29udHJvbCgnY3V0Jyk7CiAgICB0aGlzLmNsaWNrRGVsZXRlKCk7CiAgfQogIC8qKgogICAqIEBkZXNjcmlwdGlvbiBUbyB1cGRhdGUgdGhlIGNvcGllZCBjb250cm9scyBpbiByZXNwZWN0aXZlIGNvbnRhaW5lciBwcmVzZW50IGluIHJlc3BlY3RpdmUgdXNlcmZvcm0KICAgKiBAZnVuY3Rpb24gY29weUNvbnRyb2wKICAgKi8KCgogIGNvcHlDb250cm9sKHR5cGUpIHsKICAgIGlmICh0aGlzLmNvcGllZENvbnRyb2xbdGhpcy51c2VyRm9ybUlkXVt0aGlzLnVzZXJGb3JtSWRdLmNvbnRyb2xzLmxlbmd0aCA+IDApIHsKICAgICAgY29uc3QgbGVuZ3RoQ291bnQgPSB0aGlzLmNvcGllZENvbnRyb2xbdGhpcy51c2VyRm9ybUlkXVt0aGlzLnVzZXJGb3JtSWRdLmNvbnRyb2xzLmxlbmd0aDsKICAgICAgY29uc3QgY29udHJvbHMgPSBbLi4udGhpcy5jb3BpZWRDb250cm9sW3RoaXMudXNlckZvcm1JZF1bdGhpcy51c2VyRm9ybUlkXS5jb250cm9sc107CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGxlbmd0aENvdW50OyBpKyspIHsKICAgICAgICB0aGlzLmRlbGV0ZUNvcGllZENvbnRyb2woewogICAgICAgICAgdXNlckZvcm1JZDogdGhpcy51c2VyRm9ybUlkLAogICAgICAgICAgcGFyZW50SWQ6IHRoaXMudXNlckZvcm1JZCwKICAgICAgICAgIHRhcmdldElkOiBjb250cm9sc1tpXQogICAgICAgIH0pOwogICAgICB9CiAgICB9CgogICAgY29uc3QgdXNlckZvcm1EYXRhID0gdGhpcy51c2VyZm9ybURhdGFbdGhpcy51c2VyRm9ybUlkXTsKICAgIGNvbnN0IHNlbENvbnRhaW5lciA9IHRoaXMuc2VsZWN0ZWRDb250cm9sc1t0aGlzLnVzZXJGb3JtSWRdLmNvbnRhaW5lclswXTsKICAgIGNvbnN0IHNlbFNlbGVjdGVkID0gdGhpcy5zZWxlY3RlZENvbnRyb2xzW3RoaXMudXNlckZvcm1JZF0uc2VsZWN0ZWQ7CiAgICBjb25zdCB1cGRhdGVTZWxlY3RlZCA9IFtdOwoKICAgIGZvciAobGV0IGNvbnRyb2wgb2Ygc2VsU2VsZWN0ZWQpIHsKICAgICAgaWYgKCFjb250cm9sLnN0YXJ0c1dpdGgoJ2dyb3VwJykgJiYgdXNlckZvcm1EYXRhW2NvbnRyb2xdLnR5cGUgPT09ICdQYWdlJykgewogICAgICAgIGNvbnRyb2wgPSB0aGlzLmdldENvbnRhaW5lckxpc3QoY29udHJvbClbMF07CiAgICAgIH0KCiAgICAgIHVwZGF0ZVNlbGVjdGVkLnB1c2goY29udHJvbCk7CiAgICB9CgogICAgdGhpcy51cGRhdGVDb3B5Q29udHJvbExpc3QoewogICAgICB1c2VyRm9ybUlkOiB0aGlzLnVzZXJGb3JtSWQsCiAgICAgIHBhcmVudElkOiBzZWxDb250YWluZXIsCiAgICAgIHRhcmdldElkOiB1cGRhdGVTZWxlY3RlZCwKICAgICAgdHlwZTogdHlwZQogICAgfSk7CgogICAgY29uc3QgcmVjQ29weUNvbnRyb2wgPSBkYVRhcmdldCA9PiB7CiAgICAgIGNvbnN0IGRhVGFyZ2V0Q29udHJvbHMgPSB1c2VyRm9ybURhdGFbZGFUYXJnZXRdLmNvbnRyb2xzOwoKICAgICAgaWYgKGRhVGFyZ2V0Q29udHJvbHMubGVuZ3RoID4gMCkgewogICAgICAgIGZvciAobGV0IGkgaW4gZGFUYXJnZXRDb250cm9scykgewogICAgICAgICAgY29uc3QgY29udHJvbE9iamVjdCA9IEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkodXNlckZvcm1EYXRhW2RhVGFyZ2V0Q29udHJvbHNbaV1dKSk7CiAgICAgICAgICBjb25zdCBjb250cm9sQXJyYXkgPSBbXTsKICAgICAgICAgIGNvbnN0IGN0cmxPYmogPSB7IC4uLmNvbnRyb2xPYmplY3QsCiAgICAgICAgICAgIGNvbnRyb2xzOiBbXQogICAgICAgICAgfTsKICAgICAgICAgIHRoaXMuYWRkQ29waWVkQ29udHJvbCh7CiAgICAgICAgICAgIHVzZXJGb3JtSWQ6IHRoaXMudXNlckZvcm1JZCwKICAgICAgICAgICAgY29udHJvbElkOiBkYVRhcmdldCwKICAgICAgICAgICAgYWRkSWQ6IGRhVGFyZ2V0Q29udHJvbHNbaV0sCiAgICAgICAgICAgIGl0ZW06IGN0cmxPYmoKICAgICAgICAgIH0pOwogICAgICAgICAgcmVjQ29weUNvbnRyb2woZGFUYXJnZXRDb250cm9sc1tpXSk7CiAgICAgICAgfQogICAgICB9CiAgICB9OwoKICAgIGZvciAobGV0IGtleSBvZiBzZWxTZWxlY3RlZCkgewogICAgICBpZiAoIWtleS5zdGFydHNXaXRoKCdncm91cCcpKSB7CiAgICAgICAgaWYgKHVzZXJGb3JtRGF0YVtrZXldLnR5cGUgPT09ICdQYWdlJykgewogICAgICAgICAga2V5ID0gdGhpcy5nZXRDb250YWluZXJMaXN0KGtleSlbMF07CiAgICAgICAgfQoKICAgICAgICBjb25zdCBjb250cm9sT2JqZWN0ID0gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeSh1c2VyRm9ybURhdGFba2V5XSkpOwogICAgICAgIGNvbnN0IGN0cmxPYmogPSB7IC4uLmNvbnRyb2xPYmplY3QsCiAgICAgICAgICBjb250cm9sczogW10KICAgICAgICB9OwogICAgICAgIHRoaXMuYWRkQ29waWVkQ29udHJvbCh7CiAgICAgICAgICB1c2VyRm9ybUlkOiB0aGlzLnVzZXJGb3JtSWQsCiAgICAgICAgICBjb250cm9sSWQ6IHRoaXMudXNlckZvcm1JZCwKICAgICAgICAgIGFkZElkOiBrZXksCiAgICAgICAgICBpdGVtOiBjdHJsT2JqCiAgICAgICAgfSk7CiAgICAgICAgcmVjQ29weUNvbnRyb2woa2V5KTsKICAgICAgfSBlbHNlIHsKICAgICAgICBmb3IgKGxldCBjdHJsSWQgaW4gdXNlckZvcm1EYXRhKSB7CiAgICAgICAgICBjb25zdCBjb250cm9sUHJvcCA9IHVzZXJGb3JtRGF0YVtjdHJsSWRdLnByb3BlcnRpZXMuR3JvdXBJRDsKCiAgICAgICAgICBpZiAoY29udHJvbFByb3ApIHsKICAgICAgICAgICAgaWYgKGNvbnRyb2xQcm9wID09PSBrZXkpIHsKICAgICAgICAgICAgICBjb25zdCBjb250cm9sT2JqZWN0ID0gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeSh1c2VyRm9ybURhdGFbY3RybElkXSkpOwogICAgICAgICAgICAgIGNvbnN0IGN0cmxPYmogPSB7IC4uLmNvbnRyb2xPYmplY3QsCiAgICAgICAgICAgICAgICBjb250cm9sczogW10KICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgIHRoaXMuYWRkQ29waWVkQ29udHJvbCh7CiAgICAgICAgICAgICAgICB1c2VyRm9ybUlkOiB0aGlzLnVzZXJGb3JtSWQsCiAgICAgICAgICAgICAgICBjb250cm9sSWQ6IHRoaXMudXNlckZvcm1JZCwKICAgICAgICAgICAgICAgIGFkZElkOiBjdHJsSWQsCiAgICAgICAgICAgICAgICBpdGVtOiBjdHJsT2JqCiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgcmVjQ29weUNvbnRyb2woY3RybElkKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgfQogIH0KCiAgdXBkYXRlTmV3Q29udHJvbChwYXJlbnRJZCwgY3RybElkLCBjdHJsT2JqLCBpc1BhcmVudCkgewogICAgdGhpcy5hZGRDb250cm9sKHsKICAgICAgdXNlckZvcm1JZDogdGhpcy51c2VyRm9ybUlkLAogICAgICBjb250cm9sSWQ6IHBhcmVudElkLAogICAgICBhZGRJZDogY3RybElkLAogICAgICBpdGVtOiBjdHJsT2JqCiAgICB9KTsKCiAgICBpZiAoaXNQYXJlbnQpIHsKICAgICAgY29uc3QgbmV3VGFiSW5kZXggPSB0aGlzLnVzZXJmb3JtRGF0YVt0aGlzLnVzZXJGb3JtSWRdW3BhcmVudElkXS5jb250cm9scy5sZW5ndGg7CiAgICAgIHRoaXMudXBkYXRlVGFiSW5kZXhWYWx1ZShjdHJsSWQpOwogICAgICB0aGlzLnVwZGF0ZVpJbmRleFZhbHVlKGN0cmxJZCk7CiAgICB9CiAgfQoKICBuZXdQYXN0ZUNvbnRyb2xJZChrZXksIHBhcmVudElkKSB7CiAgICBjb25zdCB1c2VyRm9ybURhdGEgPSB0aGlzLnVzZXJmb3JtRGF0YVt0aGlzLnVzZXJGb3JtSWRdOwogICAgbGV0IGxhc3RDb250cm9sSWQgPSAwOwogICAgY29uc3QgdHlwZSA9IGtleSBpbiB1c2VyRm9ybURhdGEgPyB1c2VyRm9ybURhdGFba2V5XS50eXBlIDogJyc7CiAgICBjb25zdCBwYXJlbnROYW1lID0gcGFyZW50SWQgIT09ICcnID8gcGFyZW50SWQuc3BsaXQoJ011bHRpUGFnZScpLnBvcCgpIDogLTE7CiAgICBjb25zdCBzZWxlY3RlZENvbnRyb2xOYW1lID0gdHlwZSA9PT0gJ1BhZ2UnID8gYFBhZ2Uke3BhcmVudE5hbWV9X2AgOiBrZXkucmVwbGFjZSgvWzAtOV0vZywgJycpLnNwbGl0KCdfJykucG9wKCk7CiAgICBjb25zdCB1c2VyZm9ybUNvbnRyb2xJZHMgPSBPYmplY3Qua2V5cyh1c2VyRm9ybURhdGEpOwoKICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdXNlcmZvcm1Db250cm9sSWRzLmxlbmd0aDsgaSsrKSB7CiAgICAgIGlmICh1c2VyZm9ybUNvbnRyb2xJZHNbaV0uaW5kZXhPZihzZWxlY3RlZENvbnRyb2xOYW1lKSAhPT0gLTEpIHsKICAgICAgICBjb25zdCBJZE51bSA9IHVzZXJmb3JtQ29udHJvbElkc1tpXS5zcGxpdChzZWxlY3RlZENvbnRyb2xOYW1lKS5wb3AoKSB8fCAnLTEnOwogICAgICAgIGNvbnN0IHBhc3JlSWQgPSBwYXJzZUludChJZE51bSwgMTApOwoKICAgICAgICBpZiAoIWlzTmFOKHBhc3JlSWQpICYmIGxhc3RDb250cm9sSWQgPCBwYXNyZUlkKSB7CiAgICAgICAgICBsYXN0Q29udHJvbElkID0gcGFzcmVJZDsKICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgICBsYXN0Q29udHJvbElkICs9IDE7CiAgICBjb25zdCBOYW1lID0gYCR7c2VsZWN0ZWRDb250cm9sTmFtZX0ke2xhc3RDb250cm9sSWR9YDsKICAgIHJldHVybiBOYW1lOwogIH0KCiAgcmVtb3ZlQ2hpbGRDb250cm9sKGRhVGFyZ2V0LCBkZWxldGVDb250cm9sKSB7CiAgICBjb25zdCByZW1vdmVDb250cm9sID0gWy4uLnRoaXMudXNlcmZvcm1EYXRhW3RoaXMudXNlckZvcm1JZF1bZGFUYXJnZXRdLmNvbnRyb2xzXTsKICAgIGNvbnN0IHJlbW92ZUluZGV4ID0gcmVtb3ZlQ29udHJvbC5maW5kSW5kZXgodmFsID0+IHZhbCA9PT0gZGVsZXRlQ29udHJvbCk7CiAgICByZW1vdmVDb250cm9sLnNwbGljZShyZW1vdmVJbmRleCwgMSk7CiAgICB0aGlzLnNldENoaWxkQ29udHJvbHMoewogICAgICB1c2VyRm9ybUlkOiB0aGlzLnVzZXJGb3JtSWQsCiAgICAgIGNvbnRhaW5lcklkOiBkYVRhcmdldCwKICAgICAgdGFyZ2V0Q29udHJvbHM6IHJlbW92ZUNvbnRyb2wKICAgIH0pOwogIH0KCiAgZ2V0UGFzdGVDb250cm9sU2l6ZSgpIHsKICAgIGNvbnN0IHVzckZybURhdGEgPSB0aGlzLnVzZXJmb3JtRGF0YVt0aGlzLnVzZXJGb3JtSWRdOwogICAgY29uc3QgcGFzdGVDb250cm9scyA9IFsuLi50aGlzLmdldFNlbGVjdGVkQ29udHJvbHNEYXRhc107CiAgICBjb25zdCBwYXN0ZUNvbnRhaW5lciA9IHRoaXMuc2VsZWN0ZWRDb250cm9sc1t0aGlzLnVzZXJGb3JtSWRdLmNvbnRhaW5lclswXTsKICAgIGNvbnN0IGxlZnRBcnJheSA9IFsuLi5wYXN0ZUNvbnRyb2xzXTsKICAgIGNvbnN0IHRvcEFycmF5ID0gWy4uLnBhc3RlQ29udHJvbHNdOwogICAgY29uc3QgcmlnaHRBcnJheSA9IFsuLi5wYXN0ZUNvbnRyb2xzXTsKICAgIGNvbnN0IGJvdHRvbUFycmF5ID0gWy4uLnBhc3RlQ29udHJvbHNdOwogICAgbGVmdEFycmF5LnNvcnQoKGEsIGIpID0+IHsKICAgICAgcmV0dXJuIHVzckZybURhdGFbYV0ucHJvcGVydGllcy5MZWZ0IC0gdXNyRnJtRGF0YVtiXS5wcm9wZXJ0aWVzLkxlZnQ7CiAgICB9KTsKICAgIHRvcEFycmF5LnNvcnQoKGEsIGIpID0+IHsKICAgICAgcmV0dXJuIHVzckZybURhdGFbYV0ucHJvcGVydGllcy5Ub3AgLSB1c3JGcm1EYXRhW2JdLnByb3BlcnRpZXMuVG9wOwogICAgfSk7CiAgICByaWdodEFycmF5LnNvcnQoKGEsIGIpID0+IHsKICAgICAgcmV0dXJuIHVzckZybURhdGFbYl0ucHJvcGVydGllcy5MZWZ0ICsgdXNyRnJtRGF0YVtiXS5wcm9wZXJ0aWVzLldpZHRoIC0gKHVzckZybURhdGFbYV0ucHJvcGVydGllcy5MZWZ0ICsgdXNyRnJtRGF0YVthXS5wcm9wZXJ0aWVzLldpZHRoKTsKICAgIH0pOwogICAgYm90dG9tQXJyYXkuc29ydCgoYSwgYikgPT4gewogICAgICByZXR1cm4gdXNyRnJtRGF0YVtiXS5wcm9wZXJ0aWVzLlRvcCArIHVzckZybURhdGFbYl0ucHJvcGVydGllcy5IZWlnaHQgLSAodXNyRnJtRGF0YVthXS5wcm9wZXJ0aWVzLlRvcCArIHVzckZybURhdGFbYV0ucHJvcGVydGllcy5IZWlnaHQpOwogICAgfSk7CiAgICBjb25zdCBncm91cFJlY3RMZWZ0ID0gdXNyRnJtRGF0YVtsZWZ0QXJyYXlbMF1dLnByb3BlcnRpZXMuTGVmdDsKICAgIGNvbnN0IGdyb3VwUmVjdFRvcCA9IHVzckZybURhdGFbdG9wQXJyYXlbMF1dLnByb3BlcnRpZXMuVG9wOwogICAgY29uc3QgZ3JvdXBSZWN0Qm90dG9tID0gdXNyRnJtRGF0YVtib3R0b21BcnJheVswXV0ucHJvcGVydGllcy5Ub3AgKyB1c3JGcm1EYXRhW2JvdHRvbUFycmF5WzBdXS5wcm9wZXJ0aWVzLkhlaWdodDsKICAgIGNvbnN0IGdyb3VwUmVjdFJpZ2h0ID0gdXNyRnJtRGF0YVtyaWdodEFycmF5WzBdXS5wcm9wZXJ0aWVzLkxlZnQgKyB1c3JGcm1EYXRhW3JpZ2h0QXJyYXlbMF1dLnByb3BlcnRpZXMuV2lkdGg7CiAgICBjb25zdCBkZWx0YVRvcCA9IChncm91cFJlY3RCb3R0b20gLSBncm91cFJlY3RUb3ApIC8gMjsKICAgIGNvbnN0IGRlbHRhTGVmdCA9IChncm91cFJlY3RSaWdodCAtIGdyb3VwUmVjdExlZnQpIC8gMjsKICAgIGNvbnN0IHR5cGUgPSB0aGlzLnVzZXJmb3JtRGF0YVt0aGlzLnVzZXJGb3JtSWRdW3Bhc3RlQ29udGFpbmVyXS50eXBlOwogICAgY29uc3QgY29udGFpbmVyID0gdHlwZSA9PT0gJ1BhZ2UnID8gdGhpcy51c2VyZm9ybURhdGFbdGhpcy51c2VyRm9ybUlkXVt0aGlzLmdldENvbnRhaW5lckxpc3QocGFzdGVDb250YWluZXIpWzBdXS5wcm9wZXJ0aWVzIDogdGhpcy51c2VyZm9ybURhdGFbdGhpcy51c2VyRm9ybUlkXVtwYXN0ZUNvbnRhaW5lcl0ucHJvcGVydGllczsKICAgIGNvbnN0IGNvbnRhaW5lckhlaWdodCA9IHR5cGUgPT09ICdVc2VyZm9ybScgPyBjb250YWluZXIuSGVpZ2h0IC0gMzcgOiBjb250YWluZXIuSGVpZ2h0OwogICAgY29uc3QgdGFyZ2V0VG9wID0gY29udGFpbmVySGVpZ2h0IC8gMiAtIGRlbHRhVG9wOwogICAgY29uc3QgdGFyZ2V0TGVmdCA9IGNvbnRhaW5lci5XaWR0aCAvIDIgLSBkZWx0YUxlZnQ7CiAgICBjb25zdCBkaWZmVG9wID0gdGFyZ2V0VG9wIC0gdXNyRnJtRGF0YVt0b3BBcnJheVswXV0ucHJvcGVydGllcy5Ub3A7CiAgICBjb25zdCBkaWZmTGVmdCA9IHRhcmdldExlZnQgLSB1c3JGcm1EYXRhW2xlZnRBcnJheVswXV0ucHJvcGVydGllcy5MZWZ0OwoKICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbGVmdEFycmF5Lmxlbmd0aDsgaSsrKSB7CiAgICAgIGxldCBsZWZ0ID0gdXNyRnJtRGF0YVtsZWZ0QXJyYXlbaV1dLnByb3BlcnRpZXMuTGVmdCArIGRpZmZMZWZ0OwoKICAgICAgaWYgKCFpc05hTihsZWZ0KSkgewogICAgICAgIHRoaXMudXBkYXRlQ29udHJvbFByb3BlcnR5KCdMZWZ0JywgTWF0aC5hYnMobGVmdCksIGxlZnRBcnJheVtpXSk7CiAgICAgIH0KICAgIH0KCiAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRvcEFycmF5Lmxlbmd0aDsgaSsrKSB7CiAgICAgIGxldCB0b3AgPSB1c3JGcm1EYXRhW3RvcEFycmF5W2ldXS5wcm9wZXJ0aWVzLlRvcCArIGRpZmZUb3A7CgogICAgICBpZiAoIWlzTmFOKHRvcCkpIHsKICAgICAgICB0aGlzLnVwZGF0ZUNvbnRyb2xQcm9wZXJ0eSgnVG9wJywgTWF0aC5hYnModG9wKSwgdG9wQXJyYXlbaV0pOwogICAgICB9CiAgICB9CiAgfQogIC8qKgogICAqIEBkZXNjcmlwdGlvbiBUbyBwYXN0ZSBjb250cm9scyBpbiByZXNwZWN0aXZlIGNvbnRhaW5lciBwcmVzZW50IGluIHJlc3BlY3RpdmUgdXNlcmZvcm0KICAgKiBAZnVuY3Rpb24gcGFzdGVDb250cm9sCiAgICovCgoKICBwYXN0ZUNvbnRyb2woKSB7CiAgICBpZiAodGhpcy5jb3B5Q29udHJvbExpc3QudHlwZSA9PT0gJ2NvcHknKSB7CiAgICAgIGNvbnN0IHNlbENvbnRhaW5lciA9IHRoaXMuY29weUNvbnRyb2xMaXN0LnBhcmVudElkOwogICAgICBjb25zdCBzZWxTZWxlY3RlZCA9IHRoaXMuY29weUNvbnRyb2xMaXN0LnRhcmdldElkOwogICAgICBjb25zdCB1c2VyRm9ybURhdGEgPSB0aGlzLnVzZXJmb3JtRGF0YVt0aGlzLnVzZXJGb3JtSWRdOwogICAgICBjb25zdCBwcmVzZW50R3JvdXBJZCA9IFtdOwogICAgICBjb25zdCBuZXdHcm91cElkID0gW107CiAgICAgIGNvbnN0IG9sZENvbnRyb2xJZCA9IFtdOwogICAgICBjb25zdCBuZXdDb250cm9sSWQgPSBbXTsKCiAgICAgIGZvciAoY29uc3Qga2V5IGluIHRoaXMuY29waWVkQ29udHJvbFt0aGlzLnVzZXJGb3JtSWRdKSB7CiAgICAgICAgY29uc3QgY29udHJvbFByb3AgPSB0aGlzLmNvcGllZENvbnRyb2xbdGhpcy51c2VyRm9ybUlkXVtrZXldLnByb3BlcnRpZXMuR3JvdXBJRDsKCiAgICAgICAgaWYgKGNvbnRyb2xQcm9wICYmICFwcmVzZW50R3JvdXBJZC5pbmNsdWRlcyhjb250cm9sUHJvcCkpIHsKICAgICAgICAgIHByZXNlbnRHcm91cElkLnB1c2goY29udHJvbFByb3ApOwogICAgICAgIH0KICAgICAgfQoKICAgICAgZm9yIChsZXQgaiBpbiBwcmVzZW50R3JvdXBJZCkgewogICAgICAgIGNvbnN0IG5ld0lkID0gdGhpcy5jcmVhdGVHcm91cElkKCk7CiAgICAgICAgbmV3R3JvdXBJZC5wdXNoKG5ld0lkKTsKICAgICAgICBsZXQgZ3JvdXBBcnJheSA9IFsuLi50aGlzLmdyb3VwZWRDb250cm9sc1t0aGlzLnVzZXJGb3JtSWRdLmdyb3VwQXJyYXksIG5ld0lkXTsKICAgICAgICB0aGlzLnVwZGF0ZUdyb3VwKHsKICAgICAgICAgIHVzZXJGb3JtSWQ6IHRoaXMudXNlckZvcm1JZCwKICAgICAgICAgIGdyb3VwQXJyYXk6IGdyb3VwQXJyYXkKICAgICAgICB9KTsKICAgICAgfQoKICAgICAgY29uc3QgcmVjQ29weUNvbnRyb2wgPSBkYVRhcmdldCA9PiB7CiAgICAgICAgY29uc3QgZGFUYXJnZXRDb250cm9scyA9IHVzZXJGb3JtRGF0YVtkYVRhcmdldF0uY29udHJvbHM7CgogICAgICAgIGlmIChkYVRhcmdldENvbnRyb2xzICYmIGRhVGFyZ2V0Q29udHJvbHMubGVuZ3RoID4gMCkgewogICAgICAgICAgZm9yIChsZXQgaSA9IDAsIGxpbWl0ID0gZGFUYXJnZXRDb250cm9scy5sZW5ndGg7IGkgPCBsaW1pdDsgaSsrKSB7CiAgICAgICAgICAgIGNvbnN0IGtleSA9IGRhVGFyZ2V0Q29udHJvbHNbaV07CiAgICAgICAgICAgIGNvbnN0IE5hbWUgPSB0aGlzLm5ld1Bhc3RlQ29udHJvbElkKGtleSwgZGFUYXJnZXQpOwogICAgICAgICAgICBjb25zdCBjb250cm9sSUQgPSBgSURfJHtOYW1lfWA7CiAgICAgICAgICAgIGNvbnN0IGNvbnRyb2xPYmogPSB7IC4uLnRoaXMuY29waWVkQ29udHJvbFt0aGlzLnVzZXJGb3JtSWRdW2tleV0KICAgICAgICAgICAgfTsKICAgICAgICAgICAgbGV0IGdyb3VwSWRJbmRleCA9IC0xOwogICAgICAgICAgICBncm91cElkSW5kZXggPSBwcmVzZW50R3JvdXBJZC5maW5kSW5kZXgodmFsID0+IHZhbCA9PT0gY29udHJvbE9iai5wcm9wZXJ0aWVzLkdyb3VwSUQpOwogICAgICAgICAgICBjb25zdCBpdGVtID0geyAuLi5jb250cm9sT2JqLAogICAgICAgICAgICAgIHByb3BlcnRpZXM6IHsgLi4uY29udHJvbE9iai5wcm9wZXJ0aWVzLAogICAgICAgICAgICAgICAgSUQ6IGNvbnRyb2xJRCwKICAgICAgICAgICAgICAgIEdyb3VwSUQ6IGdyb3VwSWRJbmRleCAhPT0gLTEgPyBuZXdHcm91cElkW2dyb3VwSWRJbmRleF0gOiAnJywKICAgICAgICAgICAgICAgIE5hbWU6IE5hbWUKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH07CiAgICAgICAgICAgIHRoaXMucmVtb3ZlQ2hpbGRDb250cm9sKGRhVGFyZ2V0LCBrZXkpOwogICAgICAgICAgICB0aGlzLnVwZGF0ZU5ld0NvbnRyb2woZGFUYXJnZXQsIGNvbnRyb2xJRCwgaXRlbSwgZmFsc2UpOwogICAgICAgICAgICByZWNDb3B5Q29udHJvbChjb250cm9sSUQpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfTsKCiAgICAgIGZvciAoY29uc3Qga2V5IG9mIHNlbFNlbGVjdGVkKSB7CiAgICAgICAgaWYgKCFrZXkuc3RhcnRzV2l0aCgnZ3JvdXAnKSkgewogICAgICAgICAgb2xkQ29udHJvbElkLnB1c2goa2V5KTsKICAgICAgICAgIGNvbnN0IE5hbWUgPSB0aGlzLm5ld1Bhc3RlQ29udHJvbElkKGtleSwgJycpOwogICAgICAgICAgY29uc3QgY29udHJvbElEID0gYElEXyR7TmFtZX1gOwogICAgICAgICAgY29uc3QgY29udHJvbE9iaiA9IHsgLi4udGhpcy5jb3BpZWRDb250cm9sW3RoaXMudXNlckZvcm1JZF1ba2V5XQogICAgICAgICAgfTsKICAgICAgICAgIG5ld0NvbnRyb2xJZC5wdXNoKGNvbnRyb2xJRCk7CiAgICAgICAgICBsZXQgZ3JvdXBJZEluZGV4ID0gLTE7CiAgICAgICAgICBncm91cElkSW5kZXggPSBwcmVzZW50R3JvdXBJZC5maW5kSW5kZXgodmFsID0+IGNvbnRyb2xPYmoucHJvcGVydGllcy5Hcm91cElEID09PSB2YWwpOwoKICAgICAgICAgIGlmIChzZWxTZWxlY3RlZC5sZW5ndGggPT09IDEgJiYgdGhpcy5jb3BpZWRDb250cm9sW3RoaXMudXNlckZvcm1JZF1bc2VsU2VsZWN0ZWRbMF1dLnByb3BlcnRpZXMuR3JvdXBJRCAhPT0gJycpIHsKICAgICAgICAgICAgZ3JvdXBJZEluZGV4ID0gLTE7CiAgICAgICAgICB9CgogICAgICAgICAgY29uc3QgaXRlbSA9IHsgLi4uY29udHJvbE9iaiwKICAgICAgICAgICAgcHJvcGVydGllczogeyAuLi5jb250cm9sT2JqLnByb3BlcnRpZXMsCiAgICAgICAgICAgICAgSUQ6IGNvbnRyb2xJRCwKICAgICAgICAgICAgICBHcm91cElEOiBncm91cElkSW5kZXggIT09IC0xID8gbmV3R3JvdXBJZFtncm91cElkSW5kZXhdIDogJycsCiAgICAgICAgICAgICAgTmFtZTogTmFtZQogICAgICAgICAgICB9CiAgICAgICAgICB9OwogICAgICAgICAgdGhpcy51cGRhdGVOZXdDb250cm9sKHRoaXMuY29udGFpbmVySWQsIGNvbnRyb2xJRCwgaXRlbSwgdHJ1ZSk7CiAgICAgICAgICByZWNDb3B5Q29udHJvbChjb250cm9sSUQpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBmb3IgKGxldCBjdHJsSWQgaW4gdGhpcy5jb3BpZWRDb250cm9sW3RoaXMudXNlckZvcm1JZF0pIHsKICAgICAgICAgICAgY29uc3QgY29udHJvbFByb3AgPSB0aGlzLmNvcGllZENvbnRyb2xbdGhpcy51c2VyRm9ybUlkXVtjdHJsSWRdLnByb3BlcnRpZXMuR3JvdXBJRDsKCiAgICAgICAgICAgIGlmIChjb250cm9sUHJvcCkgewogICAgICAgICAgICAgIGlmIChjb250cm9sUHJvcCA9PT0ga2V5KSB7CiAgICAgICAgICAgICAgICBjb25zdCBOYW1lID0gdGhpcy5uZXdQYXN0ZUNvbnRyb2xJZChjdHJsSWQsICcnKTsKICAgICAgICAgICAgICAgIGNvbnN0IGNvbnRyb2xJRCA9IGBJRF8ke05hbWV9YDsKICAgICAgICAgICAgICAgIGNvbnN0IGNvbnRyb2xPYmogPSB0aGlzLmNvcGllZENvbnRyb2xbdGhpcy51c2VyRm9ybUlkXVtjdHJsSWRdOwogICAgICAgICAgICAgICAgbGV0IGdyb3VwSWRJbmRleCA9IC0xOwogICAgICAgICAgICAgICAgZ3JvdXBJZEluZGV4ID0gcHJlc2VudEdyb3VwSWQuZmluZEluZGV4KHZhbCA9PiBjb250cm9sT2JqLnByb3BlcnRpZXMuR3JvdXBJRCA9PT0gdmFsKTsKICAgICAgICAgICAgICAgIGNvbnN0IGl0ZW0gPSB7IC4uLmNvbnRyb2xPYmosCiAgICAgICAgICAgICAgICAgIHByb3BlcnRpZXM6IHsgLi4uY29udHJvbE9iai5wcm9wZXJ0aWVzLAogICAgICAgICAgICAgICAgICAgIElEOiBjb250cm9sSUQsCiAgICAgICAgICAgICAgICAgICAgR3JvdXBJRDogZ3JvdXBJZEluZGV4ICE9PSAtMSA/IG5ld0dyb3VwSWRbZ3JvdXBJZEluZGV4XSA6ICcnLAogICAgICAgICAgICAgICAgICAgIE5hbWU6IE5hbWUKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgIHRoaXMudXBkYXRlTmV3Q29udHJvbCh0aGlzLmNvbnRhaW5lcklkLCBjb250cm9sSUQsIGl0ZW0sIHRydWUpOwogICAgICAgICAgICAgICAgcmVjQ29weUNvbnRyb2woY29udHJvbElEKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KCiAgICAgIGZvciAobGV0IGogb2YgbmV3R3JvdXBJZCkgewogICAgICAgIHRoaXMuY3JlYXRlR3JvdXAoaik7CiAgICAgIH0KCiAgICAgIGNvbnN0IG5ld1NlbGVjdGVkID0gW107CgogICAgICBmb3IgKGNvbnN0IGNvbnRyb2wgb2Ygc2VsU2VsZWN0ZWQpIHsKICAgICAgICBpZiAoY29udHJvbC5zdGFydHNXaXRoKCdncm91cCcpKSB7CiAgICAgICAgICBjb25zdCBpbmRleCA9IHByZXNlbnRHcm91cElkLmZpbmRJbmRleCh2YWwgPT4gdmFsID09PSBjb250cm9sKTsKICAgICAgICAgIG5ld1NlbGVjdGVkLnB1c2gobmV3R3JvdXBJZFtpbmRleF0pOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBjb25zdCBpbmRleCA9IG9sZENvbnRyb2xJZC5maW5kSW5kZXgodmFsID0+IHZhbCA9PT0gY29udHJvbCk7CiAgICAgICAgICBuZXdTZWxlY3RlZC5wdXNoKG5ld0NvbnRyb2xJZFtpbmRleF0pOwogICAgICAgIH0KICAgICAgfQoKICAgICAgdGhpcy5zZWxlY3RDb250cm9sKHsKICAgICAgICB1c2VyRm9ybUlkOiB0aGlzLnVzZXJGb3JtSWQsCiAgICAgICAgc2VsZWN0OiB7CiAgICAgICAgICBjb250YWluZXI6IHRoaXMuZ2V0Q29udGFpbmVyTGlzdChuZXdTZWxlY3RlZFswXSksCiAgICAgICAgICBzZWxlY3RlZDogbmV3U2VsZWN0ZWQKICAgICAgICB9CiAgICAgIH0pOwogICAgfSBlbHNlIGlmICh0aGlzLmNvcHlDb250cm9sTGlzdC50eXBlID09PSAnY3V0JykgewogICAgICBjb25zdCBzZWxDb250YWluZXIgPSB0aGlzLmNvcHlDb250cm9sTGlzdC5wYXJlbnRJZDsKICAgICAgY29uc3Qgc2VsU2VsZWN0ZWQgPSB0aGlzLmNvcHlDb250cm9sTGlzdC50YXJnZXRJZDsKICAgICAgY29uc3QgdXNlckZvcm1EYXRhID0gdGhpcy5jb3BpZWRDb250cm9sW3RoaXMudXNlckZvcm1JZF07CgogICAgICBjb25zdCByZWNDb3B5Q29udHJvbCA9IGRhVGFyZ2V0ID0+IHsKICAgICAgICBjb25zdCBkYVRhcmdldENvbnRyb2xzID0gdXNlckZvcm1EYXRhW2RhVGFyZ2V0XS5jb250cm9sczsKCiAgICAgICAgaWYgKGRhVGFyZ2V0Q29udHJvbHMubGVuZ3RoID4gMCkgewogICAgICAgICAgZm9yIChsZXQgaSA9IDAsIGxpbWl0ID0gZGFUYXJnZXRDb250cm9scy5sZW5ndGg7IGkgPCBsaW1pdDsgaSsrKSB7CiAgICAgICAgICAgIGNvbnN0IGtleSA9IGRhVGFyZ2V0Q29udHJvbHNbaV07CiAgICAgICAgICAgIGNvbnN0IGNvbnRyb2xPYmogPSBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KHRoaXMuY29waWVkQ29udHJvbFt0aGlzLnVzZXJGb3JtSWRdW2tleV0pKTsKICAgICAgICAgICAgY29uc3QgaXRlbSA9IHsgLi4uY29udHJvbE9iagogICAgICAgICAgICB9OwogICAgICAgICAgICB0aGlzLnJlbW92ZUNoaWxkQ29udHJvbChkYVRhcmdldCwga2V5KTsKICAgICAgICAgICAgdGhpcy51cGRhdGVOZXdDb250cm9sKGRhVGFyZ2V0LCBrZXksIGl0ZW0sIGZhbHNlKTsKICAgICAgICAgICAgcmVjQ29weUNvbnRyb2woa2V5KTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH07CgogICAgICBmb3IgKGNvbnN0IGtleSBvZiBzZWxTZWxlY3RlZCkgewogICAgICAgIGlmICgha2V5LnN0YXJ0c1dpdGgoJ2dyb3VwJykpIHsKICAgICAgICAgIGNvbnN0IGNvbnRyb2xPYmogPSBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KHRoaXMuY29waWVkQ29udHJvbFt0aGlzLnVzZXJGb3JtSWRdW2tleV0pKTsKCiAgICAgICAgICBpZiAoc2VsU2VsZWN0ZWQubGVuZ3RoID09PSAxICYmIHVzZXJGb3JtRGF0YVtzZWxTZWxlY3RlZFswXV0ucHJvcGVydGllcy5Hcm91cElEICE9PSAnJykgewogICAgICAgICAgICBjb250cm9sT2JqLnByb3BlcnRpZXMuR3JvdXBJRCA9ICcnOwogICAgICAgICAgfQoKICAgICAgICAgIGNvbnN0IGl0ZW0gPSB7IC4uLmNvbnRyb2xPYmoKICAgICAgICAgIH07CiAgICAgICAgICB0aGlzLnVwZGF0ZU5ld0NvbnRyb2wodGhpcy5jb250YWluZXJJZCwga2V5LCBpdGVtLCB0cnVlKTsKICAgICAgICAgIHJlY0NvcHlDb250cm9sKGtleSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGZvciAobGV0IGN0cmxJZCBpbiB1c2VyRm9ybURhdGEpIHsKICAgICAgICAgICAgY29uc3QgY29udHJvbFByb3AgPSB1c2VyRm9ybURhdGFbY3RybElkXS5wcm9wZXJ0aWVzLkdyb3VwSUQ7CgogICAgICAgICAgICBpZiAoY29udHJvbFByb3ApIHsKICAgICAgICAgICAgICBpZiAoY29udHJvbFByb3AgPT09IGtleSkgewogICAgICAgICAgICAgICAgY29uc3QgY29udHJvbE9iaiA9IEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkodGhpcy5jb3BpZWRDb250cm9sW3RoaXMudXNlckZvcm1JZF1bY3RybElkXSkpOwogICAgICAgICAgICAgICAgY29uc3QgaXRlbSA9IHsgLi4uY29udHJvbE9iagogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgIHRoaXMudXBkYXRlTmV3Q29udHJvbCh0aGlzLmNvbnRhaW5lcklkLCBjdHJsSWQsIGl0ZW0sIHRydWUpOwogICAgICAgICAgICAgICAgcmVjQ29weUNvbnRyb2woY3RybElkKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KCiAgICAgIHRoaXMuc2VsZWN0Q29udHJvbCh7CiAgICAgICAgdXNlckZvcm1JZDogdGhpcy51c2VyRm9ybUlkLAogICAgICAgIHNlbGVjdDogewogICAgICAgICAgY29udGFpbmVyOiB0aGlzLmdldENvbnRhaW5lckxpc3Qoc2VsU2VsZWN0ZWRbMF0pLAogICAgICAgICAgc2VsZWN0ZWQ6IHNlbFNlbGVjdGVkCiAgICAgICAgfQogICAgICB9KTsKICAgICAgdGhpcy51cGRhdGVDb3B5Q29udHJvbExpc3QoewogICAgICAgIHVzZXJGb3JtSWQ6IHRoaXMudXNlckZvcm1JZCwKICAgICAgICBwYXJlbnRJZDogdGhpcy5jb250YWluZXJJZCwKICAgICAgICB0YXJnZXRJZDogc2VsU2VsZWN0ZWQsCiAgICAgICAgdHlwZTogJ2NvcHknCiAgICAgIH0pOwogICAgfQoKICAgIHRoaXMuZ2V0UGFzdGVDb250cm9sU2l6ZSgpOwogICAgY29uc3Qgc2VsU2VsZWN0ZWQgPSB0aGlzLnNlbGVjdGVkQ29udHJvbHNbdGhpcy51c2VyRm9ybUlkXS5zZWxlY3RlZDsKCiAgICBmb3IgKGNvbnN0IGNvbnRyb2wgb2Ygc2VsU2VsZWN0ZWQpIHsKICAgICAgaWYgKGNvbnRyb2wuc3RhcnRzV2l0aCgnZ3JvdXAnKSkgewogICAgICAgIHRoaXMuY3JlYXRlR3JvdXAoY29udHJvbCk7CiAgICAgIH0KICAgIH0KICB9CiAgLyoqCiAgICogQGRlc2NyaXB0aW9uIFRvIGRlbGV0ZSBjb250cm9scyBpbiByZXNwZWN0aXZlIGNvbnRhaW5lciBwcmVzZW50IGluIHJlc3BlY3RpdmUgdXNlcmZvcm0KICAgKiBAZnVuY3Rpb24gY2xpY2tEZWxldGUKICAgKi8KCgogIGNsaWNrRGVsZXRlKCkgewogICAgY29uc3Qgc2VsQ29udHJvbCA9IFtdOwogICAgY29uc3QgdXNlckRhdGEgPSB0aGlzLnVzZXJmb3JtRGF0YVt0aGlzLnVzZXJGb3JtSWRdOwogICAgY29uc3Qgc2VsZWN0ZWQgPSB0aGlzLnNlbGVjdGVkQ29udHJvbHNbdGhpcy51c2VyRm9ybUlkXS5zZWxlY3RlZDsKICAgIGNvbnN0IHNlbENvbnRhaW5lciA9IHRoaXMuc2VsZWN0ZWRDb250cm9sc1t0aGlzLnVzZXJGb3JtSWRdLmNvbnRhaW5lcjsKICAgIGNvbnN0IGZpbHRlckNvbnRyb2xzID0gW107CiAgICBjb25zdCBjb250cm9scyA9IHRoaXMudXNlcmZvcm1EYXRhW3RoaXMudXNlckZvcm1JZF1bdGhpcy5zZWxlY3RlZENvbnRyb2xzW3RoaXMudXNlckZvcm1JZF0uY29udGFpbmVyWzBdXS5jb250cm9sczsKCiAgICBmb3IgKGNvbnN0IGNvbnRyb2wgb2Ygc2VsZWN0ZWQpIHsKICAgICAgaWYgKCFjb250cm9sLnN0YXJ0c1dpdGgoJ0lEX1VTRVJGT1JNJykpIHsKICAgICAgICBpZiAoY29udHJvbC5zdGFydHNXaXRoKCdncm91cCcpKSB7CiAgICAgICAgICBmb3IgKGNvbnN0IGtleSBpbiB1c2VyRGF0YSkgewogICAgICAgICAgICBpZiAodXNlckRhdGFba2V5XS5wcm9wZXJ0aWVzLkdyb3VwSUQgPT09IGNvbnRyb2wpIHsKICAgICAgICAgICAgICBzZWxDb250cm9sLnB1c2goa2V5KTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBzZWxDb250cm9sLnB1c2goY29udHJvbCk7CiAgICAgICAgfQogICAgICB9CiAgICB9CgogICAgaWYgKHNlbGVjdGVkLmxlbmd0aCA9PT0gMSAmJiAhc2VsZWN0ZWRbMF0uc3RhcnRzV2l0aCgnZ3JvdXAnKSAmJiB0aGlzLnVzZXJmb3JtRGF0YVt0aGlzLnVzZXJGb3JtSWRdW3NlbGVjdGVkWzBdXS5wcm9wZXJ0aWVzLkdyb3VwSUQgIT09ICcnKSB7CiAgICAgIGZvciAobGV0IGogPSAwOyBqIDwgY29udHJvbHMubGVuZ3RoOyBqKyspIHsKICAgICAgICBpZiAodXNlckRhdGFbY29udHJvbHNbal1dLnByb3BlcnRpZXMuR3JvdXBJRCA9PT0gdXNlckRhdGFbc2VsZWN0ZWRbMF1dLnByb3BlcnRpZXMuR3JvdXBJRCkgewogICAgICAgICAgZmlsdGVyQ29udHJvbHMucHVzaChjb250cm9sc1tqXSk7CiAgICAgICAgfQogICAgICB9CgogICAgICBpZiAoZmlsdGVyQ29udHJvbHMubGVuZ3RoID09PSAyKSB7CiAgICAgICAgY29uc3QgY3VyU2VsZWN0ID0gZmlsdGVyQ29udHJvbHNbMF0gPT09IHNlbGVjdGVkWzBdID8gZmlsdGVyQ29udHJvbHNbMV0gOiBmaWx0ZXJDb250cm9sc1swXTsKICAgICAgICBjb25zdCBzZWxHcm91cElkID0gdXNlckRhdGFbc2VsZWN0ZWRbMF1dLnByb3BlcnRpZXMuR3JvdXBJRDsKICAgICAgICB0aGlzLnVwZGF0ZUNvbnRyb2xQcm9wZXJ0eSgnR3JvdXBJRCcsICcnLCBjdXJTZWxlY3QpOwogICAgICB9CiAgICB9CgogICAgZm9yIChsZXQgaSA9IDA7IGkgPCBzZWxDb250cm9sLmxlbmd0aDsgaSsrKSB7CiAgICAgIGNvbnN0IGNvbnRyb2xJZCA9IHVzZXJEYXRhW3NlbENvbnRyb2xbaV1dLnR5cGUgPT09ICdQYWdlJyA/IHNlbENvbnRhaW5lclswXSA6IHNlbENvbnRyb2xbaV07CiAgICAgIHRoaXMuZGVsZXRlWkluZGV4KGNvbnRyb2xJZCk7CiAgICAgIHRoaXMuZGVsZXRlVGFiSW5kZXgoY29udHJvbElkKTsKICAgICAgdGhpcy5kZWxldGVDb250cm9sKHsKICAgICAgICB1c2VyRm9ybUlkOiB0aGlzLnVzZXJGb3JtSWQsCiAgICAgICAgcGFyZW50SWQ6IHRoaXMuZ2V0Q29udGFpbmVyTGlzdChjb250cm9sSWQpWzBdLAogICAgICAgIHRhcmdldElkOiBjb250cm9sSWQKICAgICAgfSk7CiAgICB9CgogICAgdGhpcy5zZWxlY3RDb250cm9sKHsKICAgICAgdXNlckZvcm1JZDogdGhpcy51c2VyRm9ybUlkLAogICAgICBzZWxlY3Q6IHsKICAgICAgICBjb250YWluZXI6IHVzZXJEYXRhW3NlbENvbnRhaW5lclswXV0udHlwZSA9PT0gJ011bHRpUGFnZScgPyB0aGlzLmdldENvbnRhaW5lckxpc3Qoc2VsQ29udGFpbmVyWzBdKSA6IHNlbENvbnRhaW5lciwKICAgICAgICBzZWxlY3RlZDogdXNlckRhdGFbc2VsQ29udGFpbmVyWzBdXS50eXBlID09PSAnTXVsdGlQYWdlJyA/IFt0aGlzLmdldENvbnRhaW5lckxpc3Qoc2VsQ29udGFpbmVyWzBdKVswXV0gOiBbc2VsQ29udGFpbmVyWzBdXQogICAgICB9CiAgICB9KTsKICAgIEV2ZW50QnVzLiRlbWl0KCdmb2N1c1VzZXJGb3JtJyk7CiAgfQoKICB1cGRhdGVBY3Rpb24oZXZlbnQpIHsKICAgIGxldCBjb250cm9sQWN0aW9uTmFtZSA9ICcnOwoKICAgIGlmIChldmVudC5jdHJsS2V5ICYmIGV2ZW50LmNvZGUgPT09ICdLZXlBJykgewogICAgICBjb250cm9sQWN0aW9uTmFtZSA9ICdJRF9TRUxFQ1RBTEwnOwogICAgfSBlbHNlIGlmIChldmVudC5jdHJsS2V5ICYmIGV2ZW50LmNvZGUgPT09ICdLZXlDJykgewogICAgICBpZiAodGhpcy5zZWxlY3RlZENvbnRyb2xzW3RoaXMudXNlckZvcm1JZF0uc2VsZWN0ZWRbMF0gIT09IHRoaXMudXNlckZvcm1JZCkgewogICAgICAgIGNvbnRyb2xBY3Rpb25OYW1lID0gJ0lEX0NPUFknOwogICAgICB9CiAgICB9IGVsc2UgaWYgKGV2ZW50LmtleUNvZGUgPT09IDQ2KSB7CiAgICAgIGNvbnRyb2xBY3Rpb25OYW1lID0gJ0lEX0RFTEVURSc7CiAgICB9IGVsc2UgaWYgKGV2ZW50LmN0cmxLZXkgJiYgZXZlbnQuY29kZSA9PT0gJ0tleVYnKSB7CiAgICAgIGNvbnRyb2xBY3Rpb25OYW1lID0gJ0lEX1BBU1RFJzsKICAgIH0gZWxzZSBpZiAoZXZlbnQua2V5Q29kZSAmJiBldmVudC5jb2RlID09PSAnS2V5WCcpIHsKICAgICAgY29udHJvbEFjdGlvbk5hbWUgPSAnSURfQ1VUJzsKICAgIH0KCiAgICB0aGlzLmNvbnRyb2xBY3Rpb24oZXZlbnQsIGNvbnRyb2xBY3Rpb25OYW1lLCAnJyk7CiAgfQoKICB1cGRhdGVQcm9wVmFsKHByb3BOYW1lLCBwcm9wVmFsdWUpIHsKICAgIGNvbnN0IGN0cmxTZWwgPSB0aGlzLnNlbGVjdGVkQ29udHJvbHNbdGhpcy51c2VyRm9ybUlkXS5zZWxlY3RlZDsKICAgIGNvbnN0IHVzckZybURhdGEgPSB0aGlzLnVzZXJmb3JtRGF0YVt0aGlzLnVzZXJGb3JtSWRdOwoKICAgIGZvciAobGV0IGluZGV4ID0gMTsgaW5kZXggPCBjdHJsU2VsLmxlbmd0aDsgaW5kZXgrKykgewogICAgICBpZiAoIWN0cmxTZWxbaW5kZXhdLnN0YXJ0c1dpdGgoJ2dyb3VwJykpIHsKICAgICAgICBjb25zdCBjdXJQcm9wID0gdXNyRnJtRGF0YVtjdHJsU2VsW2luZGV4XV0ucHJvcGVydGllczsKCiAgICAgICAgaWYgKHByb3BOYW1lID09PSAnc2VsUmlnaHQnKSB7CiAgICAgICAgICBjb25zdCBjdXJSaWdodCA9IGN1clByb3AuV2lkdGggKyBjdXJQcm9wLkxlZnQ7CiAgICAgICAgICBjb25zdCB2YWx1ZSA9IGN1clByb3AuTGVmdCArIChwcm9wVmFsdWUgLSBjdXJSaWdodCk7CiAgICAgICAgICB0aGlzLnVwZGF0ZUNvbnRyb2xQcm9wZXJ0eSgnTGVmdCcsIHZhbHVlLCBjdHJsU2VsW2luZGV4XSk7CiAgICAgICAgfSBlbHNlIGlmIChwcm9wTmFtZSA9PT0gJ3NlbEJvdHRvbScpIHsKICAgICAgICAgIGNvbnN0IGN1ckJvdHRvbSA9IGN1clByb3AuSGVpZ2h0ICsgY3VyUHJvcC5Ub3A7CiAgICAgICAgICBjb25zdCB2YWx1ZSA9IGN1clByb3AuVG9wICsgKHByb3BWYWx1ZSAtIGN1ckJvdHRvbSk7CiAgICAgICAgICB0aGlzLnVwZGF0ZUNvbnRyb2xQcm9wZXJ0eSgnVG9wJywgdmFsdWUsIGN0cmxTZWxbaW5kZXhdKTsKICAgICAgICB9CgogICAgICAgIGlmIChwcm9wTmFtZSA9PT0gJ3NlbENlbnRlcicpIHsKICAgICAgICAgIGNvbnN0IGN1ckNlbnRlciA9IGN1clByb3AuV2lkdGggLyAyOwogICAgICAgICAgY29uc3QgdmFsdWUgPSBwcm9wVmFsdWUgLSBjdXJDZW50ZXI7CiAgICAgICAgICB0aGlzLnVwZGF0ZUNvbnRyb2xQcm9wZXJ0eSgnTGVmdCcsIHZhbHVlLCBjdHJsU2VsW2luZGV4XSk7CiAgICAgICAgfQoKICAgICAgICBpZiAocHJvcE5hbWUgPT09ICdzZWxNaWRkbGUnKSB7CiAgICAgICAgICBjb25zdCBjdXJNaWRkbGUgPSBjdXJQcm9wLkhlaWdodCAvIDI7CiAgICAgICAgICBjb25zdCB2YWx1ZSA9IHByb3BWYWx1ZSAtIGN1ck1pZGRsZTsKICAgICAgICAgIHRoaXMudXBkYXRlQ29udHJvbFByb3BlcnR5KCdUb3AnLCB2YWx1ZSwgY3RybFNlbFtpbmRleF0pOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBjb25zdCBwcm9wZXJ0eW5hbWUgPSBwcm9wTmFtZTsKICAgICAgICAgIHRoaXMudXBkYXRlQ29udHJvbFByb3BlcnR5KHByb3BlcnR5bmFtZSwgcHJvcFZhbHVlLCBjdHJsU2VsW2luZGV4XSk7CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIGNvbnN0IGdyb3VwSW5kZXggPSB0aGlzLmdyb3VwU3R5bGVBcnJheS5maW5kSW5kZXgodmFsID0+IHZhbC5ncm91cE5hbWUgPT09IGN0cmxTZWxbaW5kZXhdKTsKICAgICAgICBjb25zdCBjdXJQcm9wID0gdGhpcy5ncm91cFN0eWxlQXJyYXlbZ3JvdXBJbmRleF07CiAgICAgICAgY29uc3QgbGVmdCA9IHBhcnNlSW50KGN1clByb3AubGVmdCk7CiAgICAgICAgY29uc3QgdG9wID0gcGFyc2VJbnQoY3VyUHJvcC50b3ApOwogICAgICAgIGNvbnN0IHdpZHRoID0gcGFyc2VJbnQoY3VyUHJvcC53aWR0aCk7CiAgICAgICAgY29uc3QgaGVpZ2h0ID0gcGFyc2VJbnQoY3VyUHJvcC5oZWlnaHQpOwogICAgICAgIGxldCB2YWx1ZSA9IC0xOwoKICAgICAgICBpZiAocHJvcE5hbWUgPT09ICdzZWxSaWdodCcpIHsKICAgICAgICAgIHZhbHVlID0gbGVmdCArIChwcm9wVmFsdWUgLSAod2lkdGggKyBsZWZ0KSk7CiAgICAgICAgICBFdmVudEJ1cy4kZW1pdCgndXBkYXN0ZUdyb3VwU2l6ZScsICdMZWZ0JywgdmFsdWUsIGdyb3VwSW5kZXgpOwogICAgICAgIH0gZWxzZSBpZiAocHJvcE5hbWUgPT09ICdzZWxCb3R0b20nKSB7CiAgICAgICAgICB2YWx1ZSA9IHRvcCArIChwcm9wVmFsdWUgLSAoaGVpZ2h0ICsgdG9wKSk7CiAgICAgICAgICBFdmVudEJ1cy4kZW1pdCgndXBkYXN0ZUdyb3VwU2l6ZScsICdUb3AnLCB2YWx1ZSwgZ3JvdXBJbmRleCk7CiAgICAgICAgfQoKICAgICAgICBpZiAocHJvcE5hbWUgPT09ICdzZWxDZW50ZXInKSB7CiAgICAgICAgICB2YWx1ZSA9IHByb3BWYWx1ZSAtIHdpZHRoIC8gMjsKICAgICAgICAgIEV2ZW50QnVzLiRlbWl0KCd1cGRhc3RlR3JvdXBTaXplJywgJ0xlZnQnLCB2YWx1ZSwgZ3JvdXBJbmRleCk7CiAgICAgICAgfQoKICAgICAgICBpZiAocHJvcE5hbWUgPT09ICdzZWxNaWRkbGUnKSB7CiAgICAgICAgICB2YWx1ZSA9IHByb3BWYWx1ZSAtIGhlaWdodCAvIDI7CiAgICAgICAgICBFdmVudEJ1cy4kZW1pdCgndXBkYXN0ZUdyb3VwU2l6ZScsICdUb3AnLCB2YWx1ZSwgZ3JvdXBJbmRleCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGNvbnN0IHByb3BlcnR5bmFtZSA9IHByb3BOYW1lOwogICAgICAgICAgRXZlbnRCdXMuJGVtaXQoJ3VwZGFzdGVHcm91cFNpemUnLCBwcm9wZXJ0eW5hbWUsIHByb3BWYWx1ZSwgZ3JvdXBJbmRleCk7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgfQoKICBjb250cm9sQWxpZ25NZW50KHN1YlZhbCkgewogICAgY29uc3QgbWFpblNlbCA9IHRoaXMuc2VsZWN0ZWRDb250cm9sc1t0aGlzLnVzZXJGb3JtSWRdLnNlbGVjdGVkWzBdOwogICAgY29uc3QgaXNHcm91cCA9IG1haW5TZWwuc3RhcnRzV2l0aCgnZ3JvdXAnKTsKICAgIGNvbnN0IHVzckZybURhdGEgPSB0aGlzLnVzZXJmb3JtRGF0YVt0aGlzLnVzZXJGb3JtSWRdOwogICAgY29uc3QgY3RybFByb3AgPSAhaXNHcm91cCAmJiB1c3JGcm1EYXRhW21haW5TZWxdLnByb3BlcnRpZXM7CiAgICBjb25zdCBncm91cEluZGV4ID0gdGhpcy5ncm91cFN0eWxlQXJyYXkuZmluZEluZGV4KHZhbCA9PiB2YWwuZ3JvdXBOYW1lID09PSBtYWluU2VsKTsKICAgIGNvbnN0IG5ld09iamVjdCA9IHsKICAgICAgTGVmdDogaXNHcm91cCAmJiBncm91cEluZGV4ICE9PSAtMSA/IHBhcnNlSW50KHRoaXMuZ3JvdXBTdHlsZUFycmF5W2dyb3VwSW5kZXhdLmxlZnQpIDogY3RybFByb3AgPyBjdHJsUHJvcC5MZWZ0IDogMCwKICAgICAgVG9wOiBpc0dyb3VwICYmIGdyb3VwSW5kZXggIT09IC0xID8gcGFyc2VJbnQodGhpcy5ncm91cFN0eWxlQXJyYXlbZ3JvdXBJbmRleF0udG9wKSA6IGN0cmxQcm9wID8gY3RybFByb3AuVG9wIDogMCwKICAgICAgV2lkdGg6IGlzR3JvdXAgJiYgZ3JvdXBJbmRleCAhPT0gLTEgPyBwYXJzZUludCh0aGlzLmdyb3VwU3R5bGVBcnJheVtncm91cEluZGV4XS53aWR0aCkgOiBjdHJsUHJvcCA/IGN0cmxQcm9wLldpZHRoIDogMCwKICAgICAgSGVpZ2h0OiBpc0dyb3VwICYmIGdyb3VwSW5kZXggIT09IC0xID8gcGFyc2VJbnQodGhpcy5ncm91cFN0eWxlQXJyYXlbZ3JvdXBJbmRleF0uaGVpZ2h0KSA6IGN0cmxQcm9wID8gY3RybFByb3AuSGVpZ2h0IDogMAogICAgfTsKCiAgICBpZiAoc3ViVmFsID09PSAnSURfQUxJR05MRUZUJykgewogICAgICB0aGlzLnVwZGF0ZVByb3BWYWwoJ0xlZnQnLCBuZXdPYmplY3QuTGVmdCk7CiAgICB9IGVsc2UgaWYgKHN1YlZhbCA9PT0gJ0lEX0FMSUdOVE9QJykgewogICAgICB0aGlzLnVwZGF0ZVByb3BWYWwoJ1RvcCcsIG5ld09iamVjdC5Ub3ApOwogICAgfSBlbHNlIGlmIChzdWJWYWwgPT09ICdJRF9BTElHTlJJR0hUJykgewogICAgICBjb25zdCBzZWxSaWdodCA9IG5ld09iamVjdC5XaWR0aCArIG5ld09iamVjdC5MZWZ0OwogICAgICB0aGlzLnVwZGF0ZVByb3BWYWwoJ3NlbFJpZ2h0Jywgc2VsUmlnaHQpOwogICAgfSBlbHNlIGlmIChzdWJWYWwgPT09ICdJRF9BTElHTkJPVFRPTScpIHsKICAgICAgY29uc3Qgc2VsQm90dG9tID0gbmV3T2JqZWN0LkhlaWdodCArIG5ld09iamVjdC5Ub3A7CiAgICAgIHRoaXMudXBkYXRlUHJvcFZhbCgnc2VsQm90dG9tJywgc2VsQm90dG9tKTsKICAgIH0gZWxzZSBpZiAoc3ViVmFsID09PSAnSURfQUxJR05DRU5URVInKSB7CiAgICAgIGNvbnN0IHNlbENlbnRlciA9IG5ld09iamVjdC5MZWZ0ICsgbmV3T2JqZWN0LldpZHRoIC8gMjsKICAgICAgdGhpcy51cGRhdGVQcm9wVmFsKCdzZWxDZW50ZXInLCBzZWxDZW50ZXIpOwogICAgfSBlbHNlIGlmIChzdWJWYWwgPT09ICdJRF9BTElHTk1JRERMRScpIHsKICAgICAgY29uc3Qgc2VsTWlkZGxlID0gbmV3T2JqZWN0LlRvcCArIG5ld09iamVjdC5IZWlnaHQgLyAyOwogICAgICB0aGlzLnVwZGF0ZVByb3BWYWwoJ3NlbE1pZGRsZScsIHNlbE1pZGRsZSk7CiAgICB9IGVsc2UgaWYgKHN1YlZhbCA9PT0gJ0lEX1dJRFRIJykgewogICAgICB0aGlzLnVwZGF0ZVByb3BWYWwoJ1dpZHRoJywgbmV3T2JqZWN0LldpZHRoKTsKICAgIH0gZWxzZSBpZiAoc3ViVmFsID09PSAnSURfSEVJR0hUJykgewogICAgICB0aGlzLnVwZGF0ZVByb3BWYWwoJ0hlaWdodCcsIG5ld09iamVjdC5IZWlnaHQpOwogICAgfSBlbHNlIGlmIChzdWJWYWwgPT09ICdJRF9CT1RIJykgewogICAgICB0aGlzLnVwZGF0ZVByb3BWYWwoJ0hlaWdodCcsIG5ld09iamVjdC5IZWlnaHQpOwogICAgICB0aGlzLnVwZGF0ZVByb3BWYWwoJ1dpZHRoJywgbmV3T2JqZWN0LldpZHRoKTsKICAgIH0KICB9CgogIGNvbnRyb2xEaXNhYmxlKGV2ZW50KSB7CiAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpOwogICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7CiAgfQoKfTsKCl9fZGVjb3JhdGUoW1Byb3AoKV0sIENvbnRleHRNZW51LnByb3RvdHlwZSwgInZhbHVlcyIsIHZvaWQgMCk7CgpfX2RlY29yYXRlKFtQcm9wKCldLCBDb250ZXh0TWVudS5wcm90b3R5cGUsICJ1c2VyRm9ybUlkIiwgdm9pZCAwKTsKCl9fZGVjb3JhdGUoW1Byb3AoKV0sIENvbnRleHRNZW51LnByb3RvdHlwZSwgImNvbnRhaW5lcklkIiwgdm9pZCAwKTsKCl9fZGVjb3JhdGUoW1Byb3AoKV0sIENvbnRleHRNZW51LnByb3RvdHlwZSwgImtleUV2ZW50TmFtZSIsIHZvaWQgMCk7CgpfX2RlY29yYXRlKFtQcm9wKCldLCBDb250ZXh0TWVudS5wcm90b3R5cGUsICJjb250cm9sSWQiLCB2b2lkIDApOwoKX19kZWNvcmF0ZShbUHJvcCgpXSwgQ29udGV4dE1lbnUucHJvdG90eXBlLCAic2VsZWN0ZWRUYWIiLCB2b2lkIDApOwoKX19kZWNvcmF0ZShbUHJvcCgpXSwgQ29udGV4dE1lbnUucHJvdG90eXBlLCAiZGF0YSIsIHZvaWQgMCk7CgpfX2RlY29yYXRlKFtQcm9wKCldLCBDb250ZXh0TWVudS5wcm90b3R5cGUsICJncm91cFN0eWxlQXJyYXkiLCB2b2lkIDApOwoKX19kZWNvcmF0ZShbUHJvcCgpXSwgQ29udGV4dE1lbnUucHJvdG90eXBlLCAiY29udGV4dE1lbnV0eXBlIiwgdm9pZCAwKTsKCl9fZGVjb3JhdGUoW1Byb3AoKV0sIENvbnRleHRNZW51LnByb3RvdHlwZSwgImVkaXRUZXh0UmVmIiwgdm9pZCAwKTsKCl9fZGVjb3JhdGUoW1Byb3AoKV0sIENvbnRleHRNZW51LnByb3RvdHlwZSwgImNvcGllZFRleHQiLCB2b2lkIDApOwoKX19kZWNvcmF0ZShbUHJvcCgpXSwgQ29udGV4dE1lbnUucHJvdG90eXBlLCAidGV4dE1lbnUiLCB2b2lkIDApOwoKX19kZWNvcmF0ZShbU3RhdGUoc3RhdGUgPT4gc3RhdGUuZmQuc2VsZWN0ZWRDb250cm9scyldLCBDb250ZXh0TWVudS5wcm90b3R5cGUsICJzZWxlY3RlZENvbnRyb2xzIiwgdm9pZCAwKTsKCl9fZGVjb3JhdGUoW1N0YXRlKHN0YXRlID0+IHN0YXRlLmZkLmNvcHlDb250cm9sTGlzdCldLCBDb250ZXh0TWVudS5wcm90b3R5cGUsICJjb3B5Q29udHJvbExpc3QiLCB2b2lkIDApOwoKX19kZWNvcmF0ZShbU3RhdGUoc3RhdGUgPT4gc3RhdGUuZmQudXNlcmZvcm1EYXRhKV0sIENvbnRleHRNZW51LnByb3RvdHlwZSwgInVzZXJmb3JtRGF0YSIsIHZvaWQgMCk7CgpfX2RlY29yYXRlKFtTdGF0ZShzdGF0ZSA9PiBzdGF0ZS5mZC5jb3BpZWRDb250cm9sKV0sIENvbnRleHRNZW51LnByb3RvdHlwZSwgImNvcGllZENvbnRyb2wiLCB2b2lkIDApOwoKX19kZWNvcmF0ZShbU3RhdGUoc3RhdGUgPT4gc3RhdGUuZmQuZ3JvdXBlZENvbnRyb2xzKV0sIENvbnRleHRNZW51LnByb3RvdHlwZSwgImdyb3VwZWRDb250cm9scyIsIHZvaWQgMCk7CgpfX2RlY29yYXRlKFtBY3Rpb24oJ2ZkL2RlbGV0ZUNvbnRyb2wnKV0sIENvbnRleHRNZW51LnByb3RvdHlwZSwgImRlbGV0ZUNvbnRyb2wiLCB2b2lkIDApOwoKX19kZWNvcmF0ZShbQWN0aW9uKCdmZC9kZWxldGVDb3BpZWRDb250cm9sJyldLCBDb250ZXh0TWVudS5wcm90b3R5cGUsICJkZWxldGVDb3BpZWRDb250cm9sIiwgdm9pZCAwKTsKCl9fZGVjb3JhdGUoW0FjdGlvbignZmQvdXBkYXRlQ29weUNvbnRyb2xMaXN0JyldLCBDb250ZXh0TWVudS5wcm90b3R5cGUsICJ1cGRhdGVDb3B5Q29udHJvbExpc3QiLCB2b2lkIDApOwoKX19kZWNvcmF0ZShbQWN0aW9uKCdmZC9hZGRDb250cm9sJyldLCBDb250ZXh0TWVudS5wcm90b3R5cGUsICJhZGRDb250cm9sIiwgdm9pZCAwKTsKCl9fZGVjb3JhdGUoW0FjdGlvbignZmQvYWRkQ29waWVkQ29udHJvbCcpXSwgQ29udGV4dE1lbnUucHJvdG90eXBlLCAiYWRkQ29waWVkQ29udHJvbCIsIHZvaWQgMCk7CgpfX2RlY29yYXRlKFtBY3Rpb24oJ2ZkL3NlbGVjdENvbnRyb2wnKV0sIENvbnRleHRNZW51LnByb3RvdHlwZSwgInNlbGVjdENvbnRyb2wiLCB2b2lkIDApOwoKX19kZWNvcmF0ZShbQWN0aW9uKCdmZC91cGRhdGVHcm91cCcpXSwgQ29udGV4dE1lbnUucHJvdG90eXBlLCAidXBkYXRlR3JvdXAiLCB2b2lkIDApOwoKX19kZWNvcmF0ZShbQWN0aW9uKCdmZC91cGRhdGVDb250cm9sRXh0cmFEYXRhJyldLCBDb250ZXh0TWVudS5wcm90b3R5cGUsICJ1cGRhdGVDb250cm9sRXh0cmFEYXRhIiwgdm9pZCAwKTsKCl9fZGVjb3JhdGUoW0FjdGlvbignZmQvdXBkYXRlQ29udHJvbCcpXSwgQ29udGV4dE1lbnUucHJvdG90eXBlLCAidXBkYXRlQ29udHJvbCIsIHZvaWQgMCk7CgpfX2RlY29yYXRlKFtBY3Rpb24oJ2ZkL3NldENoaWxkQ29udHJvbHMnKV0sIENvbnRleHRNZW51LnByb3RvdHlwZSwgInNldENoaWxkQ29udHJvbHMiLCB2b2lkIDApOwoKX19kZWNvcmF0ZShbQWN0aW9uKCdmZC9hZGRDaGlsZENvbnRyb2xzJyldLCBDb250ZXh0TWVudS5wcm90b3R5cGUsICJhZGRDaGlsZENvbnRyb2xzIiwgdm9pZCAwKTsKCl9fZGVjb3JhdGUoW0VtaXQoJ2Nsb3NlTWVudScpXSwgQ29udGV4dE1lbnUucHJvdG90eXBlLCAiY2xvc2VNZW51IiwgbnVsbCk7CgpfX2RlY29yYXRlKFtFbWl0KCdjcmVhdGVHcm91cCcpXSwgQ29udGV4dE1lbnUucHJvdG90eXBlLCAiY3JlYXRlR3JvdXAiLCBudWxsKTsKCkNvbnRleHRNZW51ID0gX19kZWNvcmF0ZShbQ29tcG9uZW50KHsKICBuYW1lOiAnQ29udGV4dE1lbnUnLAogIGNvbXBvbmVudHM6IHsKICAgIEZEU1ZHSW1hZ2UKICB9Cn0pXSwgQ29udGV4dE1lbnUpOwpleHBvcnQgZGVmYXVsdCBDb250ZXh0TWVudTs="},{"version":3,"sources":["/home/mobiotics/Projects/hancom/FormcontrolLatest/node_modules/cache-loader/dist/cjs.js??ref--0-0!/home/mobiotics/Projects/hancom/FormcontrolLatest/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/mobiotics/Projects/hancom/FormcontrolLatest/src/FormDesigner/components/atoms/FDContextMenu/index.vue?vue&type=script&lang=ts&"],"names":[],"mappings":"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","sourcesContent":["\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\r\nimport { Component, Vue, Prop, Emit } from 'vue-property-decorator'\r\nimport FDSVGImage from '@/FormDesigner/components/atoms/FDSVGImage/index.vue'\r\nimport { ControlPropertyData } from '@/FormDesigner/models/ControlsTableProperties/ControlPropertyData.ts'\r\n\r\nimport { Action, State } from 'vuex-class'\r\nimport {\r\n  IaddChildControls,\r\n  IaddControl,\r\n  IdeleteControl,\r\n  IselectControl,\r\n  IsetChildControls,\r\n  IupdateControl,\r\n  IupdateControlExtraData,\r\n  IupdateCopyControlList,\r\n  IupdateGroup\r\n} from '@/storeModules/fd/actions'\r\nimport { EventBus } from '@/FormDesigner/event-bus'\r\nimport FDCommonMethod from '@/api/abstract/FormDesigner/FDCommonMethod'\r\n\r\n@Component({\r\n  name: 'ContextMenu',\r\n  components: {\r\n    FDSVGImage\r\n  }\r\n})\r\nexport default class ContextMenu extends FDCommonMethod {\r\n  @Prop() values: Array<IControlContextMenu>;\r\n  @Prop() userFormId: string;\r\n  @Prop() containerId: string;\r\n  @Prop() keyEventName: string;\r\n  @Prop() controlId: string;\r\n  @Prop() selectedTab: number;\r\n  @Prop() data: controlData;\r\n  @Prop() groupStyleArray: Array<IGroupStyle>\r\n  @Prop() contextMenutype: string\r\n  @Prop() editTextRef: HTMLSpanElement | HTMLTextAreaElement\r\n  @Prop() copiedText: string\r\n  @Prop() textMenu: boolean\r\n\r\n  @State((state) => state.fd.selectedControls)\r\n  selectedControls!: fdState['selectedControls'];\r\n  @State((state: rootState) => state.fd.copyControlList)\r\n  copyControlList!: fdState['copyControlList'];\r\n  @State((state) => state.fd.userformData) userformData!: userformData;\r\n  @State((state) => state.fd.copiedControl) copiedControl!: userformData;\r\n  @State((state) => state.fd.groupedControls)\r\n  groupedControls!: fdState['groupedControls'];\r\n\r\n  @Action('fd/deleteControl') deleteControl!: (payload: IdeleteControl) => void;\r\n  @Action('fd/deleteCopiedControl') deleteCopiedControl!: (payload: IdeleteControl) => void;\r\n  @Action('fd/updateCopyControlList') updateCopyControlList!: (\r\n    payload: IupdateCopyControlList\r\n  ) => void;\r\n  @Action('fd/addControl') addControl!: (payload: IaddControl) => void;\r\n  @Action('fd/addCopiedControl') addCopiedControl!: (\r\n    payload: IaddControl\r\n  ) => void;\r\n  @Action('fd/selectControl') selectControl!: (payload: IselectControl) => void;\r\n  @Action('fd/updateGroup') updateGroup!: (payload: IupdateGroup) => void;\r\n  @Action('fd/updateControlExtraData') updateControlExtraData!: (\r\n    payload: IupdateControlExtraData\r\n  ) => void;\r\n  @Action('fd/updateControl') updateControl!: (payload: IupdateControl) => void;\r\n  @Action('fd/setChildControls') setChildControls!: (\r\n    payload: IsetChildControls\r\n  ) => void;\r\n  @Action('fd/addChildControls') addChildControls!: (\r\n    payload: IaddChildControls\r\n  ) => void;\r\n  controlAction (event: Event, controlActionName: string, subVal: string) {\r\n    if (this.textMenu === false) {\r\n      if (controlActionName === 'ID_COPY') {\r\n        this.copyControl('copy')\r\n      } else if (controlActionName === 'ID_DELETE') {\r\n        this.clickDelete()\r\n      } else if (controlActionName === 'ID_PASTE') {\r\n        this.pasteControl()\r\n      } else if (controlActionName === 'ID_CUT') {\r\n        this.cutControl()\r\n      } else if (controlActionName === 'ID_SELECTALL') {\r\n        this.selectAll()\r\n      } else if (controlActionName === 'ID_GROUP') {\r\n        this.groupControl()\r\n      } else if (controlActionName === 'ID_UNGROUP') {\r\n        this.unGroupControl()\r\n      } else if (controlActionName === 'ID_NEWPAGE') {\r\n        this.addNewPage()\r\n      } else if (controlActionName === 'ID_DELETEPAGE') {\r\n        this.deleteCurrentPage()\r\n      } else if (controlActionName === 'ID_CONTROLFORWARD') {\r\n        this.bringForward()\r\n      } else if (controlActionName === 'ID_CONTROLBACKWARD') {\r\n        this.bringBackward()\r\n      } else if (controlActionName === 'ID_OBJECTPROP') {\r\n        this.displayProp()\r\n      } else if (controlActionName === 'ID_RENAME') {\r\n        const selectedPageID = this.selectedControls[this.userFormId].selected[0]\r\n        EventBus.$emit(\r\n          'renamePage',\r\n          this.userFormId,\r\n          selectedPageID,\r\n          this.selectedTab,\r\n          this.userformData[this.userFormId][selectedPageID].type\r\n        )\r\n      } else if (controlActionName === 'ID_MOVE') {\r\n        const type = this.userformData[this.userFormId][this.controlId].type\r\n        if (type === 'MultiPage') {\r\n          EventBus.$emit('userFormTabOrder', this.userFormId, this.controlId, type)\r\n        } else {\r\n          EventBus.$emit('tabStripTabOrder', this.userFormId, this.controlId, type)\r\n        }\r\n      } else if (controlActionName === 'ID_TABORDER') {\r\n        EventBus.$emit('userFormTabOrder', this.userFormId, this.containerId, '')\r\n      } else if (\r\n        controlActionName === 'ID_ALIGN' ||\r\n      controlActionName === 'ID_MAKESAMESIZE'\r\n      ) {\r\n        this.controlAlignMent(subVal)\r\n      }\r\n    } else {\r\n      if (controlActionName === 'ID_COPY') {\r\n        this.copyText()\r\n      } else if (controlActionName === 'ID_DELETE') {\r\n        this.deleteText()\r\n      } else if (controlActionName === 'ID_PASTE') {\r\n        if (event instanceof MouseEvent) {\r\n          this.pasteText(event)\r\n        }\r\n      } else if (controlActionName === 'ID_CUT') {\r\n        this.cutText()\r\n      } else if (controlActionName === 'ID_OBJECTPROP') {\r\n        this.displayProp()\r\n      }\r\n    }\r\n    this.closeMenu()\r\n  }\r\n  cutText () {\r\n    document.execCommand('cut')\r\n  }\r\n  deleteText () {\r\n    document.execCommand('delete')\r\n  }\r\n  copyText () {\r\n    document.execCommand('copy')\r\n  }\r\n  pasteText (event: MouseEvent) {\r\n    const controlType = this.userformData[this.userFormId][this.controlId].type\r\n    const position = this.getCursorPos(event)\r\n    const length = position.endPosition - position.startPosition\r\n    let baseValue = this.editTextRef.innerHTML.split('')\r\n    baseValue.splice(position.startPosition, length)\r\n    const updateValue = baseValue.slice(0, position.startPosition).join('') + this.copiedText + baseValue.slice(position.startPosition).join('')\r\n    EventBus.$emit('updateText', updateValue)\r\n  }\r\n  getCursorPos (event: MouseEvent) {\r\n    let startPosition = 0\r\n    let endPosition = 0\r\n    const isSupported = typeof window.getSelection !== 'undefined'\r\n    if (isSupported) {\r\n      const selection = window.getSelection()!\r\n      if (selection.anchorOffset > selection.focusOffset) {\r\n        startPosition = selection.focusOffset\r\n        endPosition = selection.anchorOffset\r\n      } else if (selection.anchorOffset === selection.focusOffset) {\r\n        startPosition = selection.focusOffset\r\n        endPosition = selection.focusOffset\r\n      } else {\r\n        startPosition = selection.anchorOffset\r\n        endPosition = selection.focusOffset\r\n      }\r\n    }\r\n    return { startPosition: startPosition, endPosition: endPosition }\r\n  }\r\n  created () {\r\n    EventBus.$on('groupControl', (value: string) => {\r\n      if (this.selectedControls[this.userFormId].container[0] === this.containerId) {\r\n        if (value === 'group') {\r\n          this.groupControl()\r\n        } else if (value === 'ungroup') {\r\n          this.unGroupControl()\r\n        }\r\n      }\r\n    })\r\n  }\r\n  destroyed () {\r\n    EventBus.$off('groupControl')\r\n  }\r\n  @Emit('closeMenu')\r\n  closeMenu () {\r\n    return 0\r\n  }\r\n\r\n  displayProp () {\r\n    EventBus.$emit('dispProp', false)\r\n  }\r\n  createPageName (pageList: string[]) {\r\n    let lastControlId = 0\r\n    for (let i of pageList) {\r\n      if (i.indexOf('Page') !== -1) {\r\n        const IdNum = i.split('Page').pop() || '-1'\r\n        const pasreId = parseInt(IdNum, 10)\r\n        if (!isNaN(pasreId) && lastControlId < pasreId) {\r\n          lastControlId = pasreId\r\n        }\r\n      }\r\n    }\r\n    return lastControlId + 1\r\n  }\r\n  getPageCount (container: string) {\r\n    const pageList: string[] = []\r\n    for (const pageId of this.userformData[this.userFormId][container].controls) {\r\n      pageList.push(this.userformData[this.userFormId][pageId].properties.Name!)\r\n    }\r\n    const name = this.createPageName(pageList)\r\n    return name\r\n  }\r\n\r\n  addNewPage () {\r\n    const type = this.userformData[this.userFormId][this.controlId].type\r\n    if (type === 'TabStrip') {\r\n      const tabControlData = JSON.parse(\r\n        JSON.stringify(this.userformData[this.userFormId][this.controlId])\r\n      ).extraDatas.Tabs\r\n      let prevTabId = -1\r\n      const initialTabData: tabsItems = {\r\n        Name: '',\r\n        Caption: '',\r\n        ToolTip: '',\r\n        Accelerator: ''\r\n      }\r\n      if (tabControlData.length > 0) {\r\n        for (let i = 0; i < tabControlData.length; i++) {\r\n          const id = tabControlData[i].Name.split('Tab').pop() || '-1'\r\n          const parseId = parseInt(id, 10)\r\n          if (!isNaN(parseId) && prevTabId < parseId) {\r\n            prevTabId = parseId\r\n          }\r\n        }\r\n        prevTabId += 1\r\n        initialTabData.Name = `Tab${prevTabId}`\r\n        initialTabData.Caption = `Tab${prevTabId}`\r\n      } else {\r\n        initialTabData.Name = `Tab${1}`\r\n        initialTabData.Caption = `Tab${1}`\r\n      }\r\n      tabControlData.push(initialTabData)\r\n      this.updateControlExtraData({\r\n        userFormId: this.userFormId,\r\n        controlId: this.controlId,\r\n        propertyName: 'Tabs',\r\n        value: tabControlData\r\n      })\r\n      this.updateControl({\r\n        userFormId: this.userFormId,\r\n        controlId: this.controlId,\r\n        propertyName: 'Value',\r\n        value: prevTabId - 1\r\n      })\r\n    } else if (type === 'MultiPage') {\r\n      const parentId = this.controlId.split('MultiPage').pop()\r\n      const controlName = `Page${parentId}_`\r\n\r\n      let lastControlId = 0\r\n      const userformControlIds = Object.keys(this.userformData[this.userFormId])\r\n      for (let i = 0; i < userformControlIds.length; i++) {\r\n        if (userformControlIds[i].indexOf(controlName) !== -1) {\r\n          const IdNum =\r\n          userformControlIds[i].split(controlName).pop() || '-1'\r\n          const pasreId = parseInt(IdNum, 10)\r\n          if (!isNaN(pasreId) && lastControlId < pasreId) {\r\n            lastControlId = pasreId\r\n          }\r\n        }\r\n      }\r\n      const controlPropData = new ControlPropertyData()\r\n      let controlObj = controlPropData.data['Page']\r\n      const item = JSON.parse(JSON.stringify(controlObj!))\r\n      lastControlId += 1\r\n      item.properties.ID = `ID_${controlName}${lastControlId}`\r\n      const count = this.getPageCount(this.controlId)\r\n      item.properties.Caption = `Page${count}`\r\n      item.properties.Name = `Page${count}`\r\n      item.properties.Index = this.userformData[this.userFormId][this.controlId].controls.length\r\n      this.addControl({\r\n        userFormId: this.userFormId,\r\n        controlId: this.controlId,\r\n        addId: item.properties.ID,\r\n        item: item\r\n      })\r\n      this.updateControl({\r\n        userFormId: this.userFormId,\r\n        controlId: this.controlId,\r\n        propertyName: 'Value',\r\n        value: item.properties.Index\r\n      })\r\n      this.selectControl({\r\n        userFormId: this.userFormId,\r\n        select: {\r\n          container: this.getContainerList(item.properties.ID),\r\n          selected: [item.properties.ID]\r\n        }\r\n      })\r\n      EventBus.$emit('updateMultiPageValue')\r\n    }\r\n  }\r\n  bringForward () {\r\n    const userData = this.userformData[this.userFormId]\r\n    const highProrControl = []\r\n    const lowProrControl = []\r\n    const container = this.getContainerList(this.getSelectedControlsDatas![0])[0]\r\n    const containerControls = this.userformData[this.userFormId][container].controls\r\n    for (const index in containerControls) {\r\n      const cntrlData = this.userformData[this.userFormId][containerControls[index]]\r\n      if (cntrlData.type === 'MultiPage' || cntrlData.type === 'Frame' || cntrlData.type === 'ListBox') {\r\n        highProrControl.push(containerControls[index])\r\n      } else {\r\n        lowProrControl.push(containerControls[index])\r\n      }\r\n    }\r\n    let nextSelctedSeries: string[] = []\r\n    let nextHighControlSeries: string[] = []\r\n    const getSelControl = [...this.getSelectedControlsDatas!]\r\n    getSelControl.sort((a, b) => {\r\n      return userData[a].extraDatas!.zIndex! - userData[b].extraDatas!.zIndex!\r\n    })\r\n    for (const selControl of getSelControl!) {\r\n      const type = userData[selControl].type\r\n      const tempZIndex = userData[selControl].extraDatas!.zIndex!\r\n      const controlIndex = Object.keys(userData).findIndex((val: string, index: number) => {\r\n        return 'zIndex' in userData[val].extraDatas! && (userData[val].extraDatas!.zIndex === tempZIndex + 1)\r\n      })\r\n      const nextSelectedControl = controlIndex !== -1 ? Object.keys(userData)[controlIndex] : ''\r\n      const nextControlType = userData[nextSelectedControl].type\r\n      if (nextSelectedControl !== '' && !highProrControl.includes(nextSelectedControl)) {\r\n        if (getSelControl!.includes(nextSelectedControl)) {\r\n          if (!nextSelctedSeries.includes(selControl)) {\r\n            nextSelctedSeries.push(selControl)\r\n          }\r\n          if (!nextSelctedSeries.includes(nextSelectedControl)) {\r\n            nextSelctedSeries.push(nextSelectedControl)\r\n          }\r\n        } else {\r\n          if (Object.keys(nextSelctedSeries).length !== 0) {\r\n            const tempExchageIndex = userData[nextSelctedSeries[0]].extraDatas!.zIndex!\r\n            const swapTabIndex = userData[nextSelectedControl].extraDatas!.zIndex!\r\n            if (swapTabIndex <= userData[container].controls.length /* && swapTabIndex > 0 */) {\r\n              const index = userData[container].controls.findIndex(\r\n                (val) => userData[val].extraDatas!.zIndex === swapTabIndex\r\n              )\r\n              this.updateExtraDatas(userData[container].controls[index], 'zIndex', tempExchageIndex)\r\n              this.updateExtraDatas(nextSelctedSeries[0], 'zIndex', swapTabIndex - (nextSelctedSeries!.length - 1))\r\n            }\r\n            for (let j = 1; j < nextSelctedSeries.length; j++) {\r\n              const updateIndex = userData[nextSelctedSeries[j]].extraDatas!.zIndex! + 1\r\n              this.updateExtraDatas(nextSelctedSeries[j], 'zIndex', updateIndex)\r\n            }\r\n            nextSelctedSeries = []\r\n          } else {\r\n            const swapTabIndex = userData[nextSelectedControl].extraDatas!.zIndex!\r\n            if (swapTabIndex <= userData[container].controls.length /* && swapTabIndex > 0 */) {\r\n              const index = userData[container].controls.findIndex(\r\n                (val) => userData[val].extraDatas!.zIndex === swapTabIndex\r\n              )\r\n              this.updateExtraDatas(selControl, 'zIndex', swapTabIndex)\r\n              this.updateExtraDatas(nextSelectedControl, 'zIndex', tempZIndex)\r\n            }\r\n          }\r\n        }\r\n      } else {\r\n        if (getSelControl!.includes(nextSelectedControl) && (type === 'Frame' || type === 'MultiPage' || type === 'ListBox')) {\r\n          if (!nextHighControlSeries.includes(selControl)) {\r\n            nextHighControlSeries.push(selControl)\r\n          }\r\n          if (!nextHighControlSeries.includes(nextSelectedControl)) {\r\n            nextHighControlSeries.push(nextSelectedControl)\r\n          }\r\n        } else if (type === 'Frame' || type === 'MultiPage' || type === 'ListBox') {\r\n          if (Object.keys(nextHighControlSeries).length !== 0) {\r\n            const tempExchageIndex = userData[nextHighControlSeries[0]].extraDatas!.zIndex!\r\n            const swapTabIndex = userData[nextSelectedControl].extraDatas!.zIndex!\r\n            if (swapTabIndex <= userData[container].controls.length) {\r\n              const index = userData[container].controls.findIndex(\r\n                (val) => userData[val].extraDatas!.zIndex === swapTabIndex\r\n              )\r\n              this.updateExtraDatas(userData[container].controls[index], 'zIndex', tempExchageIndex)\r\n              this.updateExtraDatas(nextHighControlSeries[0], 'zIndex', swapTabIndex - (nextHighControlSeries!.length - 1))\r\n            }\r\n            for (let j = 1; j < nextHighControlSeries.length; j++) {\r\n              const updateIndex = userData[nextHighControlSeries[j]].extraDatas!.zIndex! + 1\r\n              this.updateExtraDatas(nextHighControlSeries[j], 'zIndex', updateIndex)\r\n            }\r\n            nextHighControlSeries = []\r\n          } else {\r\n            const swapTabIndex = userData[nextSelectedControl].extraDatas!.zIndex!\r\n            if (swapTabIndex <= userData[container].controls.length /* && swapTabIndex > 0 */) {\r\n              const index = userData[container].controls.findIndex(\r\n                (val) => userData[val].extraDatas!.zIndex === swapTabIndex\r\n              )\r\n              this.updateExtraDatas(selControl, 'zIndex', swapTabIndex)\r\n              this.updateExtraDatas(nextSelectedControl, 'zIndex', tempZIndex)\r\n            }\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n  bringBackward () {\r\n    const userData = this.userformData[this.userFormId]\r\n    const highProrControl = []\r\n    const lowProrControl = []\r\n    const container = this.getContainerList(this.getSelectedControlsDatas![0])[0]\r\n    const containerControls = this.userformData[this.userFormId][container].controls\r\n    for (const index in containerControls) {\r\n      const cntrlData = this.userformData[this.userFormId][containerControls[index]]\r\n      if (cntrlData.type === 'MultiPage' || cntrlData.type === 'Frame' || cntrlData.type === 'ListBox') {\r\n        highProrControl.push(containerControls[index])\r\n      } else {\r\n        lowProrControl.push(containerControls[index])\r\n      }\r\n    }\r\n    let nextSelctedSeries: string[] = []\r\n    let nextHighControlSeries: string[] = []\r\n    const getSelControl = [...this.getSelectedControlsDatas!]\r\n    getSelControl.sort((a, b) => {\r\n      return userData[a].extraDatas!.zIndex! - userData[b].extraDatas!.zIndex!\r\n    })\r\n    for (const selControl of getSelControl) {\r\n      const type = userData[selControl].type\r\n      const tempZIndex = userData[selControl].extraDatas!.zIndex!\r\n      const controlIndex = Object.keys(userData).findIndex((val: string, index: number) => {\r\n        return 'zIndex' in userData[val].extraDatas! && (userData[val].extraDatas!.zIndex === tempZIndex - 1)\r\n      })\r\n      const nextSelectedControl = controlIndex !== -1 ? Object.keys(userData)[controlIndex] : ''\r\n      const nextControlType = userData[nextSelectedControl].type\r\n      if (nextSelectedControl !== '' && !highProrControl.includes(selControl)) {\r\n        if (getSelControl!.includes(nextSelectedControl)) {\r\n          if (!nextSelctedSeries.includes(selControl)) {\r\n            nextSelctedSeries.push(selControl)\r\n          }\r\n          if (!nextSelctedSeries.includes(nextSelectedControl)) {\r\n            nextSelctedSeries.push(nextSelectedControl)\r\n          }\r\n        } else {\r\n          if (Object.keys(nextSelctedSeries).length !== 0) {\r\n            const tempExchageIndex = userData[nextSelctedSeries[0]].extraDatas!.zIndex!\r\n            const swapTabIndex = userData[nextSelectedControl].extraDatas!.zIndex!\r\n            if (swapTabIndex <= userData[container].controls.length && swapTabIndex > 0) {\r\n              const index = userData[container].controls.findIndex(\r\n                (val) => userData[val].extraDatas!.zIndex === swapTabIndex\r\n              )\r\n              this.updateExtraDatas(userData[container].controls[index], 'zIndex', tempExchageIndex)\r\n              this.updateExtraDatas(nextSelctedSeries[0], 'zIndex', (nextSelctedSeries!.length + 1) - swapTabIndex)\r\n            }\r\n            for (let j = 1; j < nextSelctedSeries.length; j++) {\r\n              const updateIndex = userData[nextSelctedSeries[j]].extraDatas!.zIndex! - 1\r\n              this.updateExtraDatas(nextSelctedSeries[j], 'zIndex', updateIndex)\r\n            }\r\n            nextSelctedSeries = []\r\n          } else {\r\n            const swapTabIndex = userData[nextSelectedControl].extraDatas!.zIndex!\r\n            if (swapTabIndex <= userData[container].controls.length && swapTabIndex > 0) {\r\n              const index = userData[container].controls.findIndex(\r\n                (val) => userData[val].extraDatas!.zIndex === swapTabIndex\r\n              )\r\n              this.updateExtraDatas(selControl, 'zIndex', swapTabIndex)\r\n              this.updateExtraDatas(nextSelectedControl, 'zIndex', tempZIndex)\r\n            }\r\n          }\r\n        }\r\n      } else if (!lowProrControl.includes(nextSelectedControl) && (type === 'Frame' || type === 'MultiPage' || type === 'ListBox')) {\r\n        if (getSelControl!.includes(nextSelectedControl)) {\r\n          if (!nextHighControlSeries.includes(selControl)) {\r\n            nextHighControlSeries.push(selControl)\r\n          }\r\n          if (!nextHighControlSeries.includes(nextSelectedControl)) {\r\n            nextHighControlSeries.push(nextSelectedControl)\r\n          }\r\n        } else {\r\n          if (Object.keys(nextHighControlSeries).length !== 0) {\r\n            const tempExchageIndex = userData[nextHighControlSeries[0]].extraDatas!.zIndex!\r\n            const swapTabIndex = userData[nextSelectedControl].extraDatas!.zIndex!\r\n            if (swapTabIndex <= userData[container].controls.length) {\r\n              const index = userData[container].controls.findIndex(\r\n                (val) => userData[val].extraDatas!.zIndex === swapTabIndex\r\n              )\r\n              this.updateExtraDatas(userData[container].controls[index], 'zIndex', tempExchageIndex)\r\n              this.updateExtraDatas(nextHighControlSeries[0], 'zIndex', (nextHighControlSeries!.length + 1) - swapTabIndex)\r\n            }\r\n            for (let j = 1; j < nextHighControlSeries.length; j++) {\r\n              const updateIndex = userData[nextHighControlSeries[j]].extraDatas!.zIndex! - 1\r\n              this.updateExtraDatas(nextHighControlSeries[j], 'zIndex', updateIndex)\r\n            }\r\n            nextHighControlSeries = []\r\n          } else {\r\n            const swapTabIndex = userData[nextSelectedControl].extraDatas!.zIndex!\r\n            if (swapTabIndex <= userData[container].controls.length && swapTabIndex > 0) {\r\n              const index = userData[container].controls.findIndex(\r\n                (val) => userData[val].extraDatas!.zIndex === swapTabIndex\r\n              )\r\n              this.updateExtraDatas(selControl, 'zIndex', swapTabIndex)\r\n              this.updateExtraDatas(nextSelectedControl, 'zIndex', tempZIndex)\r\n            }\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n  deletePageIndex (id: string) {\r\n    const userData = this.userformData[this.userFormId]\r\n    const container = this.selectedControls[this.userFormId].container[0]\r\n    const tempIndex = userData[id].properties!.Index!\r\n    for (const key in userData[container].controls) {\r\n      const controlZIndex = userData[userData[container].controls[key]].properties!.Index!\r\n      if (controlZIndex > tempIndex) {\r\n        this.updateControl({\r\n          userFormId: this.userFormId,\r\n          controlId: userData[container].controls[key],\r\n          propertyName: 'Index',\r\n          value: controlZIndex - 1\r\n        })\r\n      }\r\n    }\r\n  }\r\n  deleteCurrentPage () {\r\n    const type = this.userformData[this.userFormId][this.controlId].type\r\n    if (type === 'TabStrip') {\r\n      const tabControlData = JSON.parse(\r\n        JSON.stringify(this.userformData[this.userFormId][this.controlId])\r\n      ).extraDatas.Tabs\r\n      if (tabControlData && tabControlData.length > 0) {\r\n        tabControlData.splice(this.selectedTab, 1)\r\n        this.updateControlExtraData({\r\n          userFormId: this.userFormId,\r\n          controlId: this.controlId,\r\n          propertyName: 'Tabs',\r\n          value: tabControlData\r\n        })\r\n        this.updateTabStripValue(this.selectedTab! - 1)\r\n      }\r\n    } else if (type === 'MultiPage') {\r\n      const controls = this.userformData[this.userFormId][this.controlId].controls\r\n      if (controls.length > 0) {\r\n        this.deletePageIndex(this.selectedControls[this.userFormId].selected[0])\r\n        const index = this.userformData[this.userFormId][this.selectedControls[this.userFormId].selected[0]].properties.Index\r\n        this.deleteControl({\r\n          userFormId: this.userFormId,\r\n          parentId: this.selectedControls[this.userFormId].container[0],\r\n          targetId: this.selectedControls[this.userFormId].selected[0]\r\n        })\r\n        this.updateIndex(index! - 1)\r\n      }\r\n      EventBus.$emit('updateMultiPageValue')\r\n    }\r\n  }\r\n  updateTabStripValue (index: number) {\r\n    const userData = this.userformData[this.userFormId]\r\n    const tabs = userData[this.controlId].extraDatas!.Tabs!\r\n    const tabIndex = tabs.findIndex((val, key) => key === index + 1)\r\n    if (tabIndex !== -1) {\r\n      const value = index + 1\r\n      this.updateControlProperty('Value', value, this.controlId)\r\n    } else if (tabIndex === -1 && index !== -1) {\r\n      const value = index\r\n      this.updateControlProperty('Value', value, this.controlId)\r\n    } else {\r\n      this.updateControlProperty('Value', -1, this.controlId)\r\n    }\r\n  }\r\n  changeSelect (control: string) {\r\n    this.selectControl({\r\n      userFormId: this.userFormId,\r\n      select: {\r\n        container: this.getContainerList(control),\r\n        selected: [control]\r\n      }\r\n    })\r\n  }\r\n  updateIndex (index: number) {\r\n    const userData = this.userformData[this.userFormId]\r\n    const controls = userData[this.controlId].controls\r\n    const pageIndex = controls.findIndex(val => userData[val].properties.Index === index + 1)\r\n    if (pageIndex !== -1) {\r\n      const value = userData[controls[pageIndex]].properties.Index!\r\n      this.updateControlProperty('Value', value, this.controlId)\r\n      this.changeSelect(controls[pageIndex])\r\n    } else if (pageIndex === -1 && index !== -1) {\r\n      const updateIndex = controls.findIndex(val => userData[val].properties.Index === index)\r\n      const value = userData[controls[updateIndex]].properties.Index!\r\n      this.updateControlProperty('Value', value, this.controlId)\r\n      this.changeSelect(controls[updateIndex])\r\n    } else {\r\n      this.updateControlProperty('Value', -1, this.controlId)\r\n      this.changeSelect(this.controlId)\r\n    }\r\n  }\r\n  updateControlProperty (\r\n    propertyName: keyof controlProperties,\r\n    propertyValue: number | string,\r\n    controlId: string\r\n  ) {\r\n    this.updateControl({\r\n      userFormId: this.userFormId,\r\n      controlId: controlId,\r\n      propertyName: propertyName,\r\n      value: propertyValue\r\n    })\r\n  }\r\n\r\n  unGroupControl () {\r\n    const isGroup = this.selectedControls[this.userFormId].selected[0].startsWith('group')\r\n    const selControl = this.selectedControls[this.userFormId].selected[0]\r\n    const selected = isGroup\r\n      ? selControl\r\n      : this.userformData[this.userFormId][selControl].properties.GroupID!\r\n\r\n    const controlList = []\r\n    for (const key in this.userformData[this.userFormId]) {\r\n      const type = this.userformData[this.userFormId][key].type\r\n      if (\r\n        type !== 'Userform' &&\r\n        this.userformData[this.userFormId][key].properties.GroupID === selected\r\n      ) {\r\n        controlList.push(key)\r\n      }\r\n    }\r\n    const groupArray = [...this.groupedControls[this.userFormId]!.groupArray!]\r\n    this.updateControlGroupID(selected, '')\r\n    const index = this.groupedControls[this.userFormId]!.groupArray!.findIndex(\r\n      (val) => val === selected\r\n    )\r\n    groupArray.splice(index, 1)\r\n    this.updateGroup({ userFormId: this.userFormId, groupArray: groupArray })\r\n    this.selectControl({\r\n      userFormId: this.userFormId,\r\n      select: {\r\n        container: isGroup\r\n          ? this.getContainerList(controlList[0])\r\n          : this.getContainerList(selControl[0]),\r\n        selected: isGroup ? controlList : [selControl]\r\n      }\r\n    })\r\n  }\r\n\r\n  /**\r\n   * @description To generate new GroupID\r\n   * @function createGroupId\r\n   */\r\n  createGroupId () {\r\n    let lastControlId = 0\r\n    for (let i of this.groupedControls[this.userFormId]!.groupArray!) {\r\n      if (i.indexOf('group') !== -1) {\r\n        const IdNum = i.split('group').pop() || '-1'\r\n        const pasreId = parseInt(IdNum, 10)\r\n        if (!isNaN(pasreId) && lastControlId < pasreId) {\r\n          lastControlId = pasreId\r\n        }\r\n      }\r\n    }\r\n    return `group${lastControlId + 1}`\r\n  }\r\n\r\n  @Emit('createGroup')\r\n  createGroup (groupId: string) {\r\n    return groupId\r\n  }\r\n\r\n  updateControlGroupID (groupName: string, updateGroupId: string) {\r\n    for (const val in this.userformData[this.userFormId]) {\r\n      if (!val.startsWith('ID_USERFORM')) {\r\n        const controlGrpId = this.userformData[this.userFormId][val].properties\r\n          .GroupID\r\n        if (controlGrpId === groupName) {\r\n          this.updateControlProperty('GroupID', updateGroupId, val)\r\n        }\r\n      }\r\n    }\r\n  }\r\n  /**\r\n   * @description To update the group Information in main data\r\n   * @function groupControl\r\n   */\r\n  groupControl () {\r\n    let updateGroupId: string = ''\r\n    const selected = this.selectedControls[this.userFormId].selected\r\n\r\n    const selectedGroupArray = selected.filter(\r\n      (val: string) => val.startsWith('group') && val\r\n    )\r\n    updateGroupId = selectedGroupArray[0]\r\n    if (selectedGroupArray.length >= 2) {\r\n      const groupArray = [\r\n        ...this.groupedControls[this.userFormId]!.groupArray!\r\n      ]\r\n      for (let i = 0; i < groupArray.length; i++) {\r\n        for (let j = 0; j < selectedGroupArray.length; j++) {\r\n          if (selectedGroupArray[j] === groupArray[i]) {\r\n            this.updateControlGroupID(groupArray[i], selectedGroupArray[0])\r\n            groupArray.splice(i, 1)\r\n          }\r\n        }\r\n      }\r\n      this.updateGroup({\r\n        userFormId: this.userFormId,\r\n        groupArray: [...groupArray, selectedGroupArray[0]]\r\n      })\r\n      updateGroupId = selectedGroupArray[0]!\r\n    } else if (selectedGroupArray.length === 0) {\r\n      updateGroupId = this.createGroupId()\r\n      const groupArray = [\r\n        ...this.groupedControls[this.userFormId]!.groupArray!,\r\n        updateGroupId\r\n      ]\r\n      this.updateGroup({ userFormId: this.userFormId, groupArray: groupArray })\r\n    }\r\n\r\n    for (let val of selected) {\r\n      if (!val.startsWith('group')) {\r\n        this.updateControlProperty('GroupID', updateGroupId, val)\r\n      }\r\n    }\r\n    this.createGroup(updateGroupId)\r\n    this.selectControl({\r\n      userFormId: this.userFormId,\r\n      select: {\r\n        container: this.getContainerList(updateGroupId),\r\n        selected: [updateGroupId]\r\n      }\r\n    })\r\n  }\r\n\r\n  /**\r\n   * @description To select all the controls in respective container present in respective userform\r\n   * @function selectAll\r\n   */\r\n  selectAll () {\r\n    // const selecetedContainer = this.selectedControls[this.userFormId].container[0]\r\n    const controlObjectList = [\r\n      ...this.userformData[this.userFormId][this.containerId].controls\r\n    ]\r\n    const selecedGroup: string[] = []\r\n    for (const val of controlObjectList) {\r\n      const controlGroupId: string = this.userformData[this.userFormId][val]\r\n        .properties.GroupID!\r\n      if (controlGroupId && controlGroupId !== '') {\r\n        !selecedGroup.includes(controlGroupId)! &&\r\n          selecedGroup.push(controlGroupId)\r\n      } else {\r\n        selecedGroup.push(val)\r\n      }\r\n    }\r\n\r\n    if (controlObjectList.length !== 0) {\r\n      this.selectControl({\r\n        userFormId: this.userFormId,\r\n        select: {\r\n          container: this.getContainerList(selecedGroup[0]),\r\n          selected: [...selecedGroup]\r\n        }\r\n      })\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @description To update the cutted controls in respective container present in respective userform\r\n   * @function cutControl\r\n   */\r\n  cutControl () {\r\n    this.copyControl('cut')\r\n    this.clickDelete()\r\n  }\r\n\r\n  /**\r\n   * @description To update the copied controls in respective container present in respective userform\r\n   * @function copyControl\r\n   */\r\n  copyControl (type: string) {\r\n    if (this.copiedControl[this.userFormId][this.userFormId].controls.length > 0) {\r\n      const lengthCount = this.copiedControl[this.userFormId][this.userFormId].controls.length\r\n      const controls = [...this.copiedControl[this.userFormId][this.userFormId].controls]\r\n      for (let i = 0; i < lengthCount; i++) {\r\n        this.deleteCopiedControl({\r\n          userFormId: this.userFormId,\r\n          parentId: this.userFormId,\r\n          targetId: controls[i]\r\n        })\r\n      }\r\n    }\r\n    const userFormData = this.userformData[this.userFormId]\r\n    const selContainer = this.selectedControls[this.userFormId].container[0]\r\n    const selSelected = this.selectedControls[this.userFormId].selected\r\n    const updateSelected = []\r\n    for (let control of selSelected) {\r\n      if (!control.startsWith('group') && userFormData[control].type === 'Page') {\r\n        control = this.getContainerList(control)[0]\r\n      }\r\n      updateSelected.push(control)\r\n    }\r\n    this.updateCopyControlList({\r\n      userFormId: this.userFormId,\r\n      parentId: selContainer,\r\n      targetId: updateSelected,\r\n      type: type\r\n    })\r\n\r\n    const recCopyControl = (daTarget: string) => {\r\n      const daTargetControls = userFormData[daTarget].controls\r\n      if (daTargetControls.length > 0) {\r\n        for (let i in daTargetControls) {\r\n          const controlObject = JSON.parse(JSON.stringify(userFormData[daTargetControls[i]]))\r\n          const controlArray = []\r\n          const ctrlObj = { ...controlObject, controls: [] }\r\n          this.addCopiedControl({\r\n            userFormId: this.userFormId,\r\n            controlId: daTarget,\r\n            addId: daTargetControls[i],\r\n            item: ctrlObj\r\n          })\r\n          recCopyControl(daTargetControls[i])\r\n        }\r\n      }\r\n    }\r\n\r\n    for (let key of selSelected) {\r\n      if (!key.startsWith('group')) {\r\n        if (userFormData[key].type === 'Page') {\r\n          key = this.getContainerList(key)[0]\r\n        }\r\n        const controlObject = JSON.parse(JSON.stringify(userFormData[key]))\r\n        const ctrlObj = { ...controlObject, controls: [] }\r\n        this.addCopiedControl({\r\n          userFormId: this.userFormId,\r\n          controlId: this.userFormId,\r\n          addId: key,\r\n          item: ctrlObj\r\n        })\r\n        recCopyControl(key)\r\n      } else {\r\n        for (let ctrlId in userFormData) {\r\n          const controlProp = userFormData[ctrlId].properties.GroupID\r\n          if (controlProp) {\r\n            if (controlProp === key) {\r\n              const controlObject = JSON.parse(\r\n                JSON.stringify(userFormData[ctrlId])\r\n              )\r\n              const ctrlObj = { ...controlObject, controls: [] }\r\n              this.addCopiedControl({\r\n                userFormId: this.userFormId,\r\n                controlId: this.userFormId,\r\n                addId: ctrlId,\r\n                item: ctrlObj\r\n              })\r\n              recCopyControl(ctrlId)\r\n            }\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n  updateNewControl (parentId: string, ctrlId: string, ctrlObj: controlData, isParent: boolean) {\r\n    this.addControl({\r\n      userFormId: this.userFormId,\r\n      controlId: parentId,\r\n      addId: ctrlId,\r\n      item: ctrlObj\r\n    })\r\n    if (isParent) {\r\n      const newTabIndex = this.userformData[this.userFormId][parentId].controls.length\r\n      this.updateTabIndexValue(ctrlId)\r\n      this.updateZIndexValue(ctrlId)\r\n    }\r\n  }\r\n\r\n  newPasteControlId (key: string, parentId: string) {\r\n    const userFormData = this.userformData[this.userFormId]\r\n    let lastControlId = 0\r\n    const type = key in userFormData ? userFormData[key].type : ''\r\n    const parentName = parentId !== '' ? parentId.split('MultiPage').pop() : -1\r\n    const selectedControlName: string | undefined =\r\n    type === 'Page'\r\n      ? `Page${parentName}_`\r\n      : key.replace(/[0-9]/g, '').split('_').pop()\r\n    const userformControlIds = Object.keys(userFormData)\r\n    for (let i = 0; i < userformControlIds.length; i++) {\r\n      if (userformControlIds[i].indexOf(selectedControlName!) !== -1) {\r\n        const IdNum = userformControlIds[i].split(selectedControlName!).pop() || '-1'\r\n        const pasreId = parseInt(IdNum, 10)\r\n        if (!isNaN(pasreId) && lastControlId < pasreId) {\r\n          lastControlId = pasreId\r\n        }\r\n      }\r\n    }\r\n    lastControlId += 1\r\n    const Name = `${selectedControlName}${lastControlId}`\r\n    return Name\r\n  }\r\n  removeChildControl (daTarget: string, deleteControl: string) {\r\n    const removeControl = [...this.userformData[this.userFormId][daTarget].controls]\r\n    const removeIndex = removeControl.findIndex((val) => val === deleteControl)\r\n    removeControl.splice(removeIndex, 1)\r\n    this.setChildControls({\r\n      userFormId: this.userFormId,\r\n      containerId: daTarget,\r\n      targetControls: removeControl\r\n    })\r\n  }\r\n  getPasteControlSize () {\r\n    const usrFrmData = this.userformData[this.userFormId]\r\n    const pasteControls = [...this.getSelectedControlsDatas!]\r\n    const pasteContainer = this.selectedControls[this.userFormId].container[0]\r\n    const leftArray = [...pasteControls]\r\n    const topArray = [...pasteControls]\r\n    const rightArray = [...pasteControls]\r\n    const bottomArray = [...pasteControls]\r\n    leftArray.sort((a, b) => {\r\n      return usrFrmData[a].properties.Left! - usrFrmData[b].properties.Left!\r\n    })\r\n    topArray.sort((a, b) => {\r\n      return usrFrmData[a].properties.Top! - usrFrmData[b].properties.Top!\r\n    })\r\n    rightArray.sort((a, b) => {\r\n      return (usrFrmData[b].properties.Left! + usrFrmData[b].properties.Width!) -\r\n       (usrFrmData[a].properties.Left! + usrFrmData[a].properties.Width!)\r\n    })\r\n    bottomArray.sort((a, b) => {\r\n      return (usrFrmData[b].properties.Top! + usrFrmData[b].properties.Height!) -\r\n       (usrFrmData[a].properties.Top! + usrFrmData[a].properties.Height!)\r\n    })\r\n    const groupRectLeft = usrFrmData[leftArray[0]].properties.Left!\r\n    const groupRectTop = usrFrmData[topArray[0]].properties.Top!\r\n    const groupRectBottom = usrFrmData[bottomArray[0]].properties.Top! + usrFrmData[bottomArray[0]].properties.Height!\r\n    const groupRectRight = usrFrmData[rightArray[0]].properties.Left! + usrFrmData[rightArray[0]].properties.Width!\r\n\r\n    const deltaTop = (groupRectBottom - groupRectTop) / 2\r\n    const deltaLeft = (groupRectRight - groupRectLeft) / 2\r\n\r\n    const type = this.userformData[this.userFormId][pasteContainer].type\r\n    const container = type === 'Page' ? this.userformData[this.userFormId][this.getContainerList(pasteContainer)[0]].properties : this.userformData[this.userFormId][pasteContainer].properties\r\n    const containerHeight = type === 'Userform' ? container.Height! - 37 : container.Height!\r\n    const targetTop = ((containerHeight) / 2) - deltaTop\r\n    const targetLeft = (container.Width! / 2) - deltaLeft\r\n\r\n    const diffTop = targetTop - usrFrmData[topArray[0]].properties.Top!\r\n    const diffLeft = targetLeft - usrFrmData[leftArray[0]].properties.Left!\r\n\r\n    for (let i = 0; i < leftArray.length; i++) {\r\n      let left = usrFrmData[leftArray[i]].properties.Left! + diffLeft\r\n      if (!isNaN(left)) {\r\n        this.updateControlProperty('Left', Math.abs(left), leftArray[i])\r\n      }\r\n    }\r\n    for (let i = 0; i < topArray.length; i++) {\r\n      let top = usrFrmData[topArray[i]].properties.Top! + diffTop\r\n      if (!isNaN(top)) {\r\n        this.updateControlProperty('Top', Math.abs(top), topArray[i])\r\n      }\r\n    }\r\n  }\r\n  /**\r\n   * @description To paste controls in respective container present in respective userform\r\n   * @function pasteControl\r\n   */\r\n  pasteControl () {\r\n    if (this.copyControlList.type === 'copy') {\r\n      const selContainer = this.copyControlList.parentId\r\n      const selSelected = this.copyControlList.targetId\r\n      const userFormData = this.userformData[this.userFormId]\r\n      const presentGroupId: string[] = []\r\n      const newGroupId: string[] = []\r\n      const oldControlId: string[] = []\r\n      const newControlId: string[] = []\r\n\r\n      for (const key in this.copiedControl[this.userFormId]) {\r\n        const controlProp = this.copiedControl[this.userFormId][key].properties.GroupID\r\n        if (controlProp && !presentGroupId.includes(controlProp)) {\r\n          presentGroupId.push(controlProp)\r\n        }\r\n      }\r\n      for (let j in presentGroupId) {\r\n        const newId = this.createGroupId()\r\n        newGroupId.push(newId)\r\n        let groupArray: string[] = [\r\n          ...this.groupedControls[this.userFormId]!.groupArray!,\r\n          newId\r\n        ]\r\n        this.updateGroup({\r\n          userFormId: this.userFormId,\r\n          groupArray: groupArray!\r\n        })\r\n      }\r\n\r\n      const recCopyControl = (daTarget: string) => {\r\n        const daTargetControls = userFormData[daTarget].controls\r\n        if (daTargetControls && daTargetControls.length > 0) {\r\n          for (let i = 0, limit = daTargetControls.length; i < limit; i++) {\r\n            const key = daTargetControls[i]\r\n            const Name = this.newPasteControlId(key, daTarget)\r\n            const controlID:| string| undefined = `ID_${Name}`\r\n            const controlObj = { ...this.copiedControl[this.userFormId][key] }\r\n            let groupIdIndex = -1\r\n            groupIdIndex = presentGroupId.findIndex((val) => val === controlObj.properties.GroupID)\r\n            const item: controlData = {\r\n              ...controlObj,\r\n              properties: {\r\n                ...controlObj.properties,\r\n                ID: controlID!,\r\n                GroupID: groupIdIndex !== -1 ? newGroupId[groupIdIndex] : '',\r\n                Name: Name\r\n              }\r\n            }\r\n            this.removeChildControl(daTarget, key)\r\n            this.updateNewControl(daTarget, controlID, item, false)\r\n            recCopyControl(controlID)\r\n          }\r\n        }\r\n      }\r\n\r\n      for (const key of selSelected) {\r\n        if (!key.startsWith('group')) {\r\n          oldControlId.push(key)\r\n          const Name = this.newPasteControlId(key, '')\r\n          const controlID:| string| undefined = `ID_${Name}`\r\n          const controlObj = { ...this.copiedControl[this.userFormId][key] }\r\n          newControlId.push(controlID)\r\n          let groupIdIndex = -1\r\n          groupIdIndex = presentGroupId.findIndex(\r\n            (val) => controlObj.properties.GroupID === val\r\n          )\r\n          if (selSelected.length === 1 && this.copiedControl[this.userFormId][selSelected[0]].properties.GroupID !== '') {\r\n            groupIdIndex = -1\r\n          }\r\n          const item: controlData = {\r\n            ...controlObj,\r\n            properties: {\r\n              ...controlObj.properties,\r\n              ID: controlID!,\r\n              GroupID: groupIdIndex !== -1 ? newGroupId[groupIdIndex] : '',\r\n              Name: Name\r\n            }\r\n          }\r\n          this.updateNewControl(this.containerId, controlID, item, true)\r\n          recCopyControl(controlID)\r\n        } else {\r\n          for (let ctrlId in this.copiedControl[this.userFormId]) {\r\n            const controlProp = this.copiedControl[this.userFormId][ctrlId]\r\n              .properties.GroupID\r\n            if (controlProp) {\r\n              if (controlProp === key) {\r\n                const Name = this.newPasteControlId(ctrlId, '')\r\n                const controlID:| string| undefined = `ID_${Name}`\r\n                const controlObj = this.copiedControl[this.userFormId][ctrlId]\r\n\r\n                let groupIdIndex = -1\r\n                groupIdIndex = presentGroupId.findIndex(\r\n                  (val) => controlObj.properties.GroupID === val\r\n                )\r\n                const item: controlData = {\r\n                  ...controlObj,\r\n                  properties: {\r\n                    ...controlObj.properties,\r\n                    ID: controlID!,\r\n                    GroupID: groupIdIndex !== -1 ? newGroupId[groupIdIndex] : '',\r\n                    Name: Name\r\n                  }\r\n                }\r\n                this.updateNewControl(this.containerId, controlID, item, true)\r\n                recCopyControl(controlID)\r\n              }\r\n            }\r\n          }\r\n        }\r\n      }\r\n      for (let j of newGroupId) {\r\n        this.createGroup(j)\r\n      }\r\n      const newSelected: string[] = []\r\n      for (const control of selSelected) {\r\n        if (control.startsWith('group')) {\r\n          const index = presentGroupId.findIndex((val) => val === control)\r\n          newSelected.push(newGroupId[index])\r\n        } else {\r\n          const index = oldControlId.findIndex((val) => val === control)\r\n          newSelected.push(newControlId[index])\r\n        }\r\n      }\r\n      this.selectControl({\r\n        userFormId: this.userFormId,\r\n        select: {\r\n          container: this.getContainerList(newSelected[0]),\r\n          selected: newSelected\r\n        }\r\n      })\r\n    } else if (this.copyControlList.type === 'cut') {\r\n      const selContainer = this.copyControlList.parentId\r\n      const selSelected = this.copyControlList.targetId\r\n      const userFormData = this.copiedControl[this.userFormId]\r\n      const recCopyControl = (daTarget: string) => {\r\n        const daTargetControls = userFormData[daTarget].controls\r\n        if (daTargetControls.length > 0) {\r\n          for (let i = 0, limit = daTargetControls.length; i < limit; i++) {\r\n            const key = daTargetControls[i]\r\n            const controlObj = JSON.parse(JSON.stringify(this.copiedControl[this.userFormId][key]))\r\n            const item: controlData = {\r\n              ...controlObj\r\n            }\r\n            this.removeChildControl(daTarget, key)\r\n            this.updateNewControl(daTarget, key, item, false)\r\n            recCopyControl(key)\r\n          }\r\n        }\r\n      }\r\n      for (const key of selSelected) {\r\n        if (!key.startsWith('group')) {\r\n          const controlObj = JSON.parse(\r\n            JSON.stringify(this.copiedControl[this.userFormId][key])\r\n          )\r\n          if (selSelected.length === 1 && userFormData[selSelected[0]].properties.GroupID! !== '') {\r\n            controlObj.properties.GroupID = ''\r\n          }\r\n          const item: controlData = {\r\n            ...controlObj\r\n          }\r\n          this.updateNewControl(this.containerId, key, item, true)\r\n          recCopyControl(key)\r\n        } else {\r\n          for (let ctrlId in userFormData) {\r\n            const controlProp = userFormData[ctrlId].properties.GroupID\r\n            if (controlProp) {\r\n              if (controlProp === key) {\r\n                const controlObj = JSON.parse(\r\n                  JSON.stringify(this.copiedControl[this.userFormId][ctrlId])\r\n                )\r\n                const item: controlData = {\r\n                  ...controlObj\r\n                }\r\n                this.updateNewControl(this.containerId, ctrlId, item, true)\r\n                recCopyControl(ctrlId)\r\n              }\r\n            }\r\n          }\r\n        }\r\n      }\r\n      this.selectControl({\r\n        userFormId: this.userFormId,\r\n        select: {\r\n          container: this.getContainerList(selSelected[0]),\r\n          selected: selSelected\r\n        }\r\n      })\r\n      this.updateCopyControlList({\r\n        userFormId: this.userFormId,\r\n        parentId: this.containerId,\r\n        targetId: selSelected,\r\n        type: 'copy'\r\n      })\r\n    }\r\n    this.getPasteControlSize()\r\n    const selSelected = this.selectedControls[this.userFormId].selected\r\n    for (const control of selSelected) {\r\n      if (control.startsWith('group')) {\r\n        this.createGroup(control)\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @description To delete controls in respective container present in respective userform\r\n   * @function clickDelete\r\n   */\r\n  clickDelete () {\r\n    const selControl = []\r\n    const userData = this.userformData[this.userFormId]\r\n    const selected = this.selectedControls[this.userFormId].selected\r\n    const selContainer = this.selectedControls[this.userFormId].container\r\n    const filterControls = []\r\n    const controls = this.userformData[this.userFormId][this.selectedControls[this.userFormId].container[0]].controls\r\n    for (const control of selected) {\r\n      if (!control.startsWith('ID_USERFORM')) {\r\n        if (control.startsWith('group')) {\r\n          for (const key in userData) {\r\n            if (\r\n              userData[key].properties.GroupID === control\r\n            ) {\r\n              selControl.push(key)\r\n            }\r\n          }\r\n        } else {\r\n          selControl.push(control)\r\n        }\r\n      }\r\n    }\r\n    if (selected.length === 1 && !selected[0].startsWith('group') && this.userformData[this.userFormId][selected[0]].properties.GroupID !== '') {\r\n      for (let j = 0; j < controls.length; j++) {\r\n        if (userData[controls[j]].properties.GroupID === userData[selected[0]].properties.GroupID) {\r\n          filterControls.push(controls[j])\r\n        }\r\n      }\r\n      if (filterControls.length === 2) {\r\n        const curSelect = filterControls[0] === selected[0] ? filterControls[1] : filterControls[0]\r\n        const selGroupId = userData[selected[0]].properties.GroupID\r\n        this.updateControlProperty('GroupID', '', curSelect)\r\n      }\r\n    }\r\n    for (let i = 0; i < selControl.length; i++) {\r\n      const controlId = userData[selControl[i]].type === 'Page' ? selContainer[0] : selControl[i]\r\n      this.deleteZIndex(controlId)\r\n      this.deleteTabIndex(controlId)\r\n      this.deleteControl({\r\n        userFormId: this.userFormId,\r\n        parentId: this.getContainerList(controlId)[0],\r\n        targetId: controlId\r\n      })\r\n    }\r\n\r\n    this.selectControl({\r\n      userFormId: this.userFormId,\r\n      select: {\r\n        container: userData[selContainer[0]].type === 'MultiPage' ? this.getContainerList(selContainer[0]) : selContainer,\r\n        selected: userData[selContainer[0]].type === 'MultiPage' ? [this.getContainerList(selContainer[0])[0]] : [selContainer[0]]\r\n      }\r\n    })\r\n    EventBus.$emit('focusUserForm')\r\n  }\r\n  updateAction (event: KeyboardEvent) {\r\n    let controlActionName = ''\r\n    if (event.ctrlKey && event.code === 'KeyA') {\r\n      controlActionName = 'ID_SELECTALL'\r\n    } else if (event.ctrlKey && event.code === 'KeyC') {\r\n      if (\r\n        this.selectedControls[this.userFormId].selected[0] !== this.userFormId\r\n      ) {\r\n        controlActionName = 'ID_COPY'\r\n      }\r\n    } else if (event.keyCode === 46) {\r\n      controlActionName = 'ID_DELETE'\r\n    } else if (event.ctrlKey && event.code === 'KeyV') {\r\n      controlActionName = 'ID_PASTE'\r\n    } else if (event.keyCode && event.code === 'KeyX') {\r\n      controlActionName = 'ID_CUT'\r\n    }\r\n    this.controlAction(event, controlActionName, '')\r\n  }\r\n  updatePropVal (propName: string, propValue: number) {\r\n    const ctrlSel = this.selectedControls[this.userFormId].selected\r\n    const usrFrmData = this.userformData[this.userFormId]\r\n    for (let index = 1; index < ctrlSel.length; index++) {\r\n      if (!ctrlSel[index].startsWith('group')) {\r\n        const curProp = usrFrmData[ctrlSel[index]].properties\r\n        if (propName === 'selRight') {\r\n          const curRight = curProp.Width! + curProp.Left!\r\n          const value = curProp.Left! + (propValue - curRight)\r\n          this.updateControlProperty('Left', value, ctrlSel[index])\r\n        } else if (propName === 'selBottom') {\r\n          const curBottom = curProp.Height! + curProp.Top!\r\n          const value = curProp.Top! + (propValue - curBottom)\r\n          this.updateControlProperty('Top', value, ctrlSel[index])\r\n        }\r\n        if (propName === 'selCenter') {\r\n          const curCenter = curProp.Width! / 2\r\n          const value = propValue - curCenter\r\n          this.updateControlProperty('Left', value, ctrlSel[index])\r\n        }\r\n        if (propName === 'selMiddle') {\r\n          const curMiddle = curProp.Height! / 2\r\n          const value = propValue - curMiddle\r\n          this.updateControlProperty('Top', value, ctrlSel[index])\r\n        } else {\r\n          const propertyname: keyof controlProperties = propName as keyof controlProperties\r\n          this.updateControlProperty(propertyname, propValue, ctrlSel[index])\r\n        }\r\n      } else {\r\n        const groupIndex: number = this.groupStyleArray.findIndex(val => val.groupName === ctrlSel[index])\r\n        const curProp = this.groupStyleArray[groupIndex]\r\n        const left = parseInt(curProp.left!)\r\n        const top = parseInt(curProp.top!)\r\n        const width = parseInt(curProp.width!)\r\n        const height = parseInt(curProp.height!)\r\n        let value = -1\r\n        if (propName === 'selRight') {\r\n          value = left! + (propValue - (width! + left!))\r\n          EventBus.$emit('updasteGroupSize', 'Left', value, groupIndex)\r\n        } else if (propName === 'selBottom') {\r\n          value = top! + (propValue - (height + top))\r\n          EventBus.$emit('updasteGroupSize', 'Top', value, groupIndex)\r\n        }\r\n        if (propName === 'selCenter') {\r\n          value = propValue - (width! / 2)\r\n          EventBus.$emit('updasteGroupSize', 'Left', value, groupIndex)\r\n        }\r\n        if (propName === 'selMiddle') {\r\n          value = propValue - height! / 2\r\n          EventBus.$emit('updasteGroupSize', 'Top', value, groupIndex)\r\n        } else {\r\n          const propertyname: keyof controlProperties = propName as keyof controlProperties\r\n          EventBus.$emit('updasteGroupSize', propertyname, propValue, groupIndex)\r\n        }\r\n      }\r\n    }\r\n  }\r\n  controlAlignMent (subVal: string) {\r\n    const mainSel = this.selectedControls[this.userFormId].selected[0]\r\n    const isGroup = mainSel.startsWith('group')\r\n    const usrFrmData = this.userformData[this.userFormId]\r\n    const ctrlProp = !isGroup && usrFrmData[mainSel].properties\r\n    const groupIndex: number = this.groupStyleArray.findIndex(val => val.groupName === mainSel)\r\n    const newObject = {\r\n      Left: isGroup && groupIndex !== -1 ? parseInt(this.groupStyleArray[groupIndex].left!) : ctrlProp ? ctrlProp.Left! : 0,\r\n      Top: isGroup && groupIndex !== -1 ? parseInt(this.groupStyleArray[groupIndex].top!) : ctrlProp ? ctrlProp.Top! : 0,\r\n      Width: isGroup && groupIndex !== -1 ? parseInt(this.groupStyleArray[groupIndex].width!) : ctrlProp ? ctrlProp.Width! : 0,\r\n      Height: isGroup && groupIndex !== -1 ? parseInt(this.groupStyleArray[groupIndex].height!) : ctrlProp ? ctrlProp.Height! : 0\r\n    }\r\n    if (subVal === 'ID_ALIGNLEFT') {\r\n      this.updatePropVal('Left', newObject.Left!)\r\n    } else if (subVal === 'ID_ALIGNTOP') {\r\n      this.updatePropVal('Top', newObject.Top!)\r\n    } else if (subVal === 'ID_ALIGNRIGHT') {\r\n      const selRight = newObject.Width! + newObject.Left!\r\n      this.updatePropVal('selRight', selRight)\r\n    } else if (subVal === 'ID_ALIGNBOTTOM') {\r\n      const selBottom = newObject.Height! + newObject.Top!\r\n      this.updatePropVal('selBottom', selBottom)\r\n    } else if (subVal === 'ID_ALIGNCENTER') {\r\n      const selCenter = newObject.Left! + newObject.Width! / 2\r\n      this.updatePropVal('selCenter', selCenter)\r\n    } else if (subVal === 'ID_ALIGNMIDDLE') {\r\n      const selMiddle = newObject.Top! + newObject.Height! / 2\r\n      this.updatePropVal('selMiddle', selMiddle)\r\n    } else if (subVal === 'ID_WIDTH') {\r\n      this.updatePropVal('Width', newObject.Width!)\r\n    } else if (subVal === 'ID_HEIGHT') {\r\n      this.updatePropVal('Height', newObject.Height!)\r\n    } else if (subVal === 'ID_BOTH') {\r\n      this.updatePropVal('Height', newObject.Height!)\r\n      this.updatePropVal('Width', newObject.Width!)\r\n    }\r\n  }\r\n\r\n  controlDisable (event: MouseEvent) {\r\n    event.preventDefault()\r\n    event.stopPropagation()\r\n  }\r\n}\r\n"],"sourceRoot":""}]}