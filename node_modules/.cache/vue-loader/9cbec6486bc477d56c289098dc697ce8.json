{"remainingRequest":"/home/mobiotics/Projects/hancom/FormcontrolLatest/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/mobiotics/Projects/hancom/FormcontrolLatest/src/FormDesigner/components/atoms/FDContextMenu/index.vue?vue&type=script&lang=ts&","dependencies":[{"path":"/home/mobiotics/Projects/hancom/FormcontrolLatest/src/FormDesigner/components/atoms/FDContextMenu/index.vue","mtime":1611419998000},{"path":"/home/mobiotics/Projects/hancom/FormcontrolLatest/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/mobiotics/Projects/hancom/FormcontrolLatest/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/home/mobiotics/Projects/hancom/FormcontrolLatest/node_modules/ts-loader/index.js","mtime":499162500000},{"path":"/home/mobiotics/Projects/hancom/FormcontrolLatest/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/mobiotics/Projects/hancom/FormcontrolLatest/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKDQppbXBvcnQgeyBDb21wb25lbnQsIFZ1ZSwgUHJvcCwgRW1pdCB9IGZyb20gJ3Z1ZS1wcm9wZXJ0eS1kZWNvcmF0b3InDQppbXBvcnQgRkRTVkdJbWFnZSBmcm9tICdAL0Zvcm1EZXNpZ25lci9jb21wb25lbnRzL2F0b21zL0ZEU1ZHSW1hZ2UvaW5kZXgudnVlJw0KaW1wb3J0IHsgQ29udHJvbFByb3BlcnR5RGF0YSB9IGZyb20gJ0AvRm9ybURlc2lnbmVyL21vZGVscy9Db250cm9sc1RhYmxlUHJvcGVydGllcy9Db250cm9sUHJvcGVydHlEYXRhLnRzJw0KDQppbXBvcnQgeyBBY3Rpb24sIFN0YXRlIH0gZnJvbSAndnVleC1jbGFzcycNCmltcG9ydCB7DQogIElhZGRDaGlsZENvbnRyb2xzLA0KICBJYWRkQ29udHJvbCwNCiAgSWRlbGV0ZUNvbnRyb2wsDQogIElzZWxlY3RDb250cm9sLA0KICBJc2V0Q2hpbGRDb250cm9scywNCiAgSXVwZGF0ZUNvbnRyb2wsDQogIEl1cGRhdGVDb250cm9sRXh0cmFEYXRhLA0KICBJdXBkYXRlQ29weUNvbnRyb2xMaXN0LA0KICBJdXBkYXRlR3JvdXANCn0gZnJvbSAnQC9zdG9yZU1vZHVsZXMvZmQvYWN0aW9ucycNCmltcG9ydCB7IEV2ZW50QnVzIH0gZnJvbSAnQC9Gb3JtRGVzaWduZXIvZXZlbnQtYnVzJw0KaW1wb3J0IEZEQ29tbW9uTWV0aG9kIGZyb20gJ0AvYXBpL2Fic3RyYWN0L0Zvcm1EZXNpZ25lci9GRENvbW1vbk1ldGhvZCcNCg0KQENvbXBvbmVudCh7DQogIG5hbWU6ICdDb250ZXh0TWVudScsDQogIGNvbXBvbmVudHM6IHsNCiAgICBGRFNWR0ltYWdlDQogIH0NCn0pDQpleHBvcnQgZGVmYXVsdCBjbGFzcyBDb250ZXh0TWVudSBleHRlbmRzIEZEQ29tbW9uTWV0aG9kIHsNCiAgQFByb3AoKSB2YWx1ZXM6IEFycmF5PElDb250cm9sQ29udGV4dE1lbnU+Ow0KICBAUHJvcCgpIHVzZXJGb3JtSWQ6IHN0cmluZzsNCiAgQFByb3AoKSBjb250YWluZXJJZDogc3RyaW5nOw0KICBAUHJvcCgpIGtleUV2ZW50TmFtZTogc3RyaW5nOw0KICBAUHJvcCgpIGNvbnRyb2xJZDogc3RyaW5nOw0KICBAUHJvcCgpIHNlbGVjdGVkVGFiOiBudW1iZXI7DQogIEBQcm9wKCkgZGF0YTogY29udHJvbERhdGE7DQogIEBQcm9wKCkgZ3JvdXBTdHlsZUFycmF5OiBBcnJheTxJR3JvdXBTdHlsZT4NCiAgQFByb3AoKSBjb250ZXh0TWVudXR5cGU6IHN0cmluZw0KICBAUHJvcCgpIGVkaXRUZXh0UmVmOiBIVE1MU3BhbkVsZW1lbnQgfCBIVE1MVGV4dEFyZWFFbGVtZW50DQogIEBQcm9wKCkgY29waWVkVGV4dDogc3RyaW5nDQogIEBQcm9wKCkgdGV4dE1lbnU6IGJvb2xlYW4NCg0KICBAU3RhdGUoKHN0YXRlKSA9PiBzdGF0ZS5mZC5zZWxlY3RlZENvbnRyb2xzKQ0KICBzZWxlY3RlZENvbnRyb2xzITogZmRTdGF0ZVsnc2VsZWN0ZWRDb250cm9scyddOw0KICBAU3RhdGUoKHN0YXRlOiByb290U3RhdGUpID0+IHN0YXRlLmZkLmNvcHlDb250cm9sTGlzdCkNCiAgY29weUNvbnRyb2xMaXN0ITogZmRTdGF0ZVsnY29weUNvbnRyb2xMaXN0J107DQogIEBTdGF0ZSgoc3RhdGUpID0+IHN0YXRlLmZkLnVzZXJmb3JtRGF0YSkgdXNlcmZvcm1EYXRhITogdXNlcmZvcm1EYXRhOw0KICBAU3RhdGUoKHN0YXRlKSA9PiBzdGF0ZS5mZC5jb3BpZWRDb250cm9sKSBjb3BpZWRDb250cm9sITogdXNlcmZvcm1EYXRhOw0KICBAU3RhdGUoKHN0YXRlKSA9PiBzdGF0ZS5mZC5ncm91cGVkQ29udHJvbHMpDQogIGdyb3VwZWRDb250cm9scyE6IGZkU3RhdGVbJ2dyb3VwZWRDb250cm9scyddOw0KDQogIEBBY3Rpb24oJ2ZkL2RlbGV0ZUNvbnRyb2wnKSBkZWxldGVDb250cm9sITogKHBheWxvYWQ6IElkZWxldGVDb250cm9sKSA9PiB2b2lkOw0KICBAQWN0aW9uKCdmZC9kZWxldGVDb3BpZWRDb250cm9sJykgZGVsZXRlQ29waWVkQ29udHJvbCE6IChwYXlsb2FkOiBJZGVsZXRlQ29udHJvbCkgPT4gdm9pZDsNCiAgQEFjdGlvbignZmQvdXBkYXRlQ29weUNvbnRyb2xMaXN0JykgdXBkYXRlQ29weUNvbnRyb2xMaXN0ITogKA0KICAgIHBheWxvYWQ6IEl1cGRhdGVDb3B5Q29udHJvbExpc3QNCiAgKSA9PiB2b2lkOw0KICBAQWN0aW9uKCdmZC9hZGRDb250cm9sJykgYWRkQ29udHJvbCE6IChwYXlsb2FkOiBJYWRkQ29udHJvbCkgPT4gdm9pZDsNCiAgQEFjdGlvbignZmQvYWRkQ29waWVkQ29udHJvbCcpIGFkZENvcGllZENvbnRyb2whOiAoDQogICAgcGF5bG9hZDogSWFkZENvbnRyb2wNCiAgKSA9PiB2b2lkOw0KICBAQWN0aW9uKCdmZC9zZWxlY3RDb250cm9sJykgc2VsZWN0Q29udHJvbCE6IChwYXlsb2FkOiBJc2VsZWN0Q29udHJvbCkgPT4gdm9pZDsNCiAgQEFjdGlvbignZmQvdXBkYXRlR3JvdXAnKSB1cGRhdGVHcm91cCE6IChwYXlsb2FkOiBJdXBkYXRlR3JvdXApID0+IHZvaWQ7DQogIEBBY3Rpb24oJ2ZkL3VwZGF0ZUNvbnRyb2xFeHRyYURhdGEnKSB1cGRhdGVDb250cm9sRXh0cmFEYXRhITogKA0KICAgIHBheWxvYWQ6IEl1cGRhdGVDb250cm9sRXh0cmFEYXRhDQogICkgPT4gdm9pZDsNCiAgQEFjdGlvbignZmQvdXBkYXRlQ29udHJvbCcpIHVwZGF0ZUNvbnRyb2whOiAocGF5bG9hZDogSXVwZGF0ZUNvbnRyb2wpID0+IHZvaWQ7DQogIEBBY3Rpb24oJ2ZkL3NldENoaWxkQ29udHJvbHMnKSBzZXRDaGlsZENvbnRyb2xzITogKA0KICAgIHBheWxvYWQ6IElzZXRDaGlsZENvbnRyb2xzDQogICkgPT4gdm9pZDsNCiAgQEFjdGlvbignZmQvYWRkQ2hpbGRDb250cm9scycpIGFkZENoaWxkQ29udHJvbHMhOiAoDQogICAgcGF5bG9hZDogSWFkZENoaWxkQ29udHJvbHMNCiAgKSA9PiB2b2lkOw0KICBjb250cm9sQWN0aW9uIChldmVudDogRXZlbnQsIGNvbnRyb2xBY3Rpb25OYW1lOiBzdHJpbmcsIHN1YlZhbDogc3RyaW5nKSB7DQogICAgaWYgKHRoaXMudGV4dE1lbnUgPT09IGZhbHNlKSB7DQogICAgICBpZiAoY29udHJvbEFjdGlvbk5hbWUgPT09ICdJRF9DT1BZJykgew0KICAgICAgICB0aGlzLmNvcHlDb250cm9sKCdjb3B5JykNCiAgICAgIH0gZWxzZSBpZiAoY29udHJvbEFjdGlvbk5hbWUgPT09ICdJRF9ERUxFVEUnKSB7DQogICAgICAgIHRoaXMuY2xpY2tEZWxldGUoKQ0KICAgICAgfSBlbHNlIGlmIChjb250cm9sQWN0aW9uTmFtZSA9PT0gJ0lEX1BBU1RFJykgew0KICAgICAgICB0aGlzLnBhc3RlQ29udHJvbCgpDQogICAgICB9IGVsc2UgaWYgKGNvbnRyb2xBY3Rpb25OYW1lID09PSAnSURfQ1VUJykgew0KICAgICAgICB0aGlzLmN1dENvbnRyb2woKQ0KICAgICAgfSBlbHNlIGlmIChjb250cm9sQWN0aW9uTmFtZSA9PT0gJ0lEX1NFTEVDVEFMTCcpIHsNCiAgICAgICAgdGhpcy5zZWxlY3RBbGwoKQ0KICAgICAgfSBlbHNlIGlmIChjb250cm9sQWN0aW9uTmFtZSA9PT0gJ0lEX0dST1VQJykgew0KICAgICAgICB0aGlzLmdyb3VwQ29udHJvbCgpDQogICAgICB9IGVsc2UgaWYgKGNvbnRyb2xBY3Rpb25OYW1lID09PSAnSURfVU5HUk9VUCcpIHsNCiAgICAgICAgdGhpcy51bkdyb3VwQ29udHJvbCgpDQogICAgICB9IGVsc2UgaWYgKGNvbnRyb2xBY3Rpb25OYW1lID09PSAnSURfTkVXUEFHRScpIHsNCiAgICAgICAgdGhpcy5hZGROZXdQYWdlKCkNCiAgICAgIH0gZWxzZSBpZiAoY29udHJvbEFjdGlvbk5hbWUgPT09ICdJRF9ERUxFVEVQQUdFJykgew0KICAgICAgICB0aGlzLmRlbGV0ZUN1cnJlbnRQYWdlKCkNCiAgICAgIH0gZWxzZSBpZiAoY29udHJvbEFjdGlvbk5hbWUgPT09ICdJRF9DT05UUk9MRk9SV0FSRCcpIHsNCiAgICAgICAgdGhpcy5icmluZ0ZvcndhcmQoKQ0KICAgICAgfSBlbHNlIGlmIChjb250cm9sQWN0aW9uTmFtZSA9PT0gJ0lEX0NPTlRST0xCQUNLV0FSRCcpIHsNCiAgICAgICAgdGhpcy5icmluZ0JhY2t3YXJkKCkNCiAgICAgIH0gZWxzZSBpZiAoY29udHJvbEFjdGlvbk5hbWUgPT09ICdJRF9PQkpFQ1RQUk9QJykgew0KICAgICAgICB0aGlzLmRpc3BsYXlQcm9wKCkNCiAgICAgIH0gZWxzZSBpZiAoY29udHJvbEFjdGlvbk5hbWUgPT09ICdJRF9SRU5BTUUnKSB7DQogICAgICAgIGNvbnN0IHNlbGVjdGVkUGFnZUlEID0gdGhpcy5zZWxlY3RlZENvbnRyb2xzW3RoaXMudXNlckZvcm1JZF0uc2VsZWN0ZWRbMF0NCiAgICAgICAgRXZlbnRCdXMuJGVtaXQoDQogICAgICAgICAgJ3JlbmFtZVBhZ2UnLA0KICAgICAgICAgIHRoaXMudXNlckZvcm1JZCwNCiAgICAgICAgICBzZWxlY3RlZFBhZ2VJRCwNCiAgICAgICAgICB0aGlzLnNlbGVjdGVkVGFiLA0KICAgICAgICAgIHRoaXMudXNlcmZvcm1EYXRhW3RoaXMudXNlckZvcm1JZF1bc2VsZWN0ZWRQYWdlSURdLnR5cGUNCiAgICAgICAgKQ0KICAgICAgfSBlbHNlIGlmIChjb250cm9sQWN0aW9uTmFtZSA9PT0gJ0lEX01PVkUnKSB7DQogICAgICAgIGNvbnN0IHR5cGUgPSB0aGlzLnVzZXJmb3JtRGF0YVt0aGlzLnVzZXJGb3JtSWRdW3RoaXMuY29udHJvbElkXS50eXBlDQogICAgICAgIGlmICh0eXBlID09PSAnTXVsdGlQYWdlJykgew0KICAgICAgICAgIEV2ZW50QnVzLiRlbWl0KCd1c2VyRm9ybVRhYk9yZGVyJywgdGhpcy51c2VyRm9ybUlkLCB0aGlzLmNvbnRyb2xJZCwgdHlwZSkNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICBFdmVudEJ1cy4kZW1pdCgndGFiU3RyaXBUYWJPcmRlcicsIHRoaXMudXNlckZvcm1JZCwgdGhpcy5jb250cm9sSWQsIHR5cGUpDQogICAgICAgIH0NCiAgICAgIH0gZWxzZSBpZiAoY29udHJvbEFjdGlvbk5hbWUgPT09ICdJRF9UQUJPUkRFUicpIHsNCiAgICAgICAgRXZlbnRCdXMuJGVtaXQoJ3VzZXJGb3JtVGFiT3JkZXInLCB0aGlzLnVzZXJGb3JtSWQsIHRoaXMuY29udGFpbmVySWQsICcnKQ0KICAgICAgfSBlbHNlIGlmICgNCiAgICAgICAgY29udHJvbEFjdGlvbk5hbWUgPT09ICdJRF9BTElHTicgfHwNCiAgICAgIGNvbnRyb2xBY3Rpb25OYW1lID09PSAnSURfTUFLRVNBTUVTSVpFJw0KICAgICAgKSB7DQogICAgICAgIHRoaXMuY29udHJvbEFsaWduTWVudChzdWJWYWwpDQogICAgICB9DQogICAgfSBlbHNlIHsNCiAgICAgIGlmIChjb250cm9sQWN0aW9uTmFtZSA9PT0gJ0lEX0NPUFknKSB7DQogICAgICAgIHRoaXMuY29weVRleHQoKQ0KICAgICAgfSBlbHNlIGlmIChjb250cm9sQWN0aW9uTmFtZSA9PT0gJ0lEX0RFTEVURScpIHsNCiAgICAgICAgdGhpcy5kZWxldGVUZXh0KCkNCiAgICAgIH0gZWxzZSBpZiAoY29udHJvbEFjdGlvbk5hbWUgPT09ICdJRF9QQVNURScpIHsNCiAgICAgICAgaWYgKGV2ZW50IGluc3RhbmNlb2YgTW91c2VFdmVudCkgew0KICAgICAgICAgIHRoaXMucGFzdGVUZXh0KGV2ZW50KQ0KICAgICAgICB9DQogICAgICB9IGVsc2UgaWYgKGNvbnRyb2xBY3Rpb25OYW1lID09PSAnSURfQ1VUJykgew0KICAgICAgICB0aGlzLmN1dFRleHQoKQ0KICAgICAgfSBlbHNlIGlmIChjb250cm9sQWN0aW9uTmFtZSA9PT0gJ0lEX09CSkVDVFBST1AnKSB7DQogICAgICAgIHRoaXMuZGlzcGxheVByb3AoKQ0KICAgICAgfQ0KICAgIH0NCiAgICB0aGlzLmNsb3NlTWVudSgpDQogIH0NCiAgY3V0VGV4dCAoKSB7DQogICAgZG9jdW1lbnQuZXhlY0NvbW1hbmQoJ2N1dCcpDQogIH0NCiAgZGVsZXRlVGV4dCAoKSB7DQogICAgZG9jdW1lbnQuZXhlY0NvbW1hbmQoJ2RlbGV0ZScpDQogIH0NCiAgY29weVRleHQgKCkgew0KICAgIGRvY3VtZW50LmV4ZWNDb21tYW5kKCdjb3B5JykNCiAgfQ0KICBwYXN0ZVRleHQgKGV2ZW50OiBNb3VzZUV2ZW50KSB7DQogICAgY29uc3QgY29udHJvbFR5cGUgPSB0aGlzLnVzZXJmb3JtRGF0YVt0aGlzLnVzZXJGb3JtSWRdW3RoaXMuY29udHJvbElkXS50eXBlDQogICAgY29uc3QgcG9zaXRpb24gPSB0aGlzLmdldEN1cnNvclBvcyhldmVudCkNCiAgICBjb25zdCBsZW5ndGggPSBwb3NpdGlvbi5lbmRQb3NpdGlvbiAtIHBvc2l0aW9uLnN0YXJ0UG9zaXRpb24NCiAgICBsZXQgYmFzZVZhbHVlID0gdGhpcy5lZGl0VGV4dFJlZi5pbm5lckhUTUwuc3BsaXQoJycpDQogICAgYmFzZVZhbHVlLnNwbGljZShwb3NpdGlvbi5zdGFydFBvc2l0aW9uLCBsZW5ndGgpDQogICAgY29uc3QgdXBkYXRlVmFsdWUgPSBiYXNlVmFsdWUuc2xpY2UoMCwgcG9zaXRpb24uc3RhcnRQb3NpdGlvbikuam9pbignJykgKyB0aGlzLmNvcGllZFRleHQgKyBiYXNlVmFsdWUuc2xpY2UocG9zaXRpb24uc3RhcnRQb3NpdGlvbikuam9pbignJykNCiAgICBFdmVudEJ1cy4kZW1pdCgndXBkYXRlVGV4dCcsIHVwZGF0ZVZhbHVlKQ0KICB9DQogIGdldEN1cnNvclBvcyAoZXZlbnQ6IE1vdXNlRXZlbnQpIHsNCiAgICBsZXQgc3RhcnRQb3NpdGlvbiA9IDANCiAgICBsZXQgZW5kUG9zaXRpb24gPSAwDQogICAgY29uc3QgaXNTdXBwb3J0ZWQgPSB0eXBlb2Ygd2luZG93LmdldFNlbGVjdGlvbiAhPT0gJ3VuZGVmaW5lZCcNCiAgICBpZiAoaXNTdXBwb3J0ZWQpIHsNCiAgICAgIGNvbnN0IHNlbGVjdGlvbiA9IHdpbmRvdy5nZXRTZWxlY3Rpb24oKSENCiAgICAgIGlmIChzZWxlY3Rpb24uYW5jaG9yT2Zmc2V0ID4gc2VsZWN0aW9uLmZvY3VzT2Zmc2V0KSB7DQogICAgICAgIHN0YXJ0UG9zaXRpb24gPSBzZWxlY3Rpb24uZm9jdXNPZmZzZXQNCiAgICAgICAgZW5kUG9zaXRpb24gPSBzZWxlY3Rpb24uYW5jaG9yT2Zmc2V0DQogICAgICB9IGVsc2UgaWYgKHNlbGVjdGlvbi5hbmNob3JPZmZzZXQgPT09IHNlbGVjdGlvbi5mb2N1c09mZnNldCkgew0KICAgICAgICBzdGFydFBvc2l0aW9uID0gc2VsZWN0aW9uLmZvY3VzT2Zmc2V0DQogICAgICAgIGVuZFBvc2l0aW9uID0gc2VsZWN0aW9uLmZvY3VzT2Zmc2V0DQogICAgICB9IGVsc2Ugew0KICAgICAgICBzdGFydFBvc2l0aW9uID0gc2VsZWN0aW9uLmFuY2hvck9mZnNldA0KICAgICAgICBlbmRQb3NpdGlvbiA9IHNlbGVjdGlvbi5mb2N1c09mZnNldA0KICAgICAgfQ0KICAgIH0NCiAgICByZXR1cm4geyBzdGFydFBvc2l0aW9uOiBzdGFydFBvc2l0aW9uLCBlbmRQb3NpdGlvbjogZW5kUG9zaXRpb24gfQ0KICB9DQogIGNyZWF0ZWQgKCkgew0KICAgIEV2ZW50QnVzLiRvbignZ3JvdXBDb250cm9sJywgKHZhbHVlOiBzdHJpbmcpID0+IHsNCiAgICAgIGlmICh0aGlzLnNlbGVjdGVkQ29udHJvbHNbdGhpcy51c2VyRm9ybUlkXS5jb250YWluZXJbMF0gPT09IHRoaXMuY29udGFpbmVySWQpIHsNCiAgICAgICAgaWYgKHZhbHVlID09PSAnZ3JvdXAnKSB7DQogICAgICAgICAgdGhpcy5ncm91cENvbnRyb2woKQ0KICAgICAgICB9IGVsc2UgaWYgKHZhbHVlID09PSAndW5ncm91cCcpIHsNCiAgICAgICAgICB0aGlzLnVuR3JvdXBDb250cm9sKCkNCiAgICAgICAgfQ0KICAgICAgfQ0KICAgIH0pDQogIH0NCiAgZGVzdHJveWVkICgpIHsNCiAgICBFdmVudEJ1cy4kb2ZmKCdncm91cENvbnRyb2wnKQ0KICB9DQogIEBFbWl0KCdjbG9zZU1lbnUnKQ0KICBjbG9zZU1lbnUgKCkgew0KICAgIHJldHVybiAwDQogIH0NCg0KICBkaXNwbGF5UHJvcCAoKSB7DQogICAgRXZlbnRCdXMuJGVtaXQoJ2Rpc3BQcm9wJywgZmFsc2UpDQogIH0NCiAgY3JlYXRlUGFnZU5hbWUgKHBhZ2VMaXN0OiBzdHJpbmdbXSkgew0KICAgIGxldCBsYXN0Q29udHJvbElkID0gMA0KICAgIGZvciAobGV0IGkgb2YgcGFnZUxpc3QpIHsNCiAgICAgIGlmIChpLmluZGV4T2YoJ1BhZ2UnKSAhPT0gLTEpIHsNCiAgICAgICAgY29uc3QgSWROdW0gPSBpLnNwbGl0KCdQYWdlJykucG9wKCkgfHwgJy0xJw0KICAgICAgICBjb25zdCBwYXNyZUlkID0gcGFyc2VJbnQoSWROdW0sIDEwKQ0KICAgICAgICBpZiAoIWlzTmFOKHBhc3JlSWQpICYmIGxhc3RDb250cm9sSWQgPCBwYXNyZUlkKSB7DQogICAgICAgICAgbGFzdENvbnRyb2xJZCA9IHBhc3JlSWQNCiAgICAgICAgfQ0KICAgICAgfQ0KICAgIH0NCiAgICByZXR1cm4gbGFzdENvbnRyb2xJZCArIDENCiAgfQ0KICBnZXRQYWdlQ291bnQgKGNvbnRhaW5lcjogc3RyaW5nKSB7DQogICAgY29uc3QgcGFnZUxpc3Q6IHN0cmluZ1tdID0gW10NCiAgICBmb3IgKGNvbnN0IHBhZ2VJZCBvZiB0aGlzLnVzZXJmb3JtRGF0YVt0aGlzLnVzZXJGb3JtSWRdW2NvbnRhaW5lcl0uY29udHJvbHMpIHsNCiAgICAgIHBhZ2VMaXN0LnB1c2godGhpcy51c2VyZm9ybURhdGFbdGhpcy51c2VyRm9ybUlkXVtwYWdlSWRdLnByb3BlcnRpZXMuTmFtZSEpDQogICAgfQ0KICAgIGNvbnN0IG5hbWUgPSB0aGlzLmNyZWF0ZVBhZ2VOYW1lKHBhZ2VMaXN0KQ0KICAgIHJldHVybiBuYW1lDQogIH0NCg0KICBhZGROZXdQYWdlICgpIHsNCiAgICBjb25zdCB0eXBlID0gdGhpcy51c2VyZm9ybURhdGFbdGhpcy51c2VyRm9ybUlkXVt0aGlzLmNvbnRyb2xJZF0udHlwZQ0KICAgIGlmICh0eXBlID09PSAnVGFiU3RyaXAnKSB7DQogICAgICBjb25zdCB0YWJDb250cm9sRGF0YSA9IEpTT04ucGFyc2UoDQogICAgICAgIEpTT04uc3RyaW5naWZ5KHRoaXMudXNlcmZvcm1EYXRhW3RoaXMudXNlckZvcm1JZF1bdGhpcy5jb250cm9sSWRdKQ0KICAgICAgKS5leHRyYURhdGFzLlRhYnMNCiAgICAgIGxldCBwcmV2VGFiSWQgPSAtMQ0KICAgICAgY29uc3QgaW5pdGlhbFRhYkRhdGE6IHRhYnNJdGVtcyA9IHsNCiAgICAgICAgTmFtZTogJycsDQogICAgICAgIENhcHRpb246ICcnLA0KICAgICAgICBUb29sVGlwOiAnJywNCiAgICAgICAgQWNjZWxlcmF0b3I6ICcnDQogICAgICB9DQogICAgICBpZiAodGFiQ29udHJvbERhdGEubGVuZ3RoID4gMCkgew0KICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRhYkNvbnRyb2xEYXRhLmxlbmd0aDsgaSsrKSB7DQogICAgICAgICAgY29uc3QgaWQgPSB0YWJDb250cm9sRGF0YVtpXS5OYW1lLnNwbGl0KCdUYWInKS5wb3AoKSB8fCAnLTEnDQogICAgICAgICAgY29uc3QgcGFyc2VJZCA9IHBhcnNlSW50KGlkLCAxMCkNCiAgICAgICAgICBpZiAoIWlzTmFOKHBhcnNlSWQpICYmIHByZXZUYWJJZCA8IHBhcnNlSWQpIHsNCiAgICAgICAgICAgIHByZXZUYWJJZCA9IHBhcnNlSWQNCiAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgcHJldlRhYklkICs9IDENCiAgICAgICAgaW5pdGlhbFRhYkRhdGEuTmFtZSA9IGBUYWIke3ByZXZUYWJJZH1gDQogICAgICAgIGluaXRpYWxUYWJEYXRhLkNhcHRpb24gPSBgVGFiJHtwcmV2VGFiSWR9YA0KICAgICAgfSBlbHNlIHsNCiAgICAgICAgaW5pdGlhbFRhYkRhdGEuTmFtZSA9IGBUYWIkezF9YA0KICAgICAgICBpbml0aWFsVGFiRGF0YS5DYXB0aW9uID0gYFRhYiR7MX1gDQogICAgICB9DQogICAgICB0YWJDb250cm9sRGF0YS5wdXNoKGluaXRpYWxUYWJEYXRhKQ0KICAgICAgdGhpcy51cGRhdGVDb250cm9sRXh0cmFEYXRhKHsNCiAgICAgICAgdXNlckZvcm1JZDogdGhpcy51c2VyRm9ybUlkLA0KICAgICAgICBjb250cm9sSWQ6IHRoaXMuY29udHJvbElkLA0KICAgICAgICBwcm9wZXJ0eU5hbWU6ICdUYWJzJywNCiAgICAgICAgdmFsdWU6IHRhYkNvbnRyb2xEYXRhDQogICAgICB9KQ0KICAgICAgdGhpcy51cGRhdGVDb250cm9sKHsNCiAgICAgICAgdXNlckZvcm1JZDogdGhpcy51c2VyRm9ybUlkLA0KICAgICAgICBjb250cm9sSWQ6IHRoaXMuY29udHJvbElkLA0KICAgICAgICBwcm9wZXJ0eU5hbWU6ICdWYWx1ZScsDQogICAgICAgIHZhbHVlOiBwcmV2VGFiSWQgLSAxDQogICAgICB9KQ0KICAgIH0gZWxzZSBpZiAodHlwZSA9PT0gJ011bHRpUGFnZScpIHsNCiAgICAgIGNvbnN0IHBhcmVudElkID0gdGhpcy5jb250cm9sSWQuc3BsaXQoJ011bHRpUGFnZScpLnBvcCgpDQogICAgICBjb25zdCBjb250cm9sTmFtZSA9IGBQYWdlJHtwYXJlbnRJZH1fYA0KDQogICAgICBsZXQgbGFzdENvbnRyb2xJZCA9IDANCiAgICAgIGNvbnN0IHVzZXJmb3JtQ29udHJvbElkcyA9IE9iamVjdC5rZXlzKHRoaXMudXNlcmZvcm1EYXRhW3RoaXMudXNlckZvcm1JZF0pDQogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHVzZXJmb3JtQ29udHJvbElkcy5sZW5ndGg7IGkrKykgew0KICAgICAgICBpZiAodXNlcmZvcm1Db250cm9sSWRzW2ldLmluZGV4T2YoY29udHJvbE5hbWUpICE9PSAtMSkgew0KICAgICAgICAgIGNvbnN0IElkTnVtID0NCiAgICAgICAgICB1c2VyZm9ybUNvbnRyb2xJZHNbaV0uc3BsaXQoY29udHJvbE5hbWUpLnBvcCgpIHx8ICctMScNCiAgICAgICAgICBjb25zdCBwYXNyZUlkID0gcGFyc2VJbnQoSWROdW0sIDEwKQ0KICAgICAgICAgIGlmICghaXNOYU4ocGFzcmVJZCkgJiYgbGFzdENvbnRyb2xJZCA8IHBhc3JlSWQpIHsNCiAgICAgICAgICAgIGxhc3RDb250cm9sSWQgPSBwYXNyZUlkDQogICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICB9DQogICAgICBjb25zdCBjb250cm9sUHJvcERhdGEgPSBuZXcgQ29udHJvbFByb3BlcnR5RGF0YSgpDQogICAgICBsZXQgY29udHJvbE9iaiA9IGNvbnRyb2xQcm9wRGF0YS5kYXRhWydQYWdlJ10NCiAgICAgIGNvbnN0IGl0ZW0gPSBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KGNvbnRyb2xPYmohKSkNCiAgICAgIGxhc3RDb250cm9sSWQgKz0gMQ0KICAgICAgaXRlbS5wcm9wZXJ0aWVzLklEID0gYElEXyR7Y29udHJvbE5hbWV9JHtsYXN0Q29udHJvbElkfWANCiAgICAgIGNvbnN0IGNvdW50ID0gdGhpcy5nZXRQYWdlQ291bnQodGhpcy5jb250cm9sSWQpDQogICAgICBpdGVtLnByb3BlcnRpZXMuQ2FwdGlvbiA9IGBQYWdlJHtjb3VudH1gDQogICAgICBpdGVtLnByb3BlcnRpZXMuTmFtZSA9IGBQYWdlJHtjb3VudH1gDQogICAgICBpdGVtLnByb3BlcnRpZXMuSW5kZXggPSB0aGlzLnVzZXJmb3JtRGF0YVt0aGlzLnVzZXJGb3JtSWRdW3RoaXMuY29udHJvbElkXS5jb250cm9scy5sZW5ndGgNCiAgICAgIHRoaXMuYWRkQ29udHJvbCh7DQogICAgICAgIHVzZXJGb3JtSWQ6IHRoaXMudXNlckZvcm1JZCwNCiAgICAgICAgY29udHJvbElkOiB0aGlzLmNvbnRyb2xJZCwNCiAgICAgICAgYWRkSWQ6IGl0ZW0ucHJvcGVydGllcy5JRCwNCiAgICAgICAgaXRlbTogaXRlbQ0KICAgICAgfSkNCiAgICAgIHRoaXMudXBkYXRlQ29udHJvbCh7DQogICAgICAgIHVzZXJGb3JtSWQ6IHRoaXMudXNlckZvcm1JZCwNCiAgICAgICAgY29udHJvbElkOiB0aGlzLmNvbnRyb2xJZCwNCiAgICAgICAgcHJvcGVydHlOYW1lOiAnVmFsdWUnLA0KICAgICAgICB2YWx1ZTogaXRlbS5wcm9wZXJ0aWVzLkluZGV4DQogICAgICB9KQ0KICAgICAgdGhpcy5zZWxlY3RDb250cm9sKHsNCiAgICAgICAgdXNlckZvcm1JZDogdGhpcy51c2VyRm9ybUlkLA0KICAgICAgICBzZWxlY3Q6IHsNCiAgICAgICAgICBjb250YWluZXI6IHRoaXMuZ2V0Q29udGFpbmVyTGlzdChpdGVtLnByb3BlcnRpZXMuSUQpLA0KICAgICAgICAgIHNlbGVjdGVkOiBbaXRlbS5wcm9wZXJ0aWVzLklEXQ0KICAgICAgICB9DQogICAgICB9KQ0KICAgICAgRXZlbnRCdXMuJGVtaXQoJ3VwZGF0ZU11bHRpUGFnZVZhbHVlJykNCiAgICB9DQogIH0NCiAgYnJpbmdGb3J3YXJkICgpIHsNCiAgICBjb25zdCB1c2VyRGF0YSA9IHRoaXMudXNlcmZvcm1EYXRhW3RoaXMudXNlckZvcm1JZF0NCiAgICBjb25zdCBoaWdoUHJvckNvbnRyb2wgPSBbXQ0KICAgIGNvbnN0IGxvd1Byb3JDb250cm9sID0gW10NCiAgICBjb25zdCBjb250YWluZXIgPSB0aGlzLmdldENvbnRhaW5lckxpc3QodGhpcy5nZXRTZWxlY3RlZENvbnRyb2xzRGF0YXMhWzBdKVswXQ0KICAgIGNvbnN0IGNvbnRhaW5lckNvbnRyb2xzID0gdGhpcy51c2VyZm9ybURhdGFbdGhpcy51c2VyRm9ybUlkXVtjb250YWluZXJdLmNvbnRyb2xzDQogICAgZm9yIChjb25zdCBpbmRleCBpbiBjb250YWluZXJDb250cm9scykgew0KICAgICAgY29uc3QgY250cmxEYXRhID0gdGhpcy51c2VyZm9ybURhdGFbdGhpcy51c2VyRm9ybUlkXVtjb250YWluZXJDb250cm9sc1tpbmRleF1dDQogICAgICBpZiAoY250cmxEYXRhLnR5cGUgPT09ICdNdWx0aVBhZ2UnIHx8IGNudHJsRGF0YS50eXBlID09PSAnRnJhbWUnIHx8IGNudHJsRGF0YS50eXBlID09PSAnTGlzdEJveCcpIHsNCiAgICAgICAgaGlnaFByb3JDb250cm9sLnB1c2goY29udGFpbmVyQ29udHJvbHNbaW5kZXhdKQ0KICAgICAgfSBlbHNlIHsNCiAgICAgICAgbG93UHJvckNvbnRyb2wucHVzaChjb250YWluZXJDb250cm9sc1tpbmRleF0pDQogICAgICB9DQogICAgfQ0KICAgIGxldCBuZXh0U2VsY3RlZFNlcmllczogc3RyaW5nW10gPSBbXQ0KICAgIGxldCBuZXh0SGlnaENvbnRyb2xTZXJpZXM6IHN0cmluZ1tdID0gW10NCiAgICBjb25zdCBnZXRTZWxDb250cm9sID0gWy4uLnRoaXMuZ2V0U2VsZWN0ZWRDb250cm9sc0RhdGFzIV0NCiAgICBnZXRTZWxDb250cm9sLnNvcnQoKGEsIGIpID0+IHsNCiAgICAgIHJldHVybiB1c2VyRGF0YVthXS5leHRyYURhdGFzIS56SW5kZXghIC0gdXNlckRhdGFbYl0uZXh0cmFEYXRhcyEuekluZGV4IQ0KICAgIH0pDQogICAgZm9yIChjb25zdCBzZWxDb250cm9sIG9mIGdldFNlbENvbnRyb2whKSB7DQogICAgICBjb25zdCB0eXBlID0gdXNlckRhdGFbc2VsQ29udHJvbF0udHlwZQ0KICAgICAgY29uc3QgdGVtcFpJbmRleCA9IHVzZXJEYXRhW3NlbENvbnRyb2xdLmV4dHJhRGF0YXMhLnpJbmRleCENCiAgICAgIGNvbnN0IGNvbnRyb2xJbmRleCA9IE9iamVjdC5rZXlzKHVzZXJEYXRhKS5maW5kSW5kZXgoKHZhbDogc3RyaW5nLCBpbmRleDogbnVtYmVyKSA9PiB7DQogICAgICAgIHJldHVybiAnekluZGV4JyBpbiB1c2VyRGF0YVt2YWxdLmV4dHJhRGF0YXMhICYmICh1c2VyRGF0YVt2YWxdLmV4dHJhRGF0YXMhLnpJbmRleCA9PT0gdGVtcFpJbmRleCArIDEpDQogICAgICB9KQ0KICAgICAgY29uc3QgbmV4dFNlbGVjdGVkQ29udHJvbCA9IGNvbnRyb2xJbmRleCAhPT0gLTEgPyBPYmplY3Qua2V5cyh1c2VyRGF0YSlbY29udHJvbEluZGV4XSA6ICcnDQogICAgICBjb25zdCBuZXh0Q29udHJvbFR5cGUgPSB1c2VyRGF0YVtuZXh0U2VsZWN0ZWRDb250cm9sXS50eXBlDQogICAgICBpZiAobmV4dFNlbGVjdGVkQ29udHJvbCAhPT0gJycgJiYgIWhpZ2hQcm9yQ29udHJvbC5pbmNsdWRlcyhuZXh0U2VsZWN0ZWRDb250cm9sKSkgew0KICAgICAgICBpZiAoZ2V0U2VsQ29udHJvbCEuaW5jbHVkZXMobmV4dFNlbGVjdGVkQ29udHJvbCkpIHsNCiAgICAgICAgICBpZiAoIW5leHRTZWxjdGVkU2VyaWVzLmluY2x1ZGVzKHNlbENvbnRyb2wpKSB7DQogICAgICAgICAgICBuZXh0U2VsY3RlZFNlcmllcy5wdXNoKHNlbENvbnRyb2wpDQogICAgICAgICAgfQ0KICAgICAgICAgIGlmICghbmV4dFNlbGN0ZWRTZXJpZXMuaW5jbHVkZXMobmV4dFNlbGVjdGVkQ29udHJvbCkpIHsNCiAgICAgICAgICAgIG5leHRTZWxjdGVkU2VyaWVzLnB1c2gobmV4dFNlbGVjdGVkQ29udHJvbCkNCiAgICAgICAgICB9DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgaWYgKE9iamVjdC5rZXlzKG5leHRTZWxjdGVkU2VyaWVzKS5sZW5ndGggIT09IDApIHsNCiAgICAgICAgICAgIGNvbnN0IHRlbXBFeGNoYWdlSW5kZXggPSB1c2VyRGF0YVtuZXh0U2VsY3RlZFNlcmllc1swXV0uZXh0cmFEYXRhcyEuekluZGV4IQ0KICAgICAgICAgICAgY29uc3Qgc3dhcFRhYkluZGV4ID0gdXNlckRhdGFbbmV4dFNlbGVjdGVkQ29udHJvbF0uZXh0cmFEYXRhcyEuekluZGV4IQ0KICAgICAgICAgICAgaWYgKHN3YXBUYWJJbmRleCA8PSB1c2VyRGF0YVtjb250YWluZXJdLmNvbnRyb2xzLmxlbmd0aCAvKiAmJiBzd2FwVGFiSW5kZXggPiAwICovKSB7DQogICAgICAgICAgICAgIGNvbnN0IGluZGV4ID0gdXNlckRhdGFbY29udGFpbmVyXS5jb250cm9scy5maW5kSW5kZXgoDQogICAgICAgICAgICAgICAgKHZhbCkgPT4gdXNlckRhdGFbdmFsXS5leHRyYURhdGFzIS56SW5kZXggPT09IHN3YXBUYWJJbmRleA0KICAgICAgICAgICAgICApDQogICAgICAgICAgICAgIHRoaXMudXBkYXRlRXh0cmFEYXRhcyh1c2VyRGF0YVtjb250YWluZXJdLmNvbnRyb2xzW2luZGV4XSwgJ3pJbmRleCcsIHRlbXBFeGNoYWdlSW5kZXgpDQogICAgICAgICAgICAgIHRoaXMudXBkYXRlRXh0cmFEYXRhcyhuZXh0U2VsY3RlZFNlcmllc1swXSwgJ3pJbmRleCcsIHN3YXBUYWJJbmRleCAtIChuZXh0U2VsY3RlZFNlcmllcyEubGVuZ3RoIC0gMSkpDQogICAgICAgICAgICB9DQogICAgICAgICAgICBmb3IgKGxldCBqID0gMTsgaiA8IG5leHRTZWxjdGVkU2VyaWVzLmxlbmd0aDsgaisrKSB7DQogICAgICAgICAgICAgIGNvbnN0IHVwZGF0ZUluZGV4ID0gdXNlckRhdGFbbmV4dFNlbGN0ZWRTZXJpZXNbal1dLmV4dHJhRGF0YXMhLnpJbmRleCEgKyAxDQogICAgICAgICAgICAgIHRoaXMudXBkYXRlRXh0cmFEYXRhcyhuZXh0U2VsY3RlZFNlcmllc1tqXSwgJ3pJbmRleCcsIHVwZGF0ZUluZGV4KQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgbmV4dFNlbGN0ZWRTZXJpZXMgPSBbXQ0KICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICBjb25zdCBzd2FwVGFiSW5kZXggPSB1c2VyRGF0YVtuZXh0U2VsZWN0ZWRDb250cm9sXS5leHRyYURhdGFzIS56SW5kZXghDQogICAgICAgICAgICBpZiAoc3dhcFRhYkluZGV4IDw9IHVzZXJEYXRhW2NvbnRhaW5lcl0uY29udHJvbHMubGVuZ3RoIC8qICYmIHN3YXBUYWJJbmRleCA+IDAgKi8pIHsNCiAgICAgICAgICAgICAgY29uc3QgaW5kZXggPSB1c2VyRGF0YVtjb250YWluZXJdLmNvbnRyb2xzLmZpbmRJbmRleCgNCiAgICAgICAgICAgICAgICAodmFsKSA9PiB1c2VyRGF0YVt2YWxdLmV4dHJhRGF0YXMhLnpJbmRleCA9PT0gc3dhcFRhYkluZGV4DQogICAgICAgICAgICAgICkNCiAgICAgICAgICAgICAgdGhpcy51cGRhdGVFeHRyYURhdGFzKHNlbENvbnRyb2wsICd6SW5kZXgnLCBzd2FwVGFiSW5kZXgpDQogICAgICAgICAgICAgIHRoaXMudXBkYXRlRXh0cmFEYXRhcyhuZXh0U2VsZWN0ZWRDb250cm9sLCAnekluZGV4JywgdGVtcFpJbmRleCkNCiAgICAgICAgICAgIH0NCiAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgIH0gZWxzZSB7DQogICAgICAgIGlmIChnZXRTZWxDb250cm9sIS5pbmNsdWRlcyhuZXh0U2VsZWN0ZWRDb250cm9sKSAmJiAodHlwZSA9PT0gJ0ZyYW1lJyB8fCB0eXBlID09PSAnTXVsdGlQYWdlJyB8fCB0eXBlID09PSAnTGlzdEJveCcpKSB7DQogICAgICAgICAgaWYgKCFuZXh0SGlnaENvbnRyb2xTZXJpZXMuaW5jbHVkZXMoc2VsQ29udHJvbCkpIHsNCiAgICAgICAgICAgIG5leHRIaWdoQ29udHJvbFNlcmllcy5wdXNoKHNlbENvbnRyb2wpDQogICAgICAgICAgfQ0KICAgICAgICAgIGlmICghbmV4dEhpZ2hDb250cm9sU2VyaWVzLmluY2x1ZGVzKG5leHRTZWxlY3RlZENvbnRyb2wpKSB7DQogICAgICAgICAgICBuZXh0SGlnaENvbnRyb2xTZXJpZXMucHVzaChuZXh0U2VsZWN0ZWRDb250cm9sKQ0KICAgICAgICAgIH0NCiAgICAgICAgfSBlbHNlIGlmICh0eXBlID09PSAnRnJhbWUnIHx8IHR5cGUgPT09ICdNdWx0aVBhZ2UnIHx8IHR5cGUgPT09ICdMaXN0Qm94Jykgew0KICAgICAgICAgIGlmIChPYmplY3Qua2V5cyhuZXh0SGlnaENvbnRyb2xTZXJpZXMpLmxlbmd0aCAhPT0gMCkgew0KICAgICAgICAgICAgY29uc3QgdGVtcEV4Y2hhZ2VJbmRleCA9IHVzZXJEYXRhW25leHRIaWdoQ29udHJvbFNlcmllc1swXV0uZXh0cmFEYXRhcyEuekluZGV4IQ0KICAgICAgICAgICAgY29uc3Qgc3dhcFRhYkluZGV4ID0gdXNlckRhdGFbbmV4dFNlbGVjdGVkQ29udHJvbF0uZXh0cmFEYXRhcyEuekluZGV4IQ0KICAgICAgICAgICAgaWYgKHN3YXBUYWJJbmRleCA8PSB1c2VyRGF0YVtjb250YWluZXJdLmNvbnRyb2xzLmxlbmd0aCkgew0KICAgICAgICAgICAgICBjb25zdCBpbmRleCA9IHVzZXJEYXRhW2NvbnRhaW5lcl0uY29udHJvbHMuZmluZEluZGV4KA0KICAgICAgICAgICAgICAgICh2YWwpID0+IHVzZXJEYXRhW3ZhbF0uZXh0cmFEYXRhcyEuekluZGV4ID09PSBzd2FwVGFiSW5kZXgNCiAgICAgICAgICAgICAgKQ0KICAgICAgICAgICAgICB0aGlzLnVwZGF0ZUV4dHJhRGF0YXModXNlckRhdGFbY29udGFpbmVyXS5jb250cm9sc1tpbmRleF0sICd6SW5kZXgnLCB0ZW1wRXhjaGFnZUluZGV4KQ0KICAgICAgICAgICAgICB0aGlzLnVwZGF0ZUV4dHJhRGF0YXMobmV4dEhpZ2hDb250cm9sU2VyaWVzWzBdLCAnekluZGV4Jywgc3dhcFRhYkluZGV4IC0gKG5leHRIaWdoQ29udHJvbFNlcmllcyEubGVuZ3RoIC0gMSkpDQogICAgICAgICAgICB9DQogICAgICAgICAgICBmb3IgKGxldCBqID0gMTsgaiA8IG5leHRIaWdoQ29udHJvbFNlcmllcy5sZW5ndGg7IGorKykgew0KICAgICAgICAgICAgICBjb25zdCB1cGRhdGVJbmRleCA9IHVzZXJEYXRhW25leHRIaWdoQ29udHJvbFNlcmllc1tqXV0uZXh0cmFEYXRhcyEuekluZGV4ISArIDENCiAgICAgICAgICAgICAgdGhpcy51cGRhdGVFeHRyYURhdGFzKG5leHRIaWdoQ29udHJvbFNlcmllc1tqXSwgJ3pJbmRleCcsIHVwZGF0ZUluZGV4KQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgbmV4dEhpZ2hDb250cm9sU2VyaWVzID0gW10NCiAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgY29uc3Qgc3dhcFRhYkluZGV4ID0gdXNlckRhdGFbbmV4dFNlbGVjdGVkQ29udHJvbF0uZXh0cmFEYXRhcyEuekluZGV4IQ0KICAgICAgICAgICAgaWYgKHN3YXBUYWJJbmRleCA8PSB1c2VyRGF0YVtjb250YWluZXJdLmNvbnRyb2xzLmxlbmd0aCAvKiAmJiBzd2FwVGFiSW5kZXggPiAwICovKSB7DQogICAgICAgICAgICAgIGNvbnN0IGluZGV4ID0gdXNlckRhdGFbY29udGFpbmVyXS5jb250cm9scy5maW5kSW5kZXgoDQogICAgICAgICAgICAgICAgKHZhbCkgPT4gdXNlckRhdGFbdmFsXS5leHRyYURhdGFzIS56SW5kZXggPT09IHN3YXBUYWJJbmRleA0KICAgICAgICAgICAgICApDQogICAgICAgICAgICAgIHRoaXMudXBkYXRlRXh0cmFEYXRhcyhzZWxDb250cm9sLCAnekluZGV4Jywgc3dhcFRhYkluZGV4KQ0KICAgICAgICAgICAgICB0aGlzLnVwZGF0ZUV4dHJhRGF0YXMobmV4dFNlbGVjdGVkQ29udHJvbCwgJ3pJbmRleCcsIHRlbXBaSW5kZXgpDQogICAgICAgICAgICB9DQogICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICB9DQogICAgfQ0KICB9DQogIGJyaW5nQmFja3dhcmQgKCkgew0KICAgIGNvbnN0IHVzZXJEYXRhID0gdGhpcy51c2VyZm9ybURhdGFbdGhpcy51c2VyRm9ybUlkXQ0KICAgIGNvbnN0IGhpZ2hQcm9yQ29udHJvbCA9IFtdDQogICAgY29uc3QgbG93UHJvckNvbnRyb2wgPSBbXQ0KICAgIGNvbnN0IGNvbnRhaW5lciA9IHRoaXMuZ2V0Q29udGFpbmVyTGlzdCh0aGlzLmdldFNlbGVjdGVkQ29udHJvbHNEYXRhcyFbMF0pWzBdDQogICAgY29uc3QgY29udGFpbmVyQ29udHJvbHMgPSB0aGlzLnVzZXJmb3JtRGF0YVt0aGlzLnVzZXJGb3JtSWRdW2NvbnRhaW5lcl0uY29udHJvbHMNCiAgICBmb3IgKGNvbnN0IGluZGV4IGluIGNvbnRhaW5lckNvbnRyb2xzKSB7DQogICAgICBjb25zdCBjbnRybERhdGEgPSB0aGlzLnVzZXJmb3JtRGF0YVt0aGlzLnVzZXJGb3JtSWRdW2NvbnRhaW5lckNvbnRyb2xzW2luZGV4XV0NCiAgICAgIGlmIChjbnRybERhdGEudHlwZSA9PT0gJ011bHRpUGFnZScgfHwgY250cmxEYXRhLnR5cGUgPT09ICdGcmFtZScgfHwgY250cmxEYXRhLnR5cGUgPT09ICdMaXN0Qm94Jykgew0KICAgICAgICBoaWdoUHJvckNvbnRyb2wucHVzaChjb250YWluZXJDb250cm9sc1tpbmRleF0pDQogICAgICB9IGVsc2Ugew0KICAgICAgICBsb3dQcm9yQ29udHJvbC5wdXNoKGNvbnRhaW5lckNvbnRyb2xzW2luZGV4XSkNCiAgICAgIH0NCiAgICB9DQogICAgbGV0IG5leHRTZWxjdGVkU2VyaWVzOiBzdHJpbmdbXSA9IFtdDQogICAgbGV0IG5leHRIaWdoQ29udHJvbFNlcmllczogc3RyaW5nW10gPSBbXQ0KICAgIGNvbnN0IGdldFNlbENvbnRyb2wgPSBbLi4udGhpcy5nZXRTZWxlY3RlZENvbnRyb2xzRGF0YXMhXQ0KICAgIGdldFNlbENvbnRyb2wuc29ydCgoYSwgYikgPT4gew0KICAgICAgcmV0dXJuIHVzZXJEYXRhW2FdLmV4dHJhRGF0YXMhLnpJbmRleCEgLSB1c2VyRGF0YVtiXS5leHRyYURhdGFzIS56SW5kZXghDQogICAgfSkNCiAgICBmb3IgKGNvbnN0IHNlbENvbnRyb2wgb2YgZ2V0U2VsQ29udHJvbCkgew0KICAgICAgY29uc3QgdHlwZSA9IHVzZXJEYXRhW3NlbENvbnRyb2xdLnR5cGUNCiAgICAgIGNvbnN0IHRlbXBaSW5kZXggPSB1c2VyRGF0YVtzZWxDb250cm9sXS5leHRyYURhdGFzIS56SW5kZXghDQogICAgICBjb25zdCBjb250cm9sSW5kZXggPSBPYmplY3Qua2V5cyh1c2VyRGF0YSkuZmluZEluZGV4KCh2YWw6IHN0cmluZywgaW5kZXg6IG51bWJlcikgPT4gew0KICAgICAgICByZXR1cm4gJ3pJbmRleCcgaW4gdXNlckRhdGFbdmFsXS5leHRyYURhdGFzISAmJiAodXNlckRhdGFbdmFsXS5leHRyYURhdGFzIS56SW5kZXggPT09IHRlbXBaSW5kZXggLSAxKQ0KICAgICAgfSkNCiAgICAgIGNvbnN0IG5leHRTZWxlY3RlZENvbnRyb2wgPSBjb250cm9sSW5kZXggIT09IC0xID8gT2JqZWN0LmtleXModXNlckRhdGEpW2NvbnRyb2xJbmRleF0gOiAnJw0KICAgICAgY29uc3QgbmV4dENvbnRyb2xUeXBlID0gdXNlckRhdGFbbmV4dFNlbGVjdGVkQ29udHJvbF0udHlwZQ0KICAgICAgaWYgKG5leHRTZWxlY3RlZENvbnRyb2wgIT09ICcnICYmICFoaWdoUHJvckNvbnRyb2wuaW5jbHVkZXMoc2VsQ29udHJvbCkpIHsNCiAgICAgICAgaWYgKGdldFNlbENvbnRyb2whLmluY2x1ZGVzKG5leHRTZWxlY3RlZENvbnRyb2wpKSB7DQogICAgICAgICAgaWYgKCFuZXh0U2VsY3RlZFNlcmllcy5pbmNsdWRlcyhzZWxDb250cm9sKSkgew0KICAgICAgICAgICAgbmV4dFNlbGN0ZWRTZXJpZXMucHVzaChzZWxDb250cm9sKQ0KICAgICAgICAgIH0NCiAgICAgICAgICBpZiAoIW5leHRTZWxjdGVkU2VyaWVzLmluY2x1ZGVzKG5leHRTZWxlY3RlZENvbnRyb2wpKSB7DQogICAgICAgICAgICBuZXh0U2VsY3RlZFNlcmllcy5wdXNoKG5leHRTZWxlY3RlZENvbnRyb2wpDQogICAgICAgICAgfQ0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgIGlmIChPYmplY3Qua2V5cyhuZXh0U2VsY3RlZFNlcmllcykubGVuZ3RoICE9PSAwKSB7DQogICAgICAgICAgICBjb25zdCB0ZW1wRXhjaGFnZUluZGV4ID0gdXNlckRhdGFbbmV4dFNlbGN0ZWRTZXJpZXNbMF1dLmV4dHJhRGF0YXMhLnpJbmRleCENCiAgICAgICAgICAgIGNvbnN0IHN3YXBUYWJJbmRleCA9IHVzZXJEYXRhW25leHRTZWxlY3RlZENvbnRyb2xdLmV4dHJhRGF0YXMhLnpJbmRleCENCiAgICAgICAgICAgIGlmIChzd2FwVGFiSW5kZXggPD0gdXNlckRhdGFbY29udGFpbmVyXS5jb250cm9scy5sZW5ndGggJiYgc3dhcFRhYkluZGV4ID4gMCkgew0KICAgICAgICAgICAgICBjb25zdCBpbmRleCA9IHVzZXJEYXRhW2NvbnRhaW5lcl0uY29udHJvbHMuZmluZEluZGV4KA0KICAgICAgICAgICAgICAgICh2YWwpID0+IHVzZXJEYXRhW3ZhbF0uZXh0cmFEYXRhcyEuekluZGV4ID09PSBzd2FwVGFiSW5kZXgNCiAgICAgICAgICAgICAgKQ0KICAgICAgICAgICAgICB0aGlzLnVwZGF0ZUV4dHJhRGF0YXModXNlckRhdGFbY29udGFpbmVyXS5jb250cm9sc1tpbmRleF0sICd6SW5kZXgnLCB0ZW1wRXhjaGFnZUluZGV4KQ0KICAgICAgICAgICAgICB0aGlzLnVwZGF0ZUV4dHJhRGF0YXMobmV4dFNlbGN0ZWRTZXJpZXNbMF0sICd6SW5kZXgnLCAobmV4dFNlbGN0ZWRTZXJpZXMhLmxlbmd0aCArIDEpIC0gc3dhcFRhYkluZGV4KQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZm9yIChsZXQgaiA9IDE7IGogPCBuZXh0U2VsY3RlZFNlcmllcy5sZW5ndGg7IGorKykgew0KICAgICAgICAgICAgICBjb25zdCB1cGRhdGVJbmRleCA9IHVzZXJEYXRhW25leHRTZWxjdGVkU2VyaWVzW2pdXS5leHRyYURhdGFzIS56SW5kZXghIC0gMQ0KICAgICAgICAgICAgICB0aGlzLnVwZGF0ZUV4dHJhRGF0YXMobmV4dFNlbGN0ZWRTZXJpZXNbal0sICd6SW5kZXgnLCB1cGRhdGVJbmRleCkNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIG5leHRTZWxjdGVkU2VyaWVzID0gW10NCiAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgY29uc3Qgc3dhcFRhYkluZGV4ID0gdXNlckRhdGFbbmV4dFNlbGVjdGVkQ29udHJvbF0uZXh0cmFEYXRhcyEuekluZGV4IQ0KICAgICAgICAgICAgaWYgKHN3YXBUYWJJbmRleCA8PSB1c2VyRGF0YVtjb250YWluZXJdLmNvbnRyb2xzLmxlbmd0aCAmJiBzd2FwVGFiSW5kZXggPiAwKSB7DQogICAgICAgICAgICAgIGNvbnN0IGluZGV4ID0gdXNlckRhdGFbY29udGFpbmVyXS5jb250cm9scy5maW5kSW5kZXgoDQogICAgICAgICAgICAgICAgKHZhbCkgPT4gdXNlckRhdGFbdmFsXS5leHRyYURhdGFzIS56SW5kZXggPT09IHN3YXBUYWJJbmRleA0KICAgICAgICAgICAgICApDQogICAgICAgICAgICAgIHRoaXMudXBkYXRlRXh0cmFEYXRhcyhzZWxDb250cm9sLCAnekluZGV4Jywgc3dhcFRhYkluZGV4KQ0KICAgICAgICAgICAgICB0aGlzLnVwZGF0ZUV4dHJhRGF0YXMobmV4dFNlbGVjdGVkQ29udHJvbCwgJ3pJbmRleCcsIHRlbXBaSW5kZXgpDQogICAgICAgICAgICB9DQogICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICB9IGVsc2UgaWYgKCFsb3dQcm9yQ29udHJvbC5pbmNsdWRlcyhuZXh0U2VsZWN0ZWRDb250cm9sKSAmJiAodHlwZSA9PT0gJ0ZyYW1lJyB8fCB0eXBlID09PSAnTXVsdGlQYWdlJyB8fCB0eXBlID09PSAnTGlzdEJveCcpKSB7DQogICAgICAgIGlmIChnZXRTZWxDb250cm9sIS5pbmNsdWRlcyhuZXh0U2VsZWN0ZWRDb250cm9sKSkgew0KICAgICAgICAgIGlmICghbmV4dEhpZ2hDb250cm9sU2VyaWVzLmluY2x1ZGVzKHNlbENvbnRyb2wpKSB7DQogICAgICAgICAgICBuZXh0SGlnaENvbnRyb2xTZXJpZXMucHVzaChzZWxDb250cm9sKQ0KICAgICAgICAgIH0NCiAgICAgICAgICBpZiAoIW5leHRIaWdoQ29udHJvbFNlcmllcy5pbmNsdWRlcyhuZXh0U2VsZWN0ZWRDb250cm9sKSkgew0KICAgICAgICAgICAgbmV4dEhpZ2hDb250cm9sU2VyaWVzLnB1c2gobmV4dFNlbGVjdGVkQ29udHJvbCkNCiAgICAgICAgICB9DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgaWYgKE9iamVjdC5rZXlzKG5leHRIaWdoQ29udHJvbFNlcmllcykubGVuZ3RoICE9PSAwKSB7DQogICAgICAgICAgICBjb25zdCB0ZW1wRXhjaGFnZUluZGV4ID0gdXNlckRhdGFbbmV4dEhpZ2hDb250cm9sU2VyaWVzWzBdXS5leHRyYURhdGFzIS56SW5kZXghDQogICAgICAgICAgICBjb25zdCBzd2FwVGFiSW5kZXggPSB1c2VyRGF0YVtuZXh0U2VsZWN0ZWRDb250cm9sXS5leHRyYURhdGFzIS56SW5kZXghDQogICAgICAgICAgICBpZiAoc3dhcFRhYkluZGV4IDw9IHVzZXJEYXRhW2NvbnRhaW5lcl0uY29udHJvbHMubGVuZ3RoKSB7DQogICAgICAgICAgICAgIGNvbnN0IGluZGV4ID0gdXNlckRhdGFbY29udGFpbmVyXS5jb250cm9scy5maW5kSW5kZXgoDQogICAgICAgICAgICAgICAgKHZhbCkgPT4gdXNlckRhdGFbdmFsXS5leHRyYURhdGFzIS56SW5kZXggPT09IHN3YXBUYWJJbmRleA0KICAgICAgICAgICAgICApDQogICAgICAgICAgICAgIHRoaXMudXBkYXRlRXh0cmFEYXRhcyh1c2VyRGF0YVtjb250YWluZXJdLmNvbnRyb2xzW2luZGV4XSwgJ3pJbmRleCcsIHRlbXBFeGNoYWdlSW5kZXgpDQogICAgICAgICAgICAgIHRoaXMudXBkYXRlRXh0cmFEYXRhcyhuZXh0SGlnaENvbnRyb2xTZXJpZXNbMF0sICd6SW5kZXgnLCAobmV4dEhpZ2hDb250cm9sU2VyaWVzIS5sZW5ndGggKyAxKSAtIHN3YXBUYWJJbmRleCkNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGZvciAobGV0IGogPSAxOyBqIDwgbmV4dEhpZ2hDb250cm9sU2VyaWVzLmxlbmd0aDsgaisrKSB7DQogICAgICAgICAgICAgIGNvbnN0IHVwZGF0ZUluZGV4ID0gdXNlckRhdGFbbmV4dEhpZ2hDb250cm9sU2VyaWVzW2pdXS5leHRyYURhdGFzIS56SW5kZXghIC0gMQ0KICAgICAgICAgICAgICB0aGlzLnVwZGF0ZUV4dHJhRGF0YXMobmV4dEhpZ2hDb250cm9sU2VyaWVzW2pdLCAnekluZGV4JywgdXBkYXRlSW5kZXgpDQogICAgICAgICAgICB9DQogICAgICAgICAgICBuZXh0SGlnaENvbnRyb2xTZXJpZXMgPSBbXQ0KICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICBjb25zdCBzd2FwVGFiSW5kZXggPSB1c2VyRGF0YVtuZXh0U2VsZWN0ZWRDb250cm9sXS5leHRyYURhdGFzIS56SW5kZXghDQogICAgICAgICAgICBpZiAoc3dhcFRhYkluZGV4IDw9IHVzZXJEYXRhW2NvbnRhaW5lcl0uY29udHJvbHMubGVuZ3RoICYmIHN3YXBUYWJJbmRleCA+IDApIHsNCiAgICAgICAgICAgICAgY29uc3QgaW5kZXggPSB1c2VyRGF0YVtjb250YWluZXJdLmNvbnRyb2xzLmZpbmRJbmRleCgNCiAgICAgICAgICAgICAgICAodmFsKSA9PiB1c2VyRGF0YVt2YWxdLmV4dHJhRGF0YXMhLnpJbmRleCA9PT0gc3dhcFRhYkluZGV4DQogICAgICAgICAgICAgICkNCiAgICAgICAgICAgICAgdGhpcy51cGRhdGVFeHRyYURhdGFzKHNlbENvbnRyb2wsICd6SW5kZXgnLCBzd2FwVGFiSW5kZXgpDQogICAgICAgICAgICAgIHRoaXMudXBkYXRlRXh0cmFEYXRhcyhuZXh0U2VsZWN0ZWRDb250cm9sLCAnekluZGV4JywgdGVtcFpJbmRleCkNCiAgICAgICAgICAgIH0NCiAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgIH0NCiAgICB9DQogIH0NCiAgZGVsZXRlUGFnZUluZGV4IChpZDogc3RyaW5nKSB7DQogICAgY29uc3QgdXNlckRhdGEgPSB0aGlzLnVzZXJmb3JtRGF0YVt0aGlzLnVzZXJGb3JtSWRdDQogICAgY29uc3QgY29udGFpbmVyID0gdGhpcy5zZWxlY3RlZENvbnRyb2xzW3RoaXMudXNlckZvcm1JZF0uY29udGFpbmVyWzBdDQogICAgY29uc3QgdGVtcEluZGV4ID0gdXNlckRhdGFbaWRdLnByb3BlcnRpZXMhLkluZGV4IQ0KICAgIGZvciAoY29uc3Qga2V5IGluIHVzZXJEYXRhW2NvbnRhaW5lcl0uY29udHJvbHMpIHsNCiAgICAgIGNvbnN0IGNvbnRyb2xaSW5kZXggPSB1c2VyRGF0YVt1c2VyRGF0YVtjb250YWluZXJdLmNvbnRyb2xzW2tleV1dLnByb3BlcnRpZXMhLkluZGV4IQ0KICAgICAgaWYgKGNvbnRyb2xaSW5kZXggPiB0ZW1wSW5kZXgpIHsNCiAgICAgICAgdGhpcy51cGRhdGVDb250cm9sKHsNCiAgICAgICAgICB1c2VyRm9ybUlkOiB0aGlzLnVzZXJGb3JtSWQsDQogICAgICAgICAgY29udHJvbElkOiB1c2VyRGF0YVtjb250YWluZXJdLmNvbnRyb2xzW2tleV0sDQogICAgICAgICAgcHJvcGVydHlOYW1lOiAnSW5kZXgnLA0KICAgICAgICAgIHZhbHVlOiBjb250cm9sWkluZGV4IC0gMQ0KICAgICAgICB9KQ0KICAgICAgfQ0KICAgIH0NCiAgfQ0KICBkZWxldGVDdXJyZW50UGFnZSAoKSB7DQogICAgY29uc3QgdHlwZSA9IHRoaXMudXNlcmZvcm1EYXRhW3RoaXMudXNlckZvcm1JZF1bdGhpcy5jb250cm9sSWRdLnR5cGUNCiAgICBpZiAodHlwZSA9PT0gJ1RhYlN0cmlwJykgew0KICAgICAgY29uc3QgdGFiQ29udHJvbERhdGEgPSBKU09OLnBhcnNlKA0KICAgICAgICBKU09OLnN0cmluZ2lmeSh0aGlzLnVzZXJmb3JtRGF0YVt0aGlzLnVzZXJGb3JtSWRdW3RoaXMuY29udHJvbElkXSkNCiAgICAgICkuZXh0cmFEYXRhcy5UYWJzDQogICAgICBpZiAodGFiQ29udHJvbERhdGEgJiYgdGFiQ29udHJvbERhdGEubGVuZ3RoID4gMCkgew0KICAgICAgICB0YWJDb250cm9sRGF0YS5zcGxpY2UodGhpcy5zZWxlY3RlZFRhYiwgMSkNCiAgICAgICAgdGhpcy51cGRhdGVDb250cm9sRXh0cmFEYXRhKHsNCiAgICAgICAgICB1c2VyRm9ybUlkOiB0aGlzLnVzZXJGb3JtSWQsDQogICAgICAgICAgY29udHJvbElkOiB0aGlzLmNvbnRyb2xJZCwNCiAgICAgICAgICBwcm9wZXJ0eU5hbWU6ICdUYWJzJywNCiAgICAgICAgICB2YWx1ZTogdGFiQ29udHJvbERhdGENCiAgICAgICAgfSkNCiAgICAgICAgdGhpcy51cGRhdGVUYWJTdHJpcFZhbHVlKHRoaXMuc2VsZWN0ZWRUYWIhIC0gMSkNCiAgICAgIH0NCiAgICB9IGVsc2UgaWYgKHR5cGUgPT09ICdNdWx0aVBhZ2UnKSB7DQogICAgICBjb25zdCBjb250cm9scyA9IHRoaXMudXNlcmZvcm1EYXRhW3RoaXMudXNlckZvcm1JZF1bdGhpcy5jb250cm9sSWRdLmNvbnRyb2xzDQogICAgICBpZiAoY29udHJvbHMubGVuZ3RoID4gMCkgew0KICAgICAgICB0aGlzLmRlbGV0ZVBhZ2VJbmRleCh0aGlzLnNlbGVjdGVkQ29udHJvbHNbdGhpcy51c2VyRm9ybUlkXS5zZWxlY3RlZFswXSkNCiAgICAgICAgY29uc3QgaW5kZXggPSB0aGlzLnVzZXJmb3JtRGF0YVt0aGlzLnVzZXJGb3JtSWRdW3RoaXMuc2VsZWN0ZWRDb250cm9sc1t0aGlzLnVzZXJGb3JtSWRdLnNlbGVjdGVkWzBdXS5wcm9wZXJ0aWVzLkluZGV4DQogICAgICAgIHRoaXMuZGVsZXRlQ29udHJvbCh7DQogICAgICAgICAgdXNlckZvcm1JZDogdGhpcy51c2VyRm9ybUlkLA0KICAgICAgICAgIHBhcmVudElkOiB0aGlzLnNlbGVjdGVkQ29udHJvbHNbdGhpcy51c2VyRm9ybUlkXS5jb250YWluZXJbMF0sDQogICAgICAgICAgdGFyZ2V0SWQ6IHRoaXMuc2VsZWN0ZWRDb250cm9sc1t0aGlzLnVzZXJGb3JtSWRdLnNlbGVjdGVkWzBdDQogICAgICAgIH0pDQogICAgICAgIHRoaXMudXBkYXRlSW5kZXgoaW5kZXghIC0gMSkNCiAgICAgIH0NCiAgICAgIEV2ZW50QnVzLiRlbWl0KCd1cGRhdGVNdWx0aVBhZ2VWYWx1ZScpDQogICAgfQ0KICB9DQogIHVwZGF0ZVRhYlN0cmlwVmFsdWUgKGluZGV4OiBudW1iZXIpIHsNCiAgICBjb25zdCB1c2VyRGF0YSA9IHRoaXMudXNlcmZvcm1EYXRhW3RoaXMudXNlckZvcm1JZF0NCiAgICBjb25zdCB0YWJzID0gdXNlckRhdGFbdGhpcy5jb250cm9sSWRdLmV4dHJhRGF0YXMhLlRhYnMhDQogICAgY29uc3QgdGFiSW5kZXggPSB0YWJzLmZpbmRJbmRleCgodmFsLCBrZXkpID0+IGtleSA9PT0gaW5kZXggKyAxKQ0KICAgIGlmICh0YWJJbmRleCAhPT0gLTEpIHsNCiAgICAgIGNvbnN0IHZhbHVlID0gaW5kZXggKyAxDQogICAgICB0aGlzLnVwZGF0ZUNvbnRyb2xQcm9wZXJ0eSgnVmFsdWUnLCB2YWx1ZSwgdGhpcy5jb250cm9sSWQpDQogICAgfSBlbHNlIGlmICh0YWJJbmRleCA9PT0gLTEgJiYgaW5kZXggIT09IC0xKSB7DQogICAgICBjb25zdCB2YWx1ZSA9IGluZGV4DQogICAgICB0aGlzLnVwZGF0ZUNvbnRyb2xQcm9wZXJ0eSgnVmFsdWUnLCB2YWx1ZSwgdGhpcy5jb250cm9sSWQpDQogICAgfSBlbHNlIHsNCiAgICAgIHRoaXMudXBkYXRlQ29udHJvbFByb3BlcnR5KCdWYWx1ZScsIC0xLCB0aGlzLmNvbnRyb2xJZCkNCiAgICB9DQogIH0NCiAgY2hhbmdlU2VsZWN0IChjb250cm9sOiBzdHJpbmcpIHsNCiAgICB0aGlzLnNlbGVjdENvbnRyb2woew0KICAgICAgdXNlckZvcm1JZDogdGhpcy51c2VyRm9ybUlkLA0KICAgICAgc2VsZWN0OiB7DQogICAgICAgIGNvbnRhaW5lcjogdGhpcy5nZXRDb250YWluZXJMaXN0KGNvbnRyb2wpLA0KICAgICAgICBzZWxlY3RlZDogW2NvbnRyb2xdDQogICAgICB9DQogICAgfSkNCiAgfQ0KICB1cGRhdGVJbmRleCAoaW5kZXg6IG51bWJlcikgew0KICAgIGNvbnN0IHVzZXJEYXRhID0gdGhpcy51c2VyZm9ybURhdGFbdGhpcy51c2VyRm9ybUlkXQ0KICAgIGNvbnN0IGNvbnRyb2xzID0gdXNlckRhdGFbdGhpcy5jb250cm9sSWRdLmNvbnRyb2xzDQogICAgY29uc3QgcGFnZUluZGV4ID0gY29udHJvbHMuZmluZEluZGV4KHZhbCA9PiB1c2VyRGF0YVt2YWxdLnByb3BlcnRpZXMuSW5kZXggPT09IGluZGV4ICsgMSkNCiAgICBpZiAocGFnZUluZGV4ICE9PSAtMSkgew0KICAgICAgY29uc3QgdmFsdWUgPSB1c2VyRGF0YVtjb250cm9sc1twYWdlSW5kZXhdXS5wcm9wZXJ0aWVzLkluZGV4IQ0KICAgICAgdGhpcy51cGRhdGVDb250cm9sUHJvcGVydHkoJ1ZhbHVlJywgdmFsdWUsIHRoaXMuY29udHJvbElkKQ0KICAgICAgdGhpcy5jaGFuZ2VTZWxlY3QoY29udHJvbHNbcGFnZUluZGV4XSkNCiAgICB9IGVsc2UgaWYgKHBhZ2VJbmRleCA9PT0gLTEgJiYgaW5kZXggIT09IC0xKSB7DQogICAgICBjb25zdCB1cGRhdGVJbmRleCA9IGNvbnRyb2xzLmZpbmRJbmRleCh2YWwgPT4gdXNlckRhdGFbdmFsXS5wcm9wZXJ0aWVzLkluZGV4ID09PSBpbmRleCkNCiAgICAgIGNvbnN0IHZhbHVlID0gdXNlckRhdGFbY29udHJvbHNbdXBkYXRlSW5kZXhdXS5wcm9wZXJ0aWVzLkluZGV4IQ0KICAgICAgdGhpcy51cGRhdGVDb250cm9sUHJvcGVydHkoJ1ZhbHVlJywgdmFsdWUsIHRoaXMuY29udHJvbElkKQ0KICAgICAgdGhpcy5jaGFuZ2VTZWxlY3QoY29udHJvbHNbdXBkYXRlSW5kZXhdKQ0KICAgIH0gZWxzZSB7DQogICAgICB0aGlzLnVwZGF0ZUNvbnRyb2xQcm9wZXJ0eSgnVmFsdWUnLCAtMSwgdGhpcy5jb250cm9sSWQpDQogICAgICB0aGlzLmNoYW5nZVNlbGVjdCh0aGlzLmNvbnRyb2xJZCkNCiAgICB9DQogIH0NCiAgdXBkYXRlQ29udHJvbFByb3BlcnR5ICgNCiAgICBwcm9wZXJ0eU5hbWU6IGtleW9mIGNvbnRyb2xQcm9wZXJ0aWVzLA0KICAgIHByb3BlcnR5VmFsdWU6IG51bWJlciB8IHN0cmluZywNCiAgICBjb250cm9sSWQ6IHN0cmluZw0KICApIHsNCiAgICB0aGlzLnVwZGF0ZUNvbnRyb2woew0KICAgICAgdXNlckZvcm1JZDogdGhpcy51c2VyRm9ybUlkLA0KICAgICAgY29udHJvbElkOiBjb250cm9sSWQsDQogICAgICBwcm9wZXJ0eU5hbWU6IHByb3BlcnR5TmFtZSwNCiAgICAgIHZhbHVlOiBwcm9wZXJ0eVZhbHVlDQogICAgfSkNCiAgfQ0KDQogIHVuR3JvdXBDb250cm9sICgpIHsNCiAgICBjb25zdCBpc0dyb3VwID0gdGhpcy5zZWxlY3RlZENvbnRyb2xzW3RoaXMudXNlckZvcm1JZF0uc2VsZWN0ZWRbMF0uc3RhcnRzV2l0aCgnZ3JvdXAnKQ0KICAgIGNvbnN0IHNlbENvbnRyb2wgPSB0aGlzLnNlbGVjdGVkQ29udHJvbHNbdGhpcy51c2VyRm9ybUlkXS5zZWxlY3RlZFswXQ0KICAgIGNvbnN0IHNlbGVjdGVkID0gaXNHcm91cA0KICAgICAgPyBzZWxDb250cm9sDQogICAgICA6IHRoaXMudXNlcmZvcm1EYXRhW3RoaXMudXNlckZvcm1JZF1bc2VsQ29udHJvbF0ucHJvcGVydGllcy5Hcm91cElEIQ0KDQogICAgY29uc3QgY29udHJvbExpc3QgPSBbXQ0KICAgIGZvciAoY29uc3Qga2V5IGluIHRoaXMudXNlcmZvcm1EYXRhW3RoaXMudXNlckZvcm1JZF0pIHsNCiAgICAgIGNvbnN0IHR5cGUgPSB0aGlzLnVzZXJmb3JtRGF0YVt0aGlzLnVzZXJGb3JtSWRdW2tleV0udHlwZQ0KICAgICAgaWYgKA0KICAgICAgICB0eXBlICE9PSAnVXNlcmZvcm0nICYmDQogICAgICAgIHRoaXMudXNlcmZvcm1EYXRhW3RoaXMudXNlckZvcm1JZF1ba2V5XS5wcm9wZXJ0aWVzLkdyb3VwSUQgPT09IHNlbGVjdGVkDQogICAgICApIHsNCiAgICAgICAgY29udHJvbExpc3QucHVzaChrZXkpDQogICAgICB9DQogICAgfQ0KICAgIGNvbnN0IGdyb3VwQXJyYXkgPSBbLi4udGhpcy5ncm91cGVkQ29udHJvbHNbdGhpcy51c2VyRm9ybUlkXSEuZ3JvdXBBcnJheSFdDQogICAgdGhpcy51cGRhdGVDb250cm9sR3JvdXBJRChzZWxlY3RlZCwgJycpDQogICAgY29uc3QgaW5kZXggPSB0aGlzLmdyb3VwZWRDb250cm9sc1t0aGlzLnVzZXJGb3JtSWRdIS5ncm91cEFycmF5IS5maW5kSW5kZXgoDQogICAgICAodmFsKSA9PiB2YWwgPT09IHNlbGVjdGVkDQogICAgKQ0KICAgIGdyb3VwQXJyYXkuc3BsaWNlKGluZGV4LCAxKQ0KICAgIHRoaXMudXBkYXRlR3JvdXAoeyB1c2VyRm9ybUlkOiB0aGlzLnVzZXJGb3JtSWQsIGdyb3VwQXJyYXk6IGdyb3VwQXJyYXkgfSkNCiAgICB0aGlzLnNlbGVjdENvbnRyb2woew0KICAgICAgdXNlckZvcm1JZDogdGhpcy51c2VyRm9ybUlkLA0KICAgICAgc2VsZWN0OiB7DQogICAgICAgIGNvbnRhaW5lcjogaXNHcm91cA0KICAgICAgICAgID8gdGhpcy5nZXRDb250YWluZXJMaXN0KGNvbnRyb2xMaXN0WzBdKQ0KICAgICAgICAgIDogdGhpcy5nZXRDb250YWluZXJMaXN0KHNlbENvbnRyb2xbMF0pLA0KICAgICAgICBzZWxlY3RlZDogaXNHcm91cCA/IGNvbnRyb2xMaXN0IDogW3NlbENvbnRyb2xdDQogICAgICB9DQogICAgfSkNCiAgfQ0KDQogIC8qKg0KICAgKiBAZGVzY3JpcHRpb24gVG8gZ2VuZXJhdGUgbmV3IEdyb3VwSUQNCiAgICogQGZ1bmN0aW9uIGNyZWF0ZUdyb3VwSWQNCiAgICovDQogIGNyZWF0ZUdyb3VwSWQgKCkgew0KICAgIGxldCBsYXN0Q29udHJvbElkID0gMA0KICAgIGZvciAobGV0IGkgb2YgdGhpcy5ncm91cGVkQ29udHJvbHNbdGhpcy51c2VyRm9ybUlkXSEuZ3JvdXBBcnJheSEpIHsNCiAgICAgIGlmIChpLmluZGV4T2YoJ2dyb3VwJykgIT09IC0xKSB7DQogICAgICAgIGNvbnN0IElkTnVtID0gaS5zcGxpdCgnZ3JvdXAnKS5wb3AoKSB8fCAnLTEnDQogICAgICAgIGNvbnN0IHBhc3JlSWQgPSBwYXJzZUludChJZE51bSwgMTApDQogICAgICAgIGlmICghaXNOYU4ocGFzcmVJZCkgJiYgbGFzdENvbnRyb2xJZCA8IHBhc3JlSWQpIHsNCiAgICAgICAgICBsYXN0Q29udHJvbElkID0gcGFzcmVJZA0KICAgICAgICB9DQogICAgICB9DQogICAgfQ0KICAgIHJldHVybiBgZ3JvdXAke2xhc3RDb250cm9sSWQgKyAxfWANCiAgfQ0KDQogIEBFbWl0KCdjcmVhdGVHcm91cCcpDQogIGNyZWF0ZUdyb3VwIChncm91cElkOiBzdHJpbmcpIHsNCiAgICByZXR1cm4gZ3JvdXBJZA0KICB9DQoNCiAgdXBkYXRlQ29udHJvbEdyb3VwSUQgKGdyb3VwTmFtZTogc3RyaW5nLCB1cGRhdGVHcm91cElkOiBzdHJpbmcpIHsNCiAgICBmb3IgKGNvbnN0IHZhbCBpbiB0aGlzLnVzZXJmb3JtRGF0YVt0aGlzLnVzZXJGb3JtSWRdKSB7DQogICAgICBpZiAoIXZhbC5zdGFydHNXaXRoKCdJRF9VU0VSRk9STScpKSB7DQogICAgICAgIGNvbnN0IGNvbnRyb2xHcnBJZCA9IHRoaXMudXNlcmZvcm1EYXRhW3RoaXMudXNlckZvcm1JZF1bdmFsXS5wcm9wZXJ0aWVzDQogICAgICAgICAgLkdyb3VwSUQNCiAgICAgICAgaWYgKGNvbnRyb2xHcnBJZCA9PT0gZ3JvdXBOYW1lKSB7DQogICAgICAgICAgdGhpcy51cGRhdGVDb250cm9sUHJvcGVydHkoJ0dyb3VwSUQnLCB1cGRhdGVHcm91cElkLCB2YWwpDQogICAgICAgIH0NCiAgICAgIH0NCiAgICB9DQogIH0NCiAgLyoqDQogICAqIEBkZXNjcmlwdGlvbiBUbyB1cGRhdGUgdGhlIGdyb3VwIEluZm9ybWF0aW9uIGluIG1haW4gZGF0YQ0KICAgKiBAZnVuY3Rpb24gZ3JvdXBDb250cm9sDQogICAqLw0KICBncm91cENvbnRyb2wgKCkgew0KICAgIGxldCB1cGRhdGVHcm91cElkOiBzdHJpbmcgPSAnJw0KICAgIGNvbnN0IHNlbGVjdGVkID0gdGhpcy5zZWxlY3RlZENvbnRyb2xzW3RoaXMudXNlckZvcm1JZF0uc2VsZWN0ZWQNCg0KICAgIGNvbnN0IHNlbGVjdGVkR3JvdXBBcnJheSA9IHNlbGVjdGVkLmZpbHRlcigNCiAgICAgICh2YWw6IHN0cmluZykgPT4gdmFsLnN0YXJ0c1dpdGgoJ2dyb3VwJykgJiYgdmFsDQogICAgKQ0KICAgIHVwZGF0ZUdyb3VwSWQgPSBzZWxlY3RlZEdyb3VwQXJyYXlbMF0NCiAgICBpZiAoc2VsZWN0ZWRHcm91cEFycmF5Lmxlbmd0aCA+PSAyKSB7DQogICAgICBjb25zdCBncm91cEFycmF5ID0gWw0KICAgICAgICAuLi50aGlzLmdyb3VwZWRDb250cm9sc1t0aGlzLnVzZXJGb3JtSWRdIS5ncm91cEFycmF5IQ0KICAgICAgXQ0KICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBncm91cEFycmF5Lmxlbmd0aDsgaSsrKSB7DQogICAgICAgIGZvciAobGV0IGogPSAwOyBqIDwgc2VsZWN0ZWRHcm91cEFycmF5Lmxlbmd0aDsgaisrKSB7DQogICAgICAgICAgaWYgKHNlbGVjdGVkR3JvdXBBcnJheVtqXSA9PT0gZ3JvdXBBcnJheVtpXSkgew0KICAgICAgICAgICAgdGhpcy51cGRhdGVDb250cm9sR3JvdXBJRChncm91cEFycmF5W2ldLCBzZWxlY3RlZEdyb3VwQXJyYXlbMF0pDQogICAgICAgICAgICBncm91cEFycmF5LnNwbGljZShpLCAxKQ0KICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgfQ0KICAgICAgdGhpcy51cGRhdGVHcm91cCh7DQogICAgICAgIHVzZXJGb3JtSWQ6IHRoaXMudXNlckZvcm1JZCwNCiAgICAgICAgZ3JvdXBBcnJheTogWy4uLmdyb3VwQXJyYXksIHNlbGVjdGVkR3JvdXBBcnJheVswXV0NCiAgICAgIH0pDQogICAgICB1cGRhdGVHcm91cElkID0gc2VsZWN0ZWRHcm91cEFycmF5WzBdIQ0KICAgIH0gZWxzZSBpZiAoc2VsZWN0ZWRHcm91cEFycmF5Lmxlbmd0aCA9PT0gMCkgew0KICAgICAgdXBkYXRlR3JvdXBJZCA9IHRoaXMuY3JlYXRlR3JvdXBJZCgpDQogICAgICBjb25zdCBncm91cEFycmF5ID0gWw0KICAgICAgICAuLi50aGlzLmdyb3VwZWRDb250cm9sc1t0aGlzLnVzZXJGb3JtSWRdIS5ncm91cEFycmF5ISwNCiAgICAgICAgdXBkYXRlR3JvdXBJZA0KICAgICAgXQ0KICAgICAgdGhpcy51cGRhdGVHcm91cCh7IHVzZXJGb3JtSWQ6IHRoaXMudXNlckZvcm1JZCwgZ3JvdXBBcnJheTogZ3JvdXBBcnJheSB9KQ0KICAgIH0NCg0KICAgIGZvciAobGV0IHZhbCBvZiBzZWxlY3RlZCkgew0KICAgICAgaWYgKCF2YWwuc3RhcnRzV2l0aCgnZ3JvdXAnKSkgew0KICAgICAgICB0aGlzLnVwZGF0ZUNvbnRyb2xQcm9wZXJ0eSgnR3JvdXBJRCcsIHVwZGF0ZUdyb3VwSWQsIHZhbCkNCiAgICAgIH0NCiAgICB9DQogICAgdGhpcy5jcmVhdGVHcm91cCh1cGRhdGVHcm91cElkKQ0KICAgIHRoaXMuc2VsZWN0Q29udHJvbCh7DQogICAgICB1c2VyRm9ybUlkOiB0aGlzLnVzZXJGb3JtSWQsDQogICAgICBzZWxlY3Q6IHsNCiAgICAgICAgY29udGFpbmVyOiB0aGlzLmdldENvbnRhaW5lckxpc3QodXBkYXRlR3JvdXBJZCksDQogICAgICAgIHNlbGVjdGVkOiBbdXBkYXRlR3JvdXBJZF0NCiAgICAgIH0NCiAgICB9KQ0KICB9DQoNCiAgLyoqDQogICAqIEBkZXNjcmlwdGlvbiBUbyBzZWxlY3QgYWxsIHRoZSBjb250cm9scyBpbiByZXNwZWN0aXZlIGNvbnRhaW5lciBwcmVzZW50IGluIHJlc3BlY3RpdmUgdXNlcmZvcm0NCiAgICogQGZ1bmN0aW9uIHNlbGVjdEFsbA0KICAgKi8NCiAgc2VsZWN0QWxsICgpIHsNCiAgICAvLyBjb25zdCBzZWxlY2V0ZWRDb250YWluZXIgPSB0aGlzLnNlbGVjdGVkQ29udHJvbHNbdGhpcy51c2VyRm9ybUlkXS5jb250YWluZXJbMF0NCiAgICBjb25zdCBjb250cm9sT2JqZWN0TGlzdCA9IFsNCiAgICAgIC4uLnRoaXMudXNlcmZvcm1EYXRhW3RoaXMudXNlckZvcm1JZF1bdGhpcy5jb250YWluZXJJZF0uY29udHJvbHMNCiAgICBdDQogICAgY29uc3Qgc2VsZWNlZEdyb3VwOiBzdHJpbmdbXSA9IFtdDQogICAgZm9yIChjb25zdCB2YWwgb2YgY29udHJvbE9iamVjdExpc3QpIHsNCiAgICAgIGNvbnN0IGNvbnRyb2xHcm91cElkOiBzdHJpbmcgPSB0aGlzLnVzZXJmb3JtRGF0YVt0aGlzLnVzZXJGb3JtSWRdW3ZhbF0NCiAgICAgICAgLnByb3BlcnRpZXMuR3JvdXBJRCENCiAgICAgIGlmIChjb250cm9sR3JvdXBJZCAmJiBjb250cm9sR3JvdXBJZCAhPT0gJycpIHsNCiAgICAgICAgIXNlbGVjZWRHcm91cC5pbmNsdWRlcyhjb250cm9sR3JvdXBJZCkhICYmDQogICAgICAgICAgc2VsZWNlZEdyb3VwLnB1c2goY29udHJvbEdyb3VwSWQpDQogICAgICB9IGVsc2Ugew0KICAgICAgICBzZWxlY2VkR3JvdXAucHVzaCh2YWwpDQogICAgICB9DQogICAgfQ0KDQogICAgaWYgKGNvbnRyb2xPYmplY3RMaXN0Lmxlbmd0aCAhPT0gMCkgew0KICAgICAgdGhpcy5zZWxlY3RDb250cm9sKHsNCiAgICAgICAgdXNlckZvcm1JZDogdGhpcy51c2VyRm9ybUlkLA0KICAgICAgICBzZWxlY3Q6IHsNCiAgICAgICAgICBjb250YWluZXI6IHRoaXMuZ2V0Q29udGFpbmVyTGlzdChzZWxlY2VkR3JvdXBbMF0pLA0KICAgICAgICAgIHNlbGVjdGVkOiBbLi4uc2VsZWNlZEdyb3VwXQ0KICAgICAgICB9DQogICAgICB9KQ0KICAgIH0NCiAgfQ0KDQogIC8qKg0KICAgKiBAZGVzY3JpcHRpb24gVG8gdXBkYXRlIHRoZSBjdXR0ZWQgY29udHJvbHMgaW4gcmVzcGVjdGl2ZSBjb250YWluZXIgcHJlc2VudCBpbiByZXNwZWN0aXZlIHVzZXJmb3JtDQogICAqIEBmdW5jdGlvbiBjdXRDb250cm9sDQogICAqLw0KICBjdXRDb250cm9sICgpIHsNCiAgICB0aGlzLmNvcHlDb250cm9sKCdjdXQnKQ0KICAgIHRoaXMuY2xpY2tEZWxldGUoKQ0KICB9DQoNCiAgLyoqDQogICAqIEBkZXNjcmlwdGlvbiBUbyB1cGRhdGUgdGhlIGNvcGllZCBjb250cm9scyBpbiByZXNwZWN0aXZlIGNvbnRhaW5lciBwcmVzZW50IGluIHJlc3BlY3RpdmUgdXNlcmZvcm0NCiAgICogQGZ1bmN0aW9uIGNvcHlDb250cm9sDQogICAqLw0KICBjb3B5Q29udHJvbCAodHlwZTogc3RyaW5nKSB7DQogICAgaWYgKHRoaXMuY29waWVkQ29udHJvbFt0aGlzLnVzZXJGb3JtSWRdW3RoaXMudXNlckZvcm1JZF0uY29udHJvbHMubGVuZ3RoID4gMCkgew0KICAgICAgY29uc3QgbGVuZ3RoQ291bnQgPSB0aGlzLmNvcGllZENvbnRyb2xbdGhpcy51c2VyRm9ybUlkXVt0aGlzLnVzZXJGb3JtSWRdLmNvbnRyb2xzLmxlbmd0aA0KICAgICAgY29uc3QgY29udHJvbHMgPSBbLi4udGhpcy5jb3BpZWRDb250cm9sW3RoaXMudXNlckZvcm1JZF1bdGhpcy51c2VyRm9ybUlkXS5jb250cm9sc10NCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbGVuZ3RoQ291bnQ7IGkrKykgew0KICAgICAgICB0aGlzLmRlbGV0ZUNvcGllZENvbnRyb2woew0KICAgICAgICAgIHVzZXJGb3JtSWQ6IHRoaXMudXNlckZvcm1JZCwNCiAgICAgICAgICBwYXJlbnRJZDogdGhpcy51c2VyRm9ybUlkLA0KICAgICAgICAgIHRhcmdldElkOiBjb250cm9sc1tpXQ0KICAgICAgICB9KQ0KICAgICAgfQ0KICAgIH0NCiAgICBjb25zdCB1c2VyRm9ybURhdGEgPSB0aGlzLnVzZXJmb3JtRGF0YVt0aGlzLnVzZXJGb3JtSWRdDQogICAgY29uc3Qgc2VsQ29udGFpbmVyID0gdGhpcy5zZWxlY3RlZENvbnRyb2xzW3RoaXMudXNlckZvcm1JZF0uY29udGFpbmVyWzBdDQogICAgY29uc3Qgc2VsU2VsZWN0ZWQgPSB0aGlzLnNlbGVjdGVkQ29udHJvbHNbdGhpcy51c2VyRm9ybUlkXS5zZWxlY3RlZA0KICAgIGNvbnN0IHVwZGF0ZVNlbGVjdGVkID0gW10NCiAgICBmb3IgKGxldCBjb250cm9sIG9mIHNlbFNlbGVjdGVkKSB7DQogICAgICBpZiAoIWNvbnRyb2wuc3RhcnRzV2l0aCgnZ3JvdXAnKSAmJiB1c2VyRm9ybURhdGFbY29udHJvbF0udHlwZSA9PT0gJ1BhZ2UnKSB7DQogICAgICAgIGNvbnRyb2wgPSB0aGlzLmdldENvbnRhaW5lckxpc3QoY29udHJvbClbMF0NCiAgICAgIH0NCiAgICAgIHVwZGF0ZVNlbGVjdGVkLnB1c2goY29udHJvbCkNCiAgICB9DQogICAgdGhpcy51cGRhdGVDb3B5Q29udHJvbExpc3Qoew0KICAgICAgdXNlckZvcm1JZDogdGhpcy51c2VyRm9ybUlkLA0KICAgICAgcGFyZW50SWQ6IHNlbENvbnRhaW5lciwNCiAgICAgIHRhcmdldElkOiB1cGRhdGVTZWxlY3RlZCwNCiAgICAgIHR5cGU6IHR5cGUNCiAgICB9KQ0KDQogICAgY29uc3QgcmVjQ29weUNvbnRyb2wgPSAoZGFUYXJnZXQ6IHN0cmluZykgPT4gew0KICAgICAgY29uc3QgZGFUYXJnZXRDb250cm9scyA9IHVzZXJGb3JtRGF0YVtkYVRhcmdldF0uY29udHJvbHMNCiAgICAgIGlmIChkYVRhcmdldENvbnRyb2xzLmxlbmd0aCA+IDApIHsNCiAgICAgICAgZm9yIChsZXQgaSBpbiBkYVRhcmdldENvbnRyb2xzKSB7DQogICAgICAgICAgY29uc3QgY29udHJvbE9iamVjdCA9IEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkodXNlckZvcm1EYXRhW2RhVGFyZ2V0Q29udHJvbHNbaV1dKSkNCiAgICAgICAgICBjb25zdCBjb250cm9sQXJyYXkgPSBbXQ0KICAgICAgICAgIGNvbnN0IGN0cmxPYmogPSB7IC4uLmNvbnRyb2xPYmplY3QsIGNvbnRyb2xzOiBbXSB9DQogICAgICAgICAgdGhpcy5hZGRDb3BpZWRDb250cm9sKHsNCiAgICAgICAgICAgIHVzZXJGb3JtSWQ6IHRoaXMudXNlckZvcm1JZCwNCiAgICAgICAgICAgIGNvbnRyb2xJZDogZGFUYXJnZXQsDQogICAgICAgICAgICBhZGRJZDogZGFUYXJnZXRDb250cm9sc1tpXSwNCiAgICAgICAgICAgIGl0ZW06IGN0cmxPYmoNCiAgICAgICAgICB9KQ0KICAgICAgICAgIHJlY0NvcHlDb250cm9sKGRhVGFyZ2V0Q29udHJvbHNbaV0pDQogICAgICAgIH0NCiAgICAgIH0NCiAgICB9DQoNCiAgICBmb3IgKGxldCBrZXkgb2Ygc2VsU2VsZWN0ZWQpIHsNCiAgICAgIGlmICgha2V5LnN0YXJ0c1dpdGgoJ2dyb3VwJykpIHsNCiAgICAgICAgaWYgKHVzZXJGb3JtRGF0YVtrZXldLnR5cGUgPT09ICdQYWdlJykgew0KICAgICAgICAgIGtleSA9IHRoaXMuZ2V0Q29udGFpbmVyTGlzdChrZXkpWzBdDQogICAgICAgIH0NCiAgICAgICAgY29uc3QgY29udHJvbE9iamVjdCA9IEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkodXNlckZvcm1EYXRhW2tleV0pKQ0KICAgICAgICBjb25zdCBjdHJsT2JqID0geyAuLi5jb250cm9sT2JqZWN0LCBjb250cm9sczogW10gfQ0KICAgICAgICB0aGlzLmFkZENvcGllZENvbnRyb2woew0KICAgICAgICAgIHVzZXJGb3JtSWQ6IHRoaXMudXNlckZvcm1JZCwNCiAgICAgICAgICBjb250cm9sSWQ6IHRoaXMudXNlckZvcm1JZCwNCiAgICAgICAgICBhZGRJZDoga2V5LA0KICAgICAgICAgIGl0ZW06IGN0cmxPYmoNCiAgICAgICAgfSkNCiAgICAgICAgcmVjQ29weUNvbnRyb2woa2V5KQ0KICAgICAgfSBlbHNlIHsNCiAgICAgICAgZm9yIChsZXQgY3RybElkIGluIHVzZXJGb3JtRGF0YSkgew0KICAgICAgICAgIGNvbnN0IGNvbnRyb2xQcm9wID0gdXNlckZvcm1EYXRhW2N0cmxJZF0ucHJvcGVydGllcy5Hcm91cElEDQogICAgICAgICAgaWYgKGNvbnRyb2xQcm9wKSB7DQogICAgICAgICAgICBpZiAoY29udHJvbFByb3AgPT09IGtleSkgew0KICAgICAgICAgICAgICBjb25zdCBjb250cm9sT2JqZWN0ID0gSlNPTi5wYXJzZSgNCiAgICAgICAgICAgICAgICBKU09OLnN0cmluZ2lmeSh1c2VyRm9ybURhdGFbY3RybElkXSkNCiAgICAgICAgICAgICAgKQ0KICAgICAgICAgICAgICBjb25zdCBjdHJsT2JqID0geyAuLi5jb250cm9sT2JqZWN0LCBjb250cm9sczogW10gfQ0KICAgICAgICAgICAgICB0aGlzLmFkZENvcGllZENvbnRyb2woew0KICAgICAgICAgICAgICAgIHVzZXJGb3JtSWQ6IHRoaXMudXNlckZvcm1JZCwNCiAgICAgICAgICAgICAgICBjb250cm9sSWQ6IHRoaXMudXNlckZvcm1JZCwNCiAgICAgICAgICAgICAgICBhZGRJZDogY3RybElkLA0KICAgICAgICAgICAgICAgIGl0ZW06IGN0cmxPYmoNCiAgICAgICAgICAgICAgfSkNCiAgICAgICAgICAgICAgcmVjQ29weUNvbnRyb2woY3RybElkKQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgfQ0KICAgIH0NCiAgfQ0KICB1cGRhdGVOZXdDb250cm9sIChwYXJlbnRJZDogc3RyaW5nLCBjdHJsSWQ6IHN0cmluZywgY3RybE9iajogY29udHJvbERhdGEsIGlzUGFyZW50OiBib29sZWFuKSB7DQogICAgdGhpcy5hZGRDb250cm9sKHsNCiAgICAgIHVzZXJGb3JtSWQ6IHRoaXMudXNlckZvcm1JZCwNCiAgICAgIGNvbnRyb2xJZDogcGFyZW50SWQsDQogICAgICBhZGRJZDogY3RybElkLA0KICAgICAgaXRlbTogY3RybE9iag0KICAgIH0pDQogICAgaWYgKGlzUGFyZW50KSB7DQogICAgICBjb25zdCBuZXdUYWJJbmRleCA9IHRoaXMudXNlcmZvcm1EYXRhW3RoaXMudXNlckZvcm1JZF1bcGFyZW50SWRdLmNvbnRyb2xzLmxlbmd0aA0KICAgICAgdGhpcy51cGRhdGVUYWJJbmRleFZhbHVlKGN0cmxJZCkNCiAgICAgIHRoaXMudXBkYXRlWkluZGV4VmFsdWUoY3RybElkKQ0KICAgIH0NCiAgfQ0KDQogIG5ld1Bhc3RlQ29udHJvbElkIChrZXk6IHN0cmluZywgcGFyZW50SWQ6IHN0cmluZykgew0KICAgIGNvbnN0IHVzZXJGb3JtRGF0YSA9IHRoaXMudXNlcmZvcm1EYXRhW3RoaXMudXNlckZvcm1JZF0NCiAgICBsZXQgbGFzdENvbnRyb2xJZCA9IDANCiAgICBjb25zdCB0eXBlID0ga2V5IGluIHVzZXJGb3JtRGF0YSA/IHVzZXJGb3JtRGF0YVtrZXldLnR5cGUgOiAnJw0KICAgIGNvbnN0IHBhcmVudE5hbWUgPSBwYXJlbnRJZCAhPT0gJycgPyBwYXJlbnRJZC5zcGxpdCgnTXVsdGlQYWdlJykucG9wKCkgOiAtMQ0KICAgIGNvbnN0IHNlbGVjdGVkQ29udHJvbE5hbWU6IHN0cmluZyB8IHVuZGVmaW5lZCA9DQogICAgdHlwZSA9PT0gJ1BhZ2UnDQogICAgICA/IGBQYWdlJHtwYXJlbnROYW1lfV9gDQogICAgICA6IGtleS5yZXBsYWNlKC9bMC05XS9nLCAnJykuc3BsaXQoJ18nKS5wb3AoKQ0KICAgIGNvbnN0IHVzZXJmb3JtQ29udHJvbElkcyA9IE9iamVjdC5rZXlzKHVzZXJGb3JtRGF0YSkNCiAgICBmb3IgKGxldCBpID0gMDsgaSA8IHVzZXJmb3JtQ29udHJvbElkcy5sZW5ndGg7IGkrKykgew0KICAgICAgaWYgKHVzZXJmb3JtQ29udHJvbElkc1tpXS5pbmRleE9mKHNlbGVjdGVkQ29udHJvbE5hbWUhKSAhPT0gLTEpIHsNCiAgICAgICAgY29uc3QgSWROdW0gPSB1c2VyZm9ybUNvbnRyb2xJZHNbaV0uc3BsaXQoc2VsZWN0ZWRDb250cm9sTmFtZSEpLnBvcCgpIHx8ICctMScNCiAgICAgICAgY29uc3QgcGFzcmVJZCA9IHBhcnNlSW50KElkTnVtLCAxMCkNCiAgICAgICAgaWYgKCFpc05hTihwYXNyZUlkKSAmJiBsYXN0Q29udHJvbElkIDwgcGFzcmVJZCkgew0KICAgICAgICAgIGxhc3RDb250cm9sSWQgPSBwYXNyZUlkDQogICAgICAgIH0NCiAgICAgIH0NCiAgICB9DQogICAgbGFzdENvbnRyb2xJZCArPSAxDQogICAgY29uc3QgTmFtZSA9IGAke3NlbGVjdGVkQ29udHJvbE5hbWV9JHtsYXN0Q29udHJvbElkfWANCiAgICByZXR1cm4gTmFtZQ0KICB9DQogIHJlbW92ZUNoaWxkQ29udHJvbCAoZGFUYXJnZXQ6IHN0cmluZywgZGVsZXRlQ29udHJvbDogc3RyaW5nKSB7DQogICAgY29uc3QgcmVtb3ZlQ29udHJvbCA9IFsuLi50aGlzLnVzZXJmb3JtRGF0YVt0aGlzLnVzZXJGb3JtSWRdW2RhVGFyZ2V0XS5jb250cm9sc10NCiAgICBjb25zdCByZW1vdmVJbmRleCA9IHJlbW92ZUNvbnRyb2wuZmluZEluZGV4KCh2YWwpID0+IHZhbCA9PT0gZGVsZXRlQ29udHJvbCkNCiAgICByZW1vdmVDb250cm9sLnNwbGljZShyZW1vdmVJbmRleCwgMSkNCiAgICB0aGlzLnNldENoaWxkQ29udHJvbHMoew0KICAgICAgdXNlckZvcm1JZDogdGhpcy51c2VyRm9ybUlkLA0KICAgICAgY29udGFpbmVySWQ6IGRhVGFyZ2V0LA0KICAgICAgdGFyZ2V0Q29udHJvbHM6IHJlbW92ZUNvbnRyb2wNCiAgICB9KQ0KICB9DQogIGdldFBhc3RlQ29udHJvbFNpemUgKCkgew0KICAgIGNvbnN0IHVzckZybURhdGEgPSB0aGlzLnVzZXJmb3JtRGF0YVt0aGlzLnVzZXJGb3JtSWRdDQogICAgY29uc3QgcGFzdGVDb250cm9scyA9IFsuLi50aGlzLmdldFNlbGVjdGVkQ29udHJvbHNEYXRhcyFdDQogICAgY29uc3QgcGFzdGVDb250YWluZXIgPSB0aGlzLnNlbGVjdGVkQ29udHJvbHNbdGhpcy51c2VyRm9ybUlkXS5jb250YWluZXJbMF0NCiAgICBjb25zdCBsZWZ0QXJyYXkgPSBbLi4ucGFzdGVDb250cm9sc10NCiAgICBjb25zdCB0b3BBcnJheSA9IFsuLi5wYXN0ZUNvbnRyb2xzXQ0KICAgIGNvbnN0IHJpZ2h0QXJyYXkgPSBbLi4ucGFzdGVDb250cm9sc10NCiAgICBjb25zdCBib3R0b21BcnJheSA9IFsuLi5wYXN0ZUNvbnRyb2xzXQ0KICAgIGxlZnRBcnJheS5zb3J0KChhLCBiKSA9PiB7DQogICAgICByZXR1cm4gdXNyRnJtRGF0YVthXS5wcm9wZXJ0aWVzLkxlZnQhIC0gdXNyRnJtRGF0YVtiXS5wcm9wZXJ0aWVzLkxlZnQhDQogICAgfSkNCiAgICB0b3BBcnJheS5zb3J0KChhLCBiKSA9PiB7DQogICAgICByZXR1cm4gdXNyRnJtRGF0YVthXS5wcm9wZXJ0aWVzLlRvcCEgLSB1c3JGcm1EYXRhW2JdLnByb3BlcnRpZXMuVG9wIQ0KICAgIH0pDQogICAgcmlnaHRBcnJheS5zb3J0KChhLCBiKSA9PiB7DQogICAgICByZXR1cm4gKHVzckZybURhdGFbYl0ucHJvcGVydGllcy5MZWZ0ISArIHVzckZybURhdGFbYl0ucHJvcGVydGllcy5XaWR0aCEpIC0NCiAgICAgICAodXNyRnJtRGF0YVthXS5wcm9wZXJ0aWVzLkxlZnQhICsgdXNyRnJtRGF0YVthXS5wcm9wZXJ0aWVzLldpZHRoISkNCiAgICB9KQ0KICAgIGJvdHRvbUFycmF5LnNvcnQoKGEsIGIpID0+IHsNCiAgICAgIHJldHVybiAodXNyRnJtRGF0YVtiXS5wcm9wZXJ0aWVzLlRvcCEgKyB1c3JGcm1EYXRhW2JdLnByb3BlcnRpZXMuSGVpZ2h0ISkgLQ0KICAgICAgICh1c3JGcm1EYXRhW2FdLnByb3BlcnRpZXMuVG9wISArIHVzckZybURhdGFbYV0ucHJvcGVydGllcy5IZWlnaHQhKQ0KICAgIH0pDQogICAgY29uc3QgZ3JvdXBSZWN0TGVmdCA9IHVzckZybURhdGFbbGVmdEFycmF5WzBdXS5wcm9wZXJ0aWVzLkxlZnQhDQogICAgY29uc3QgZ3JvdXBSZWN0VG9wID0gdXNyRnJtRGF0YVt0b3BBcnJheVswXV0ucHJvcGVydGllcy5Ub3AhDQogICAgY29uc3QgZ3JvdXBSZWN0Qm90dG9tID0gdXNyRnJtRGF0YVtib3R0b21BcnJheVswXV0ucHJvcGVydGllcy5Ub3AhICsgdXNyRnJtRGF0YVtib3R0b21BcnJheVswXV0ucHJvcGVydGllcy5IZWlnaHQhDQogICAgY29uc3QgZ3JvdXBSZWN0UmlnaHQgPSB1c3JGcm1EYXRhW3JpZ2h0QXJyYXlbMF1dLnByb3BlcnRpZXMuTGVmdCEgKyB1c3JGcm1EYXRhW3JpZ2h0QXJyYXlbMF1dLnByb3BlcnRpZXMuV2lkdGghDQoNCiAgICBjb25zdCBkZWx0YVRvcCA9IChncm91cFJlY3RCb3R0b20gLSBncm91cFJlY3RUb3ApIC8gMg0KICAgIGNvbnN0IGRlbHRhTGVmdCA9IChncm91cFJlY3RSaWdodCAtIGdyb3VwUmVjdExlZnQpIC8gMg0KDQogICAgY29uc3QgdHlwZSA9IHRoaXMudXNlcmZvcm1EYXRhW3RoaXMudXNlckZvcm1JZF1bcGFzdGVDb250YWluZXJdLnR5cGUNCiAgICBjb25zdCBjb250YWluZXIgPSB0eXBlID09PSAnUGFnZScgPyB0aGlzLnVzZXJmb3JtRGF0YVt0aGlzLnVzZXJGb3JtSWRdW3RoaXMuZ2V0Q29udGFpbmVyTGlzdChwYXN0ZUNvbnRhaW5lcilbMF1dLnByb3BlcnRpZXMgOiB0aGlzLnVzZXJmb3JtRGF0YVt0aGlzLnVzZXJGb3JtSWRdW3Bhc3RlQ29udGFpbmVyXS5wcm9wZXJ0aWVzDQogICAgY29uc3QgY29udGFpbmVySGVpZ2h0ID0gdHlwZSA9PT0gJ1VzZXJmb3JtJyA/IGNvbnRhaW5lci5IZWlnaHQhIC0gMzcgOiBjb250YWluZXIuSGVpZ2h0IQ0KICAgIGNvbnN0IHRhcmdldFRvcCA9ICgoY29udGFpbmVySGVpZ2h0KSAvIDIpIC0gZGVsdGFUb3ANCiAgICBjb25zdCB0YXJnZXRMZWZ0ID0gKGNvbnRhaW5lci5XaWR0aCEgLyAyKSAtIGRlbHRhTGVmdA0KDQogICAgY29uc3QgZGlmZlRvcCA9IHRhcmdldFRvcCAtIHVzckZybURhdGFbdG9wQXJyYXlbMF1dLnByb3BlcnRpZXMuVG9wIQ0KICAgIGNvbnN0IGRpZmZMZWZ0ID0gdGFyZ2V0TGVmdCAtIHVzckZybURhdGFbbGVmdEFycmF5WzBdXS5wcm9wZXJ0aWVzLkxlZnQhDQoNCiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGxlZnRBcnJheS5sZW5ndGg7IGkrKykgew0KICAgICAgbGV0IGxlZnQgPSB1c3JGcm1EYXRhW2xlZnRBcnJheVtpXV0ucHJvcGVydGllcy5MZWZ0ISArIGRpZmZMZWZ0DQogICAgICBpZiAoIWlzTmFOKGxlZnQpKSB7DQogICAgICAgIHRoaXMudXBkYXRlQ29udHJvbFByb3BlcnR5KCdMZWZ0JywgTWF0aC5hYnMobGVmdCksIGxlZnRBcnJheVtpXSkNCiAgICAgIH0NCiAgICB9DQogICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0b3BBcnJheS5sZW5ndGg7IGkrKykgew0KICAgICAgbGV0IHRvcCA9IHVzckZybURhdGFbdG9wQXJyYXlbaV1dLnByb3BlcnRpZXMuVG9wISArIGRpZmZUb3ANCiAgICAgIGlmICghaXNOYU4odG9wKSkgew0KICAgICAgICB0aGlzLnVwZGF0ZUNvbnRyb2xQcm9wZXJ0eSgnVG9wJywgTWF0aC5hYnModG9wKSwgdG9wQXJyYXlbaV0pDQogICAgICB9DQogICAgfQ0KICB9DQogIC8qKg0KICAgKiBAZGVzY3JpcHRpb24gVG8gcGFzdGUgY29udHJvbHMgaW4gcmVzcGVjdGl2ZSBjb250YWluZXIgcHJlc2VudCBpbiByZXNwZWN0aXZlIHVzZXJmb3JtDQogICAqIEBmdW5jdGlvbiBwYXN0ZUNvbnRyb2wNCiAgICovDQogIHBhc3RlQ29udHJvbCAoKSB7DQogICAgaWYgKHRoaXMuY29weUNvbnRyb2xMaXN0LnR5cGUgPT09ICdjb3B5Jykgew0KICAgICAgY29uc3Qgc2VsQ29udGFpbmVyID0gdGhpcy5jb3B5Q29udHJvbExpc3QucGFyZW50SWQNCiAgICAgIGNvbnN0IHNlbFNlbGVjdGVkID0gdGhpcy5jb3B5Q29udHJvbExpc3QudGFyZ2V0SWQNCiAgICAgIGNvbnN0IHVzZXJGb3JtRGF0YSA9IHRoaXMudXNlcmZvcm1EYXRhW3RoaXMudXNlckZvcm1JZF0NCiAgICAgIGNvbnN0IHByZXNlbnRHcm91cElkOiBzdHJpbmdbXSA9IFtdDQogICAgICBjb25zdCBuZXdHcm91cElkOiBzdHJpbmdbXSA9IFtdDQogICAgICBjb25zdCBvbGRDb250cm9sSWQ6IHN0cmluZ1tdID0gW10NCiAgICAgIGNvbnN0IG5ld0NvbnRyb2xJZDogc3RyaW5nW10gPSBbXQ0KDQogICAgICBmb3IgKGNvbnN0IGtleSBpbiB0aGlzLmNvcGllZENvbnRyb2xbdGhpcy51c2VyRm9ybUlkXSkgew0KICAgICAgICBjb25zdCBjb250cm9sUHJvcCA9IHRoaXMuY29waWVkQ29udHJvbFt0aGlzLnVzZXJGb3JtSWRdW2tleV0ucHJvcGVydGllcy5Hcm91cElEDQogICAgICAgIGlmIChjb250cm9sUHJvcCAmJiAhcHJlc2VudEdyb3VwSWQuaW5jbHVkZXMoY29udHJvbFByb3ApKSB7DQogICAgICAgICAgcHJlc2VudEdyb3VwSWQucHVzaChjb250cm9sUHJvcCkNCiAgICAgICAgfQ0KICAgICAgfQ0KICAgICAgZm9yIChsZXQgaiBpbiBwcmVzZW50R3JvdXBJZCkgew0KICAgICAgICBjb25zdCBuZXdJZCA9IHRoaXMuY3JlYXRlR3JvdXBJZCgpDQogICAgICAgIG5ld0dyb3VwSWQucHVzaChuZXdJZCkNCiAgICAgICAgbGV0IGdyb3VwQXJyYXk6IHN0cmluZ1tdID0gWw0KICAgICAgICAgIC4uLnRoaXMuZ3JvdXBlZENvbnRyb2xzW3RoaXMudXNlckZvcm1JZF0hLmdyb3VwQXJyYXkhLA0KICAgICAgICAgIG5ld0lkDQogICAgICAgIF0NCiAgICAgICAgdGhpcy51cGRhdGVHcm91cCh7DQogICAgICAgICAgdXNlckZvcm1JZDogdGhpcy51c2VyRm9ybUlkLA0KICAgICAgICAgIGdyb3VwQXJyYXk6IGdyb3VwQXJyYXkhDQogICAgICAgIH0pDQogICAgICB9DQoNCiAgICAgIGNvbnN0IHJlY0NvcHlDb250cm9sID0gKGRhVGFyZ2V0OiBzdHJpbmcpID0+IHsNCiAgICAgICAgY29uc3QgZGFUYXJnZXRDb250cm9scyA9IHVzZXJGb3JtRGF0YVtkYVRhcmdldF0uY29udHJvbHMNCiAgICAgICAgaWYgKGRhVGFyZ2V0Q29udHJvbHMgJiYgZGFUYXJnZXRDb250cm9scy5sZW5ndGggPiAwKSB7DQogICAgICAgICAgZm9yIChsZXQgaSA9IDAsIGxpbWl0ID0gZGFUYXJnZXRDb250cm9scy5sZW5ndGg7IGkgPCBsaW1pdDsgaSsrKSB7DQogICAgICAgICAgICBjb25zdCBrZXkgPSBkYVRhcmdldENvbnRyb2xzW2ldDQogICAgICAgICAgICBjb25zdCBOYW1lID0gdGhpcy5uZXdQYXN0ZUNvbnRyb2xJZChrZXksIGRhVGFyZ2V0KQ0KICAgICAgICAgICAgY29uc3QgY29udHJvbElEOnwgc3RyaW5nfCB1bmRlZmluZWQgPSBgSURfJHtOYW1lfWANCiAgICAgICAgICAgIGNvbnN0IGNvbnRyb2xPYmogPSB7IC4uLnRoaXMuY29waWVkQ29udHJvbFt0aGlzLnVzZXJGb3JtSWRdW2tleV0gfQ0KICAgICAgICAgICAgbGV0IGdyb3VwSWRJbmRleCA9IC0xDQogICAgICAgICAgICBncm91cElkSW5kZXggPSBwcmVzZW50R3JvdXBJZC5maW5kSW5kZXgoKHZhbCkgPT4gdmFsID09PSBjb250cm9sT2JqLnByb3BlcnRpZXMuR3JvdXBJRCkNCiAgICAgICAgICAgIGNvbnN0IGl0ZW06IGNvbnRyb2xEYXRhID0gew0KICAgICAgICAgICAgICAuLi5jb250cm9sT2JqLA0KICAgICAgICAgICAgICBwcm9wZXJ0aWVzOiB7DQogICAgICAgICAgICAgICAgLi4uY29udHJvbE9iai5wcm9wZXJ0aWVzLA0KICAgICAgICAgICAgICAgIElEOiBjb250cm9sSUQhLA0KICAgICAgICAgICAgICAgIEdyb3VwSUQ6IGdyb3VwSWRJbmRleCAhPT0gLTEgPyBuZXdHcm91cElkW2dyb3VwSWRJbmRleF0gOiAnJywNCiAgICAgICAgICAgICAgICBOYW1lOiBOYW1lDQogICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHRoaXMucmVtb3ZlQ2hpbGRDb250cm9sKGRhVGFyZ2V0LCBrZXkpDQogICAgICAgICAgICB0aGlzLnVwZGF0ZU5ld0NvbnRyb2woZGFUYXJnZXQsIGNvbnRyb2xJRCwgaXRlbSwgZmFsc2UpDQogICAgICAgICAgICByZWNDb3B5Q29udHJvbChjb250cm9sSUQpDQogICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICB9DQoNCiAgICAgIGZvciAoY29uc3Qga2V5IG9mIHNlbFNlbGVjdGVkKSB7DQogICAgICAgIGlmICgha2V5LnN0YXJ0c1dpdGgoJ2dyb3VwJykpIHsNCiAgICAgICAgICBvbGRDb250cm9sSWQucHVzaChrZXkpDQogICAgICAgICAgY29uc3QgTmFtZSA9IHRoaXMubmV3UGFzdGVDb250cm9sSWQoa2V5LCAnJykNCiAgICAgICAgICBjb25zdCBjb250cm9sSUQ6fCBzdHJpbmd8IHVuZGVmaW5lZCA9IGBJRF8ke05hbWV9YA0KICAgICAgICAgIGNvbnN0IGNvbnRyb2xPYmogPSB7IC4uLnRoaXMuY29waWVkQ29udHJvbFt0aGlzLnVzZXJGb3JtSWRdW2tleV0gfQ0KICAgICAgICAgIG5ld0NvbnRyb2xJZC5wdXNoKGNvbnRyb2xJRCkNCiAgICAgICAgICBsZXQgZ3JvdXBJZEluZGV4ID0gLTENCiAgICAgICAgICBncm91cElkSW5kZXggPSBwcmVzZW50R3JvdXBJZC5maW5kSW5kZXgoDQogICAgICAgICAgICAodmFsKSA9PiBjb250cm9sT2JqLnByb3BlcnRpZXMuR3JvdXBJRCA9PT0gdmFsDQogICAgICAgICAgKQ0KICAgICAgICAgIGlmIChzZWxTZWxlY3RlZC5sZW5ndGggPT09IDEgJiYgdGhpcy5jb3BpZWRDb250cm9sW3RoaXMudXNlckZvcm1JZF1bc2VsU2VsZWN0ZWRbMF1dLnByb3BlcnRpZXMuR3JvdXBJRCAhPT0gJycpIHsNCiAgICAgICAgICAgIGdyb3VwSWRJbmRleCA9IC0xDQogICAgICAgICAgfQ0KICAgICAgICAgIGNvbnN0IGl0ZW06IGNvbnRyb2xEYXRhID0gew0KICAgICAgICAgICAgLi4uY29udHJvbE9iaiwNCiAgICAgICAgICAgIHByb3BlcnRpZXM6IHsNCiAgICAgICAgICAgICAgLi4uY29udHJvbE9iai5wcm9wZXJ0aWVzLA0KICAgICAgICAgICAgICBJRDogY29udHJvbElEISwNCiAgICAgICAgICAgICAgR3JvdXBJRDogZ3JvdXBJZEluZGV4ICE9PSAtMSA/IG5ld0dyb3VwSWRbZ3JvdXBJZEluZGV4XSA6ICcnLA0KICAgICAgICAgICAgICBOYW1lOiBOYW1lDQogICAgICAgICAgICB9DQogICAgICAgICAgfQ0KICAgICAgICAgIHRoaXMudXBkYXRlTmV3Q29udHJvbCh0aGlzLmNvbnRhaW5lcklkLCBjb250cm9sSUQsIGl0ZW0sIHRydWUpDQogICAgICAgICAgcmVjQ29weUNvbnRyb2woY29udHJvbElEKQ0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgIGZvciAobGV0IGN0cmxJZCBpbiB0aGlzLmNvcGllZENvbnRyb2xbdGhpcy51c2VyRm9ybUlkXSkgew0KICAgICAgICAgICAgY29uc3QgY29udHJvbFByb3AgPSB0aGlzLmNvcGllZENvbnRyb2xbdGhpcy51c2VyRm9ybUlkXVtjdHJsSWRdDQogICAgICAgICAgICAgIC5wcm9wZXJ0aWVzLkdyb3VwSUQNCiAgICAgICAgICAgIGlmIChjb250cm9sUHJvcCkgew0KICAgICAgICAgICAgICBpZiAoY29udHJvbFByb3AgPT09IGtleSkgew0KICAgICAgICAgICAgICAgIGNvbnN0IE5hbWUgPSB0aGlzLm5ld1Bhc3RlQ29udHJvbElkKGN0cmxJZCwgJycpDQogICAgICAgICAgICAgICAgY29uc3QgY29udHJvbElEOnwgc3RyaW5nfCB1bmRlZmluZWQgPSBgSURfJHtOYW1lfWANCiAgICAgICAgICAgICAgICBjb25zdCBjb250cm9sT2JqID0gdGhpcy5jb3BpZWRDb250cm9sW3RoaXMudXNlckZvcm1JZF1bY3RybElkXQ0KDQogICAgICAgICAgICAgICAgbGV0IGdyb3VwSWRJbmRleCA9IC0xDQogICAgICAgICAgICAgICAgZ3JvdXBJZEluZGV4ID0gcHJlc2VudEdyb3VwSWQuZmluZEluZGV4KA0KICAgICAgICAgICAgICAgICAgKHZhbCkgPT4gY29udHJvbE9iai5wcm9wZXJ0aWVzLkdyb3VwSUQgPT09IHZhbA0KICAgICAgICAgICAgICAgICkNCiAgICAgICAgICAgICAgICBjb25zdCBpdGVtOiBjb250cm9sRGF0YSA9IHsNCiAgICAgICAgICAgICAgICAgIC4uLmNvbnRyb2xPYmosDQogICAgICAgICAgICAgICAgICBwcm9wZXJ0aWVzOiB7DQogICAgICAgICAgICAgICAgICAgIC4uLmNvbnRyb2xPYmoucHJvcGVydGllcywNCiAgICAgICAgICAgICAgICAgICAgSUQ6IGNvbnRyb2xJRCEsDQogICAgICAgICAgICAgICAgICAgIEdyb3VwSUQ6IGdyb3VwSWRJbmRleCAhPT0gLTEgPyBuZXdHcm91cElkW2dyb3VwSWRJbmRleF0gOiAnJywNCiAgICAgICAgICAgICAgICAgICAgTmFtZTogTmFtZQ0KICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB0aGlzLnVwZGF0ZU5ld0NvbnRyb2wodGhpcy5jb250YWluZXJJZCwgY29udHJvbElELCBpdGVtLCB0cnVlKQ0KICAgICAgICAgICAgICAgIHJlY0NvcHlDb250cm9sKGNvbnRyb2xJRCkNCiAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgfQ0KICAgICAgZm9yIChsZXQgaiBvZiBuZXdHcm91cElkKSB7DQogICAgICAgIHRoaXMuY3JlYXRlR3JvdXAoaikNCiAgICAgIH0NCiAgICAgIGNvbnN0IG5ld1NlbGVjdGVkOiBzdHJpbmdbXSA9IFtdDQogICAgICBmb3IgKGNvbnN0IGNvbnRyb2wgb2Ygc2VsU2VsZWN0ZWQpIHsNCiAgICAgICAgaWYgKGNvbnRyb2wuc3RhcnRzV2l0aCgnZ3JvdXAnKSkgew0KICAgICAgICAgIGNvbnN0IGluZGV4ID0gcHJlc2VudEdyb3VwSWQuZmluZEluZGV4KCh2YWwpID0+IHZhbCA9PT0gY29udHJvbCkNCiAgICAgICAgICBuZXdTZWxlY3RlZC5wdXNoKG5ld0dyb3VwSWRbaW5kZXhdKQ0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgIGNvbnN0IGluZGV4ID0gb2xkQ29udHJvbElkLmZpbmRJbmRleCgodmFsKSA9PiB2YWwgPT09IGNvbnRyb2wpDQogICAgICAgICAgbmV3U2VsZWN0ZWQucHVzaChuZXdDb250cm9sSWRbaW5kZXhdKQ0KICAgICAgICB9DQogICAgICB9DQogICAgICB0aGlzLnNlbGVjdENvbnRyb2woew0KICAgICAgICB1c2VyRm9ybUlkOiB0aGlzLnVzZXJGb3JtSWQsDQogICAgICAgIHNlbGVjdDogew0KICAgICAgICAgIGNvbnRhaW5lcjogdGhpcy5nZXRDb250YWluZXJMaXN0KG5ld1NlbGVjdGVkWzBdKSwNCiAgICAgICAgICBzZWxlY3RlZDogbmV3U2VsZWN0ZWQNCiAgICAgICAgfQ0KICAgICAgfSkNCiAgICB9IGVsc2UgaWYgKHRoaXMuY29weUNvbnRyb2xMaXN0LnR5cGUgPT09ICdjdXQnKSB7DQogICAgICBjb25zdCBzZWxDb250YWluZXIgPSB0aGlzLmNvcHlDb250cm9sTGlzdC5wYXJlbnRJZA0KICAgICAgY29uc3Qgc2VsU2VsZWN0ZWQgPSB0aGlzLmNvcHlDb250cm9sTGlzdC50YXJnZXRJZA0KICAgICAgY29uc3QgdXNlckZvcm1EYXRhID0gdGhpcy5jb3BpZWRDb250cm9sW3RoaXMudXNlckZvcm1JZF0NCiAgICAgIGNvbnN0IHJlY0NvcHlDb250cm9sID0gKGRhVGFyZ2V0OiBzdHJpbmcpID0+IHsNCiAgICAgICAgY29uc3QgZGFUYXJnZXRDb250cm9scyA9IHVzZXJGb3JtRGF0YVtkYVRhcmdldF0uY29udHJvbHMNCiAgICAgICAgaWYgKGRhVGFyZ2V0Q29udHJvbHMubGVuZ3RoID4gMCkgew0KICAgICAgICAgIGZvciAobGV0IGkgPSAwLCBsaW1pdCA9IGRhVGFyZ2V0Q29udHJvbHMubGVuZ3RoOyBpIDwgbGltaXQ7IGkrKykgew0KICAgICAgICAgICAgY29uc3Qga2V5ID0gZGFUYXJnZXRDb250cm9sc1tpXQ0KICAgICAgICAgICAgY29uc3QgY29udHJvbE9iaiA9IEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkodGhpcy5jb3BpZWRDb250cm9sW3RoaXMudXNlckZvcm1JZF1ba2V5XSkpDQogICAgICAgICAgICBjb25zdCBpdGVtOiBjb250cm9sRGF0YSA9IHsNCiAgICAgICAgICAgICAgLi4uY29udHJvbE9iag0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgdGhpcy5yZW1vdmVDaGlsZENvbnRyb2woZGFUYXJnZXQsIGtleSkNCiAgICAgICAgICAgIHRoaXMudXBkYXRlTmV3Q29udHJvbChkYVRhcmdldCwga2V5LCBpdGVtLCBmYWxzZSkNCiAgICAgICAgICAgIHJlY0NvcHlDb250cm9sKGtleSkNCiAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgIH0NCiAgICAgIGZvciAoY29uc3Qga2V5IG9mIHNlbFNlbGVjdGVkKSB7DQogICAgICAgIGlmICgha2V5LnN0YXJ0c1dpdGgoJ2dyb3VwJykpIHsNCiAgICAgICAgICBjb25zdCBjb250cm9sT2JqID0gSlNPTi5wYXJzZSgNCiAgICAgICAgICAgIEpTT04uc3RyaW5naWZ5KHRoaXMuY29waWVkQ29udHJvbFt0aGlzLnVzZXJGb3JtSWRdW2tleV0pDQogICAgICAgICAgKQ0KICAgICAgICAgIGlmIChzZWxTZWxlY3RlZC5sZW5ndGggPT09IDEgJiYgdXNlckZvcm1EYXRhW3NlbFNlbGVjdGVkWzBdXS5wcm9wZXJ0aWVzLkdyb3VwSUQhICE9PSAnJykgew0KICAgICAgICAgICAgY29udHJvbE9iai5wcm9wZXJ0aWVzLkdyb3VwSUQgPSAnJw0KICAgICAgICAgIH0NCiAgICAgICAgICBjb25zdCBpdGVtOiBjb250cm9sRGF0YSA9IHsNCiAgICAgICAgICAgIC4uLmNvbnRyb2xPYmoNCiAgICAgICAgICB9DQogICAgICAgICAgdGhpcy51cGRhdGVOZXdDb250cm9sKHRoaXMuY29udGFpbmVySWQsIGtleSwgaXRlbSwgdHJ1ZSkNCiAgICAgICAgICByZWNDb3B5Q29udHJvbChrZXkpDQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgZm9yIChsZXQgY3RybElkIGluIHVzZXJGb3JtRGF0YSkgew0KICAgICAgICAgICAgY29uc3QgY29udHJvbFByb3AgPSB1c2VyRm9ybURhdGFbY3RybElkXS5wcm9wZXJ0aWVzLkdyb3VwSUQNCiAgICAgICAgICAgIGlmIChjb250cm9sUHJvcCkgew0KICAgICAgICAgICAgICBpZiAoY29udHJvbFByb3AgPT09IGtleSkgew0KICAgICAgICAgICAgICAgIGNvbnN0IGNvbnRyb2xPYmogPSBKU09OLnBhcnNlKA0KICAgICAgICAgICAgICAgICAgSlNPTi5zdHJpbmdpZnkodGhpcy5jb3BpZWRDb250cm9sW3RoaXMudXNlckZvcm1JZF1bY3RybElkXSkNCiAgICAgICAgICAgICAgICApDQogICAgICAgICAgICAgICAgY29uc3QgaXRlbTogY29udHJvbERhdGEgPSB7DQogICAgICAgICAgICAgICAgICAuLi5jb250cm9sT2JqDQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIHRoaXMudXBkYXRlTmV3Q29udHJvbCh0aGlzLmNvbnRhaW5lcklkLCBjdHJsSWQsIGl0ZW0sIHRydWUpDQogICAgICAgICAgICAgICAgcmVjQ29weUNvbnRyb2woY3RybElkKQ0KICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICB9DQogICAgICB0aGlzLnNlbGVjdENvbnRyb2woew0KICAgICAgICB1c2VyRm9ybUlkOiB0aGlzLnVzZXJGb3JtSWQsDQogICAgICAgIHNlbGVjdDogew0KICAgICAgICAgIGNvbnRhaW5lcjogdGhpcy5nZXRDb250YWluZXJMaXN0KHNlbFNlbGVjdGVkWzBdKSwNCiAgICAgICAgICBzZWxlY3RlZDogc2VsU2VsZWN0ZWQNCiAgICAgICAgfQ0KICAgICAgfSkNCiAgICAgIHRoaXMudXBkYXRlQ29weUNvbnRyb2xMaXN0KHsNCiAgICAgICAgdXNlckZvcm1JZDogdGhpcy51c2VyRm9ybUlkLA0KICAgICAgICBwYXJlbnRJZDogdGhpcy5jb250YWluZXJJZCwNCiAgICAgICAgdGFyZ2V0SWQ6IHNlbFNlbGVjdGVkLA0KICAgICAgICB0eXBlOiAnY29weScNCiAgICAgIH0pDQogICAgfQ0KICAgIHRoaXMuZ2V0UGFzdGVDb250cm9sU2l6ZSgpDQogICAgY29uc3Qgc2VsU2VsZWN0ZWQgPSB0aGlzLnNlbGVjdGVkQ29udHJvbHNbdGhpcy51c2VyRm9ybUlkXS5zZWxlY3RlZA0KICAgIGZvciAoY29uc3QgY29udHJvbCBvZiBzZWxTZWxlY3RlZCkgew0KICAgICAgaWYgKGNvbnRyb2wuc3RhcnRzV2l0aCgnZ3JvdXAnKSkgew0KICAgICAgICB0aGlzLmNyZWF0ZUdyb3VwKGNvbnRyb2wpDQogICAgICB9DQogICAgfQ0KICB9DQoNCiAgLyoqDQogICAqIEBkZXNjcmlwdGlvbiBUbyBkZWxldGUgY29udHJvbHMgaW4gcmVzcGVjdGl2ZSBjb250YWluZXIgcHJlc2VudCBpbiByZXNwZWN0aXZlIHVzZXJmb3JtDQogICAqIEBmdW5jdGlvbiBjbGlja0RlbGV0ZQ0KICAgKi8NCiAgY2xpY2tEZWxldGUgKCkgew0KICAgIGNvbnN0IHNlbENvbnRyb2wgPSBbXQ0KICAgIGNvbnN0IHVzZXJEYXRhID0gdGhpcy51c2VyZm9ybURhdGFbdGhpcy51c2VyRm9ybUlkXQ0KICAgIGNvbnN0IHNlbGVjdGVkID0gdGhpcy5zZWxlY3RlZENvbnRyb2xzW3RoaXMudXNlckZvcm1JZF0uc2VsZWN0ZWQNCiAgICBjb25zdCBzZWxDb250YWluZXIgPSB0aGlzLnNlbGVjdGVkQ29udHJvbHNbdGhpcy51c2VyRm9ybUlkXS5jb250YWluZXINCiAgICBjb25zdCBmaWx0ZXJDb250cm9scyA9IFtdDQogICAgY29uc3QgY29udHJvbHMgPSB0aGlzLnVzZXJmb3JtRGF0YVt0aGlzLnVzZXJGb3JtSWRdW3RoaXMuc2VsZWN0ZWRDb250cm9sc1t0aGlzLnVzZXJGb3JtSWRdLmNvbnRhaW5lclswXV0uY29udHJvbHMNCiAgICBmb3IgKGNvbnN0IGNvbnRyb2wgb2Ygc2VsZWN0ZWQpIHsNCiAgICAgIGlmICghY29udHJvbC5zdGFydHNXaXRoKCdJRF9VU0VSRk9STScpKSB7DQogICAgICAgIGlmIChjb250cm9sLnN0YXJ0c1dpdGgoJ2dyb3VwJykpIHsNCiAgICAgICAgICBmb3IgKGNvbnN0IGtleSBpbiB1c2VyRGF0YSkgew0KICAgICAgICAgICAgaWYgKA0KICAgICAgICAgICAgICB1c2VyRGF0YVtrZXldLnByb3BlcnRpZXMuR3JvdXBJRCA9PT0gY29udHJvbA0KICAgICAgICAgICAgKSB7DQogICAgICAgICAgICAgIHNlbENvbnRyb2wucHVzaChrZXkpDQogICAgICAgICAgICB9DQogICAgICAgICAgfQ0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgIHNlbENvbnRyb2wucHVzaChjb250cm9sKQ0KICAgICAgICB9DQogICAgICB9DQogICAgfQ0KICAgIGlmIChzZWxlY3RlZC5sZW5ndGggPT09IDEgJiYgIXNlbGVjdGVkWzBdLnN0YXJ0c1dpdGgoJ2dyb3VwJykgJiYgdGhpcy51c2VyZm9ybURhdGFbdGhpcy51c2VyRm9ybUlkXVtzZWxlY3RlZFswXV0ucHJvcGVydGllcy5Hcm91cElEICE9PSAnJykgew0KICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCBjb250cm9scy5sZW5ndGg7IGorKykgew0KICAgICAgICBpZiAodXNlckRhdGFbY29udHJvbHNbal1dLnByb3BlcnRpZXMuR3JvdXBJRCA9PT0gdXNlckRhdGFbc2VsZWN0ZWRbMF1dLnByb3BlcnRpZXMuR3JvdXBJRCkgew0KICAgICAgICAgIGZpbHRlckNvbnRyb2xzLnB1c2goY29udHJvbHNbal0pDQogICAgICAgIH0NCiAgICAgIH0NCiAgICAgIGlmIChmaWx0ZXJDb250cm9scy5sZW5ndGggPT09IDIpIHsNCiAgICAgICAgY29uc3QgY3VyU2VsZWN0ID0gZmlsdGVyQ29udHJvbHNbMF0gPT09IHNlbGVjdGVkWzBdID8gZmlsdGVyQ29udHJvbHNbMV0gOiBmaWx0ZXJDb250cm9sc1swXQ0KICAgICAgICBjb25zdCBzZWxHcm91cElkID0gdXNlckRhdGFbc2VsZWN0ZWRbMF1dLnByb3BlcnRpZXMuR3JvdXBJRA0KICAgICAgICB0aGlzLnVwZGF0ZUNvbnRyb2xQcm9wZXJ0eSgnR3JvdXBJRCcsICcnLCBjdXJTZWxlY3QpDQogICAgICB9DQogICAgfQ0KICAgIGZvciAobGV0IGkgPSAwOyBpIDwgc2VsQ29udHJvbC5sZW5ndGg7IGkrKykgew0KICAgICAgY29uc3QgY29udHJvbElkID0gdXNlckRhdGFbc2VsQ29udHJvbFtpXV0udHlwZSA9PT0gJ1BhZ2UnID8gc2VsQ29udGFpbmVyWzBdIDogc2VsQ29udHJvbFtpXQ0KICAgICAgdGhpcy5kZWxldGVaSW5kZXgoY29udHJvbElkKQ0KICAgICAgdGhpcy5kZWxldGVUYWJJbmRleChjb250cm9sSWQpDQogICAgICB0aGlzLmRlbGV0ZUNvbnRyb2woew0KICAgICAgICB1c2VyRm9ybUlkOiB0aGlzLnVzZXJGb3JtSWQsDQogICAgICAgIHBhcmVudElkOiB0aGlzLmdldENvbnRhaW5lckxpc3QoY29udHJvbElkKVswXSwNCiAgICAgICAgdGFyZ2V0SWQ6IGNvbnRyb2xJZA0KICAgICAgfSkNCiAgICB9DQoNCiAgICB0aGlzLnNlbGVjdENvbnRyb2woew0KICAgICAgdXNlckZvcm1JZDogdGhpcy51c2VyRm9ybUlkLA0KICAgICAgc2VsZWN0OiB7DQogICAgICAgIGNvbnRhaW5lcjogdXNlckRhdGFbc2VsQ29udGFpbmVyWzBdXS50eXBlID09PSAnTXVsdGlQYWdlJyA/IHRoaXMuZ2V0Q29udGFpbmVyTGlzdChzZWxDb250YWluZXJbMF0pIDogc2VsQ29udGFpbmVyLA0KICAgICAgICBzZWxlY3RlZDogdXNlckRhdGFbc2VsQ29udGFpbmVyWzBdXS50eXBlID09PSAnTXVsdGlQYWdlJyA/IFt0aGlzLmdldENvbnRhaW5lckxpc3Qoc2VsQ29udGFpbmVyWzBdKVswXV0gOiBbc2VsQ29udGFpbmVyWzBdXQ0KICAgICAgfQ0KICAgIH0pDQogICAgRXZlbnRCdXMuJGVtaXQoJ2ZvY3VzVXNlckZvcm0nKQ0KICB9DQogIHVwZGF0ZUFjdGlvbiAoZXZlbnQ6IEtleWJvYXJkRXZlbnQpIHsNCiAgICBsZXQgY29udHJvbEFjdGlvbk5hbWUgPSAnJw0KICAgIGlmIChldmVudC5jdHJsS2V5ICYmIGV2ZW50LmNvZGUgPT09ICdLZXlBJykgew0KICAgICAgY29udHJvbEFjdGlvbk5hbWUgPSAnSURfU0VMRUNUQUxMJw0KICAgIH0gZWxzZSBpZiAoZXZlbnQuY3RybEtleSAmJiBldmVudC5jb2RlID09PSAnS2V5QycpIHsNCiAgICAgIGlmICgNCiAgICAgICAgdGhpcy5zZWxlY3RlZENvbnRyb2xzW3RoaXMudXNlckZvcm1JZF0uc2VsZWN0ZWRbMF0gIT09IHRoaXMudXNlckZvcm1JZA0KICAgICAgKSB7DQogICAgICAgIGNvbnRyb2xBY3Rpb25OYW1lID0gJ0lEX0NPUFknDQogICAgICB9DQogICAgfSBlbHNlIGlmIChldmVudC5rZXlDb2RlID09PSA0Nikgew0KICAgICAgY29udHJvbEFjdGlvbk5hbWUgPSAnSURfREVMRVRFJw0KICAgIH0gZWxzZSBpZiAoZXZlbnQuY3RybEtleSAmJiBldmVudC5jb2RlID09PSAnS2V5VicpIHsNCiAgICAgIGNvbnRyb2xBY3Rpb25OYW1lID0gJ0lEX1BBU1RFJw0KICAgIH0gZWxzZSBpZiAoZXZlbnQua2V5Q29kZSAmJiBldmVudC5jb2RlID09PSAnS2V5WCcpIHsNCiAgICAgIGNvbnRyb2xBY3Rpb25OYW1lID0gJ0lEX0NVVCcNCiAgICB9DQogICAgdGhpcy5jb250cm9sQWN0aW9uKGV2ZW50LCBjb250cm9sQWN0aW9uTmFtZSwgJycpDQogIH0NCiAgdXBkYXRlUHJvcFZhbCAocHJvcE5hbWU6IHN0cmluZywgcHJvcFZhbHVlOiBudW1iZXIpIHsNCiAgICBjb25zdCBjdHJsU2VsID0gdGhpcy5zZWxlY3RlZENvbnRyb2xzW3RoaXMudXNlckZvcm1JZF0uc2VsZWN0ZWQNCiAgICBjb25zdCB1c3JGcm1EYXRhID0gdGhpcy51c2VyZm9ybURhdGFbdGhpcy51c2VyRm9ybUlkXQ0KICAgIGZvciAobGV0IGluZGV4ID0gMTsgaW5kZXggPCBjdHJsU2VsLmxlbmd0aDsgaW5kZXgrKykgew0KICAgICAgaWYgKCFjdHJsU2VsW2luZGV4XS5zdGFydHNXaXRoKCdncm91cCcpKSB7DQogICAgICAgIGNvbnN0IGN1clByb3AgPSB1c3JGcm1EYXRhW2N0cmxTZWxbaW5kZXhdXS5wcm9wZXJ0aWVzDQogICAgICAgIGlmIChwcm9wTmFtZSA9PT0gJ3NlbFJpZ2h0Jykgew0KICAgICAgICAgIGNvbnN0IGN1clJpZ2h0ID0gY3VyUHJvcC5XaWR0aCEgKyBjdXJQcm9wLkxlZnQhDQogICAgICAgICAgY29uc3QgdmFsdWUgPSBjdXJQcm9wLkxlZnQhICsgKHByb3BWYWx1ZSAtIGN1clJpZ2h0KQ0KICAgICAgICAgIHRoaXMudXBkYXRlQ29udHJvbFByb3BlcnR5KCdMZWZ0JywgdmFsdWUsIGN0cmxTZWxbaW5kZXhdKQ0KICAgICAgICB9IGVsc2UgaWYgKHByb3BOYW1lID09PSAnc2VsQm90dG9tJykgew0KICAgICAgICAgIGNvbnN0IGN1ckJvdHRvbSA9IGN1clByb3AuSGVpZ2h0ISArIGN1clByb3AuVG9wIQ0KICAgICAgICAgIGNvbnN0IHZhbHVlID0gY3VyUHJvcC5Ub3AhICsgKHByb3BWYWx1ZSAtIGN1ckJvdHRvbSkNCiAgICAgICAgICB0aGlzLnVwZGF0ZUNvbnRyb2xQcm9wZXJ0eSgnVG9wJywgdmFsdWUsIGN0cmxTZWxbaW5kZXhdKQ0KICAgICAgICB9DQogICAgICAgIGlmIChwcm9wTmFtZSA9PT0gJ3NlbENlbnRlcicpIHsNCiAgICAgICAgICBjb25zdCBjdXJDZW50ZXIgPSBjdXJQcm9wLldpZHRoISAvIDINCiAgICAgICAgICBjb25zdCB2YWx1ZSA9IHByb3BWYWx1ZSAtIGN1ckNlbnRlcg0KICAgICAgICAgIHRoaXMudXBkYXRlQ29udHJvbFByb3BlcnR5KCdMZWZ0JywgdmFsdWUsIGN0cmxTZWxbaW5kZXhdKQ0KICAgICAgICB9DQogICAgICAgIGlmIChwcm9wTmFtZSA9PT0gJ3NlbE1pZGRsZScpIHsNCiAgICAgICAgICBjb25zdCBjdXJNaWRkbGUgPSBjdXJQcm9wLkhlaWdodCEgLyAyDQogICAgICAgICAgY29uc3QgdmFsdWUgPSBwcm9wVmFsdWUgLSBjdXJNaWRkbGUNCiAgICAgICAgICB0aGlzLnVwZGF0ZUNvbnRyb2xQcm9wZXJ0eSgnVG9wJywgdmFsdWUsIGN0cmxTZWxbaW5kZXhdKQ0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgIGNvbnN0IHByb3BlcnR5bmFtZToga2V5b2YgY29udHJvbFByb3BlcnRpZXMgPSBwcm9wTmFtZSBhcyBrZXlvZiBjb250cm9sUHJvcGVydGllcw0KICAgICAgICAgIHRoaXMudXBkYXRlQ29udHJvbFByb3BlcnR5KHByb3BlcnR5bmFtZSwgcHJvcFZhbHVlLCBjdHJsU2VsW2luZGV4XSkNCiAgICAgICAgfQ0KICAgICAgfSBlbHNlIHsNCiAgICAgICAgY29uc3QgZ3JvdXBJbmRleDogbnVtYmVyID0gdGhpcy5ncm91cFN0eWxlQXJyYXkuZmluZEluZGV4KHZhbCA9PiB2YWwuZ3JvdXBOYW1lID09PSBjdHJsU2VsW2luZGV4XSkNCiAgICAgICAgY29uc3QgY3VyUHJvcCA9IHRoaXMuZ3JvdXBTdHlsZUFycmF5W2dyb3VwSW5kZXhdDQogICAgICAgIGNvbnN0IGxlZnQgPSBwYXJzZUludChjdXJQcm9wLmxlZnQhKQ0KICAgICAgICBjb25zdCB0b3AgPSBwYXJzZUludChjdXJQcm9wLnRvcCEpDQogICAgICAgIGNvbnN0IHdpZHRoID0gcGFyc2VJbnQoY3VyUHJvcC53aWR0aCEpDQogICAgICAgIGNvbnN0IGhlaWdodCA9IHBhcnNlSW50KGN1clByb3AuaGVpZ2h0ISkNCiAgICAgICAgbGV0IHZhbHVlID0gLTENCiAgICAgICAgaWYgKHByb3BOYW1lID09PSAnc2VsUmlnaHQnKSB7DQogICAgICAgICAgdmFsdWUgPSBsZWZ0ISArIChwcm9wVmFsdWUgLSAod2lkdGghICsgbGVmdCEpKQ0KICAgICAgICAgIEV2ZW50QnVzLiRlbWl0KCd1cGRhc3RlR3JvdXBTaXplJywgJ0xlZnQnLCB2YWx1ZSwgZ3JvdXBJbmRleCkNCiAgICAgICAgfSBlbHNlIGlmIChwcm9wTmFtZSA9PT0gJ3NlbEJvdHRvbScpIHsNCiAgICAgICAgICB2YWx1ZSA9IHRvcCEgKyAocHJvcFZhbHVlIC0gKGhlaWdodCArIHRvcCkpDQogICAgICAgICAgRXZlbnRCdXMuJGVtaXQoJ3VwZGFzdGVHcm91cFNpemUnLCAnVG9wJywgdmFsdWUsIGdyb3VwSW5kZXgpDQogICAgICAgIH0NCiAgICAgICAgaWYgKHByb3BOYW1lID09PSAnc2VsQ2VudGVyJykgew0KICAgICAgICAgIHZhbHVlID0gcHJvcFZhbHVlIC0gKHdpZHRoISAvIDIpDQogICAgICAgICAgRXZlbnRCdXMuJGVtaXQoJ3VwZGFzdGVHcm91cFNpemUnLCAnTGVmdCcsIHZhbHVlLCBncm91cEluZGV4KQ0KICAgICAgICB9DQogICAgICAgIGlmIChwcm9wTmFtZSA9PT0gJ3NlbE1pZGRsZScpIHsNCiAgICAgICAgICB2YWx1ZSA9IHByb3BWYWx1ZSAtIGhlaWdodCEgLyAyDQogICAgICAgICAgRXZlbnRCdXMuJGVtaXQoJ3VwZGFzdGVHcm91cFNpemUnLCAnVG9wJywgdmFsdWUsIGdyb3VwSW5kZXgpDQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgY29uc3QgcHJvcGVydHluYW1lOiBrZXlvZiBjb250cm9sUHJvcGVydGllcyA9IHByb3BOYW1lIGFzIGtleW9mIGNvbnRyb2xQcm9wZXJ0aWVzDQogICAgICAgICAgRXZlbnRCdXMuJGVtaXQoJ3VwZGFzdGVHcm91cFNpemUnLCBwcm9wZXJ0eW5hbWUsIHByb3BWYWx1ZSwgZ3JvdXBJbmRleCkNCiAgICAgICAgfQ0KICAgICAgfQ0KICAgIH0NCiAgfQ0KICBjb250cm9sQWxpZ25NZW50IChzdWJWYWw6IHN0cmluZykgew0KICAgIGNvbnN0IG1haW5TZWwgPSB0aGlzLnNlbGVjdGVkQ29udHJvbHNbdGhpcy51c2VyRm9ybUlkXS5zZWxlY3RlZFswXQ0KICAgIGNvbnN0IGlzR3JvdXAgPSBtYWluU2VsLnN0YXJ0c1dpdGgoJ2dyb3VwJykNCiAgICBjb25zdCB1c3JGcm1EYXRhID0gdGhpcy51c2VyZm9ybURhdGFbdGhpcy51c2VyRm9ybUlkXQ0KICAgIGNvbnN0IGN0cmxQcm9wID0gIWlzR3JvdXAgJiYgdXNyRnJtRGF0YVttYWluU2VsXS5wcm9wZXJ0aWVzDQogICAgY29uc3QgZ3JvdXBJbmRleDogbnVtYmVyID0gdGhpcy5ncm91cFN0eWxlQXJyYXkuZmluZEluZGV4KHZhbCA9PiB2YWwuZ3JvdXBOYW1lID09PSBtYWluU2VsKQ0KICAgIGNvbnN0IG5ld09iamVjdCA9IHsNCiAgICAgIExlZnQ6IGlzR3JvdXAgJiYgZ3JvdXBJbmRleCAhPT0gLTEgPyBwYXJzZUludCh0aGlzLmdyb3VwU3R5bGVBcnJheVtncm91cEluZGV4XS5sZWZ0ISkgOiBjdHJsUHJvcCA/IGN0cmxQcm9wLkxlZnQhIDogMCwNCiAgICAgIFRvcDogaXNHcm91cCAmJiBncm91cEluZGV4ICE9PSAtMSA/IHBhcnNlSW50KHRoaXMuZ3JvdXBTdHlsZUFycmF5W2dyb3VwSW5kZXhdLnRvcCEpIDogY3RybFByb3AgPyBjdHJsUHJvcC5Ub3AhIDogMCwNCiAgICAgIFdpZHRoOiBpc0dyb3VwICYmIGdyb3VwSW5kZXggIT09IC0xID8gcGFyc2VJbnQodGhpcy5ncm91cFN0eWxlQXJyYXlbZ3JvdXBJbmRleF0ud2lkdGghKSA6IGN0cmxQcm9wID8gY3RybFByb3AuV2lkdGghIDogMCwNCiAgICAgIEhlaWdodDogaXNHcm91cCAmJiBncm91cEluZGV4ICE9PSAtMSA/IHBhcnNlSW50KHRoaXMuZ3JvdXBTdHlsZUFycmF5W2dyb3VwSW5kZXhdLmhlaWdodCEpIDogY3RybFByb3AgPyBjdHJsUHJvcC5IZWlnaHQhIDogMA0KICAgIH0NCiAgICBpZiAoc3ViVmFsID09PSAnSURfQUxJR05MRUZUJykgew0KICAgICAgdGhpcy51cGRhdGVQcm9wVmFsKCdMZWZ0JywgbmV3T2JqZWN0LkxlZnQhKQ0KICAgIH0gZWxzZSBpZiAoc3ViVmFsID09PSAnSURfQUxJR05UT1AnKSB7DQogICAgICB0aGlzLnVwZGF0ZVByb3BWYWwoJ1RvcCcsIG5ld09iamVjdC5Ub3AhKQ0KICAgIH0gZWxzZSBpZiAoc3ViVmFsID09PSAnSURfQUxJR05SSUdIVCcpIHsNCiAgICAgIGNvbnN0IHNlbFJpZ2h0ID0gbmV3T2JqZWN0LldpZHRoISArIG5ld09iamVjdC5MZWZ0IQ0KICAgICAgdGhpcy51cGRhdGVQcm9wVmFsKCdzZWxSaWdodCcsIHNlbFJpZ2h0KQ0KICAgIH0gZWxzZSBpZiAoc3ViVmFsID09PSAnSURfQUxJR05CT1RUT00nKSB7DQogICAgICBjb25zdCBzZWxCb3R0b20gPSBuZXdPYmplY3QuSGVpZ2h0ISArIG5ld09iamVjdC5Ub3AhDQogICAgICB0aGlzLnVwZGF0ZVByb3BWYWwoJ3NlbEJvdHRvbScsIHNlbEJvdHRvbSkNCiAgICB9IGVsc2UgaWYgKHN1YlZhbCA9PT0gJ0lEX0FMSUdOQ0VOVEVSJykgew0KICAgICAgY29uc3Qgc2VsQ2VudGVyID0gbmV3T2JqZWN0LkxlZnQhICsgbmV3T2JqZWN0LldpZHRoISAvIDINCiAgICAgIHRoaXMudXBkYXRlUHJvcFZhbCgnc2VsQ2VudGVyJywgc2VsQ2VudGVyKQ0KICAgIH0gZWxzZSBpZiAoc3ViVmFsID09PSAnSURfQUxJR05NSURETEUnKSB7DQogICAgICBjb25zdCBzZWxNaWRkbGUgPSBuZXdPYmplY3QuVG9wISArIG5ld09iamVjdC5IZWlnaHQhIC8gMg0KICAgICAgdGhpcy51cGRhdGVQcm9wVmFsKCdzZWxNaWRkbGUnLCBzZWxNaWRkbGUpDQogICAgfSBlbHNlIGlmIChzdWJWYWwgPT09ICdJRF9XSURUSCcpIHsNCiAgICAgIHRoaXMudXBkYXRlUHJvcFZhbCgnV2lkdGgnLCBuZXdPYmplY3QuV2lkdGghKQ0KICAgIH0gZWxzZSBpZiAoc3ViVmFsID09PSAnSURfSEVJR0hUJykgew0KICAgICAgdGhpcy51cGRhdGVQcm9wVmFsKCdIZWlnaHQnLCBuZXdPYmplY3QuSGVpZ2h0ISkNCiAgICB9IGVsc2UgaWYgKHN1YlZhbCA9PT0gJ0lEX0JPVEgnKSB7DQogICAgICB0aGlzLnVwZGF0ZVByb3BWYWwoJ0hlaWdodCcsIG5ld09iamVjdC5IZWlnaHQhKQ0KICAgICAgdGhpcy51cGRhdGVQcm9wVmFsKCdXaWR0aCcsIG5ld09iamVjdC5XaWR0aCEpDQogICAgfQ0KICB9DQoNCiAgY29udHJvbERpc2FibGUgKGV2ZW50OiBNb3VzZUV2ZW50KSB7DQogICAgZXZlbnQucHJldmVudERlZmF1bHQoKQ0KICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpDQogIH0NCn0NCg=="},{"version":3,"sources":["index.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA4EA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA","file":"index.vue","sourceRoot":"src/FormDesigner/components/atoms/FDContextMenu","sourcesContent":["<template>\r\n  <div>\r\n    <div class=\"outercontext-div\">\r\n      <div class=\"wrapper-context\" v-for=\"(value, i) in values\" :key=\"i\">\r\n        <button\r\n          class=\"wrapper1-context\"\r\n          v-if=\"value.values.length === 0\"\r\n          :style=\"{\r\n            border: value.text === 'none' ? '0.3px solid white' : '',\r\n            background: value.text === 'none' ? 'white' : '',\r\n            height: value.text === 'none' ? '4px' : '',\r\n            'padding-top': value.text === 'none' ? '0px' : '',\r\n            outline: value.text === 'none' ? 'none' : '',\r\n          }\"\r\n          @mousedown.stop=\"value.disabled === false ? controlAction($event,value.id) : controlDisable($event)\"\r\n        >\r\n          <div>\r\n            <FDSVGImage v-if=\"value.icon\" :name=\"value.icon\" />\r\n          </div>\r\n          <span v-if=\"value.text === 'none'\">\r\n            <hr />\r\n          </span>\r\n          <span\r\n            v-else\r\n            class=\"set-context\"\r\n            v-html=\"value.text\"\r\n            :style=\"{ opacity: value.disabled ? 0.5 : 1 }\"\r\n            >{{ value.text }}\r\n          </span>\r\n        </button>\r\n        <button class=\"wrapper1-context wrapper21\" v-else>\r\n          <div></div>\r\n          <ul class=\"set-context top-level-menu\">\r\n            <li>\r\n              <a href=\"#\" v-html=\"value.text\"  @mousedown.prevent.stop>{{ value.text }}</a>\r\n              <ul class=\"third-level-menu\">\r\n                <li\r\n                  class=\"wrapper1-context\"\r\n                  v-for=\"(subVal, i) in value.values\"\r\n                  :key=\"i\"\r\n                  :style=\"{\r\n                    border: subVal.text === 'none' ? '0.3px solid white' : '',\r\n                    background: subVal.text === 'none' ? 'white' : '',\r\n                    height: subVal.text === 'none' ? '4px' : '',\r\n                    'padding-top': subVal.text === 'none' ? '0px' : '',\r\n                    outline: subVal.text === 'none' ? 'none' : '',\r\n                  }\"\r\n                  @mousedown.stop=\"subVal.disabled === false ? controlAction($event,value.id, subVal.id): controlDisable($event)\"\r\n                >\r\n                  <div>\r\n                    <FDSVGImage v-if=\"subVal.icon\" :name=\"subVal.icon\" />\r\n                  </div>\r\n                  <a v-if=\"subVal.text === 'none'\">\r\n                    <hr />\r\n                  </a>\r\n                  <a\r\n                    v-else\r\n                    href=\"#\"\r\n                    v-html=\"subVal.text\"\r\n                    :style=\"{ opacity: subVal.disabled ? 0.5 : 1 }\"\r\n                    >{{ subVal.text }}</a\r\n                  >\r\n                </li>\r\n              </ul>\r\n            </li>\r\n          </ul>\r\n          <div class=\"triangle-right\"></div>\r\n        </button>\r\n      </div>\r\n    </div>\r\n    <div></div>\r\n    <div></div>\r\n  </div>\r\n</template>\r\n\r\n<script lang=\"ts\">\r\nimport { Component, Vue, Prop, Emit } from 'vue-property-decorator'\r\nimport FDSVGImage from '@/FormDesigner/components/atoms/FDSVGImage/index.vue'\r\nimport { ControlPropertyData } from '@/FormDesigner/models/ControlsTableProperties/ControlPropertyData.ts'\r\n\r\nimport { Action, State } from 'vuex-class'\r\nimport {\r\n  IaddChildControls,\r\n  IaddControl,\r\n  IdeleteControl,\r\n  IselectControl,\r\n  IsetChildControls,\r\n  IupdateControl,\r\n  IupdateControlExtraData,\r\n  IupdateCopyControlList,\r\n  IupdateGroup\r\n} from '@/storeModules/fd/actions'\r\nimport { EventBus } from '@/FormDesigner/event-bus'\r\nimport FDCommonMethod from '@/api/abstract/FormDesigner/FDCommonMethod'\r\n\r\n@Component({\r\n  name: 'ContextMenu',\r\n  components: {\r\n    FDSVGImage\r\n  }\r\n})\r\nexport default class ContextMenu extends FDCommonMethod {\r\n  @Prop() values: Array<IControlContextMenu>;\r\n  @Prop() userFormId: string;\r\n  @Prop() containerId: string;\r\n  @Prop() keyEventName: string;\r\n  @Prop() controlId: string;\r\n  @Prop() selectedTab: number;\r\n  @Prop() data: controlData;\r\n  @Prop() groupStyleArray: Array<IGroupStyle>\r\n  @Prop() contextMenutype: string\r\n  @Prop() editTextRef: HTMLSpanElement | HTMLTextAreaElement\r\n  @Prop() copiedText: string\r\n  @Prop() textMenu: boolean\r\n\r\n  @State((state) => state.fd.selectedControls)\r\n  selectedControls!: fdState['selectedControls'];\r\n  @State((state: rootState) => state.fd.copyControlList)\r\n  copyControlList!: fdState['copyControlList'];\r\n  @State((state) => state.fd.userformData) userformData!: userformData;\r\n  @State((state) => state.fd.copiedControl) copiedControl!: userformData;\r\n  @State((state) => state.fd.groupedControls)\r\n  groupedControls!: fdState['groupedControls'];\r\n\r\n  @Action('fd/deleteControl') deleteControl!: (payload: IdeleteControl) => void;\r\n  @Action('fd/deleteCopiedControl') deleteCopiedControl!: (payload: IdeleteControl) => void;\r\n  @Action('fd/updateCopyControlList') updateCopyControlList!: (\r\n    payload: IupdateCopyControlList\r\n  ) => void;\r\n  @Action('fd/addControl') addControl!: (payload: IaddControl) => void;\r\n  @Action('fd/addCopiedControl') addCopiedControl!: (\r\n    payload: IaddControl\r\n  ) => void;\r\n  @Action('fd/selectControl') selectControl!: (payload: IselectControl) => void;\r\n  @Action('fd/updateGroup') updateGroup!: (payload: IupdateGroup) => void;\r\n  @Action('fd/updateControlExtraData') updateControlExtraData!: (\r\n    payload: IupdateControlExtraData\r\n  ) => void;\r\n  @Action('fd/updateControl') updateControl!: (payload: IupdateControl) => void;\r\n  @Action('fd/setChildControls') setChildControls!: (\r\n    payload: IsetChildControls\r\n  ) => void;\r\n  @Action('fd/addChildControls') addChildControls!: (\r\n    payload: IaddChildControls\r\n  ) => void;\r\n  controlAction (event: Event, controlActionName: string, subVal: string) {\r\n    if (this.textMenu === false) {\r\n      if (controlActionName === 'ID_COPY') {\r\n        this.copyControl('copy')\r\n      } else if (controlActionName === 'ID_DELETE') {\r\n        this.clickDelete()\r\n      } else if (controlActionName === 'ID_PASTE') {\r\n        this.pasteControl()\r\n      } else if (controlActionName === 'ID_CUT') {\r\n        this.cutControl()\r\n      } else if (controlActionName === 'ID_SELECTALL') {\r\n        this.selectAll()\r\n      } else if (controlActionName === 'ID_GROUP') {\r\n        this.groupControl()\r\n      } else if (controlActionName === 'ID_UNGROUP') {\r\n        this.unGroupControl()\r\n      } else if (controlActionName === 'ID_NEWPAGE') {\r\n        this.addNewPage()\r\n      } else if (controlActionName === 'ID_DELETEPAGE') {\r\n        this.deleteCurrentPage()\r\n      } else if (controlActionName === 'ID_CONTROLFORWARD') {\r\n        this.bringForward()\r\n      } else if (controlActionName === 'ID_CONTROLBACKWARD') {\r\n        this.bringBackward()\r\n      } else if (controlActionName === 'ID_OBJECTPROP') {\r\n        this.displayProp()\r\n      } else if (controlActionName === 'ID_RENAME') {\r\n        const selectedPageID = this.selectedControls[this.userFormId].selected[0]\r\n        EventBus.$emit(\r\n          'renamePage',\r\n          this.userFormId,\r\n          selectedPageID,\r\n          this.selectedTab,\r\n          this.userformData[this.userFormId][selectedPageID].type\r\n        )\r\n      } else if (controlActionName === 'ID_MOVE') {\r\n        const type = this.userformData[this.userFormId][this.controlId].type\r\n        if (type === 'MultiPage') {\r\n          EventBus.$emit('userFormTabOrder', this.userFormId, this.controlId, type)\r\n        } else {\r\n          EventBus.$emit('tabStripTabOrder', this.userFormId, this.controlId, type)\r\n        }\r\n      } else if (controlActionName === 'ID_TABORDER') {\r\n        EventBus.$emit('userFormTabOrder', this.userFormId, this.containerId, '')\r\n      } else if (\r\n        controlActionName === 'ID_ALIGN' ||\r\n      controlActionName === 'ID_MAKESAMESIZE'\r\n      ) {\r\n        this.controlAlignMent(subVal)\r\n      }\r\n    } else {\r\n      if (controlActionName === 'ID_COPY') {\r\n        this.copyText()\r\n      } else if (controlActionName === 'ID_DELETE') {\r\n        this.deleteText()\r\n      } else if (controlActionName === 'ID_PASTE') {\r\n        if (event instanceof MouseEvent) {\r\n          this.pasteText(event)\r\n        }\r\n      } else if (controlActionName === 'ID_CUT') {\r\n        this.cutText()\r\n      } else if (controlActionName === 'ID_OBJECTPROP') {\r\n        this.displayProp()\r\n      }\r\n    }\r\n    this.closeMenu()\r\n  }\r\n  cutText () {\r\n    document.execCommand('cut')\r\n  }\r\n  deleteText () {\r\n    document.execCommand('delete')\r\n  }\r\n  copyText () {\r\n    document.execCommand('copy')\r\n  }\r\n  pasteText (event: MouseEvent) {\r\n    const controlType = this.userformData[this.userFormId][this.controlId].type\r\n    const position = this.getCursorPos(event)\r\n    const length = position.endPosition - position.startPosition\r\n    let baseValue = this.editTextRef.innerHTML.split('')\r\n    baseValue.splice(position.startPosition, length)\r\n    const updateValue = baseValue.slice(0, position.startPosition).join('') + this.copiedText + baseValue.slice(position.startPosition).join('')\r\n    EventBus.$emit('updateText', updateValue)\r\n  }\r\n  getCursorPos (event: MouseEvent) {\r\n    let startPosition = 0\r\n    let endPosition = 0\r\n    const isSupported = typeof window.getSelection !== 'undefined'\r\n    if (isSupported) {\r\n      const selection = window.getSelection()!\r\n      if (selection.anchorOffset > selection.focusOffset) {\r\n        startPosition = selection.focusOffset\r\n        endPosition = selection.anchorOffset\r\n      } else if (selection.anchorOffset === selection.focusOffset) {\r\n        startPosition = selection.focusOffset\r\n        endPosition = selection.focusOffset\r\n      } else {\r\n        startPosition = selection.anchorOffset\r\n        endPosition = selection.focusOffset\r\n      }\r\n    }\r\n    return { startPosition: startPosition, endPosition: endPosition }\r\n  }\r\n  created () {\r\n    EventBus.$on('groupControl', (value: string) => {\r\n      if (this.selectedControls[this.userFormId].container[0] === this.containerId) {\r\n        if (value === 'group') {\r\n          this.groupControl()\r\n        } else if (value === 'ungroup') {\r\n          this.unGroupControl()\r\n        }\r\n      }\r\n    })\r\n  }\r\n  destroyed () {\r\n    EventBus.$off('groupControl')\r\n  }\r\n  @Emit('closeMenu')\r\n  closeMenu () {\r\n    return 0\r\n  }\r\n\r\n  displayProp () {\r\n    EventBus.$emit('dispProp', false)\r\n  }\r\n  createPageName (pageList: string[]) {\r\n    let lastControlId = 0\r\n    for (let i of pageList) {\r\n      if (i.indexOf('Page') !== -1) {\r\n        const IdNum = i.split('Page').pop() || '-1'\r\n        const pasreId = parseInt(IdNum, 10)\r\n        if (!isNaN(pasreId) && lastControlId < pasreId) {\r\n          lastControlId = pasreId\r\n        }\r\n      }\r\n    }\r\n    return lastControlId + 1\r\n  }\r\n  getPageCount (container: string) {\r\n    const pageList: string[] = []\r\n    for (const pageId of this.userformData[this.userFormId][container].controls) {\r\n      pageList.push(this.userformData[this.userFormId][pageId].properties.Name!)\r\n    }\r\n    const name = this.createPageName(pageList)\r\n    return name\r\n  }\r\n\r\n  addNewPage () {\r\n    const type = this.userformData[this.userFormId][this.controlId].type\r\n    if (type === 'TabStrip') {\r\n      const tabControlData = JSON.parse(\r\n        JSON.stringify(this.userformData[this.userFormId][this.controlId])\r\n      ).extraDatas.Tabs\r\n      let prevTabId = -1\r\n      const initialTabData: tabsItems = {\r\n        Name: '',\r\n        Caption: '',\r\n        ToolTip: '',\r\n        Accelerator: ''\r\n      }\r\n      if (tabControlData.length > 0) {\r\n        for (let i = 0; i < tabControlData.length; i++) {\r\n          const id = tabControlData[i].Name.split('Tab').pop() || '-1'\r\n          const parseId = parseInt(id, 10)\r\n          if (!isNaN(parseId) && prevTabId < parseId) {\r\n            prevTabId = parseId\r\n          }\r\n        }\r\n        prevTabId += 1\r\n        initialTabData.Name = `Tab${prevTabId}`\r\n        initialTabData.Caption = `Tab${prevTabId}`\r\n      } else {\r\n        initialTabData.Name = `Tab${1}`\r\n        initialTabData.Caption = `Tab${1}`\r\n      }\r\n      tabControlData.push(initialTabData)\r\n      this.updateControlExtraData({\r\n        userFormId: this.userFormId,\r\n        controlId: this.controlId,\r\n        propertyName: 'Tabs',\r\n        value: tabControlData\r\n      })\r\n      this.updateControl({\r\n        userFormId: this.userFormId,\r\n        controlId: this.controlId,\r\n        propertyName: 'Value',\r\n        value: prevTabId - 1\r\n      })\r\n    } else if (type === 'MultiPage') {\r\n      const parentId = this.controlId.split('MultiPage').pop()\r\n      const controlName = `Page${parentId}_`\r\n\r\n      let lastControlId = 0\r\n      const userformControlIds = Object.keys(this.userformData[this.userFormId])\r\n      for (let i = 0; i < userformControlIds.length; i++) {\r\n        if (userformControlIds[i].indexOf(controlName) !== -1) {\r\n          const IdNum =\r\n          userformControlIds[i].split(controlName).pop() || '-1'\r\n          const pasreId = parseInt(IdNum, 10)\r\n          if (!isNaN(pasreId) && lastControlId < pasreId) {\r\n            lastControlId = pasreId\r\n          }\r\n        }\r\n      }\r\n      const controlPropData = new ControlPropertyData()\r\n      let controlObj = controlPropData.data['Page']\r\n      const item = JSON.parse(JSON.stringify(controlObj!))\r\n      lastControlId += 1\r\n      item.properties.ID = `ID_${controlName}${lastControlId}`\r\n      const count = this.getPageCount(this.controlId)\r\n      item.properties.Caption = `Page${count}`\r\n      item.properties.Name = `Page${count}`\r\n      item.properties.Index = this.userformData[this.userFormId][this.controlId].controls.length\r\n      this.addControl({\r\n        userFormId: this.userFormId,\r\n        controlId: this.controlId,\r\n        addId: item.properties.ID,\r\n        item: item\r\n      })\r\n      this.updateControl({\r\n        userFormId: this.userFormId,\r\n        controlId: this.controlId,\r\n        propertyName: 'Value',\r\n        value: item.properties.Index\r\n      })\r\n      this.selectControl({\r\n        userFormId: this.userFormId,\r\n        select: {\r\n          container: this.getContainerList(item.properties.ID),\r\n          selected: [item.properties.ID]\r\n        }\r\n      })\r\n      EventBus.$emit('updateMultiPageValue')\r\n    }\r\n  }\r\n  bringForward () {\r\n    const userData = this.userformData[this.userFormId]\r\n    const highProrControl = []\r\n    const lowProrControl = []\r\n    const container = this.getContainerList(this.getSelectedControlsDatas![0])[0]\r\n    const containerControls = this.userformData[this.userFormId][container].controls\r\n    for (const index in containerControls) {\r\n      const cntrlData = this.userformData[this.userFormId][containerControls[index]]\r\n      if (cntrlData.type === 'MultiPage' || cntrlData.type === 'Frame' || cntrlData.type === 'ListBox') {\r\n        highProrControl.push(containerControls[index])\r\n      } else {\r\n        lowProrControl.push(containerControls[index])\r\n      }\r\n    }\r\n    let nextSelctedSeries: string[] = []\r\n    let nextHighControlSeries: string[] = []\r\n    const getSelControl = [...this.getSelectedControlsDatas!]\r\n    getSelControl.sort((a, b) => {\r\n      return userData[a].extraDatas!.zIndex! - userData[b].extraDatas!.zIndex!\r\n    })\r\n    for (const selControl of getSelControl!) {\r\n      const type = userData[selControl].type\r\n      const tempZIndex = userData[selControl].extraDatas!.zIndex!\r\n      const controlIndex = Object.keys(userData).findIndex((val: string, index: number) => {\r\n        return 'zIndex' in userData[val].extraDatas! && (userData[val].extraDatas!.zIndex === tempZIndex + 1)\r\n      })\r\n      const nextSelectedControl = controlIndex !== -1 ? Object.keys(userData)[controlIndex] : ''\r\n      const nextControlType = userData[nextSelectedControl].type\r\n      if (nextSelectedControl !== '' && !highProrControl.includes(nextSelectedControl)) {\r\n        if (getSelControl!.includes(nextSelectedControl)) {\r\n          if (!nextSelctedSeries.includes(selControl)) {\r\n            nextSelctedSeries.push(selControl)\r\n          }\r\n          if (!nextSelctedSeries.includes(nextSelectedControl)) {\r\n            nextSelctedSeries.push(nextSelectedControl)\r\n          }\r\n        } else {\r\n          if (Object.keys(nextSelctedSeries).length !== 0) {\r\n            const tempExchageIndex = userData[nextSelctedSeries[0]].extraDatas!.zIndex!\r\n            const swapTabIndex = userData[nextSelectedControl].extraDatas!.zIndex!\r\n            if (swapTabIndex <= userData[container].controls.length /* && swapTabIndex > 0 */) {\r\n              const index = userData[container].controls.findIndex(\r\n                (val) => userData[val].extraDatas!.zIndex === swapTabIndex\r\n              )\r\n              this.updateExtraDatas(userData[container].controls[index], 'zIndex', tempExchageIndex)\r\n              this.updateExtraDatas(nextSelctedSeries[0], 'zIndex', swapTabIndex - (nextSelctedSeries!.length - 1))\r\n            }\r\n            for (let j = 1; j < nextSelctedSeries.length; j++) {\r\n              const updateIndex = userData[nextSelctedSeries[j]].extraDatas!.zIndex! + 1\r\n              this.updateExtraDatas(nextSelctedSeries[j], 'zIndex', updateIndex)\r\n            }\r\n            nextSelctedSeries = []\r\n          } else {\r\n            const swapTabIndex = userData[nextSelectedControl].extraDatas!.zIndex!\r\n            if (swapTabIndex <= userData[container].controls.length /* && swapTabIndex > 0 */) {\r\n              const index = userData[container].controls.findIndex(\r\n                (val) => userData[val].extraDatas!.zIndex === swapTabIndex\r\n              )\r\n              this.updateExtraDatas(selControl, 'zIndex', swapTabIndex)\r\n              this.updateExtraDatas(nextSelectedControl, 'zIndex', tempZIndex)\r\n            }\r\n          }\r\n        }\r\n      } else {\r\n        if (getSelControl!.includes(nextSelectedControl) && (type === 'Frame' || type === 'MultiPage' || type === 'ListBox')) {\r\n          if (!nextHighControlSeries.includes(selControl)) {\r\n            nextHighControlSeries.push(selControl)\r\n          }\r\n          if (!nextHighControlSeries.includes(nextSelectedControl)) {\r\n            nextHighControlSeries.push(nextSelectedControl)\r\n          }\r\n        } else if (type === 'Frame' || type === 'MultiPage' || type === 'ListBox') {\r\n          if (Object.keys(nextHighControlSeries).length !== 0) {\r\n            const tempExchageIndex = userData[nextHighControlSeries[0]].extraDatas!.zIndex!\r\n            const swapTabIndex = userData[nextSelectedControl].extraDatas!.zIndex!\r\n            if (swapTabIndex <= userData[container].controls.length) {\r\n              const index = userData[container].controls.findIndex(\r\n                (val) => userData[val].extraDatas!.zIndex === swapTabIndex\r\n              )\r\n              this.updateExtraDatas(userData[container].controls[index], 'zIndex', tempExchageIndex)\r\n              this.updateExtraDatas(nextHighControlSeries[0], 'zIndex', swapTabIndex - (nextHighControlSeries!.length - 1))\r\n            }\r\n            for (let j = 1; j < nextHighControlSeries.length; j++) {\r\n              const updateIndex = userData[nextHighControlSeries[j]].extraDatas!.zIndex! + 1\r\n              this.updateExtraDatas(nextHighControlSeries[j], 'zIndex', updateIndex)\r\n            }\r\n            nextHighControlSeries = []\r\n          } else {\r\n            const swapTabIndex = userData[nextSelectedControl].extraDatas!.zIndex!\r\n            if (swapTabIndex <= userData[container].controls.length /* && swapTabIndex > 0 */) {\r\n              const index = userData[container].controls.findIndex(\r\n                (val) => userData[val].extraDatas!.zIndex === swapTabIndex\r\n              )\r\n              this.updateExtraDatas(selControl, 'zIndex', swapTabIndex)\r\n              this.updateExtraDatas(nextSelectedControl, 'zIndex', tempZIndex)\r\n            }\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n  bringBackward () {\r\n    const userData = this.userformData[this.userFormId]\r\n    const highProrControl = []\r\n    const lowProrControl = []\r\n    const container = this.getContainerList(this.getSelectedControlsDatas![0])[0]\r\n    const containerControls = this.userformData[this.userFormId][container].controls\r\n    for (const index in containerControls) {\r\n      const cntrlData = this.userformData[this.userFormId][containerControls[index]]\r\n      if (cntrlData.type === 'MultiPage' || cntrlData.type === 'Frame' || cntrlData.type === 'ListBox') {\r\n        highProrControl.push(containerControls[index])\r\n      } else {\r\n        lowProrControl.push(containerControls[index])\r\n      }\r\n    }\r\n    let nextSelctedSeries: string[] = []\r\n    let nextHighControlSeries: string[] = []\r\n    const getSelControl = [...this.getSelectedControlsDatas!]\r\n    getSelControl.sort((a, b) => {\r\n      return userData[a].extraDatas!.zIndex! - userData[b].extraDatas!.zIndex!\r\n    })\r\n    for (const selControl of getSelControl) {\r\n      const type = userData[selControl].type\r\n      const tempZIndex = userData[selControl].extraDatas!.zIndex!\r\n      const controlIndex = Object.keys(userData).findIndex((val: string, index: number) => {\r\n        return 'zIndex' in userData[val].extraDatas! && (userData[val].extraDatas!.zIndex === tempZIndex - 1)\r\n      })\r\n      const nextSelectedControl = controlIndex !== -1 ? Object.keys(userData)[controlIndex] : ''\r\n      const nextControlType = userData[nextSelectedControl].type\r\n      if (nextSelectedControl !== '' && !highProrControl.includes(selControl)) {\r\n        if (getSelControl!.includes(nextSelectedControl)) {\r\n          if (!nextSelctedSeries.includes(selControl)) {\r\n            nextSelctedSeries.push(selControl)\r\n          }\r\n          if (!nextSelctedSeries.includes(nextSelectedControl)) {\r\n            nextSelctedSeries.push(nextSelectedControl)\r\n          }\r\n        } else {\r\n          if (Object.keys(nextSelctedSeries).length !== 0) {\r\n            const tempExchageIndex = userData[nextSelctedSeries[0]].extraDatas!.zIndex!\r\n            const swapTabIndex = userData[nextSelectedControl].extraDatas!.zIndex!\r\n            if (swapTabIndex <= userData[container].controls.length && swapTabIndex > 0) {\r\n              const index = userData[container].controls.findIndex(\r\n                (val) => userData[val].extraDatas!.zIndex === swapTabIndex\r\n              )\r\n              this.updateExtraDatas(userData[container].controls[index], 'zIndex', tempExchageIndex)\r\n              this.updateExtraDatas(nextSelctedSeries[0], 'zIndex', (nextSelctedSeries!.length + 1) - swapTabIndex)\r\n            }\r\n            for (let j = 1; j < nextSelctedSeries.length; j++) {\r\n              const updateIndex = userData[nextSelctedSeries[j]].extraDatas!.zIndex! - 1\r\n              this.updateExtraDatas(nextSelctedSeries[j], 'zIndex', updateIndex)\r\n            }\r\n            nextSelctedSeries = []\r\n          } else {\r\n            const swapTabIndex = userData[nextSelectedControl].extraDatas!.zIndex!\r\n            if (swapTabIndex <= userData[container].controls.length && swapTabIndex > 0) {\r\n              const index = userData[container].controls.findIndex(\r\n                (val) => userData[val].extraDatas!.zIndex === swapTabIndex\r\n              )\r\n              this.updateExtraDatas(selControl, 'zIndex', swapTabIndex)\r\n              this.updateExtraDatas(nextSelectedControl, 'zIndex', tempZIndex)\r\n            }\r\n          }\r\n        }\r\n      } else if (!lowProrControl.includes(nextSelectedControl) && (type === 'Frame' || type === 'MultiPage' || type === 'ListBox')) {\r\n        if (getSelControl!.includes(nextSelectedControl)) {\r\n          if (!nextHighControlSeries.includes(selControl)) {\r\n            nextHighControlSeries.push(selControl)\r\n          }\r\n          if (!nextHighControlSeries.includes(nextSelectedControl)) {\r\n            nextHighControlSeries.push(nextSelectedControl)\r\n          }\r\n        } else {\r\n          if (Object.keys(nextHighControlSeries).length !== 0) {\r\n            const tempExchageIndex = userData[nextHighControlSeries[0]].extraDatas!.zIndex!\r\n            const swapTabIndex = userData[nextSelectedControl].extraDatas!.zIndex!\r\n            if (swapTabIndex <= userData[container].controls.length) {\r\n              const index = userData[container].controls.findIndex(\r\n                (val) => userData[val].extraDatas!.zIndex === swapTabIndex\r\n              )\r\n              this.updateExtraDatas(userData[container].controls[index], 'zIndex', tempExchageIndex)\r\n              this.updateExtraDatas(nextHighControlSeries[0], 'zIndex', (nextHighControlSeries!.length + 1) - swapTabIndex)\r\n            }\r\n            for (let j = 1; j < nextHighControlSeries.length; j++) {\r\n              const updateIndex = userData[nextHighControlSeries[j]].extraDatas!.zIndex! - 1\r\n              this.updateExtraDatas(nextHighControlSeries[j], 'zIndex', updateIndex)\r\n            }\r\n            nextHighControlSeries = []\r\n          } else {\r\n            const swapTabIndex = userData[nextSelectedControl].extraDatas!.zIndex!\r\n            if (swapTabIndex <= userData[container].controls.length && swapTabIndex > 0) {\r\n              const index = userData[container].controls.findIndex(\r\n                (val) => userData[val].extraDatas!.zIndex === swapTabIndex\r\n              )\r\n              this.updateExtraDatas(selControl, 'zIndex', swapTabIndex)\r\n              this.updateExtraDatas(nextSelectedControl, 'zIndex', tempZIndex)\r\n            }\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n  deletePageIndex (id: string) {\r\n    const userData = this.userformData[this.userFormId]\r\n    const container = this.selectedControls[this.userFormId].container[0]\r\n    const tempIndex = userData[id].properties!.Index!\r\n    for (const key in userData[container].controls) {\r\n      const controlZIndex = userData[userData[container].controls[key]].properties!.Index!\r\n      if (controlZIndex > tempIndex) {\r\n        this.updateControl({\r\n          userFormId: this.userFormId,\r\n          controlId: userData[container].controls[key],\r\n          propertyName: 'Index',\r\n          value: controlZIndex - 1\r\n        })\r\n      }\r\n    }\r\n  }\r\n  deleteCurrentPage () {\r\n    const type = this.userformData[this.userFormId][this.controlId].type\r\n    if (type === 'TabStrip') {\r\n      const tabControlData = JSON.parse(\r\n        JSON.stringify(this.userformData[this.userFormId][this.controlId])\r\n      ).extraDatas.Tabs\r\n      if (tabControlData && tabControlData.length > 0) {\r\n        tabControlData.splice(this.selectedTab, 1)\r\n        this.updateControlExtraData({\r\n          userFormId: this.userFormId,\r\n          controlId: this.controlId,\r\n          propertyName: 'Tabs',\r\n          value: tabControlData\r\n        })\r\n        this.updateTabStripValue(this.selectedTab! - 1)\r\n      }\r\n    } else if (type === 'MultiPage') {\r\n      const controls = this.userformData[this.userFormId][this.controlId].controls\r\n      if (controls.length > 0) {\r\n        this.deletePageIndex(this.selectedControls[this.userFormId].selected[0])\r\n        const index = this.userformData[this.userFormId][this.selectedControls[this.userFormId].selected[0]].properties.Index\r\n        this.deleteControl({\r\n          userFormId: this.userFormId,\r\n          parentId: this.selectedControls[this.userFormId].container[0],\r\n          targetId: this.selectedControls[this.userFormId].selected[0]\r\n        })\r\n        this.updateIndex(index! - 1)\r\n      }\r\n      EventBus.$emit('updateMultiPageValue')\r\n    }\r\n  }\r\n  updateTabStripValue (index: number) {\r\n    const userData = this.userformData[this.userFormId]\r\n    const tabs = userData[this.controlId].extraDatas!.Tabs!\r\n    const tabIndex = tabs.findIndex((val, key) => key === index + 1)\r\n    if (tabIndex !== -1) {\r\n      const value = index + 1\r\n      this.updateControlProperty('Value', value, this.controlId)\r\n    } else if (tabIndex === -1 && index !== -1) {\r\n      const value = index\r\n      this.updateControlProperty('Value', value, this.controlId)\r\n    } else {\r\n      this.updateControlProperty('Value', -1, this.controlId)\r\n    }\r\n  }\r\n  changeSelect (control: string) {\r\n    this.selectControl({\r\n      userFormId: this.userFormId,\r\n      select: {\r\n        container: this.getContainerList(control),\r\n        selected: [control]\r\n      }\r\n    })\r\n  }\r\n  updateIndex (index: number) {\r\n    const userData = this.userformData[this.userFormId]\r\n    const controls = userData[this.controlId].controls\r\n    const pageIndex = controls.findIndex(val => userData[val].properties.Index === index + 1)\r\n    if (pageIndex !== -1) {\r\n      const value = userData[controls[pageIndex]].properties.Index!\r\n      this.updateControlProperty('Value', value, this.controlId)\r\n      this.changeSelect(controls[pageIndex])\r\n    } else if (pageIndex === -1 && index !== -1) {\r\n      const updateIndex = controls.findIndex(val => userData[val].properties.Index === index)\r\n      const value = userData[controls[updateIndex]].properties.Index!\r\n      this.updateControlProperty('Value', value, this.controlId)\r\n      this.changeSelect(controls[updateIndex])\r\n    } else {\r\n      this.updateControlProperty('Value', -1, this.controlId)\r\n      this.changeSelect(this.controlId)\r\n    }\r\n  }\r\n  updateControlProperty (\r\n    propertyName: keyof controlProperties,\r\n    propertyValue: number | string,\r\n    controlId: string\r\n  ) {\r\n    this.updateControl({\r\n      userFormId: this.userFormId,\r\n      controlId: controlId,\r\n      propertyName: propertyName,\r\n      value: propertyValue\r\n    })\r\n  }\r\n\r\n  unGroupControl () {\r\n    const isGroup = this.selectedControls[this.userFormId].selected[0].startsWith('group')\r\n    const selControl = this.selectedControls[this.userFormId].selected[0]\r\n    const selected = isGroup\r\n      ? selControl\r\n      : this.userformData[this.userFormId][selControl].properties.GroupID!\r\n\r\n    const controlList = []\r\n    for (const key in this.userformData[this.userFormId]) {\r\n      const type = this.userformData[this.userFormId][key].type\r\n      if (\r\n        type !== 'Userform' &&\r\n        this.userformData[this.userFormId][key].properties.GroupID === selected\r\n      ) {\r\n        controlList.push(key)\r\n      }\r\n    }\r\n    const groupArray = [...this.groupedControls[this.userFormId]!.groupArray!]\r\n    this.updateControlGroupID(selected, '')\r\n    const index = this.groupedControls[this.userFormId]!.groupArray!.findIndex(\r\n      (val) => val === selected\r\n    )\r\n    groupArray.splice(index, 1)\r\n    this.updateGroup({ userFormId: this.userFormId, groupArray: groupArray })\r\n    this.selectControl({\r\n      userFormId: this.userFormId,\r\n      select: {\r\n        container: isGroup\r\n          ? this.getContainerList(controlList[0])\r\n          : this.getContainerList(selControl[0]),\r\n        selected: isGroup ? controlList : [selControl]\r\n      }\r\n    })\r\n  }\r\n\r\n  /**\r\n   * @description To generate new GroupID\r\n   * @function createGroupId\r\n   */\r\n  createGroupId () {\r\n    let lastControlId = 0\r\n    for (let i of this.groupedControls[this.userFormId]!.groupArray!) {\r\n      if (i.indexOf('group') !== -1) {\r\n        const IdNum = i.split('group').pop() || '-1'\r\n        const pasreId = parseInt(IdNum, 10)\r\n        if (!isNaN(pasreId) && lastControlId < pasreId) {\r\n          lastControlId = pasreId\r\n        }\r\n      }\r\n    }\r\n    return `group${lastControlId + 1}`\r\n  }\r\n\r\n  @Emit('createGroup')\r\n  createGroup (groupId: string) {\r\n    return groupId\r\n  }\r\n\r\n  updateControlGroupID (groupName: string, updateGroupId: string) {\r\n    for (const val in this.userformData[this.userFormId]) {\r\n      if (!val.startsWith('ID_USERFORM')) {\r\n        const controlGrpId = this.userformData[this.userFormId][val].properties\r\n          .GroupID\r\n        if (controlGrpId === groupName) {\r\n          this.updateControlProperty('GroupID', updateGroupId, val)\r\n        }\r\n      }\r\n    }\r\n  }\r\n  /**\r\n   * @description To update the group Information in main data\r\n   * @function groupControl\r\n   */\r\n  groupControl () {\r\n    let updateGroupId: string = ''\r\n    const selected = this.selectedControls[this.userFormId].selected\r\n\r\n    const selectedGroupArray = selected.filter(\r\n      (val: string) => val.startsWith('group') && val\r\n    )\r\n    updateGroupId = selectedGroupArray[0]\r\n    if (selectedGroupArray.length >= 2) {\r\n      const groupArray = [\r\n        ...this.groupedControls[this.userFormId]!.groupArray!\r\n      ]\r\n      for (let i = 0; i < groupArray.length; i++) {\r\n        for (let j = 0; j < selectedGroupArray.length; j++) {\r\n          if (selectedGroupArray[j] === groupArray[i]) {\r\n            this.updateControlGroupID(groupArray[i], selectedGroupArray[0])\r\n            groupArray.splice(i, 1)\r\n          }\r\n        }\r\n      }\r\n      this.updateGroup({\r\n        userFormId: this.userFormId,\r\n        groupArray: [...groupArray, selectedGroupArray[0]]\r\n      })\r\n      updateGroupId = selectedGroupArray[0]!\r\n    } else if (selectedGroupArray.length === 0) {\r\n      updateGroupId = this.createGroupId()\r\n      const groupArray = [\r\n        ...this.groupedControls[this.userFormId]!.groupArray!,\r\n        updateGroupId\r\n      ]\r\n      this.updateGroup({ userFormId: this.userFormId, groupArray: groupArray })\r\n    }\r\n\r\n    for (let val of selected) {\r\n      if (!val.startsWith('group')) {\r\n        this.updateControlProperty('GroupID', updateGroupId, val)\r\n      }\r\n    }\r\n    this.createGroup(updateGroupId)\r\n    this.selectControl({\r\n      userFormId: this.userFormId,\r\n      select: {\r\n        container: this.getContainerList(updateGroupId),\r\n        selected: [updateGroupId]\r\n      }\r\n    })\r\n  }\r\n\r\n  /**\r\n   * @description To select all the controls in respective container present in respective userform\r\n   * @function selectAll\r\n   */\r\n  selectAll () {\r\n    // const selecetedContainer = this.selectedControls[this.userFormId].container[0]\r\n    const controlObjectList = [\r\n      ...this.userformData[this.userFormId][this.containerId].controls\r\n    ]\r\n    const selecedGroup: string[] = []\r\n    for (const val of controlObjectList) {\r\n      const controlGroupId: string = this.userformData[this.userFormId][val]\r\n        .properties.GroupID!\r\n      if (controlGroupId && controlGroupId !== '') {\r\n        !selecedGroup.includes(controlGroupId)! &&\r\n          selecedGroup.push(controlGroupId)\r\n      } else {\r\n        selecedGroup.push(val)\r\n      }\r\n    }\r\n\r\n    if (controlObjectList.length !== 0) {\r\n      this.selectControl({\r\n        userFormId: this.userFormId,\r\n        select: {\r\n          container: this.getContainerList(selecedGroup[0]),\r\n          selected: [...selecedGroup]\r\n        }\r\n      })\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @description To update the cutted controls in respective container present in respective userform\r\n   * @function cutControl\r\n   */\r\n  cutControl () {\r\n    this.copyControl('cut')\r\n    this.clickDelete()\r\n  }\r\n\r\n  /**\r\n   * @description To update the copied controls in respective container present in respective userform\r\n   * @function copyControl\r\n   */\r\n  copyControl (type: string) {\r\n    if (this.copiedControl[this.userFormId][this.userFormId].controls.length > 0) {\r\n      const lengthCount = this.copiedControl[this.userFormId][this.userFormId].controls.length\r\n      const controls = [...this.copiedControl[this.userFormId][this.userFormId].controls]\r\n      for (let i = 0; i < lengthCount; i++) {\r\n        this.deleteCopiedControl({\r\n          userFormId: this.userFormId,\r\n          parentId: this.userFormId,\r\n          targetId: controls[i]\r\n        })\r\n      }\r\n    }\r\n    const userFormData = this.userformData[this.userFormId]\r\n    const selContainer = this.selectedControls[this.userFormId].container[0]\r\n    const selSelected = this.selectedControls[this.userFormId].selected\r\n    const updateSelected = []\r\n    for (let control of selSelected) {\r\n      if (!control.startsWith('group') && userFormData[control].type === 'Page') {\r\n        control = this.getContainerList(control)[0]\r\n      }\r\n      updateSelected.push(control)\r\n    }\r\n    this.updateCopyControlList({\r\n      userFormId: this.userFormId,\r\n      parentId: selContainer,\r\n      targetId: updateSelected,\r\n      type: type\r\n    })\r\n\r\n    const recCopyControl = (daTarget: string) => {\r\n      const daTargetControls = userFormData[daTarget].controls\r\n      if (daTargetControls.length > 0) {\r\n        for (let i in daTargetControls) {\r\n          const controlObject = JSON.parse(JSON.stringify(userFormData[daTargetControls[i]]))\r\n          const controlArray = []\r\n          const ctrlObj = { ...controlObject, controls: [] }\r\n          this.addCopiedControl({\r\n            userFormId: this.userFormId,\r\n            controlId: daTarget,\r\n            addId: daTargetControls[i],\r\n            item: ctrlObj\r\n          })\r\n          recCopyControl(daTargetControls[i])\r\n        }\r\n      }\r\n    }\r\n\r\n    for (let key of selSelected) {\r\n      if (!key.startsWith('group')) {\r\n        if (userFormData[key].type === 'Page') {\r\n          key = this.getContainerList(key)[0]\r\n        }\r\n        const controlObject = JSON.parse(JSON.stringify(userFormData[key]))\r\n        const ctrlObj = { ...controlObject, controls: [] }\r\n        this.addCopiedControl({\r\n          userFormId: this.userFormId,\r\n          controlId: this.userFormId,\r\n          addId: key,\r\n          item: ctrlObj\r\n        })\r\n        recCopyControl(key)\r\n      } else {\r\n        for (let ctrlId in userFormData) {\r\n          const controlProp = userFormData[ctrlId].properties.GroupID\r\n          if (controlProp) {\r\n            if (controlProp === key) {\r\n              const controlObject = JSON.parse(\r\n                JSON.stringify(userFormData[ctrlId])\r\n              )\r\n              const ctrlObj = { ...controlObject, controls: [] }\r\n              this.addCopiedControl({\r\n                userFormId: this.userFormId,\r\n                controlId: this.userFormId,\r\n                addId: ctrlId,\r\n                item: ctrlObj\r\n              })\r\n              recCopyControl(ctrlId)\r\n            }\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n  updateNewControl (parentId: string, ctrlId: string, ctrlObj: controlData, isParent: boolean) {\r\n    this.addControl({\r\n      userFormId: this.userFormId,\r\n      controlId: parentId,\r\n      addId: ctrlId,\r\n      item: ctrlObj\r\n    })\r\n    if (isParent) {\r\n      const newTabIndex = this.userformData[this.userFormId][parentId].controls.length\r\n      this.updateTabIndexValue(ctrlId)\r\n      this.updateZIndexValue(ctrlId)\r\n    }\r\n  }\r\n\r\n  newPasteControlId (key: string, parentId: string) {\r\n    const userFormData = this.userformData[this.userFormId]\r\n    let lastControlId = 0\r\n    const type = key in userFormData ? userFormData[key].type : ''\r\n    const parentName = parentId !== '' ? parentId.split('MultiPage').pop() : -1\r\n    const selectedControlName: string | undefined =\r\n    type === 'Page'\r\n      ? `Page${parentName}_`\r\n      : key.replace(/[0-9]/g, '').split('_').pop()\r\n    const userformControlIds = Object.keys(userFormData)\r\n    for (let i = 0; i < userformControlIds.length; i++) {\r\n      if (userformControlIds[i].indexOf(selectedControlName!) !== -1) {\r\n        const IdNum = userformControlIds[i].split(selectedControlName!).pop() || '-1'\r\n        const pasreId = parseInt(IdNum, 10)\r\n        if (!isNaN(pasreId) && lastControlId < pasreId) {\r\n          lastControlId = pasreId\r\n        }\r\n      }\r\n    }\r\n    lastControlId += 1\r\n    const Name = `${selectedControlName}${lastControlId}`\r\n    return Name\r\n  }\r\n  removeChildControl (daTarget: string, deleteControl: string) {\r\n    const removeControl = [...this.userformData[this.userFormId][daTarget].controls]\r\n    const removeIndex = removeControl.findIndex((val) => val === deleteControl)\r\n    removeControl.splice(removeIndex, 1)\r\n    this.setChildControls({\r\n      userFormId: this.userFormId,\r\n      containerId: daTarget,\r\n      targetControls: removeControl\r\n    })\r\n  }\r\n  getPasteControlSize () {\r\n    const usrFrmData = this.userformData[this.userFormId]\r\n    const pasteControls = [...this.getSelectedControlsDatas!]\r\n    const pasteContainer = this.selectedControls[this.userFormId].container[0]\r\n    const leftArray = [...pasteControls]\r\n    const topArray = [...pasteControls]\r\n    const rightArray = [...pasteControls]\r\n    const bottomArray = [...pasteControls]\r\n    leftArray.sort((a, b) => {\r\n      return usrFrmData[a].properties.Left! - usrFrmData[b].properties.Left!\r\n    })\r\n    topArray.sort((a, b) => {\r\n      return usrFrmData[a].properties.Top! - usrFrmData[b].properties.Top!\r\n    })\r\n    rightArray.sort((a, b) => {\r\n      return (usrFrmData[b].properties.Left! + usrFrmData[b].properties.Width!) -\r\n       (usrFrmData[a].properties.Left! + usrFrmData[a].properties.Width!)\r\n    })\r\n    bottomArray.sort((a, b) => {\r\n      return (usrFrmData[b].properties.Top! + usrFrmData[b].properties.Height!) -\r\n       (usrFrmData[a].properties.Top! + usrFrmData[a].properties.Height!)\r\n    })\r\n    const groupRectLeft = usrFrmData[leftArray[0]].properties.Left!\r\n    const groupRectTop = usrFrmData[topArray[0]].properties.Top!\r\n    const groupRectBottom = usrFrmData[bottomArray[0]].properties.Top! + usrFrmData[bottomArray[0]].properties.Height!\r\n    const groupRectRight = usrFrmData[rightArray[0]].properties.Left! + usrFrmData[rightArray[0]].properties.Width!\r\n\r\n    const deltaTop = (groupRectBottom - groupRectTop) / 2\r\n    const deltaLeft = (groupRectRight - groupRectLeft) / 2\r\n\r\n    const type = this.userformData[this.userFormId][pasteContainer].type\r\n    const container = type === 'Page' ? this.userformData[this.userFormId][this.getContainerList(pasteContainer)[0]].properties : this.userformData[this.userFormId][pasteContainer].properties\r\n    const containerHeight = type === 'Userform' ? container.Height! - 37 : container.Height!\r\n    const targetTop = ((containerHeight) / 2) - deltaTop\r\n    const targetLeft = (container.Width! / 2) - deltaLeft\r\n\r\n    const diffTop = targetTop - usrFrmData[topArray[0]].properties.Top!\r\n    const diffLeft = targetLeft - usrFrmData[leftArray[0]].properties.Left!\r\n\r\n    for (let i = 0; i < leftArray.length; i++) {\r\n      let left = usrFrmData[leftArray[i]].properties.Left! + diffLeft\r\n      if (!isNaN(left)) {\r\n        this.updateControlProperty('Left', Math.abs(left), leftArray[i])\r\n      }\r\n    }\r\n    for (let i = 0; i < topArray.length; i++) {\r\n      let top = usrFrmData[topArray[i]].properties.Top! + diffTop\r\n      if (!isNaN(top)) {\r\n        this.updateControlProperty('Top', Math.abs(top), topArray[i])\r\n      }\r\n    }\r\n  }\r\n  /**\r\n   * @description To paste controls in respective container present in respective userform\r\n   * @function pasteControl\r\n   */\r\n  pasteControl () {\r\n    if (this.copyControlList.type === 'copy') {\r\n      const selContainer = this.copyControlList.parentId\r\n      const selSelected = this.copyControlList.targetId\r\n      const userFormData = this.userformData[this.userFormId]\r\n      const presentGroupId: string[] = []\r\n      const newGroupId: string[] = []\r\n      const oldControlId: string[] = []\r\n      const newControlId: string[] = []\r\n\r\n      for (const key in this.copiedControl[this.userFormId]) {\r\n        const controlProp = this.copiedControl[this.userFormId][key].properties.GroupID\r\n        if (controlProp && !presentGroupId.includes(controlProp)) {\r\n          presentGroupId.push(controlProp)\r\n        }\r\n      }\r\n      for (let j in presentGroupId) {\r\n        const newId = this.createGroupId()\r\n        newGroupId.push(newId)\r\n        let groupArray: string[] = [\r\n          ...this.groupedControls[this.userFormId]!.groupArray!,\r\n          newId\r\n        ]\r\n        this.updateGroup({\r\n          userFormId: this.userFormId,\r\n          groupArray: groupArray!\r\n        })\r\n      }\r\n\r\n      const recCopyControl = (daTarget: string) => {\r\n        const daTargetControls = userFormData[daTarget].controls\r\n        if (daTargetControls && daTargetControls.length > 0) {\r\n          for (let i = 0, limit = daTargetControls.length; i < limit; i++) {\r\n            const key = daTargetControls[i]\r\n            const Name = this.newPasteControlId(key, daTarget)\r\n            const controlID:| string| undefined = `ID_${Name}`\r\n            const controlObj = { ...this.copiedControl[this.userFormId][key] }\r\n            let groupIdIndex = -1\r\n            groupIdIndex = presentGroupId.findIndex((val) => val === controlObj.properties.GroupID)\r\n            const item: controlData = {\r\n              ...controlObj,\r\n              properties: {\r\n                ...controlObj.properties,\r\n                ID: controlID!,\r\n                GroupID: groupIdIndex !== -1 ? newGroupId[groupIdIndex] : '',\r\n                Name: Name\r\n              }\r\n            }\r\n            this.removeChildControl(daTarget, key)\r\n            this.updateNewControl(daTarget, controlID, item, false)\r\n            recCopyControl(controlID)\r\n          }\r\n        }\r\n      }\r\n\r\n      for (const key of selSelected) {\r\n        if (!key.startsWith('group')) {\r\n          oldControlId.push(key)\r\n          const Name = this.newPasteControlId(key, '')\r\n          const controlID:| string| undefined = `ID_${Name}`\r\n          const controlObj = { ...this.copiedControl[this.userFormId][key] }\r\n          newControlId.push(controlID)\r\n          let groupIdIndex = -1\r\n          groupIdIndex = presentGroupId.findIndex(\r\n            (val) => controlObj.properties.GroupID === val\r\n          )\r\n          if (selSelected.length === 1 && this.copiedControl[this.userFormId][selSelected[0]].properties.GroupID !== '') {\r\n            groupIdIndex = -1\r\n          }\r\n          const item: controlData = {\r\n            ...controlObj,\r\n            properties: {\r\n              ...controlObj.properties,\r\n              ID: controlID!,\r\n              GroupID: groupIdIndex !== -1 ? newGroupId[groupIdIndex] : '',\r\n              Name: Name\r\n            }\r\n          }\r\n          this.updateNewControl(this.containerId, controlID, item, true)\r\n          recCopyControl(controlID)\r\n        } else {\r\n          for (let ctrlId in this.copiedControl[this.userFormId]) {\r\n            const controlProp = this.copiedControl[this.userFormId][ctrlId]\r\n              .properties.GroupID\r\n            if (controlProp) {\r\n              if (controlProp === key) {\r\n                const Name = this.newPasteControlId(ctrlId, '')\r\n                const controlID:| string| undefined = `ID_${Name}`\r\n                const controlObj = this.copiedControl[this.userFormId][ctrlId]\r\n\r\n                let groupIdIndex = -1\r\n                groupIdIndex = presentGroupId.findIndex(\r\n                  (val) => controlObj.properties.GroupID === val\r\n                )\r\n                const item: controlData = {\r\n                  ...controlObj,\r\n                  properties: {\r\n                    ...controlObj.properties,\r\n                    ID: controlID!,\r\n                    GroupID: groupIdIndex !== -1 ? newGroupId[groupIdIndex] : '',\r\n                    Name: Name\r\n                  }\r\n                }\r\n                this.updateNewControl(this.containerId, controlID, item, true)\r\n                recCopyControl(controlID)\r\n              }\r\n            }\r\n          }\r\n        }\r\n      }\r\n      for (let j of newGroupId) {\r\n        this.createGroup(j)\r\n      }\r\n      const newSelected: string[] = []\r\n      for (const control of selSelected) {\r\n        if (control.startsWith('group')) {\r\n          const index = presentGroupId.findIndex((val) => val === control)\r\n          newSelected.push(newGroupId[index])\r\n        } else {\r\n          const index = oldControlId.findIndex((val) => val === control)\r\n          newSelected.push(newControlId[index])\r\n        }\r\n      }\r\n      this.selectControl({\r\n        userFormId: this.userFormId,\r\n        select: {\r\n          container: this.getContainerList(newSelected[0]),\r\n          selected: newSelected\r\n        }\r\n      })\r\n    } else if (this.copyControlList.type === 'cut') {\r\n      const selContainer = this.copyControlList.parentId\r\n      const selSelected = this.copyControlList.targetId\r\n      const userFormData = this.copiedControl[this.userFormId]\r\n      const recCopyControl = (daTarget: string) => {\r\n        const daTargetControls = userFormData[daTarget].controls\r\n        if (daTargetControls.length > 0) {\r\n          for (let i = 0, limit = daTargetControls.length; i < limit; i++) {\r\n            const key = daTargetControls[i]\r\n            const controlObj = JSON.parse(JSON.stringify(this.copiedControl[this.userFormId][key]))\r\n            const item: controlData = {\r\n              ...controlObj\r\n            }\r\n            this.removeChildControl(daTarget, key)\r\n            this.updateNewControl(daTarget, key, item, false)\r\n            recCopyControl(key)\r\n          }\r\n        }\r\n      }\r\n      for (const key of selSelected) {\r\n        if (!key.startsWith('group')) {\r\n          const controlObj = JSON.parse(\r\n            JSON.stringify(this.copiedControl[this.userFormId][key])\r\n          )\r\n          if (selSelected.length === 1 && userFormData[selSelected[0]].properties.GroupID! !== '') {\r\n            controlObj.properties.GroupID = ''\r\n          }\r\n          const item: controlData = {\r\n            ...controlObj\r\n          }\r\n          this.updateNewControl(this.containerId, key, item, true)\r\n          recCopyControl(key)\r\n        } else {\r\n          for (let ctrlId in userFormData) {\r\n            const controlProp = userFormData[ctrlId].properties.GroupID\r\n            if (controlProp) {\r\n              if (controlProp === key) {\r\n                const controlObj = JSON.parse(\r\n                  JSON.stringify(this.copiedControl[this.userFormId][ctrlId])\r\n                )\r\n                const item: controlData = {\r\n                  ...controlObj\r\n                }\r\n                this.updateNewControl(this.containerId, ctrlId, item, true)\r\n                recCopyControl(ctrlId)\r\n              }\r\n            }\r\n          }\r\n        }\r\n      }\r\n      this.selectControl({\r\n        userFormId: this.userFormId,\r\n        select: {\r\n          container: this.getContainerList(selSelected[0]),\r\n          selected: selSelected\r\n        }\r\n      })\r\n      this.updateCopyControlList({\r\n        userFormId: this.userFormId,\r\n        parentId: this.containerId,\r\n        targetId: selSelected,\r\n        type: 'copy'\r\n      })\r\n    }\r\n    this.getPasteControlSize()\r\n    const selSelected = this.selectedControls[this.userFormId].selected\r\n    for (const control of selSelected) {\r\n      if (control.startsWith('group')) {\r\n        this.createGroup(control)\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @description To delete controls in respective container present in respective userform\r\n   * @function clickDelete\r\n   */\r\n  clickDelete () {\r\n    const selControl = []\r\n    const userData = this.userformData[this.userFormId]\r\n    const selected = this.selectedControls[this.userFormId].selected\r\n    const selContainer = this.selectedControls[this.userFormId].container\r\n    const filterControls = []\r\n    const controls = this.userformData[this.userFormId][this.selectedControls[this.userFormId].container[0]].controls\r\n    for (const control of selected) {\r\n      if (!control.startsWith('ID_USERFORM')) {\r\n        if (control.startsWith('group')) {\r\n          for (const key in userData) {\r\n            if (\r\n              userData[key].properties.GroupID === control\r\n            ) {\r\n              selControl.push(key)\r\n            }\r\n          }\r\n        } else {\r\n          selControl.push(control)\r\n        }\r\n      }\r\n    }\r\n    if (selected.length === 1 && !selected[0].startsWith('group') && this.userformData[this.userFormId][selected[0]].properties.GroupID !== '') {\r\n      for (let j = 0; j < controls.length; j++) {\r\n        if (userData[controls[j]].properties.GroupID === userData[selected[0]].properties.GroupID) {\r\n          filterControls.push(controls[j])\r\n        }\r\n      }\r\n      if (filterControls.length === 2) {\r\n        const curSelect = filterControls[0] === selected[0] ? filterControls[1] : filterControls[0]\r\n        const selGroupId = userData[selected[0]].properties.GroupID\r\n        this.updateControlProperty('GroupID', '', curSelect)\r\n      }\r\n    }\r\n    for (let i = 0; i < selControl.length; i++) {\r\n      const controlId = userData[selControl[i]].type === 'Page' ? selContainer[0] : selControl[i]\r\n      this.deleteZIndex(controlId)\r\n      this.deleteTabIndex(controlId)\r\n      this.deleteControl({\r\n        userFormId: this.userFormId,\r\n        parentId: this.getContainerList(controlId)[0],\r\n        targetId: controlId\r\n      })\r\n    }\r\n\r\n    this.selectControl({\r\n      userFormId: this.userFormId,\r\n      select: {\r\n        container: userData[selContainer[0]].type === 'MultiPage' ? this.getContainerList(selContainer[0]) : selContainer,\r\n        selected: userData[selContainer[0]].type === 'MultiPage' ? [this.getContainerList(selContainer[0])[0]] : [selContainer[0]]\r\n      }\r\n    })\r\n    EventBus.$emit('focusUserForm')\r\n  }\r\n  updateAction (event: KeyboardEvent) {\r\n    let controlActionName = ''\r\n    if (event.ctrlKey && event.code === 'KeyA') {\r\n      controlActionName = 'ID_SELECTALL'\r\n    } else if (event.ctrlKey && event.code === 'KeyC') {\r\n      if (\r\n        this.selectedControls[this.userFormId].selected[0] !== this.userFormId\r\n      ) {\r\n        controlActionName = 'ID_COPY'\r\n      }\r\n    } else if (event.keyCode === 46) {\r\n      controlActionName = 'ID_DELETE'\r\n    } else if (event.ctrlKey && event.code === 'KeyV') {\r\n      controlActionName = 'ID_PASTE'\r\n    } else if (event.keyCode && event.code === 'KeyX') {\r\n      controlActionName = 'ID_CUT'\r\n    }\r\n    this.controlAction(event, controlActionName, '')\r\n  }\r\n  updatePropVal (propName: string, propValue: number) {\r\n    const ctrlSel = this.selectedControls[this.userFormId].selected\r\n    const usrFrmData = this.userformData[this.userFormId]\r\n    for (let index = 1; index < ctrlSel.length; index++) {\r\n      if (!ctrlSel[index].startsWith('group')) {\r\n        const curProp = usrFrmData[ctrlSel[index]].properties\r\n        if (propName === 'selRight') {\r\n          const curRight = curProp.Width! + curProp.Left!\r\n          const value = curProp.Left! + (propValue - curRight)\r\n          this.updateControlProperty('Left', value, ctrlSel[index])\r\n        } else if (propName === 'selBottom') {\r\n          const curBottom = curProp.Height! + curProp.Top!\r\n          const value = curProp.Top! + (propValue - curBottom)\r\n          this.updateControlProperty('Top', value, ctrlSel[index])\r\n        }\r\n        if (propName === 'selCenter') {\r\n          const curCenter = curProp.Width! / 2\r\n          const value = propValue - curCenter\r\n          this.updateControlProperty('Left', value, ctrlSel[index])\r\n        }\r\n        if (propName === 'selMiddle') {\r\n          const curMiddle = curProp.Height! / 2\r\n          const value = propValue - curMiddle\r\n          this.updateControlProperty('Top', value, ctrlSel[index])\r\n        } else {\r\n          const propertyname: keyof controlProperties = propName as keyof controlProperties\r\n          this.updateControlProperty(propertyname, propValue, ctrlSel[index])\r\n        }\r\n      } else {\r\n        const groupIndex: number = this.groupStyleArray.findIndex(val => val.groupName === ctrlSel[index])\r\n        const curProp = this.groupStyleArray[groupIndex]\r\n        const left = parseInt(curProp.left!)\r\n        const top = parseInt(curProp.top!)\r\n        const width = parseInt(curProp.width!)\r\n        const height = parseInt(curProp.height!)\r\n        let value = -1\r\n        if (propName === 'selRight') {\r\n          value = left! + (propValue - (width! + left!))\r\n          EventBus.$emit('updasteGroupSize', 'Left', value, groupIndex)\r\n        } else if (propName === 'selBottom') {\r\n          value = top! + (propValue - (height + top))\r\n          EventBus.$emit('updasteGroupSize', 'Top', value, groupIndex)\r\n        }\r\n        if (propName === 'selCenter') {\r\n          value = propValue - (width! / 2)\r\n          EventBus.$emit('updasteGroupSize', 'Left', value, groupIndex)\r\n        }\r\n        if (propName === 'selMiddle') {\r\n          value = propValue - height! / 2\r\n          EventBus.$emit('updasteGroupSize', 'Top', value, groupIndex)\r\n        } else {\r\n          const propertyname: keyof controlProperties = propName as keyof controlProperties\r\n          EventBus.$emit('updasteGroupSize', propertyname, propValue, groupIndex)\r\n        }\r\n      }\r\n    }\r\n  }\r\n  controlAlignMent (subVal: string) {\r\n    const mainSel = this.selectedControls[this.userFormId].selected[0]\r\n    const isGroup = mainSel.startsWith('group')\r\n    const usrFrmData = this.userformData[this.userFormId]\r\n    const ctrlProp = !isGroup && usrFrmData[mainSel].properties\r\n    const groupIndex: number = this.groupStyleArray.findIndex(val => val.groupName === mainSel)\r\n    const newObject = {\r\n      Left: isGroup && groupIndex !== -1 ? parseInt(this.groupStyleArray[groupIndex].left!) : ctrlProp ? ctrlProp.Left! : 0,\r\n      Top: isGroup && groupIndex !== -1 ? parseInt(this.groupStyleArray[groupIndex].top!) : ctrlProp ? ctrlProp.Top! : 0,\r\n      Width: isGroup && groupIndex !== -1 ? parseInt(this.groupStyleArray[groupIndex].width!) : ctrlProp ? ctrlProp.Width! : 0,\r\n      Height: isGroup && groupIndex !== -1 ? parseInt(this.groupStyleArray[groupIndex].height!) : ctrlProp ? ctrlProp.Height! : 0\r\n    }\r\n    if (subVal === 'ID_ALIGNLEFT') {\r\n      this.updatePropVal('Left', newObject.Left!)\r\n    } else if (subVal === 'ID_ALIGNTOP') {\r\n      this.updatePropVal('Top', newObject.Top!)\r\n    } else if (subVal === 'ID_ALIGNRIGHT') {\r\n      const selRight = newObject.Width! + newObject.Left!\r\n      this.updatePropVal('selRight', selRight)\r\n    } else if (subVal === 'ID_ALIGNBOTTOM') {\r\n      const selBottom = newObject.Height! + newObject.Top!\r\n      this.updatePropVal('selBottom', selBottom)\r\n    } else if (subVal === 'ID_ALIGNCENTER') {\r\n      const selCenter = newObject.Left! + newObject.Width! / 2\r\n      this.updatePropVal('selCenter', selCenter)\r\n    } else if (subVal === 'ID_ALIGNMIDDLE') {\r\n      const selMiddle = newObject.Top! + newObject.Height! / 2\r\n      this.updatePropVal('selMiddle', selMiddle)\r\n    } else if (subVal === 'ID_WIDTH') {\r\n      this.updatePropVal('Width', newObject.Width!)\r\n    } else if (subVal === 'ID_HEIGHT') {\r\n      this.updatePropVal('Height', newObject.Height!)\r\n    } else if (subVal === 'ID_BOTH') {\r\n      this.updatePropVal('Height', newObject.Height!)\r\n      this.updatePropVal('Width', newObject.Width!)\r\n    }\r\n  }\r\n\r\n  controlDisable (event: MouseEvent) {\r\n    event.preventDefault()\r\n    event.stopPropagation()\r\n  }\r\n}\r\n</script>\r\n\r\n<style scoped>\r\n.outercontext-div {\r\n  border: 0.3px solid black;\r\n  box-shadow: 2px 2px lightgray;\r\n  width: 150px;\r\n  height: auto;\r\n  font-size: 13px;\r\n  position: fixed;\r\n  z-index: 1000;\r\n}\r\n.wrapper-context {\r\n  display: grid;\r\n  grid-template-columns: 1fr;\r\n  width: 100%;\r\n  height: 100%;\r\n}\r\n.wrapper1-context {\r\n  display: grid;\r\n  grid-template-columns: 10% 90%;\r\n  border: 0.3px solid white;\r\n  background: white;\r\n  height: 24px;\r\n  padding-top: 5px;\r\n  outline: none;\r\n}\r\n.wrapper1-context:hover {\r\n  background-color: rgb(155, 215, 255);\r\n  border: 0.3px solid rgb(0, 153, 255);\r\n}\r\n.wrapper21 {\r\n  display: grid;\r\n  grid-template-columns: 10% 85% 5%;\r\n}\r\n.triangle-right {\r\n  width: 0;\r\n  height: 0;\r\n  border-top: 5px solid transparent;\r\n  border-left: 5px solid black;\r\n  border-bottom: 5px solid transparent;\r\n  padding-top: 2px;\r\n}\r\n.iset-context {\r\n  text-align: left;\r\n  padding-left: 15px;\r\n  font-size: 12px;\r\n}\r\n.set-context {\r\n  text-align: left;\r\n  padding-left: 15px;\r\n  font-size: 12px;\r\n}\r\nhr {\r\n  margin: 0px;\r\n}\r\nul {\r\n  list-style-type: none;\r\n  margin-block-start: 0em;\r\n  margin-block-end: 0em;\r\n  margin-inline-start: 0px;\r\n  margin-inline-end: 0px;\r\n  padding-inline-start: 0px;\r\n  margin-top: 0px;\r\n  margin-bottom: 0px;\r\n}\r\n\r\n/* testing submenu */\r\n\r\n.top-level-menu {\r\n  list-style: none;\r\n  padding: 0;\r\n  margin: 0;\r\n}\r\n\r\n.top-level-menu > li {\r\n  position: absolute;\r\n  float: left;\r\n  height: 30px;\r\n  width: 143px;\r\n}\r\n\r\n.top-level-menu li:hover > ul {\r\n  /* On hover, display the next level's menu */\r\n  display: inline;\r\n}\r\n\r\n/* Menu Link Styles */\r\n\r\n.top-level-menu a /* Apply to all links inside the multi-level menu */ {\r\n  font-size: 12px;\r\n  color: black;\r\n  text-decoration: none;\r\n  padding: 0 0 0 10px;\r\n  padding-left: 15px;\r\n\r\n  /* Make the link cover the entire list item-container */\r\n  display: block;\r\n}\r\n.top-level-menu a:hover {\r\n  color: black;\r\n}\r\n.third-level-menu {\r\n  position: absolute;\r\n  top: 0;\r\n  right: -100px;\r\n  width: 110px;\r\n  list-style: none;\r\n  padding: 0;\r\n  margin: 0;\r\n  display: none;\r\n  border: 1px solid black;\r\n  background-color: white;\r\n}\r\n\r\n.third-level-menu > li {\r\n  height: 20px;\r\n  padding-top: 5px;\r\n  /* margin: 1px; */\r\n}\r\n.third-level-menu > li:hover {\r\n  background-color: rgb(155, 215, 255);\r\n  border: 0.2px solid rgb(0, 153, 255);\r\n}\r\n.top-level-menu1 {\r\n  list-style: none;\r\n  padding: 0;\r\n  margin: 0;\r\n}\r\n\r\n.top-level-menu1 > li {\r\n  position: absolute;\r\n  float: left;\r\n  height: 30px;\r\n  width: 143px;\r\n}\r\n\r\n.top-level-menu1 li:hover > ul {\r\n  /* On hover, display the next level's menu */\r\n  display: inline;\r\n}\r\n\r\n/* Menu Link Styles */\r\n\r\n.top-level-menu1 a /* Apply to all links inside the multi-level menu */ {\r\n  font-size: 12px;\r\n  color: black;\r\n  text-decoration: none;\r\n  padding: 0 0 0 10px;\r\n  padding-left: 15px;\r\n\r\n  /* Make the link cover the entire list item-container */\r\n  display: block;\r\n}\r\n.top-level-menu1 a:hover {\r\n  color: black;\r\n}\r\n.third {\r\n  padding-left: 5px;\r\n}\r\n.third > a {\r\n  padding-left: 10px;\r\n}\r\n.icons {\r\n  margin-left: 3px;\r\n}\r\n</style>\r\n"]}]}